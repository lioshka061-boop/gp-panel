<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zero-to-Bot Panel</title>
  <style>
    :root {
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", sans-serif;
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top, rgba(70, 100, 255, 0.12), transparent 55%), #f4f6fb;
      color: #101828;
      display: flex;
      justify-content: center;
      padding: 32px 16px 48px;
      transition: background 0.3s ease, color 0.3s ease;
    }

    body[data-theme="dark"] {
      background: radial-gradient(circle at top, rgba(70, 100, 255, 0.16), transparent 60%), #060c18;
      color: #e5edff;
      color-scheme: dark;
    }

    #ztb-app {
      width: min(1120px, 100%);
      background: rgba(255, 255, 255, 0.9);
      border-radius: 24px;
      backdrop-filter: blur(14px);
      box-shadow: 0 28px 80px -40px rgba(15, 23, 42, 0.55);
      display: flex;
      flex-direction: column;
      min-height: 92vh;
      border: 1px solid rgba(70, 100, 255, 0.12);
      overflow: hidden;
      transition: background 0.3s ease, border-color 0.3s ease;
    }

    body[data-theme="dark"] #ztb-app {
      background: rgba(11, 18, 32, 0.88);
      border-color: rgba(70, 100, 255, 0.2);
      box-shadow: 0 32px 90px -46px rgba(4, 12, 28, 0.95);
    }

    header {
      padding: 22px 28px 12px;
      border-bottom: 1px solid rgba(15, 23, 42, 0.08);
      transition: border-color 0.3s ease;
    }

    body[data-theme="dark"] header {
      border-color: rgba(148, 163, 184, 0.16);
    }

    header .top-line {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 16px;
    }

    .brand {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .brand .logo {
      width: 52px;
      height: 52px;
      border-radius: 16px;
      display: grid;
      place-items: center;
      color: #fff;
      font-size: 22px;
      font-weight: 600;
      background: linear-gradient(120deg, #4664ff, #55a0ff);
    }

    .brand h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
    }

    .status-line {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .status-line .tag {
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 13px;
      background: rgba(70, 100, 255, 0.12);
      color: #1e3aff;
    }

    body[data-theme="dark"] .status-line .tag {
      background: rgba(70, 100, 255, 0.22);
      color: #9db4ff;
    }

    .controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    button,
    .btn {
      border: 1px solid rgba(15, 23, 42, 0.08);
      background: #fff;
      color: inherit;
      border-radius: 12px;
      padding: 10px 16px;
      font-size: 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
      transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease, background 0.18s ease;
      position: relative;
      overflow: hidden;
    }

    body[data-theme="dark"] button,
    body[data-theme="dark"] .btn {
      background: rgba(13, 24, 45, 0.9);
      border-color: rgba(148, 163, 184, 0.18);
    }

    button.primary,
    .btn.primary {
      border: none;
      color: #fff;
      background: linear-gradient(120deg, #4664ff, #55a0ff);
      font-weight: 600;
      box-shadow: 0 12px 28px -18px rgba(70, 100, 255, 0.75);
    }

    button.chat2 {
      background: rgba(85, 160, 255, 0.16);
      border-color: rgba(85, 160, 255, 0.32);
      color: #0f1f52;
    }

    body[data-theme="dark"] button.chat2 {
      background: rgba(85, 160, 255, 0.25);
      color: #eaf1ff;
    }

    button.ghost,
    .btn.ghost {
      background: transparent;
    }

    button:disabled {
      opacity: 0.65;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 16px 34px -24px rgba(15, 23, 42, 0.5);
    }

    button:active:not(:disabled) {
      transform: translateY(0) scale(0.98);
      box-shadow: inset 0 0 0 1px rgba(70, 100, 255, 0.25);
      background: rgba(70, 100, 255, 0.12);
    }

    button:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px rgba(70, 100, 255, 0.35);
    }

    .progress {
      margin-top: 16px;
      display: grid;
      gap: 8px;
    }

    .progress-label {
      font-size: 13px;
      color: rgba(15, 23, 42, 0.65);
    }

    body[data-theme="dark"] .progress-label {
      color: rgba(226, 232, 240, 0.7);
    }

    .progress-bar {
      height: 8px;
      background: rgba(70, 100, 255, 0.18);
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-bar span {
      display: block;
      height: 100%;
      width: 0;
      border-radius: inherit;
      background: linear-gradient(120deg, #4664ff, #55a0ff);
      transition: width 0.35s ease;
    }

    main {
      flex: 1;
      padding: 38px 36px 48px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .step-headline {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .step-headline h2 {
      margin: 0;
      font-size: 26px;
    }

    .step-headline p {
      margin: 0;
      color: rgba(15, 23, 42, 0.7);
      font-size: 15px;
      max-width: 640px;
    }

    body[data-theme="dark"] .step-headline p {
      color: rgba(226, 232, 240, 0.75);
    }

    .step-body {
      display: grid;
      gap: 20px;
    }

    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
    }

    .card {
      border: 1px solid rgba(15, 23, 42, 0.08);
      border-radius: 18px;
      padding: 18px;
      background: rgba(255, 255, 255, 0.8);
      display: grid;
      gap: 10px;
      cursor: pointer;
      transition: border-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
    }

    body[data-theme="dark"] .card {
      background: rgba(13, 24, 45, 0.8);
      border-color: rgba(148, 163, 184, 0.18);
    }

    .card:hover {
      transform: translateY(-2px);
      border-color: rgba(70, 100, 255, 0.6);
      box-shadow: 0 18px 38px -28px rgba(70, 100, 255, 0.4);
    }

    .card.active {
      border: 2px solid rgba(70, 100, 255, 0.9);
      box-shadow: 0 18px 42px -30px rgba(70, 100, 255, 0.55);
      background: rgba(70, 100, 255, 0.08);
    }

    body[data-theme="dark"] .card.active {
      background: rgba(46, 76, 170, 0.28);
      border-color: rgba(125, 159, 255, 0.9);
      box-shadow: 0 18px 48px -28px rgba(70, 120, 255, 0.65);
    }

    .card h3 {
      margin: 0;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card p {
      margin: 0;
      color: rgba(15, 23, 42, 0.68);
      font-size: 14px;
    }

    body[data-theme="dark"] .card p {
      color: rgba(226, 232, 240, 0.75);
    }

    .form-grid {
      display: grid;
      gap: 16px;
    }

    .form-grid.two {
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    label {
      display: grid;
      gap: 6px;
      font-size: 13px;
      color: rgba(15, 23, 42, 0.72);
      font-weight: 600;
    }

    body[data-theme="dark"] label {
      color: rgba(226, 232, 240, 0.8);
    }

    input,
    textarea,
    select {
      width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(15, 23, 42, 0.08);
      padding: 12px;
      font-size: 14px;
      background: rgba(255, 255, 255, 0.92);
      color: inherit;
      transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    }

    body[data-theme="dark"] input,
    body[data-theme="dark"] textarea,
    body[data-theme="dark"] select {
      background: rgba(9, 16, 28, 0.92);
      border-color: rgba(148, 163, 184, 0.2);
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: rgba(70, 100, 255, 0.7);
      box-shadow: 0 0 0 3px rgba(70, 100, 255, 0.18);
    }

    .chip-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .chip {
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(15, 23, 42, 0.12);
      background: rgba(70, 100, 255, 0.06);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.18s ease;
    }

    .chip.active {
      background: linear-gradient(120deg, #3b5bff, #00a2ff);
      color: #fff;
      border-color: transparent;
      box-shadow: 0 10px 22px -16px rgba(70, 100, 255, 0.85);
    }

    .chip:active {
      transform: scale(0.96);
    }

    body[data-theme="dark"] .chip {
      border-color: rgba(148, 163, 184, 0.18);
      background: rgba(70, 100, 255, 0.12);
      color: #dbe7ff;
    }

    body[data-theme="dark"] .chip.active {
      background: linear-gradient(120deg, rgba(102, 135, 255, 0.95), rgba(85, 210, 255, 0.95));
      color: #030712;
    }
    .info-block {
      border: 1px dashed rgba(70, 100, 255, 0.4);
      border-radius: 14px;
      padding: 16px;
      display: grid;
      gap: 10px;
      background: rgba(70, 100, 255, 0.07);
      font-size: 14px;
    }

    body[data-theme="dark"] .info-block {
      background: rgba(70, 100, 255, 0.16);
      border-color: rgba(70, 100, 255, 0.6);
      color: #e8eeff;
    }

    .guide-list {
      margin: 0;
      padding-left: 18px;
      display: grid;
      gap: 6px;
      font-size: 14px;
    }

    .guide-list li {
      line-height: 1.5;
    }

    .confirm-row {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      border: 1px solid rgba(70, 100, 255, 0.3);
      border-radius: 14px;
      padding: 14px 16px;
      background: rgba(70, 100, 255, 0.08);
      font-size: 14px;
    }

    .confirm-row input {
      margin-top: 4px;
    }

    body[data-theme="dark"] .confirm-row {
      background: rgba(70, 100, 255, 0.22);
      border-color: rgba(123, 150, 255, 0.65);
      color: #f8fbff;
      font-weight: 600;
    }

    .muted-note {
      font-size: 13px;
      color: rgba(15, 23, 42, 0.65);
    }

    body[data-theme="dark"] .muted-note {
      color: rgba(226, 232, 240, 0.7);
    }

    .prompt-area {
      border: 1px solid rgba(15, 23, 42, 0.08);
      border-radius: 16px;
      padding: 16px;
      background: rgba(247, 249, 255, 0.7);
      font-family: "IBM Plex Mono", "Fira Code", ui-monospace, SFMono-Regular, Menlo, Monaco, "Courier New", monospace;
      font-size: 13px;
      line-height: 1.55;
      white-space: pre-wrap;
      color: #0b1a46;
      position: relative;
    }

    body[data-theme="dark"] .prompt-area {
      background: rgba(9, 16, 28, 0.88);
      border-color: rgba(148, 163, 184, 0.22);
      color: #dbe7ff;
    }

    .prompt-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #4664ff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
    }

    .prompt-label.chat1 { color: #4664ff; }
    .prompt-label.chat2 { color: #1aa251; }
    .prompt-label.cursor { color: #0b6bff; }

    .prompt-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .checklist {
      display: grid;
      gap: 10px;
    }

    .check-item {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      border: 1px solid rgba(15, 23, 42, 0.08);
      padding: 12px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.78);
      transition: border-color 0.2s ease, background 0.2s ease;
    }

    body[data-theme="dark"] .check-item {
      background: rgba(13, 24, 45, 0.8);
      border-color: rgba(148, 163, 184, 0.18);
    }

    .check-item input {
      width: 20px;
      height: 20px;
      margin-top: 2px;
    }

    .check-item.completed {
      border-color: rgba(26, 162, 81, 0.6);
      background: rgba(26, 162, 81, 0.12);
    }

    .bottom-bar {
      padding: 20px 28px 28px;
      border-top: 1px solid rgba(15, 23, 42, 0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
      transition: border-color 0.3s ease;
    }

    body[data-theme="dark"] .bottom-bar {
      border-color: rgba(148, 163, 184, 0.16);
    }

    .bottom-bar .note {
      font-size: 13px;
      color: rgba(15, 23, 42, 0.65);
    }

    body[data-theme="dark"] .bottom-bar .note {
      color: rgba(226, 232, 240, 0.7);
    }

    .toast {
      position: fixed;
      bottom: 26px;
      right: 30px;
      background: linear-gradient(135deg, rgba(70, 100, 255, 0.92), rgba(85, 160, 255, 0.9));
      color: #fff;
      padding: 14px 18px;
      border-radius: 14px;
      box-shadow: 0 18px 38px -24px rgba(70, 100, 255, 0.6);
      display: none;
      gap: 10px;
      font-size: 14px;
      align-items: center;
      z-index: 20;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(6, 12, 24, 0.55);
      display: none;
      z-index: 25;
    }

    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 30;
    }

    .modal .box {
      width: min(760px, 92vw);
      max-height: 84vh;
      overflow: auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 26px;
      display: grid;
      gap: 16px;
      border: 1px solid rgba(70, 100, 255, 0.14);
      box-shadow: 0 32px 88px -46px rgba(6, 12, 24, 0.65);
    }

    body[data-theme="dark"] .modal .box {
      background: rgba(9, 14, 26, 0.95);
      border-color: rgba(70, 100, 255, 0.35);
      color: #f1f5ff;
    }

    .modal .box h3 {
      margin: 0;
    }

    .modal .box p {
      margin: 0;
      color: inherit;
      opacity: 0.85;
    }

    .modal .list {
      display: grid;
      gap: 12px;
    }

    .note-area {
      display: grid;
      gap: 8px;
    }

    .note-area textarea {
      min-height: 120px;
      resize: vertical;
    }

    @media (max-width: 860px) {
      header,
      .bottom-bar {
        padding-inline: 20px;
      }

      main {
        padding-inline: 22px;
      }
    }
  </style>
</head>
<body data-theme="light">
  <div id="ztb-app">
    <header>
      <div class="top-line">
        <div class="brand">
          <div class="logo">ü§ñ</div>
          <div>
            <h1>Zero-to-Bot Panel</h1>
            <div class="status-line">
              <span class="tag" id="mode-badge">–†–µ–∂–∏–º –Ω–µ –æ–±—Ä–∞–Ω–æ</span>
              <span class="tag" id="env-badge">–°–µ—Ä–µ–¥–æ–≤–∏—â–µ –Ω–µ –≤–∏–±—Ä–∞–Ω–µ</span>
            </div>
          </div>
        </div>
        <div class="controls">
          <button class="ghost" id="open-help">‚ùì –î–æ–ø–æ–º–æ–≥–∞</button>
          <button class="ghost" id="open-trouble">ü™õ –¢—Ä–∞–±–ª—à—É—Ç—ñ–Ω–≥</button>
          <button class="ghost" id="open-how">‚ÑπÔ∏è –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î</button>
          <button id="toggle-theme">üåô –¢–µ–º–Ω–∞ —Ç–µ–º–∞</button>
          <button id="reset-flow">üîÑ –ü–æ—á–∞—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É</button>
        </div>
      </div>
      <div class="progress">
        <span class="progress-label" id="progress-label">–ü—Ä–æ–≥—Ä–µ—Å: 0% ¬∑ –ö—Ä–æ–∫ 0 / 11</span>
        <div class="progress-bar"><span id="progress-bar"></span></div>
      </div>
    </header>
    <main>
      <div class="step-headline">
        <h2 id="step-title">–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ!</h2>
        <p id="step-desc">–û–±–µ—Ä—ñ—Ç—å ¬´–ü–æ—á–∞—Ç–∏¬ª, —â–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –º–∞–π—Å—Ç–µ—Ä. –ú–∏ –ø—ñ–¥–∫–∞–∂–µ–º–æ –∫–æ–∂–µ–Ω –∫—Ä–æ–∫.</p>
      </div>
      <div class="step-body" id="step-body"></div>
      <div class="note-area" id="note-wrapper" hidden>
        <label for="step-note">–ù–æ—Ç–∞—Ç–∫–∏ –¥–ª—è —Ü—å–æ–≥–æ –∫—Ä–æ–∫—É (–∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ)</label>
        <textarea id="step-note" placeholder="–ó–∞–ø–∏—Å—É–π –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ ChatGPT, —Ç–æ–∫–µ–Ω–∏ –∞–±–æ –≤–ª–∞—Å–Ω—ñ –¥—É–º–∫–∏"></textarea>
      </div>
    </main>
    <div class="bottom-bar">
      <div class="note" id="action-hint">–ü–æ—á–Ω—ñ—Ç—å —ñ–∑ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è ¬´–ü–æ—á–∞—Ç–∏¬ª.</div>
      <div class="controls">
        <button id="prev-step">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
        <button class="primary" id="next-step">–î–∞–ª—ñ ‚û°Ô∏è</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>
  <div class="modal-backdrop" id="modal-backdrop"></div>
  <div class="modal" id="modal"></div>

  <script>
    if (typeof structuredClone !== 'function') {
      window.structuredClone = (value) => JSON.parse(JSON.stringify(value));
    }

    const STORAGE_KEY = 'ztb_panel_state_v2';

    const defaultState = {
      currentStep: 0,
      started: false,
      theme: null,
      themeManual: false,
      mode: null,
      environment: null,
      survey: {
        role: '',
        goal: '',
        audience: '',
        tone: 'friendly',
        commands: ['/start', '/help'],
        language: 'uk',
        channel: 'dm'
      },
      autoProfile: {
        type: '',
        modules: [],
        storage: '',
        integrations: [],
        backend: '',
        uiLanguage: 'uk',
        difficulty: 'L0'
      },
      assistedBrief: '',
      generatedBrief: '',
      generatedCursorPrompt: '',
      generatedChecklist: [],
      notes: {},
      tools: {
        python: false,
        cursor: false,
        editor: false,
        codespaces: false
      },
      ack: {},
      testChecklist: {
        start: false,
        help: false,
        custom: false
      }
    };

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return structuredClone(defaultState);
        const parsed = JSON.parse(raw);
        return Object.assign(structuredClone(defaultState), parsed);
      } catch (err) {
        console.error('Failed to load state', err);
        return structuredClone(defaultState);
      }
    }

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    let state = loadState();

    const steps = [
      {
        id: 'start',
        title: '–°—Ç–∞—Ä—Ç',
        desc: '–ü–æ—è—Å–Ω—é—î–º–æ, —è–∫ –ø—Ä–∞—Ü—é—î –ø–∞–Ω–µ–ª—å. 1 –¥—ñ—è ‚Äî 1 –µ–∫—Ä–∞–Ω.',
        render: renderStartStep,
        showNotes: false
      },
      {
        id: 'survey',
        title: '–ê–Ω–∫–µ—Ç–∞',
        desc: '–û–ø–∏—à–∏, —è–∫–∏–π –±–æ—Ç –ø–æ—Ç—Ä—ñ–±–µ–Ω. –ú–∏ –ø—ñ–¥–∫–∞–∂–µ–º–æ –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –Ω–µ–º–∞—î —ñ–¥–µ–π.',
        render: renderSurveyStep,
        showNotes: true
      },
      {
        id: 'mode',
        title: '–í–∏–±—ñ—Ä —Ä–µ–∂–∏–º—É',
        desc: 'AUTO ‚Äî –ø–∞–Ω–µ–ª—å —Å–∞–º–∞ –≥–µ–Ω–µ—Ä—É—î –ø—Ä–æ–º–ø—Ç–∏. ASSISTED ‚Äî –ø—Ä–∞—Ü—é—î–º–æ —á–µ—Ä–µ–∑ ChatGPT –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä–∞.',
        render: renderModeStep,
        showNotes: false
      },
      {
        id: 'builder',
        title: '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–æ—Ç–∞',
        desc: '–°–∫–ª–∞–¥–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –∑ –ø–ª–∏—Ç–æ–∫. –Ø–∫—â–æ —Ä–µ–∂–∏–º ASSISTED ‚Äî —Ü–µ–π –∫—Ä–æ–∫ –º–æ–∂–Ω–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏.',
        render: renderBuilderStep,
        showNotes: true
      },
      {
        id: 'overview',
        title: 'DEV BRIEF —Ç–∞ –ø—Ä–æ–º–ø—Ç–∏',
        desc: '–û—Å—å –∫–æ—Ä–æ—Ç–∫–∏–π DEV BRIEF —ñ –≥–æ—Ç–æ–≤—ñ –ø—Ä–æ–º–ø—Ç–∏ –¥–ª—è ChatGPT —Ç–∞ Cursor.',
        render: renderOverviewStep,
        showNotes: true
      },
      {
        id: 'environment',
        title: '–í–∏–±—ñ—Ä —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞',
        desc: '–ü–æ—è—Å–Ω—é—î–º–æ —Ä—ñ–∑–Ω–∏—Ü—é –º—ñ–∂ Local —Ç–∞ Codespaces. –û–±–µ—Ä–∏, —â–æ –∑—Ä—É—á–Ω–æ.',
        render: renderEnvironmentStep,
        showNotes: false
      },
      {
        id: 'accounts',
        title: '–ü—ñ–¥–≥–æ—Ç—É—î–º–æ –∞–∫–∞—É–Ω—Ç–∏',
        desc: '–°—Ç–≤–æ—Ä—é—î–º–æ GitHub, Cursor —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ Telegram. –ö–æ–∂–µ–Ω –ø—É–Ω–∫—Ç –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º.',
        render: renderAccountsStep,
        showNotes: false
      },
      {
        id: 'workspace',
        title: '–†–æ–±–æ—á–∞ –ø–∞–ø–∫–∞ —ñ —Ç–µ—Ä–º—ñ–Ω–∞–ª',
        desc: '–ü–æ—è—Å–Ω—é—î–º–æ, —è–∫ –≤—ñ–¥–∫—Ä–∏—Ç–∏ –ø–∞–ø–∫—É, VS Code –∞–±–æ Codespaces —Ç–∞ –∑–Ω–∞–π—Ç–∏ —Ç–µ—Ä–º—ñ–Ω–∞–ª.',
        render: renderWorkspaceStep,
        showNotes: false
      },
      {
        id: 'files-intro',
        title: '–©–æ —Å—Ç–≤–æ—Ä–∏—Ç—å Cursor',
        desc: '–†–æ–∑–ø–æ–≤—ñ–¥–∞—î–º–æ, —è–∫ Cursor –≥–µ–Ω–µ—Ä—É—î –∫–æ–¥ —ñ —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–æ–±–∏—Ç–∏ –≤—Ä—É—á–Ω—É.',
        render: renderFilesIntroStep,
        showNotes: true
      },
      {
        id: 'file-requirements',
        title: '–°—Ç–≤–æ—Ä—é—î–º–æ requirements.txt',
        desc: '–ü–æ–∫–∞–∑—É—î–º–æ, —è–∫ –∑—Ä–æ–±–∏—Ç–∏ —Ñ–∞–π–ª —ñ–∑ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞–º–∏ –¥–ª—è –Ω–∞—à–æ–≥–æ –±–æ—Ç–∞.',
        render: renderFileRequirementsStep,
        showNotes: false
      },
      {
        id: 'file-main',
        title: '–ì–æ—Ç—É—î–º–æ main.py',
        desc: '–ü–æ—è—Å–Ω—é—î–º–æ, —è–∫ –≤—Å—Ç–∞–≤–∏—Ç–∏ –∫–æ–¥ —ñ–∑ Cursor —Ç–∞ —â–æ –º–∞—î –±—É—Ç–∏ —É —Ñ–∞–π–ª—ñ.',
        render: renderFileMainStep,
        showNotes: true
      },
      {
        id: 'file-env',
        title: '–ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ .env',
        desc: '–î–æ–¥–∞—î–º–æ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ —Ç–∞ –ø—Ä–∏–∫–ª–∞–¥ –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è.',
        render: renderFileEnvStep,
        showNotes: false
      },
      {
        id: 'cursor-guide',
        title: '–Ø–∫ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ Cursor',
        desc: '–í—ñ–¥–ø–æ–≤—ñ–¥–∞—î–º–æ –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è: —Ö—Ç–æ –ø–∏—à–µ –∫–æ–¥, —è–∫ –π–æ–≥–æ –∫–æ–ø—ñ—é–≤–∞—Ç–∏, —â–æ —Ä–æ–±–∏—Ç–∏ –¥–∞–ª—ñ.',
        render: renderCursorGuideStep,
        showNotes: true
      },
      {
        id: 'tools',
        title: '–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤',
        desc: '–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –≤—Å—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ —Ç–∞ –≤—ñ–¥–∫—Ä–∏—Ç—ñ.',
        render: renderToolsStep,
        showNotes: false
      },
      {
        id: 'cursor',
        title: '–í—Å—Ç–∞–≤–∏—Ç–∏ —É Cursor',
        desc: '–°–∫–æ–ø—ñ—é–π –ø—Ä–æ–º–ø—Ç —ñ –≤—Å—Ç–∞–≤ —É Cursor (Chat 2).',
        render: renderCursorStep,
        showNotes: true
      },
      {
        id: 'launch',
        title: '–ó–∞–ø—É—Å–∫',
        desc: '–°–∫–æ–ø—ñ—é–π –∫–æ–º–∞–Ω–¥–∏ —É —Ç–µ—Ä–º—ñ–Ω–∞–ª —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä, —â–æ –±–æ—Ç –ø—Ä–∞—Ü—é—î.',
        render: renderLaunchStep,
        showNotes: false
      },
      {
        id: 'botfather',
        title: 'BotFather',
        desc: '–î–æ–¥–∞–π –∫–æ–º–∞–Ω–¥–∏ —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–π –±–æ—Ç–∞.',
        render: renderBotFatherStep,
        showNotes: false
      },
      {
        id: 'test',
        title: '–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞',
        desc: '–ü—Ä–æ–π–¥–∏ —á–µ–∫-–ª–∏—Å—Ç —ñ –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –≤—Å–µ –ø—Ä–∞—Ü—é—î.',
        render: renderTestStep,
        showNotes: true
      },
      {
        id: 'finish',
        title: '–ì–æ—Ç–æ–≤–æ —Ç–∞ –∞–ø“ë—Ä–µ–π–¥–∏',
        desc: '–û–±–µ—Ä–∏ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏: –∫–Ω–æ–ø–∫–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –æ–ø–ª–∞—Ç–∏.',
        render: renderFinishStep,
        showNotes: false
      }
    ];

    const elements = {
      title: document.getElementById('step-title'),
      desc: document.getElementById('step-desc'),
      body: document.getElementById('step-body'),
      noteWrap: document.getElementById('note-wrapper'),
      note: document.getElementById('step-note'),
      progressLabel: document.getElementById('progress-label'),
      progressBar: document.getElementById('progress-bar'),
      actionHint: document.getElementById('action-hint'),
      prev: document.getElementById('prev-step'),
      next: document.getElementById('next-step'),
      toast: document.getElementById('toast'),
      modeBadge: document.getElementById('mode-badge'),
      envBadge: document.getElementById('env-badge'),
      modal: document.getElementById('modal'),
      backdrop: document.getElementById('modal-backdrop')
    };
    function setTheme(theme) {
      document.body.setAttribute('data-theme', theme);
      const toggle = document.getElementById('toggle-theme');
      if (!toggle) return;
      if (state.themeManual) {
        toggle.textContent = theme === 'dark' ? '‚òÄÔ∏è –°–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞' : 'üåô –¢–µ–º–Ω–∞ —Ç–µ–º–∞';
        toggle.title = '–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ç–µ–º—É –≤—Ä—É—á–Ω—É';
      } else {
        toggle.textContent = theme === 'dark' ? 'üîÑ –ê–≤—Ç–æ—Ç–µ–º–∞ (—Ç–µ–º–Ω–∞)' : 'üîÑ –ê–≤—Ç–æ—Ç–µ–º–∞ (—Å–≤—ñ—Ç–ª–∞)';
        toggle.title = '–¢–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–∞ –∑ –ø—Ä–∏—Å—Ç—Ä–æ—î–º. –ù–∞—Ç–∏—Å–Ω–∏, —â–æ–± –ø–µ—Ä–µ–º–∫–Ω—É—Ç–∏ –≤—Ä—É—á–Ω—É.';
      }
    }

    function toggleTheme() {
      const current = state.theme || document.body.getAttribute('data-theme') || 'light';
      const next = current === 'dark' ? 'light' : 'dark';
      state.themeManual = true;
      state.theme = next;
      setTheme(next);
      saveState();
    }

    function showToast(message) {
      elements.toast.textContent = message;
      elements.toast.style.display = 'inline-flex';
      setTimeout(() => {
        elements.toast.style.display = 'none';
      }, 2200);
    }

    function openModal(content) {
      elements.modal.innerHTML = '';
      elements.modal.appendChild(content);
      elements.modal.style.display = 'flex';
      elements.backdrop.style.display = 'block';
    }

    function closeModal() {
      elements.modal.style.display = 'none';
      elements.backdrop.style.display = 'none';
      elements.modal.innerHTML = '';
    }

    elements.backdrop.addEventListener('click', closeModal);

    function renderAckToggle(container, key, label, helper) {
      const row = document.createElement('label');
      row.className = 'confirm-row';
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = !!state.ack[key];
      checkbox.addEventListener('change', (event) => {
        state.ack[key] = event.target.checked;
        saveState();
      });
      const body = document.createElement('div');
      body.innerHTML = `<strong>${label}</strong>${helper ? `<div class="muted-note">${helper}</div>` : ''}`;
      row.appendChild(checkbox);
      row.appendChild(body);
      container.appendChild(row);
    }

    function createModal({ title, body, list, actions }) {
      const box = document.createElement('div');
      box.className = 'box';
      const head = document.createElement('div');
      head.style.display = 'flex';
      head.style.justifyContent = 'space-between';
      head.style.alignItems = 'center';
      head.style.gap = '12px';

      const titleEl = document.createElement('h3');
      titleEl.textContent = title;
      head.appendChild(titleEl);

      const closeBtn = document.createElement('button');
      closeBtn.textContent = '‚úï';
      closeBtn.className = 'ghost';
      closeBtn.style.justifySelf = 'flex-end';
      closeBtn.addEventListener('click', closeModal);
      head.appendChild(closeBtn);

      box.appendChild(head);

      if (body) {
        const p = document.createElement('p');
        p.innerHTML = body;
        box.appendChild(p);
      }

      if (Array.isArray(list)) {
        const ul = document.createElement('div');
        ul.className = 'list';
        list.forEach((item) => {
          const li = document.createElement('div');
          li.innerHTML = item;
          ul.appendChild(li);
        });
        box.appendChild(ul);
      }

      if (Array.isArray(actions) && actions.length) {
        const row = document.createElement('div');
        row.style.display = 'flex';
        row.style.flexWrap = 'wrap';
        row.style.gap = '10px';
        actions.forEach((action) => {
          const btn = document.createElement('button');
          btn.textContent = action.label;
          if (action.variant === 'primary') btn.classList.add('primary');
          btn.addEventListener('click', () => {
            if (action.onClick) action.onClick();
          });
          row.appendChild(btn);
        });
        box.appendChild(row);
      }

      return box;
    }

    document.getElementById('open-how').addEventListener('click', () => {
      openModal(
        createModal({
          title: '–Ø–∫ –ø—Ä–∞—Ü—é—î –ø–∞–Ω–µ–ª—å',
          body: '–í—Å–µ –¥—É–∂–µ –ø—Ä–æ—Å—Ç–æ: –∫–æ–ø—ñ—é—î—à –Ω–∞—à—ñ –ø—Ä–æ–º–ø—Ç–∏ ‚Üí –≤—Å—Ç–∞–≤–ª—è—î—à —É –ø–æ—Ç—Ä—ñ–±–Ω–∏–π —á–∞—Ç ‚Üí –≤–∏–∫–æ–Ω—É—î—à –∫—Ä–æ–∫ ‚Üí –Ω–∞—Ç–∏—Å–∫–∞—î—à ¬´–î–∞–ª—ñ¬ª.',
          list: [
            '1. –ó–∞–ø–æ–≤–Ω—é—î—à –∫–æ—Ä–æ—Ç–∫—É –∞–Ω–∫–µ—Ç—É –ø—Ä–æ –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ –±–æ—Ç–∞.',
            '2. –û–±–∏—Ä–∞—î—à —Ä–µ–∂–∏–º: AUTO –∞–±–æ ASSISTED. –£ –±—É–¥—å-—è–∫–æ–º—É –≤–∏–ø–∞–¥–∫—É –º–∏ –ø—ñ–¥–≥–æ—Ç—É—î–º–æ –∞–Ω–≥–ª–æ–º–æ–≤–Ω—ñ –ø—Ä–æ–º–ø—Ç–∏.',
            '3. –Ø–∫—â–æ AUTO ‚Äî —Ç–∏ –ª–∏—à–µ –Ω–∞—Ç–∏—Å–∫–∞—î—à ¬´–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏¬ª —ñ –≤—Å—Ç–∞–≤–ª—è—î—à —É Cursor. –Ø–∫—â–æ ASSISTED ‚Äî ChatGPT –¥–æ–ø–æ–º–∞–≥–∞—î —Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ DEV BRIEF.',
            '4. –î–∞–ª—ñ –º–∏ –≤–µ–¥–µ–º–æ —Ç–µ–±–µ —á–µ—Ä–µ–∑ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞, –∑–∞–ø—É—Å–∫ —ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è BotFather.',
            '5. –£ –∫–æ–∂–Ω–æ–º—É –∫—Ä–æ—Ü—ñ —î –∫–Ω–æ–ø–∫–∞ ¬´–ü—Ä–æ–±–ª–µ–º–∞?¬ª ‚Äî –Ω–µ —Å–æ—Ä–æ–º—Å—è –Ω–∞—Ç–∏—Å–∫–∞—Ç–∏.'
          ]
        })
      );
    });

    document.getElementById('open-help').addEventListener('click', () => {
      openModal(
        createModal({
          title: '–î–æ–ø–æ–º–æ–≥–∞',
          body: '–Ø–∫—â–æ —â–æ—Å—å –Ω–µ–∑—Ä–æ–∑—É–º—ñ–ª–æ, —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Å—è —Ü–∏–º–∏ –ø—ñ–¥–∫–∞–∑–∫–∞–º–∏.',
          list: [
            '–ü—Ä–∞—Ü—é–π –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ: 1 –µ–∫—Ä–∞–Ω = 1 –¥—ñ—è. –ù–µ –ø–µ—Ä–µ—Å–∫–∞–∫—É–π.',
            '–£—Å—ñ –ø–æ–ª—è –º–æ–∂–Ω–∞ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—ñ–∑–Ω—ñ—à–µ. –ü–∞–Ω–µ–ª—å –∑–∞–ø–∞–º‚Äô—è—Ç–æ–≤—É—î –ø—Ä–æ–≥—Ä–µ—Å.',
            '–î–ª—è ChatGPT —Å—Ç–≤–æ—Ä—é–π –æ–∫—Ä–µ–º–∏–π —á–∞—Ç ¬´–ù–∞–≤—ñ–≥–∞—Ç–æ—Ä¬ª ‚Äî –≤—ñ–Ω –¥–æ–ø–æ–º–∞–≥–∞—î –ø–æ—è—Å–Ω–∏—Ç–∏ –ø–æ–º–∏–ª–∫–∏ –ø—Ä–æ—Å—Ç–∏–º–∏ —Å–ª–æ–≤–∞–º–∏.',
            '–£—Å—ñ –ø—Ä–æ–º–ø—Ç–∏ –≤–∂–µ –º—ñ—Å—Ç—è—Ç—å –ø–µ—Ä–µ–∫–ª–∞–¥–∏ —Ç–∞ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è: –ø—Ä–æ—Å—Ç–æ –∫–æ–ø—ñ—é–π —ñ –≤—Å—Ç–∞–≤–ª—è–π.'
          ],
          actions: [
            {
              label: '–ü–µ—Ä–µ–π—Ç–∏ –¥–æ ¬´–ü—Ä–æ–±–ª–µ–º–∞?¬ª',
              onClick: () => {
                closeModal();
                renderProblemModal();
              }
            }
          ]
        })
      );
    });

    document.getElementById('open-trouble').addEventListener('click', renderProblemModal);
    function renderProblemModal() {
      const box = document.createElement('div');
      box.className = 'box';

      const head = document.createElement('div');
      head.style.display = 'flex';
      head.style.justifyContent = 'space-between';
      head.style.alignItems = 'center';
      const title = document.createElement('h3');
      title.textContent = '–ü—Ä–æ–±–ª–µ–º–∞? –û–±–µ—Ä–∏ —Å–∏—Ç—É–∞—Ü—ñ—é';
      const close = document.createElement('button');
      close.textContent = '‚úï';
      close.className = 'ghost';
      close.addEventListener('click', closeModal);
      head.appendChild(title);
      head.appendChild(close);
      box.appendChild(head);

      const intro = document.createElement('p');
      intro.innerHTML = '–ú–∏ —Å—Ñ–æ—Ä–º—É—î–º–æ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä–∞ (Chat 1) –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –Ω–∞—à–æ—ó —Å–∏—Å—Ç–µ–º–∏. –û–±–µ—Ä–∏, —â–æ —Å—Ç–∞–ª–æ—Å—è, –∞–±–æ –æ–ø–∏—à–∏ –≤–ª–∞—Å–Ω–∏–º–∏ —Å–ª–æ–≤–∞–º–∏.';
      box.appendChild(intro);

      const grid = document.createElement('div');
      grid.className = 'card-grid';

      PROBLEM_PRESETS.forEach((preset) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('role', 'button');
        card.tabIndex = 0;
        const h = document.createElement('h3');
        h.textContent = preset.title;
        const p = document.createElement('p');
        p.textContent = preset.summaryUk;
        card.appendChild(h);
        card.appendChild(p);
        const button = document.createElement('button');
        button.className = 'primary';
        button.textContent = '–°—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç';
        button.addEventListener('click', (event) => {
          event.stopPropagation();
          openNavigatorPrompt(preset);
        });
        card.addEventListener('click', () => openNavigatorPrompt(preset));
        card.appendChild(button);
        grid.appendChild(card);
      });

      box.appendChild(grid);

      openModal(box);
    }

    function openNavigatorPrompt(preset) {
      const chosen = preset || PROBLEM_LOOKUP.custom;
      const box = document.createElement('div');
      box.className = 'box';

      const head = document.createElement('div');
      head.style.display = 'flex';
      head.style.justifyContent = 'space-between';
      head.style.alignItems = 'center';
      const title = document.createElement('h3');
      title.textContent = `–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä–∞ ¬∑ ${chosen.title}`;
      const close = document.createElement('button');
      close.textContent = '‚úï';
      close.className = 'ghost';
      close.addEventListener('click', closeModal);
      head.appendChild(title);
      head.appendChild(close);
      box.appendChild(head);

      const description = document.createElement('p');
      description.textContent = '–û–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ, —â–æ —Å—Ç–∞–ª–æ—Å—è (–º–æ–∂–Ω–∞ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é). –ú–∏ –¥–æ–¥–∞–º–æ —Ü–µ —É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —â–æ–± ChatGPT –¥–∞–≤ —á—ñ—Ç–∫—ñ –∫—Ä–æ–∫–∏.';
      box.appendChild(description);

      const textarea = document.createElement('textarea');
      textarea.placeholder = '–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ø—ñ—Å–ª—è –∫–æ–º–∞–Ω–¥–∏ python main.py –æ—Ç—Ä–∏–º–∞–≤ ModuleNotFoundError: aiogram';
      textarea.style.minHeight = '80px';
      textarea.value = chosen.key === 'custom' ? '' : chosen.summaryUk;
      box.appendChild(textarea);

      const area = document.createElement('div');
      area.className = 'prompt-area';
      const updatePrompt = () => {
        area.textContent = generateNavigatorHelpPrompt(chosen.key, textarea.value);
      };
      textarea.addEventListener('input', updatePrompt);
      updatePrompt();

      box.appendChild(area);

      const actions = document.createElement('div');
      actions.className = 'prompt-actions';
      const copyBtn = document.createElement('button');
      copyBtn.className = 'primary';
      copyBtn.textContent = '–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –¥–ª—è ChatGPT';
      copyBtn.addEventListener('click', () => {
        copyText(area.textContent);
        showToast('–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ. –í—Å—Ç–∞–≤ —É ChatGPT –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä.');
      });
      actions.appendChild(copyBtn);

      const backBtn = document.createElement('button');
      backBtn.textContent = '–ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É';
      backBtn.addEventListener('click', () => {
        renderProblemModal();
      });
      actions.appendChild(backBtn);

      box.appendChild(actions);

      openModal(box);
      textarea.focus();
    }

    document.getElementById('toggle-theme').addEventListener('click', toggleTheme);
    document.getElementById('reset-flow').addEventListener('click', () => {
      if (confirm('–°–∫–∏–Ω—É—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ —Ç–∞ –ø–æ—á–∞—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É?')) {
        state = structuredClone(defaultState);
        initTheme();
        setStep(0);
        showToast('–ü–∞–Ω–µ–ª—å –æ–Ω–æ–≤–ª–µ–Ω–æ. –ü–æ—á–Ω—ñ–º–æ –∑–Ω–æ–≤—É!');
      }
    });

    elements.prev.addEventListener('click', () => {
      if (state.currentStep === 0) return;
      setStep(state.currentStep - 1);
    });

    elements.next.addEventListener('click', () => {
      if (state.currentStep === steps.length - 1) return;
      const { allowAdvance, message } = validateStep();
      if (!allowAdvance) {
        showToast(message || '–ó–∞–≤–µ—Ä—à–∏ –¥—ñ—é –Ω–∞ –ø–æ—Ç–æ—á–Ω–æ–º—É –µ–∫—Ä–∞–Ω—ñ.');
        return;
      }
      setStep(state.currentStep + 1);
    });

    elements.note.addEventListener('input', (event) => {
      const key = steps[state.currentStep].id;
      state.notes[key] = event.target.value;
      saveState();
    });

    function setStep(index) {
      state.currentStep = Math.max(0, Math.min(index, steps.length - 1));
      saveState();
      render();
    }

    function render() {
      const step = steps[state.currentStep];
      ensurePrompts();
      elements.title.textContent = `–ö—Ä–æ–∫ ${state.currentStep} ¬∑ ${step.title}`;
      elements.desc.textContent = step.desc;
      elements.body.innerHTML = '';
      step.render(elements.body);
      const total = steps.length - 1;
      const progress = Math.round((state.currentStep / total) * 100);
      elements.progressLabel.textContent = `–ü—Ä–æ–≥—Ä–µ—Å: ${progress}% ¬∑ –ö—Ä–æ–∫ ${state.currentStep} / ${total}`;
      elements.progressBar.style.width = `${progress}%`;
      elements.prev.disabled = state.currentStep === 0;
      elements.next.disabled = state.currentStep === steps.length - 1;
      if (step.showNotes) {
        elements.noteWrap.hidden = false;
        const key = step.id;
        elements.note.value = state.notes[key] || '';
      } else {
        elements.noteWrap.hidden = true;
      }
      updateBadges();
      elements.actionHint.textContent = getStepHint(step.id);
      saveState();
    }

    function updateBadges() {
      elements.modeBadge.textContent = state.mode ? `–†–µ–∂–∏–º: ${state.mode}` : '–†–µ–∂–∏–º –Ω–µ –æ–±—Ä–∞–Ω–æ';
      elements.envBadge.textContent = state.environment ? `–°–µ—Ä–µ–¥–æ–≤–∏—â–µ: ${state.environment}` : '–°–µ—Ä–µ–¥–æ–≤–∏—â–µ –Ω–µ –≤–∏–±—Ä–∞–Ω–µ';
    }
    function getStepHint(stepId) {
      switch (stepId) {
        case 'start':
          return '–ù–∞—Ç–∏—Å–Ω–∏ ¬´–ü–æ—á–∞—Ç–∏¬ª —ñ –≤—ñ–¥–º—ñ—á–∞–π –∫–æ–∂–µ–Ω –ø—ñ–¥–∫—Ä–æ–∫.';
        case 'survey':
          return '–ù–µ –∑–Ω–∞—î—à –∫–æ–º–∞–Ω–¥–∏? –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π –≥–æ—Ç–æ–≤—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –Ω–∏–∂—á–µ.';
        case 'mode':
          return 'AUTO –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ —Å—Ç–∞—Ä—Ç—É. ASSISTED, —è–∫—â–æ —Ö–æ—á–µ—à —Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—å –∑ ChatGPT.';
        case 'builder':
          return state.mode === 'ASSISTED' ? '–†–µ–∂–∏–º ASSISTED ‚Äî —Ü–µ–π –∫—Ä–æ–∫ –ª–∏—à–µ –¥–ª—è –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è.' : '–û–±–µ—Ä–∏ —Ö–æ—á–∞ –± –ø–æ –æ–¥–Ω–æ–º—É –ø—É–Ω–∫—Ç—É —É –∫–æ–∂–Ω–æ–º—É –±–ª–æ—Ü—ñ.';
        case 'overview':
          return '–°–∫–æ–ø—ñ—é–π –ø—Ä–æ–º–ø—Ç–∏ —ñ –≤–∏–∫–æ–Ω–∞–π —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ä–µ–∂–∏–º—É.';
        case 'environment':
          return '–í–∏–∑–Ω–∞—á—Å—è: –ª–æ–∫–∞–ª—å–Ω–æ —á–∏ –≤ —Ö–º–∞—Ä—ñ. –ú–∏ –ø—ñ–¥–ª–∞—à—Ç—É—î–º–æ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–∞–ª—ñ.';
        case 'accounts':
          return '–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –º–∞—î—à –¥–æ—Å—Ç—É–ø –¥–æ Telegram, GitHub (–∑–∞ –ø–æ—Ç—Ä–µ–±–∏) —Ç–∞ Cursor.';
        case 'workspace':
          return '–í—ñ–¥–∫—Ä–∏–π –ø–∞–ø–∫—É –ø—Ä–æ—î–∫—Ç—É —Ç–∞ –∑–Ω–∞–π–¥–∏ —Ç–µ—Ä–º—ñ–Ω–∞–ª. –ë–µ–∑ —Ü—å–æ–≥–æ –¥–∞–ª—ñ –Ω–µ –ø—ñ–¥–µ–º–æ.';
        case 'files-intro':
          return '–ü—Ä–æ—á–∏—Ç–∞–π –ø–æ—è—Å–Ω–µ–Ω–Ω—è –ø—Ä–æ —Ñ–∞–π–ª–∏ ‚Äî Cursor –ø–∏—à–µ –∫–æ–¥, —Ç–∏ –ø–µ—Ä–µ–Ω–æ—Å–∏—à —É —Ä–µ–¥–∞–∫—Ç–æ—Ä.';
        case 'file-requirements':
          return '–°—Ç–≤–æ—Ä–∏ requirements.txt —Ç–∞ –≤—Å—Ç–∞–≤ –¥–≤–∞ —Ä—è–¥–∫–∏ –∑ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞–º–∏.';
        case 'file-main':
          return '–ü—ñ–¥–≥–æ—Ç—É–π—Å—è –≤—Å—Ç–∞–≤–∏—Ç–∏ –∫–æ–¥ main.py, —è–∫–∏–π –∑–≥–µ–Ω–µ—Ä—É—î Cursor.';
        case 'file-env':
          return '–°—Ç–≤–æ—Ä–∏ .env —ñ .env.example, —â–æ–± –∑–±–µ—Ä–µ–≥—Ç–∏ —Ç–æ–∫–µ–Ω –±–µ–∑–ø–µ—á–Ω–æ.';
        case 'cursor-guide':
          return '–ó—Ä–æ–∑—É–º—ñ–π, —è–∫ –ø—Ä–∞—Ü—é—î Cursor: –≤—ñ–Ω –ø–∏—à–µ –∫–æ–¥, —Ç–∏ –∫–æ–ø—ñ—é—î—à —É —Ñ–∞–π–ª–∏.';
        case 'tools':
          return '–ü–µ—Ä–µ–≤—ñ—Ä, —â–æ Python, Cursor —ñ —Ä–µ–¥–∞–∫—Ç–æ—Ä –≤–∂–µ –≤—ñ–¥–∫—Ä–∏—Ç—ñ.';
        case 'cursor':
          return '–°–∫–æ–ø—ñ—é–π –ø—Ä–æ–º–ø—Ç —É Cursor. –Ø–∫—â–æ –∑–∞–≤–∏—Å ‚Äî –Ω–∞—Ç–∏—Å–Ω–∏ ¬´–ü—Ä–æ–±–ª–µ–º–∞?¬ª. ';
        case 'launch':
          return '–í–∏–∫–æ–Ω–∞–π –∫–æ–º–∞–Ω–¥–∏ –ø–æ —á–µ—Ä–∑—ñ. –Ø–∫—â–æ —î –ø–æ–º–∏–ª–∫–∞ ‚Äî –Ω–∞—Ç–∏—Å–Ω–∏ ¬´–ü—Ä–æ–±–ª–µ–º–∞?¬ª. ';
        case 'botfather':
          return '–î–æ–¥–∞–π –∫–æ–º–∞–Ω–¥–∏. –í–æ–Ω–∏ –≤–∂–µ –ø–µ—Ä–µ–∫–ª–∞–¥–µ–Ω—ñ.';
        case 'test':
          return '–ü–µ—Ä–µ–≤—ñ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –±–æ—Ç–∞ —Ç–∞ –ø–æ–∑–Ω–∞—á–∞–π –≥–∞–ª–æ—á–∫–∏.';
        case 'finish':
          return '–û–±–µ—Ä–∏, —â–æ —Ö–æ—á–µ—à –ø–æ–∫—Ä–∞—â–∏—Ç–∏ –¥–∞–ª—ñ.';
        default:
          return '';
      }
    }

    function validateStep() {
      const step = steps[state.currentStep];
      switch (step.id) {
        case 'survey': {
          const { role, goal } = state.survey;
          if (!role || !goal) {
            return { allowAdvance: false, message: '–ó–∞–ø–æ–≤–Ω–∏ —Ä–æ–ª—å —ñ —Ü—ñ–ª—å –±–æ—Ç–∞. –¶–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ —Å–≤–æ—ó–º–∏ —Å–ª–æ–≤–∞–º–∏.' };
          }
          return { allowAdvance: true };
        }
        case 'mode': {
          if (!state.mode) return { allowAdvance: false, message: '–û–±–µ—Ä—ñ—Ç—å —Ä–µ–∂–∏–º —Ä–æ–±–æ—Ç–∏ –ø–∞–Ω–µ–ª—ñ.' };
          return { allowAdvance: true };
        }
        case 'builder': {
          if (state.mode === 'ASSISTED') return { allowAdvance: true };
          const { type, modules, storage } = state.autoProfile;
          if (!type || modules.length === 0 || !storage) {
            return { allowAdvance: false, message: '–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø, —Ö–æ—á–∞ –± –æ–¥–∏–Ω –º–æ–¥—É–ª—å —Ç–∞ —Å–ø–æ—Å—ñ–± –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è.' };
          }
          return { allowAdvance: true };
        }
        case 'overview': {
          if (state.mode === 'ASSISTED' && !state.assistedBrief.trim()) {
            return { allowAdvance: false, message: '–í—Å—Ç–∞–≤ DEV BRIEF, —è–∫–∏–π —Ç–∏ –æ—Ç—Ä–∏–º–∞–≤ —É ChatGPT.' };
          }
          return { allowAdvance: true };
        }
        case 'environment': {
          if (!state.environment) {
            return { allowAdvance: false, message: '–û–±–µ—Ä—ñ—Ç—å —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ: Local –∞–±–æ Codespaces.' };
          }
          return { allowAdvance: true };
        }
        case 'accounts': {
          if (!state.ack.accounts) {
            return { allowAdvance: false, message: '–ü–æ—Å—Ç–∞–≤ –≥–∞–ª–æ—á–∫—É, —â–æ –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –∞–∫–∞—É–Ω—Ç–∏ –≥–æ—Ç–æ–≤—ñ.' };
          }
          return { allowAdvance: true };
        }
        case 'workspace': {
          if (!state.ack.workspace) {
            return { allowAdvance: false, message: '–ü—ñ–¥—Ç–≤–µ—Ä–¥—å, —â–æ –≤—ñ–¥–∫—Ä–∏–≤ –ø–∞–ø–∫—É –ø—Ä–æ—î–∫—Ç—É —Ç–∞ –±–∞—á–∏—à —Ç–µ—Ä–º—ñ–Ω–∞–ª.' };
          }
          return { allowAdvance: true };
        }
        case 'files-intro': {
          if (!state.ack['files-intro']) {
            return { allowAdvance: false, message: '–ü—Ä–æ—á–∏—Ç–∞–π –ø–æ—è—Å–Ω–µ–Ω–Ω—è —Ç–∞ –ø–æ—Å—Ç–∞–≤ –≤—ñ–¥–º—ñ—Ç–∫—É –ø—ñ–¥ –±–ª–æ–∫–æ–º.' };
          }
          return { allowAdvance: true };
        }
        case 'file-requirements': {
          if (!state.ack['file-requirements']) {
            return { allowAdvance: false, message: '–°—Ç–≤–æ—Ä–∏ requirements.txt —Ç–∞ –≤—ñ–¥–º—ñ—Ç—å, —â–æ –≤—Å–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ.' };
          }
          return { allowAdvance: true };
        }
        case 'file-main': {
          if (!state.ack['file-main']) {
            return { allowAdvance: false, message: '–ü—ñ–¥—Ç–≤–µ—Ä–¥—å, —â–æ –∑–Ω–∞—î—à —è–∫ –≤—Å—Ç–∞–≤–ª—è—Ç–∏ main.py.' };
          }
          return { allowAdvance: true };
        }
        case 'file-env': {
          if (!state.ack['file-env']) {
            return { allowAdvance: false, message: '–°—Ç–≤–æ—Ä–∏ .env/.env.example –∞–±–æ –ø–æ–∑–Ω–∞—á, —â–æ –∑—Ä–æ–±–∏—à —Ü–µ.' };
          }
          return { allowAdvance: true };
        }
        case 'cursor-guide': {
          if (!state.ack['cursor-guide']) {
            return { allowAdvance: false, message: '–ü–æ–∑–Ω–∞—á, —â–æ –∑—Ä–æ–∑—É–º—ñ–≤, —è–∫ –ø—Ä–∞—Ü—é—î Cursor.' };
          }
          return { allowAdvance: true };
        }
        default:
          return { allowAdvance: true };
      }
    }

    function copyText(text) {
      navigator.clipboard.writeText(text).then(() => {
        showToast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ —É –±—É—Ñ–µ—Ä.');
      });
    }

    function handleChipToggle(chip, list, value) {
      const index = list.indexOf(value);
      if (index >= 0) {
        list.splice(index, 1);
        chip.classList.remove('active');
      } else {
        list.push(value);
        chip.classList.add('active');
      }
      saveState();
    }

    function enhanceChipInteractivity(chip) {
      chip.setAttribute('role', 'button');
      chip.tabIndex = 0;
      chip.addEventListener('keydown', (event) => {
        if (event.key === 'Enter' || event.key === ' ') {
          event.preventDefault();
          chip.click();
        }
      });
    }

    function enhanceCardInteractivity(card, onSelect) {
      card.setAttribute('role', 'button');
      card.tabIndex = 0;
      card.addEventListener('keydown', (event) => {
        if (event.key === 'Enter' || event.key === ' ') {
          event.preventDefault();
          onSelect();
        }
      });
    }

    const COMMAND_SUGGESTIONS = ['/start', '/help', '/add', '/list', '/done', '/stats', '/tips', '/pay', '/admin', '/panic'];
    const BOT_TYPES = [
      { value: 'CRM', label: 'CRM', desc: '–í–µ–¥–µ –∫–ª—ñ—î–Ω—Ç—ñ–≤ —ñ –∑–∞–≤–¥–∞–Ω–Ω—è' },
      { value: 'Task Manager', label: 'Task Manager', desc: '–°–ø–∏—Å–æ–∫ —Å–ø—Ä–∞–≤ –¥–ª—è –∫–æ–º–∞–Ω–¥–∏' },
      { value: 'Habit Tracker', label: 'Habit Tracker', desc: '–©–æ–¥–µ–Ω–Ω—ñ –∑–≤–∏—á–∫–∏ –π –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è' },
      { value: 'FAQ', label: 'FAQ / Support', desc: '–í—ñ–¥–ø–æ–≤—ñ–¥–∞—î –Ω–∞ —Ç–∏–ø–æ–≤—ñ –ø–∏—Ç–∞–Ω–Ω—è' },
      { value: 'Shop', label: 'Shop', desc: '–ú—ñ–Ω—ñ-–º–∞–≥–∞–∑–∏–Ω —É Telegram' },
      { value: 'Booking', label: 'Booking', desc: '–ó–∞–ø–∏—Å –Ω–∞ –ø–æ—Å–ª—É–≥–∏' },
      { value: 'Custom', label: 'Custom', desc: '–°–≤—ñ–π —Å—Ü–µ–Ω–∞—Ä—ñ–π' }
    ];

    const MODULES = [
      ['/start', '–ü—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è'],
      ['/help', '–ü–æ—è—Å–Ω–µ–Ω–Ω—è'],
      ['/add', '–î–æ–¥–∞—Ç–∏'],
      ['/list', '–°–ø–∏—Å–æ–∫'],
      ['/done', '–ü–æ–∑–Ω–∞—á–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–µ'],
      ['/stats', '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞'],
      ['/tips', '–ü–æ—Ä–∞–¥–∏'],
      ['/pay', '–û–ø–ª–∞—Ç–∏'],
      ['/admin', '–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å'],
      ['/panic', '–®–≤–∏–¥–∫–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞']
    ];

    const STORAGE_OPTIONS = [
      ['None', '–ë–µ–∑ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è'],
      ['JSON', 'JSON —Ñ–∞–π–ª (–ø—Ä–æ—Å—Ç–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç)'],
      ['Google Sheets', 'Google Sheets'],
      ['SQLite', 'SQLite'],
      ['Postgres', 'Postgres']
    ];

    const INTEGRATIONS = ['Google Sheets', 'Notion', 'Webhook', 'Stripe', 'OpenAI'];

    const BACKENDS = [
      ['None', '–ë–µ–∑ –±–µ–∫–µ–Ω–¥—É'],
      ['Parser', '–ü–∞—Ä—Å–µ—Ä —Å—Ç–æ—Ä—ñ–Ω–∫–∏'],
      ['Webhook', 'Webhook –ø—Ä–∏–π–æ–º'],
      ['FastAPI', 'FastAPI API']
    ];

    const DIFFICULTIES = [
      ['L0', 'L0 ‚Äî –±–∞–∑–æ–≤–æ'],
      ['L1', 'L1 ‚Äî —Å–µ—Ä–µ–¥–Ω—ñ–π'],
      ['L2', 'L2 ‚Äî –ø—Ä–æ—Å—É–Ω—É—Ç–∏–π'],
      ['L3', 'L3 ‚Äî —Å–∫–ª–∞–¥–Ω–∏–π']
    ];

    const PROBLEM_PRESETS = [
      {
        key: 'python',
        title: 'Python –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ',
        summaryUk: '–¢–µ—Ä–º—ñ–Ω–∞–ª –ø–∏—à–µ, —â–æ –∫–æ–º–∞–Ω–¥–∞ python/py –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞ –∞–±–æ –Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è.',
        navSummary: 'Terminal reports that Python command is missing or not recognized.'
      },
      {
        key: 'token',
        title: '–ü–æ–º–∏–ª–∫–∞ —Ç–æ–∫–µ–Ω–∞',
        summaryUk: 'BotFather –≤–∏–¥–∞—î Invalid token –∞–±–æ –±–æ—Ç –ø–∞–¥–∞—î –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É.',
        navSummary: 'Bot crashes with invalid token or cannot read the .env file.'
      },
      {
        key: 'silent',
        title: '–ë–æ—Ç –º–æ–≤—á–∏—Ç—å',
        summaryUk: '–ë–æ—Ç –∑–∞–ø—É—Å—Ç–∏–≤—Å—è –±–µ–∑ –ø–æ–º–∏–ª–æ–∫, –∞–ª–µ –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤ Telegram.',
        navSummary: 'Bot starts without errors but does not respond to messages in Telegram.'
      },
      {
        key: 'module',
        title: 'ModuleNotFound –∞–±–æ —ñ–Ω—à–∞ –ø–æ–º–∏–ª–∫–∞',
        summaryUk: '–ü—Ä–∏ –∑–∞–ø—É—Å–∫—É –∑‚Äô—è–≤–ª—è—î—Ç—å—Å—è ModuleNotFoundError —á–∏ —ñ–Ω—à–∏–π —Ç—Ä–µ–π—Å–±–µ–∫.',
        navSummary: 'Running the project shows ModuleNotFoundError or another traceback from Python.'
      },
      {
        key: 'custom',
        title: '–ú–æ—î—ó –ø—Ä–æ–±–ª–µ–º–∏ –Ω–µ–º–∞—î —É —Å–ø–∏—Å–∫—É',
        summaryUk: '–û–ø–∏—à–∏ —Å–≤–æ—ó–º–∏ —Å–ª–æ–≤–∞–º–∏, —â–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è. –ú–∏ —Å—Ñ–æ—Ä–º—É—î–º–æ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä–∞.',
        navSummary: 'I have another issue that I need help with.'
      }
    ];

    const PROBLEM_LOOKUP = Object.fromEntries(PROBLEM_PRESETS.map((item) => [item.key, item]));
    function renderStartStep(container) {
      const block = document.createElement('div');
      block.className = 'step-body';

      const intro = document.createElement('div');
      intro.className = 'info-block';
      intro.innerHTML = `
        <strong>Zero-to-Bot Panel</strong> –ø—Ä–æ–≤–µ–¥–µ —Ç–µ–±–µ –≤—ñ–¥ —ñ–¥–µ—ó –¥–æ –ø—Ä–∞—Ü—é—é—á–æ–≥–æ Telegram-–±–æ—Ç–∞.<br>
        –í—Å–µ, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ ‚Äî —á–∏—Ç–∞—Ç–∏ –ø—ñ–¥–∫–∞–∑–∫–∏, –∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø—Ä–æ–º–ø—Ç–∏ —ñ –Ω–∞—Ç–∏—Å–∫–∞—Ç–∏ ¬´–î–∞–ª—ñ¬ª.
      `;

      const actions = document.createElement('div');
      actions.style.display = 'flex';
      actions.style.gap = '12px';
      actions.style.flexWrap = 'wrap';

      const startBtn = document.createElement('button');
      startBtn.className = 'primary';
      startBtn.textContent = '–ü–æ—á–∞—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è';
      startBtn.addEventListener('click', () => {
        state.started = true;
        showToast('–ü–æ—ó—Ö–∞–ª–∏! –ö—Ä–æ–∫ 1 ‚Äî –ê–Ω–∫–µ—Ç–∞.');
        setStep(1);
      });

      const howBtn = document.createElement('button');
      howBtn.textContent = '–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î?';
      howBtn.addEventListener('click', () => {
        document.getElementById('open-how').click();
      });

      actions.appendChild(startBtn);
      actions.appendChild(howBtn);

      block.appendChild(intro);
      block.appendChild(actions);

      container.appendChild(block);
    }

    function renderSurveyStep(container) {
      const grid = document.createElement('div');
      grid.className = 'form-grid';

      const row1 = document.createElement('div');
      row1.className = 'form-grid two';

      row1.appendChild(createInput('–†–æ–ª—å –±–æ—Ç–∞', '–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ê—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ –∑–≤–∏—á–∫–∞–º', state.survey.role, (value) => {
        state.survey.role = value;
        saveState();
        ensurePrompts();
      }));

      row1.appendChild(createInput('–ì–æ–ª–æ–≤–Ω–∞ —Ü—ñ–ª—å', '–©–æ –º–∞—î —Ä–æ–±–∏—Ç–∏ –±–æ—Ç?', state.survey.goal, (value) => {
        state.survey.goal = value;
        saveState();
        ensurePrompts();
      }));

      grid.appendChild(row1);

      grid.appendChild(
        createInput('–ö–æ–º—É –¥–æ–ø–æ–º–∞–≥–∞—î –±–æ—Ç?', '–ù–∞–ø—Ä–∏–∫–ª–∞–¥: —Ñ—Ä—ñ–ª–∞–Ω—Å–µ—Ä–∞–º, –∫–ª—ñ—î–Ω—Ç–∞–º –º–∞–≥–∞–∑–∏–Ω—É, –∫–æ–º–∞–Ω–¥—ñ', state.survey.audience, (value) => {
          state.survey.audience = value;
          saveState();
          ensurePrompts();
        })
      );

      const commandsBlock = document.createElement('div');
      commandsBlock.className = 'form-grid';

      const commandLabel = document.createElement('label');
      commandLabel.textContent = '–ö–æ–º–∞–Ω–¥–∏ (–Ω–∞—Ç–∏—Å–∫–∞–π, —â–æ–± –¥–æ–¥–∞—Ç–∏)';
      commandsBlock.appendChild(commandLabel);

      const chips = document.createElement('div');
      chips.className = 'chip-group';

      COMMAND_SUGGESTIONS.forEach((command) => {
        const chip = document.createElement('div');
        chip.className = 'chip';
        chip.textContent = command;
        if (state.survey.commands.includes(command)) chip.classList.add('active');
        chip.addEventListener('click', () => {
          handleChipToggle(chip, state.survey.commands, command);
          commandsTextarea.value = state.survey.commands.join(', ');
          ensurePrompts();
        });
        enhanceChipInteractivity(chip);
        chips.appendChild(chip);
      });

      const commandsTextarea = document.createElement('textarea');
      commandsTextarea.value = state.survey.commands.join(', ');
      commandsTextarea.placeholder = '–ù–∞–ø—Ä–∏–∫–ª–∞–¥: /start, /help, /add';
      commandsTextarea.addEventListener('input', (event) => {
        const values = event.target.value
          .split(',')
          .map((item) => item.trim())
          .filter(Boolean);
        state.survey.commands = [...new Set(values.map((cmd) => (cmd.startsWith('/') ? cmd : `/${cmd}`)))];
        saveState();
        ensurePrompts();
        chips.querySelectorAll('.chip').forEach((chip) => {
          if (state.survey.commands.includes(chip.textContent)) chip.classList.add('active');
          else chip.classList.remove('active');
        });
      });

      commandsBlock.appendChild(chips);
      commandsBlock.appendChild(commandsTextarea);

      grid.appendChild(commandsBlock);

      const selectRow = document.createElement('div');
      selectRow.className = 'form-grid two';

      selectRow.appendChild(
        createSelect('–ú–æ–≤–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É', state.survey.language, [
          ['uk', '–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞'],
          ['en', 'English']
        ], (value) => {
          state.survey.language = value;
          state.autoProfile.uiLanguage = value;
          saveState();
          ensurePrompts();
        })
      );

      selectRow.appendChild(
        createSelect('–ö–∞–Ω–∞–ª', state.survey.channel, [
          ['dm', '–û—Å–æ–±–∏—Å—Ç—ñ —á–∞—Ç–∏'],
          ['group', '–ì—Ä—É–ø–∏']
        ], (value) => {
          state.survey.channel = value;
          saveState();
          ensurePrompts();
        })
      );

      grid.appendChild(selectRow);

      const helper = document.createElement('div');
      helper.className = 'info-block';
      helper.innerHTML = `
        <strong>–ù–µ –∑–Ω–∞—î—à, —è–∫—ñ –∫–æ–º–∞–Ω–¥–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ?</strong><br>
        –û–±–µ—Ä–∏ –≥–æ—Ç–æ–≤—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ –∞–±–æ –∑–∞–ª–∏—à –Ω–∞—à—ñ —à–∞–±–ª–æ–Ω–∏. –ü–∞–Ω–µ–ª—å –ø—ñ–∑–Ω—ñ—à–µ –∑–≥–µ–Ω–µ—Ä—É—î –±–ª–æ–∫ –¥–ª—è BotFather.
      `;

      container.appendChild(grid);
      container.appendChild(helper);
    }
    function createInput(labelText, placeholder, value, onInput) {
      const wrapper = document.createElement('label');
      wrapper.textContent = labelText;
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = placeholder;
      input.value = value;
      input.addEventListener('input', (event) => onInput(event.target.value));
      wrapper.appendChild(input);
      return wrapper;
    }

    function createSelect(labelText, value, options, onChange) {
      const wrapper = document.createElement('label');
      wrapper.textContent = labelText;
      const select = document.createElement('select');
      options.forEach(([val, label]) => {
        const option = document.createElement('option');
        option.value = val;
        option.textContent = label;
        if (value === val) option.selected = true;
        select.appendChild(option);
      });
      select.addEventListener('change', (event) => onChange(event.target.value));
      wrapper.appendChild(select);
      return wrapper;
    }

    function renderModeStep(container) {
      const grid = document.createElement('div');
      grid.className = 'card-grid';

      const autoCard = createModeCard('AUTO', '‚ö°', '–ü–∞–Ω–µ–ª—å —Å–∞–º–∞ —Å—Ç–≤–æ—Ä–∏—Ç—å –∞–Ω–≥–ª–æ–º–æ–≤–Ω–∏–π DEV BRIEF —ñ –ø—Ä–æ–º–ø—Ç –¥–ª—è Cursor. –Ü–¥–µ–∞–ª—å–Ω–æ, —è–∫—â–æ —Ö–æ—á–µ—à ¬´–Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ –π –æ—Ç—Ä–∏–º–∞—Ç–∏¬ª.');
      const assistedCard = createModeCard('ASSISTED', 'üí¨', '–û—Ç—Ä–∏–º–∞—î—à –ø—Ä–æ–º–ø—Ç –¥–ª—è ChatGPT –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä–∞, —è–∫–∏–π –¥–æ–ø–æ–º–æ–∂–µ —Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ DEV BRIEF. –ü–æ—Ç—ñ–º –≤—Å—Ç–∞–≤–∏—à –π–æ–≥–æ —Å—é–¥–∏.');

      if (state.mode === 'AUTO') autoCard.classList.add('active');
      if (state.mode === 'ASSISTED') assistedCard.classList.add('active');

      autoCard.addEventListener('click', () => {
        state.mode = 'AUTO';
        saveState();
        ensurePrompts();
        render();
        showToast('AUTO: –ø—Ä–æ–º–ø—Ç–∏ –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.');
      });

      assistedCard.addEventListener('click', () => {
        state.mode = 'ASSISTED';
        saveState();
        ensurePrompts();
        render();
        showToast('ASSISTED: –ø—Ä–∞—Ü—é—î–º–æ —á–µ—Ä–µ–∑ ChatGPT –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä–∞.');
      });

      grid.appendChild(autoCard);
      grid.appendChild(assistedCard);

      const reminder = document.createElement('div');
      reminder.className = 'info-block';
      reminder.innerHTML = `
        <strong>–ü–æ—Ä–∞–¥–∞.</strong> –ú–æ–∂–µ—à –∑–º—ñ–Ω–∏—Ç–∏ —Ä–µ–∂–∏–º —É –±—É–¥—å-—è–∫–∏–π –º–æ–º–µ–Ω—Ç. –í—Å—ñ –ø—Ä–æ–º–ø—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ—Ä–∞—Ö—É—é—Ç—å—Å—è.
      `;

      container.appendChild(grid);
      container.appendChild(reminder);
    }

    function createModeCard(mode, emoji, description) {
      const card = document.createElement('div');
      card.className = 'card';
      const title = document.createElement('h3');
      title.textContent = `${emoji} ${mode}`;
      const text = document.createElement('p');
      text.textContent = description;
      card.appendChild(title);
      card.appendChild(text);
      return card;
    }
    function renderBuilderStep(container) {
      if (state.mode === 'ASSISTED') {
        const block = document.createElement('div');
        block.className = 'info-block';
        block.innerHTML = `
          –¢–∏ –æ–±—Ä–∞–≤ —Ä–µ–∂–∏–º ASSISTED. –¶–µ–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –º–æ–∂–Ω–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ ‚Äî ChatGPT —Å–∞–º –¥–æ–ø–æ–º–æ–∂–µ —Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É. –Ø–∫—â–æ —Ö–æ—á–µ—à, –º–æ–∂–µ—à –≤—Å–µ –∂ –æ–±—Ä–∞—Ç–∏ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –¥–ª—è –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è.
        `;
        container.appendChild(block);
      }

      const wrapper = document.createElement('div');
      wrapper.className = 'step-body';

      const typeSection = document.createElement('div');
      typeSection.appendChild(createSectionTitle('–¢–∏–ø –±–æ—Ç–∞'));
      const typeGrid = document.createElement('div');
      typeGrid.className = 'card-grid';
      BOT_TYPES.forEach(({ value, label, desc }) => {
        const card = document.createElement('div');
        card.className = 'card';
        if (state.autoProfile.type === value) card.classList.add('active');
        const title = document.createElement('h3');
        title.textContent = label;
        const text = document.createElement('p');
        text.textContent = desc;
        card.appendChild(title);
        card.appendChild(text);
        const selectType = () => {
          state.autoProfile.type = value;
          saveState();
          ensurePrompts();
          render();
        };
        card.addEventListener('click', selectType);
        enhanceCardInteractivity(card, selectType);
        typeGrid.appendChild(card);
      });
      typeSection.appendChild(typeGrid);
      wrapper.appendChild(typeSection);

      const modulesSection = document.createElement('div');
      modulesSection.appendChild(createSectionTitle('–ú–æ–¥—É–ª—ñ —Ç–∞ –∫–æ–º–∞–Ω–¥–∏'));
      const moduleChips = document.createElement('div');
      moduleChips.className = 'chip-group';
      MODULES.forEach(([value, label]) => {
        const chip = document.createElement('div');
        chip.className = 'chip';
        chip.textContent = `${value} ¬∑ ${label}`;
        if (state.autoProfile.modules.includes(value)) chip.classList.add('active');
        chip.addEventListener('click', () => {
          handleChipToggle(chip, state.autoProfile.modules, value);
          ensurePrompts();
        });
        enhanceChipInteractivity(chip);
        moduleChips.appendChild(chip);
      });
      modulesSection.appendChild(moduleChips);
      wrapper.appendChild(modulesSection);

      const storageSection = document.createElement('div');
      storageSection.appendChild(createSectionTitle('–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö'));
      const storageGrid = document.createElement('div');
      storageGrid.className = 'card-grid';
      STORAGE_OPTIONS.forEach(([value, label]) => {
        const card = document.createElement('div');
        card.className = 'card';
        if (state.autoProfile.storage === value) card.classList.add('active');
        const title = document.createElement('h3');
        title.textContent = label;
        card.appendChild(title);
        const selectStorage = () => {
          state.autoProfile.storage = value;
          saveState();
          ensurePrompts();
          render();
        };
        card.addEventListener('click', selectStorage);
        enhanceCardInteractivity(card, selectStorage);
        storageGrid.appendChild(card);
      });
      storageSection.appendChild(storageGrid);
      wrapper.appendChild(storageSection);

      const integrationsSection = document.createElement('div');
      integrationsSection.appendChild(createSectionTitle('–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó'));
      const integrationsChips = document.createElement('div');
      integrationsChips.className = 'chip-group';
      INTEGRATIONS.forEach((integration) => {
        const chip = document.createElement('div');
        chip.className = 'chip';
        chip.textContent = integration;
        if (state.autoProfile.integrations.includes(integration)) chip.classList.add('active');
        chip.addEventListener('click', () => {
          handleChipToggle(chip, state.autoProfile.integrations, integration);
          ensurePrompts();
        });
        enhanceChipInteractivity(chip);
        integrationsChips.appendChild(chip);
      });
      integrationsSection.appendChild(integrationsChips);
      wrapper.appendChild(integrationsSection);

      const backendSection = document.createElement('div');
      backendSection.appendChild(createSectionTitle('–ë–µ–∫–µ–Ω–¥'));
      const backendGrid = document.createElement('div');
      backendGrid.className = 'card-grid';
      BACKENDS.forEach(([value, label]) => {
        const card = document.createElement('div');
        card.className = 'card';
        if (state.autoProfile.backend === value) card.classList.add('active');
        const title = document.createElement('h3');
        title.textContent = label;
        card.appendChild(title);
        const selectBackend = () => {
          state.autoProfile.backend = value;
          saveState();
          ensurePrompts();
          render();
        };
        card.addEventListener('click', selectBackend);
        enhanceCardInteractivity(card, selectBackend);
        backendGrid.appendChild(card);
      });
      backendSection.appendChild(backendGrid);
      wrapper.appendChild(backendSection);

      const diffSection = document.createElement('div');
      diffSection.appendChild(createSectionTitle('–†—ñ–≤–µ–Ω—å —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ'));
      diffSection.appendChild(
        createSelect('–û–±–µ—Ä—ñ—Ç—å —Ä—ñ–≤–µ–Ω—å', state.autoProfile.difficulty, DIFFICULTIES, (value) => {
          state.autoProfile.difficulty = value;
          saveState();
          ensurePrompts();
        })
      );
      wrapper.appendChild(diffSection);

      container.appendChild(wrapper);
    }

    function createSectionTitle(text) {
      const title = document.createElement('h3');
      title.textContent = text;
      title.style.margin = '0 0 12px';
      return title;
    }
    function renderAccountsStep(container) {
      const block = document.createElement('div');
      block.className = 'step-body';

      const info = document.createElement('div');
      info.className = 'info-block';
      info.innerHTML = `
        <strong>–©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è —Ü—å–æ–≥–æ –µ—Ç–∞–ø—É:</strong>
        <ol class="guide-list">
          <li>–ê–∫—Ç–∏–≤–Ω–∏–π <strong>Telegram</strong> –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å ‚Äî —Å–∞–º–µ —Ç–∞–º —Ç–µ—Å—Ç—É–≤–∞—Ç–∏–º–µ–º–æ –±–æ—Ç–∞.</li>
          <li>–î–æ—Å—Ç—É–ø –¥–æ <strong>ChatGPT</strong> –∞–±–æ –∞–Ω–∞–ª–æ–≥–∞ (–¥–ª—è —Ä–µ–∂–∏–º—É ASSISTED —Ç–µ–∂ –ø—ñ–¥—ñ–π–¥–µ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π —Ç–∞—Ä–∏—Ñ).</li>
          <li>–°—Ç–≤–æ—Ä–µ–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å —É <strong>Cursor</strong> ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä, —É —è–∫–æ–º—É –≥–µ–Ω–µ—Ä—É—î–º–æ –∫–æ–¥.</li>
          <li>${state.environment === 'Codespaces'
            ? '–û–±–æ–≤‚Äô—è–∑–∫–æ–≤–∏–π –∞–∫–∞—É–Ω—Ç <strong>GitHub</strong> ‚Äî –±–µ–∑ –Ω—å–æ–≥–æ Codespaces –Ω–µ –≤—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è.'
            : '–ë–∞–∂–∞–Ω–æ –º–∞—Ç–∏ –∞–∫–∞—É–Ω—Ç <strong>GitHub</strong>, —â–æ–± –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –∫–æ–¥ –∞–±–æ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ Codespaces –∑–∞ –ø–æ—Ç—Ä–µ–±–∏.'}</li>
        </ol>
        –ö–æ–∂–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∏–∂—á–µ –≤—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è –≤ –Ω–æ–≤—ñ–π –≤–∫–ª–∞–¥—Ü—ñ. –°—Ç–≤–æ—Ä–∏ –∞–∫–∞—É–Ω—Ç–∏, —è–∫—â–æ —ó—Ö —â–µ –Ω–µ–º–∞—î.
      `;

      const actions = document.createElement('div');
      actions.className = 'prompt-actions';

      const links = [
        { label: '–í—ñ–¥–∫—Ä–∏—Ç–∏ ChatGPT', url: 'https://chat.openai.com/' },
        { label: '–°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–∫–∞—É–Ω—Ç Cursor', url: 'https://www.cursor.com/' },
        { label: '–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –∑ Telegram', url: 'https://telegram.org/faq' }
      ];
      if (state.environment === 'Codespaces') {
        links.push({ label: '–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è GitHub', url: 'https://github.com/signup' });
      } else {
        links.push({ label: 'GitHub (–æ–ø—Ü—ñ–π–Ω–æ)', url: 'https://github.com/signup' });
      }

      links.forEach((item) => {
        const btn = document.createElement('button');
        btn.textContent = item.label;
        btn.addEventListener('click', () => window.open(item.url, '_blank'));
        actions.appendChild(btn);
      });

      block.appendChild(info);
      block.appendChild(actions);
      renderAckToggle(
        block,
        'accounts',
        '–Ø —É–≤—ñ–π—à–æ–≤ –∞–±–æ —Å—Ç–≤–æ—Ä–∏–≤ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –∞–∫–∞—É–Ω—Ç–∏',
        '–¶–µ –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –∫—Ä–æ–∫–∞—Ö –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–∞–±–ª–æ–∫—É—î—Ç—å—Å—è.'
      );

      container.appendChild(block);
    }

    function renderWorkspaceStep(container) {
      const block = document.createElement('div');
      block.className = 'step-body';

      const info = document.createElement('div');
      info.className = 'info-block';
      if (state.environment === 'Codespaces') {
        info.innerHTML = `
          <strong>–ì–æ—Ç—É—î–º–æ GitHub Codespaces:</strong>
          <ol class="guide-list">
            <li>–ù–∞ github.com –Ω–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É <em>¬´Code¬ª ‚Üí ¬´Create codespace on main¬ª</em>. –Ø–∫—â–æ –∫–Ω–æ–ø–∫–∏ –Ω–µ–º–∞—î ‚Äî –∑–∞–π–¥–∏ —É —Ä–æ–∑–¥—ñ–ª Codespaces —Ç–∞ —Å—Ç–≤–æ—Ä–∏ –ø–æ—Ä–æ–∂–Ω—ñ–π.</li>
            <li>–ó–∞—á–µ–∫–∞–π, –ø–æ–∫–∏ –≤—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è –≤—ñ–∫–Ω–æ –∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º. –¶–µ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∏–π VS Code —É –±—Ä–∞—É–∑–µ—Ä—ñ.</li>
            <li>–£ –º–µ–Ω—é –∑–≤–µ—Ä—Ö—É –∑–Ω–∞–π–¥–∏ <strong>Terminal ‚Üí New Terminal</strong>. –ó–Ω–∏–∑—É –∑‚Äô—è–≤–∏—Ç—å—Å—è –ø–∞–Ω–µ–ª—å —ñ–∑ –∫–æ–Ω—Å–æ–ª–ª—é ‚Äî —Å—é–¥–∏ –≤—Å—Ç–∞–≤–ª—è—Ç–∏–º–µ–º–æ –∫–æ–º–∞–Ω–¥–∏.</li>
          </ol>
          –Ø–∫—â–æ —â–æ—Å—å –∑–∞–≤–∏—Å–ª–æ ‚Äî –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂ —Å—Ç–æ—Ä—ñ–Ω–∫—É –∞–±–æ –Ω–∞—Ç–∏—Å–Ω–∏ ¬´Stop¬ª ‚Üí ¬´Start¬ª —É —Å–ø–∏—Å–∫—É Codespaces.
        `;
      } else {
        info.innerHTML = `
          <strong>–õ–æ–∫–∞–ª—å–Ω–∏–π —Ä–µ–∂–∏–º (Windows/macOS/Linux):</strong>
          <ol class="guide-list">
            <li>–°—Ç–≤–æ—Ä–∏ –ø–∞–ø–∫—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ <code>my-telegram-bot</code>, —É –∑—Ä—É—á–Ω–æ–º—É –º—ñ—Å—Ü—ñ –Ω–∞ –∫–æ–º–ø‚Äô—é—Ç–µ—Ä—ñ.</li>
            <li>–í—ñ–¥–∫—Ä–∏–π —ó—ó —É VS Code: <em>File ‚Üí Open Folder</em>. –ü–æ–≥–æ–¥—å—Å—è –Ω–∞ ¬´Yes, I trust the authors¬ª.</li>
            <li>–í—ñ–¥–∫—Ä–∏–π —Ç–µ—Ä–º—ñ–Ω–∞–ª: <strong>View ‚Üí Terminal</strong> –∞–±–æ –Ω–∞—Ç–∏—Å–Ω–∏ <kbd>Ctrl</kbd>+<kbd>&#96;</kbd> (–Ω–∞ macOS ‚Äî <kbd>‚åò</kbd>+<kbd>&#96;</kbd>).</li>
            <li>–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –≤–≥–æ—Ä—ñ —Ç–µ—Ä–º—ñ–Ω–∞–ª–∞ –≤–∏–¥–Ω–æ —à–ª—è—Ö –¥–æ —Ç–≤–æ—î—ó –ø–∞–ø–∫–∏. –Ø–∫—â–æ –Ω—ñ ‚Äî –Ω–∞–ø–∏—à–∏ <code>pwd</code> (macOS/Linux) –∞–±–æ <code>cd</code> (Windows) —ñ –ø–æ–≤—Ç–æ—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è.</li>
          </ol>
          –¢–µ—Ä–º—ñ–Ω–∞–ª ‚Äî —Ü–µ –º—ñ—Å—Ü–µ, –¥–µ –º–∏ –≤–≤–æ–¥–∏–º–æ –∫–æ–º–∞–Ω–¥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫—É –±–æ—Ç–∞.
        `;
      }

      block.appendChild(info);
      renderAckToggle(
        block,
        'workspace',
        '–Ø –≤—ñ–¥–∫—Ä–∏–≤ —Ä–æ–±–æ—á—É –ø–∞–ø–∫—É —ñ –±–∞—á—É —Ç–µ—Ä–º—ñ–Ω–∞–ª',
        state.environment === 'Codespaces'
          ? '–£–Ω–∏–∑—É –≤—ñ–∫–Ω–∞ Codespaces –º–∞—î –±—É—Ç–∏ –ø–∞–Ω–µ–ª—å —ñ–∑ –ø—Ä–æ–º–ø—Ç-–∑–Ω–∞–∫–æ–º $. –Ø–∫—â–æ –Ω—ñ ‚Äî –≤—ñ–¥–∫—Ä–∏–π –Ω–æ–≤–∏–π —Ç–µ—Ä–º—ñ–Ω–∞–ª.'
          : '–Ø–∫—â–æ —Ç–µ—Ä–º—ñ–Ω–∞–ª –Ω–µ –∑‚Äô—è–≤–∏–≤—Å—è ‚Äî —â–µ —Ä–∞–∑ –æ–±–µ—Ä–∏ View ‚Üí Terminal.'
      );

      container.appendChild(block);
    }

    function renderFilesIntroStep(container) {
      const block = document.createElement('div');
      block.className = 'step-body';

      const info = document.createElement('div');
      info.className = 'info-block';
      info.innerHTML = `
        <strong>–Ø–∫ –º–∏ –ø—Ä–∞—Ü—é—î–º–æ –∑ —Ñ–∞–π–ª–∞–º–∏:</strong>
        <ol class="guide-list">
          <li>–ü–∞–Ω–µ–ª—å –≥–µ–Ω–µ—Ä—É—î –∞–Ω–≥–ª–æ–º–æ–≤–Ω—ñ –ø—Ä–æ–º–ø—Ç–∏. Cursor –ø–∏—à–µ –∫–æ–¥, –∞–ª–µ —Ñ–∞–π–ª–∏ —Å—Ç–≤–æ—Ä—é—î—à —Ç–∏ (–º–∏ –ø—ñ–¥–∫–∞–∂–µ–º–æ, —â–æ —Å–∞–º–µ –∫–æ–ø—ñ—é–≤–∞—Ç–∏).</li>
          <li>–ü—ñ—Å–ª—è –∫–æ–∂–Ω–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ Cursor –∫–æ–ø—ñ—é–π –ø–æ—Ç—Ä—ñ–±–Ω—ñ —à–º–∞—Ç–∫–∏ –∫–æ–¥—É —É VS Code/Codespaces. –ó–±–µ—Ä—ñ–≥–∞–π —Ñ–∞–π–ª–∏ –ø–æ <kbd>Ctrl</kbd>+<kbd>S</kbd>.</li>
          <li>–Ø–∫—â–æ –Ω–µ –≤–ø–µ–≤–Ω–µ–Ω–∏–π, —â–æ –≤—Å—Ç–∞–≤–∏–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî –ø–æ–ø—Ä–æ—Å–∏ Cursor –ø–æ–≤—Ç–æ—Ä–∏—Ç–∏ –∞–±–æ –ø–æ–∫–∞–∂–∏ –π–æ–º—É –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É.</li>
          <li>–ú–∏ —Ä—É—Ö–∞—î–º–æ—Å—å –º–∞–ª–µ–Ω—å–∫–∏–º–∏ –∫—Ä–æ–∫–∞–º–∏: —Å–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä—é—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ —Ñ–∞–π–ª–∏, –ø–æ—Ç—ñ–º –≤—Å—Ç–∞–≤–ª—è—î–º–æ –∫–æ–¥ —ñ –ª–∏—à–µ –ø—ñ—Å–ª—è —Ü—å–æ–≥–æ –∑–∞–ø—É—Å–∫–∞—î–º–æ –±–æ—Ç–∞.</li>
        </ol>
      `;

      block.appendChild(info);
      renderAckToggle(
        block,
        'files-intro',
        '–Ø —Ä–æ–∑—É–º—ñ—é, —â–æ –∫–æ–¥ –≥–µ–Ω–µ—Ä—É—î Cursor, –∞ —Ñ–∞–π–ª–∏ —Ä–µ–¥–∞–≥—É—é —è',
        '–ù–µ —Ö–≤–∏–ª—é–π—Å—è: –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –∫—Ä–æ–∫–∞—Ö –±—É–¥—É—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ñ–∞–π–ª—É.'
      );

      container.appendChild(block);
    }

    function renderFileRequirementsStep(container) {
      const block = document.createElement('div');
      block.className = 'step-body';

      const info = document.createElement('div');
      info.className = 'info-block';
      info.innerHTML = `
        <strong>–§–∞–π–ª requirements.txt</strong> ‚Äî —Å–ø–∏—Å–æ–∫ –±—ñ–±–ª—ñ–æ—Ç–µ–∫, —è–∫—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ.
        <ol class="guide-list">
          <li>–£ —Ñ–∞–π–ª–æ–≤–æ–º—É –¥–µ—Ä–µ–≤—ñ –Ω–∞—Ç–∏—Å–Ω–∏ –ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é <em>New File</em> ‚Üí –≤–≤–µ–¥–∏ <code>requirements.txt</code>.</li>
          <li>–°–∫–æ–ø—ñ—é–π —Ä—è–¥–∫–∏ –Ω–∏–∂—á–µ —Ç–∞ –≤—Å—Ç–∞–≤ —É —Ñ–∞–π–ª. –í–æ–Ω–∏ –æ–¥–Ω–∞–∫–æ–≤—ñ –¥–ª—è Local —ñ Codespaces.</li>
          <li>–ó–±–µ—Ä–µ–∂–∏ —Ñ–∞–π–ª (<kbd>Ctrl</kbd>+<kbd>S</kbd> –∞–±–æ <kbd>‚åò</kbd>+<kbd>S</kbd>).</li>
        </ol>
      `;

      const code = document.createElement('div');
      code.className = 'prompt-area';
      code.textContent = 'aiogram==3.*\npython-dotenv';

      block.appendChild(info);
      block.appendChild(code);
      renderAckToggle(
        block,
        'file-requirements',
        'requirements.txt —Å—Ç–≤–æ—Ä–µ–Ω–æ —Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–æ',
        '–Ø–∫—â–æ —Ñ–∞–π–ª —É–∂–µ –±—É–≤ ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ —Ç–∞–º —Å–∞–º–µ —Ü—ñ –¥–≤–∞ —Ä—è–¥–∫–∏.'
      );

      container.appendChild(block);
    }

    function renderFileMainStep(container) {
      const block = document.createElement('div');
      block.className = 'step-body';

      const info = document.createElement('div');
      info.className = 'info-block';
      info.innerHTML = `
        <strong>–§–∞–π–ª main.py</strong> ‚Äî –æ—Å–Ω–æ–≤–∞ –Ω–∞—à–æ–≥–æ –±–æ—Ç–∞.
        <ol class="guide-list">
          <li>–°—Ç–≤–æ—Ä–∏ –ø–æ—Ä–æ–∂–Ω—ñ–π —Ñ–∞–π–ª <code>main.py</code> —É –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ—î–∫—Ç—É. –Ø–∫—â–æ –≤—ñ–Ω —É–∂–µ —î ‚Äî –æ—á–∏—Å—Ç–∏ –≤–º—ñ—Å—Ç.</li>
          <li>–ö–æ–ª–∏ Cursor –∑–≥–µ–Ω–µ—Ä—É—î –∫–æ–¥, –≤–∏–¥—ñ–ª–∏ –≤—Å—é –≤—ñ–¥–ø–æ–≤—ñ–¥—å (Ctrl+A ‚Üí Ctrl+C) —ñ –≤—Å—Ç–∞–≤ —É —Ñ–∞–π–ª (Ctrl+V).</li>
          <li>–ó–±–µ—Ä–µ–∂–∏ —Ñ–∞–π–ª. –Ø–∫—â–æ Cursor –ø—Ä–æ–ø–æ–Ω—É—î –∫—ñ–ª—å–∫–∞ —Ñ–∞–π–ª—ñ–≤, —Å–ø–æ—á–∞—Ç–∫—É –≤—Å—Ç–∞–≤ main.py, –ø–æ—Ç—ñ–º –ø–æ–≤–µ—Ä–Ω–∏—Å—å —Å—é–¥–∏ –π –ø—Ä–æ—á–∏—Ç–∞–π –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏.</li>
          <li>–ó–∞ –ø–æ—Ç—Ä–µ–±–∏ –ø–æ–ø—Ä–æ—Å–∏ Cursor: ¬´–ü–æ–∫–∞–∂–∏, —è–∫ –º–∞—î –≤–∏–≥–ª—è–¥–∞—Ç–∏ main.py –ø–æ–≤–Ω—ñ—Å—Ç—é¬ª, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–µ–±–µ.</li>
        </ol>
      `;

      block.appendChild(info);
      renderAckToggle(
        block,
        'file-main',
        '–Ø –∑–Ω–∞—é, —è–∫ –∑–∞–ø–æ–≤–Ω—é–≤–∞—Ç–∏ main.py –∫–æ–¥–æ–º —ñ–∑ Cursor',
        '–ü—ñ–∑–Ω—ñ—à–µ –º–∏ —â–µ —Ä–∞–∑ –Ω–∞–≥–∞–¥–∞—î–º–æ –ø—Ä–æ —Ü–µ –ø—ñ–¥ —á–∞—Å –≤—Å—Ç–∞–≤–∫–∏ –ø—Ä–æ–º–ø—Ç–∞.'
      );

      container.appendChild(block);
    }

    function renderFileEnvStep(container) {
      const block = document.createElement('div');
      block.className = 'step-body';

      const info = document.createElement('div');
      info.className = 'info-block';
      info.innerHTML = `
        <strong>–§–∞–π–ª .env</strong> –∑–±–µ—Ä—ñ–≥–∞—î —Å–µ–∫—Ä–µ—Ç–∏.
        <ol class="guide-list">
          <li>–°—Ç–≤–æ—Ä–∏ —Ñ–∞–π–ª <code>.env</code> (–Ω–∞–∑–≤–∞ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ –∫—Ä–∞–ø–∫–∏). –£—Å–µ—Ä–µ–¥–∏–Ω—ñ –¥–æ–¥–∞–π —Ä—è–¥–æ–∫ <code>TOKEN=—Å—é–¥–∏_–≤—Å—Ç–∞–≤–∏—à_–∫–ª—é—á</code>.</li>
          <li>–°—Ç–≤–æ—Ä–∏ —Ñ–∞–π–ª <code>.env.example</code> —ñ–∑ —Ç–∞–∫–∏–º —Å–∞–º–∏–º —Ä—è–¥–∫–æ–º, –∞–ª–µ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞. –ô–æ–≥–æ –º–æ–∂–Ω–∞ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ —ñ–Ω—à–∏–º.</li>
          <li>–ü–æ–ø—Ä–æ—Å–∏ Cursor –¥–æ–¥–∞—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥ —É README: –≤—ñ–Ω —Ü–µ –∑—Ä–æ–±–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞ –Ω–∞—à–∏–º –ø—Ä–æ–º–ø—Ç–æ–º.</li>
          <li>–ö–æ–ª–∏ –æ—Ç—Ä–∏–º–∞—î—à —Ç–æ–∫–µ–Ω –≤—ñ–¥ BotFather, –≤—Å—Ç–∞–≤ –π–æ–≥–æ —É <code>.env</code>. –¶–µ–π —Ñ–∞–π–ª –Ω–µ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –Ω—ñ–∫—É–¥–∏.</li>
        </ol>
      `;

      block.appendChild(info);
      renderAckToggle(
        block,
        'file-env',
        '.env —ñ .env.example —Å—Ç–≤–æ—Ä–µ–Ω–æ –∞–±–æ —è –∑–Ω–∞—é, —è–∫ —ó—Ö —Å—Ç–≤–æ—Ä–∏—Ç–∏',
        '–ù–∞–≤—ñ—Ç—å —è–∫—â–æ —Ç–æ–∫–µ–Ω–∞ —â–µ –Ω–µ–º–∞—î ‚Äî –ø—ñ–¥–≥–æ—Ç—É–π —Ñ–∞–π–ª–∏ –∑–∞–∑–¥–∞–ª–µ–≥—ñ–¥—å.'
      );

      container.appendChild(block);
    }

    function renderCursorGuideStep(container) {
      const block = document.createElement('div');
      block.className = 'step-body';

      const info = document.createElement('div');
      info.className = 'info-block';
      info.innerHTML = `
        <strong>–ü–µ—Ä–µ–¥ —Ç–∏–º —è–∫ –≤—ñ–¥–∫—Ä–∏–≤–∞—Ç–∏ Cursor:</strong>
        <ol class="guide-list">
          <li>–£ Cursor —î –¥–≤–∞ —Ä–µ–∂–∏–º–∏: Chat 1 (–ù–∞–≤—ñ–≥–∞—Ç–æ—Ä) –¥–ª—è –ø–æ—è—Å–Ω–µ–Ω—å —ñ Chat 2 (Cursor) –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –∫–æ–¥—É. –ú–∏ –ø—Ä–∞—Ü—é—î–º–æ —Å–∞–º–µ –∑ Chat 2.</li>
          <li>Cursor –≥–µ–Ω–µ—Ä—É—î –∫–æ–¥, –∞–ª–µ <strong>–Ω–µ –∑–º—ñ–Ω—é—î —Ñ–∞–π–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</strong>. –ü—ñ—Å–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —Ç–∏ –∫–æ–ø—ñ—é—î—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É VS Code/Codespaces.</li>
          <li>–Ø–∫—â–æ Cursor –ø—Ä–æ–ø–æ–Ω—É—î ¬´Apply¬ª ‚Äî —Å–ø–æ—á–∞—Ç–∫—É –ø—Ä–æ—á–∏—Ç–∞–π –∑–º—ñ–Ω–∏. –ù–æ–≤–∞—á–∫–∞–º –∑—Ä—É—á–Ω—ñ—à–µ –∫–æ–ø—ñ—é–≤–∞—Ç–∏ –≤—Ä—É—á–Ω—É, —â–æ–± –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–∞–≥—É–±–∏—Ç–∏.</li>
          <li>–ö–æ–ª–∏ —â–æ—Å—å –Ω–µ –∑—Ä–æ–∑—É–º—ñ–ª–æ, –Ω–∞–ø–∏—à–∏ –≤ –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä: ¬´–ü–æ—è—Å–Ω–∏ –ø–æ–∫—Ä–æ–∫–æ–≤–æ, —â–æ —Ä–æ–±–∏—Ç–∏ –∑ —Ü—ñ—î—é –≤—ñ–¥–ø–æ–≤—ñ–¥–¥—é¬ª ‚Äî –≤—ñ–Ω —Ä–æ–∑–∫–ª–∞–¥–µ –Ω–∞ –ø—Ä–æ—Å—Ç—ñ –¥—ñ—ó.</li>
        </ol>
      `;

      block.appendChild(info);
      renderAckToggle(
        block,
        'cursor-guide',
        '–Ø —Ä–æ–∑—É–º—ñ—é, —â–æ Cursor –ø–∏—à–µ –∫–æ–¥, –∞ —è –ø–µ—Ä–µ–Ω–æ—Å—é –π–æ–≥–æ —É —Ñ–∞–π–ª–∏',
        '–¶–µ –≥–æ–ª–æ–≤–Ω–µ –ø—Ä–∞–≤–∏–ª–æ, —â–æ–± —É—Å–µ –ø—Ä–∞—Ü—é–≤–∞–ª–æ –±–µ–∑–ø–µ—á–Ω–æ.'
      );

      container.appendChild(block);
    }
    function renderOverviewStep(container) {
      ensurePrompts();

      const info = document.createElement('div');
      info.className = 'info-block';
      info.innerHTML = `
        <strong>–Ø–∫ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –ø—Ä–æ–º–ø—Ç–∞–º–∏ –Ω–∞ —Ü—å–æ–º—É –∫—Ä–æ—Ü—ñ:</strong>
        <ol class="guide-list">
          <li>–ù–∞—Ç–∏—Å–Ω–∏ ¬´–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏¬ª –ø—ñ–¥ –ø–æ—Ç—Ä—ñ–±–Ω–∏–º –±–ª–æ–∫–æ–º.</li>
          <li>${state.mode === 'ASSISTED'
            ? '–í—Å—Ç–∞–≤ —Ç–µ–∫—Å—Ç —É ChatGPT (–ù–∞–≤—ñ–≥–∞—Ç–æ—Ä), –¥–æ—á–µ–∫–∞–π—Å—è DEV BRIEF –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é —Ç–∞ –≤—Å—Ç–∞–≤ –π–æ–≥–æ –Ω–∞–∑–∞–¥ —É –ø–æ–ª–µ –Ω–∏–∂—á–µ.'
            : '–í—Å—Ç–∞–≤ –æ–¥—Ä–∞–∑—É —É Cursor (Chat 2). –í—ñ–Ω —Å—Ç–≤–æ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ—î–∫—Ç—É –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é.'}</li>
          <li>–ü—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏ –ø–æ–≤–µ—Ä–Ω–∏—Å—å —É –ø–∞–Ω–µ–ª—å —ñ –Ω–∞—Ç–∏—Å–Ω–∏ ¬´–î–∞–ª—ñ¬ª –ª–∏—à–µ –∫–æ–ª–∏ –∫—Ä–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–æ.</li>
          <li>–Ø–∫—â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–µ–∑—Ä–æ–∑—É–º—ñ–ª–∞ ‚Äî –Ω–∞—Ç–∏—Å–Ω–∏ ¬´–ü—Ä–æ–±–ª–µ–º–∞?¬ª –∞–±–æ –∑–≤–µ—Ä–Ω–∏—Å—å –¥–æ –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä–∞ –∑ –ø–∏—Ç–∞–Ω–Ω—è–º ¬´–ü–æ—è—Å–Ω–∏ —Ü–µ–π –∫—Ä–æ–∫¬ª.</li>
        </ol>
      `;
      container.appendChild(info);

      if (state.mode === 'ASSISTED') {
        const assistedCard = document.createElement('div');
        assistedCard.className = 'card';
        const label = document.createElement('div');
        label.className = 'prompt-label chat1';
        label.textContent = 'Chat 1 ¬∑ –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä';
        assistedCard.appendChild(label);
        const text = document.createElement('div');
        text.className = 'prompt-area';
        text.textContent = generateAssistedPrompt();
        assistedCard.appendChild(text);

        const actions = document.createElement('div');
        actions.className = 'prompt-actions';
        const copy = document.createElement('button');
        copy.className = 'chat2';
        copy.textContent = '–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –¥–ª—è ChatGPT';
        copy.addEventListener('click', () => copyText(text.textContent));
        actions.appendChild(copy);
        assistedCard.appendChild(actions);
        container.appendChild(assistedCard);

        const textareaLabel = document.createElement('label');
        textareaLabel.textContent = '–í—Å—Ç–∞–≤ DEV BRIEF, —è–∫–∏–π –ø–æ–≤–µ—Ä–Ω—É–≤ ChatGPT';
        const textarea = document.createElement('textarea');
        textarea.placeholder = '–í—Å—Ç–∞–≤ —Å—é–¥–∏ —Ç–µ–∫—Å—Ç –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é. –ú–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏–º–æ –π–æ–≥–æ –Ω–∞ –ø—Ä–æ–º–ø—Ç –¥–ª—è Cursor.';
        textarea.value = state.assistedBrief;
        textarea.addEventListener('input', (event) => {
          state.assistedBrief = event.target.value;
          saveState();
          ensurePrompts();
          render();
        });
        textareaLabel.appendChild(textarea);
        container.appendChild(textareaLabel);
      }

      const briefCard = document.createElement('div');
      briefCard.className = 'card';
      const briefLabel = document.createElement('div');
      briefLabel.className = 'prompt-label chat1';
      briefLabel.textContent = 'DEV BRIEF';
      const briefText = document.createElement('div');
      briefText.className = 'prompt-area';
      briefText.textContent = state.generatedBrief;
      const briefCopy = document.createElement('button');
      briefCopy.textContent = '–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ DEV BRIEF';
      briefCopy.addEventListener('click', () => copyText(state.generatedBrief));
      briefCard.appendChild(briefLabel);
      briefCard.appendChild(briefText);
      briefCard.appendChild(briefCopy);
      container.appendChild(briefCard);

      const cursorCard = document.createElement('div');
      cursorCard.className = 'card';
      const cursorLabel = document.createElement('div');
      cursorLabel.className = 'prompt-label cursor';
      cursorLabel.textContent = 'Cursor Prompt';
      const cursorText = document.createElement('div');
      cursorText.className = 'prompt-area';
      cursorText.textContent = state.generatedCursorPrompt;
      const cursorCopy = document.createElement('button');
      cursorCopy.className = 'chat2';
      cursorCopy.textContent = '–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –¥–ª—è Cursor';
      cursorCopy.addEventListener('click', () => copyText(state.generatedCursorPrompt));
      cursorCard.appendChild(cursorLabel);
      cursorCard.appendChild(cursorText);
      cursorCard.appendChild(cursorCopy);
      container.appendChild(cursorCard);

      const checklistCard = document.createElement('div');
      checklistCard.className = 'card';
      const checklistLabel = document.createElement('div');
      checklistLabel.className = 'prompt-label';
      checklistLabel.textContent = 'CHECKLIST';
      const list = document.createElement('div');
      list.className = 'checklist';
      state.generatedChecklist.forEach((item) => {
        const row = document.createElement('div');
        row.className = 'check-item';
        row.innerHTML = `<span>‚Ä¢</span><span>${item}</span>`;
        list.appendChild(row);
      });
      checklistCard.appendChild(checklistLabel);
      checklistCard.appendChild(list);
      container.appendChild(checklistCard);
    }
    function renderEnvironmentStep(container) {
      const grid = document.createElement('div');
      grid.className = 'card-grid';

      const localCard = createEnvironmentCard('Local', 'üíª', '–ü—Ä–∞—Ü—é—î—à –Ω–∞ —Å–≤–æ—î–º—É –∫–æ–º–ø‚Äô—é—Ç–µ—Ä—ñ. –ü–æ—Ç—Ä—ñ–±–Ω—ñ Python 3.10+ —ñ Cursor.', [
        '–ü–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ñ–∞–π–ª–∞–º–∏',
        '–ü—Ä–∞—Ü—é—î –æ—Ñ–ª–∞–π–Ω',
        '–í–∏–º–∞–≥–∞—î –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º'
      ]);

      const cloudCard = createEnvironmentCard('Codespaces', '‚òÅÔ∏è', '–í—Å–µ –ø—Ä–∞—Ü—é—î –≤ –±—Ä–∞—É–∑–µ—Ä—ñ. –ù—ñ—á–æ–≥–æ —Å—Ç–∞–≤–∏—Ç–∏ –Ω–µ —Ç—Ä–µ–±–∞, —Ç—ñ–ª—å–∫–∏ GitHub-–∞–∫–∞—É–Ω—Ç.', [
        '–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ –∑ Linux',
        '–ó—Ä—É—á–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –¥–ª—è —Å–ª–∞–±–∫–∏—Ö –ü–ö',
        '–ü–æ—Ç—Ä—ñ–±–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É'
      ]);

      if (state.environment === 'Local') localCard.classList.add('active');
      if (state.environment === 'Codespaces') cloudCard.classList.add('active');

      grid.appendChild(localCard);
      grid.appendChild(cloudCard);

      container.appendChild(grid);

      const tip = document.createElement('div');
      tip.className = 'info-block';
      tip.innerHTML = `
        <strong>–©–æ –æ–±—Ä–∞—Ç–∏?</strong><br>
        –Ø–∫—â–æ –≤–ø–µ–≤–Ω–µ–Ω–æ –ø—Ä–∞—Ü—é—î—à —ñ–∑ —Ñ–∞–π–ª–∞–º–∏ ‚Äî –æ–±–∏—Ä–∞–π Local. –Ø–∫—â–æ —Ö–æ—á–µ—à –º—ñ–Ω—ñ–º—É–º –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å ‚Äî –æ–±–∏—Ä–∞–π Codespaces. –¢–∏ –º–æ–∂–µ—à –∑–º—ñ–Ω–∏—Ç–∏ –≤–∏–±—ñ—Ä –ø—ñ–∑–Ω—ñ—à–µ.
      `;
      container.appendChild(tip);
    }

    function createEnvironmentCard(name, emoji, text, bullets) {
      const card = document.createElement('div');
      card.className = 'card';
      const title = document.createElement('h3');
      title.textContent = `${emoji} ${name}`;
      const desc = document.createElement('p');
      desc.textContent = text;
      card.appendChild(title);
      card.appendChild(desc);
      const list = document.createElement('ul');
      list.style.margin = '0';
      list.style.paddingLeft = '18px';
      bullets.forEach((bullet) => {
        const li = document.createElement('li');
        li.textContent = bullet;
        list.appendChild(li);
      });
      card.appendChild(list);
      card.addEventListener('click', () => {
        state.environment = name;
        saveState();
        ensurePrompts();
        render();
        showToast(`–û–±—Ä–∞–Ω–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ: ${name}`);
      });
      return card;
    }

    function renderToolsStep(container) {
      const tools = [
        {
          key: 'python',
          label: 'Python 3.10+',
          description: '–ë–µ–∑ Python –±–æ—Ç –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è. –ù–∞—Ç–∏—Å–Ω–∏, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è.',
          link: 'https://www.python.org/downloads/'
        },
        {
          key: 'cursor',
          label: 'Cursor IDE',
          description: '–†–µ–¥–∞–∫—Ç–æ—Ä –∑ –≤–±—É–¥–æ–≤–∞–Ω–∏–º Chat 2. –ü–æ—Ç—Ä—ñ–±–µ–Ω –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞.',
          link: 'https://www.cursor.com/'
        },
        {
          key: 'editor',
          label: 'VS Code (–æ–ø—Ü—ñ–π–Ω–æ)',
          description: '–ó—Ä—É—á–Ω–∏–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É —Ñ–∞–π–ª—ñ–≤, —è–∫—â–æ –ø—Ä–∞—Ü—é—î—à –ª–æ–∫–∞–ª—å–Ω–æ.',
          link: 'https://code.visualstudio.com/'
        },
        {
          key: 'codespaces',
          label: 'GitHub Codespaces',
          description: '–í—ñ–¥–∫—Ä–∏–π –≥–æ—Ç–æ–≤–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ.',
          link: 'https://github.com/codespaces'
        }
      ];

      const list = document.createElement('div');
      list.className = 'checklist';

      tools.forEach((tool) => {
        if (tool.key === 'codespaces' && state.environment !== 'Codespaces') return;
        if (tool.key !== 'codespaces' && state.environment === 'Codespaces' && tool.key === 'editor') return;
        const item = document.createElement('label');
        item.className = 'check-item';
        if (state.tools[tool.key]) item.classList.add('completed');
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = !!state.tools[tool.key];
        checkbox.addEventListener('change', (event) => {
          state.tools[tool.key] = event.target.checked;
          saveState();
          if (event.target.checked) {
            item.classList.add('completed');
            showToast(`${tool.label} –≥–æ—Ç–æ–≤–æ!`);
          } else {
            item.classList.remove('completed');
          }
        });
        const body = document.createElement('div');
        body.innerHTML = `<strong>${tool.label}</strong><br>${tool.description}`;
        const button = document.createElement('button');
        button.textContent = '–í—ñ–¥–∫—Ä–∏—Ç–∏';
        button.addEventListener('click', () => window.open(tool.link, '_blank'));
        item.appendChild(checkbox);
        item.appendChild(body);
        item.appendChild(button);
        list.appendChild(item);
      });

      container.appendChild(list);

      const tip = document.createElement('div');
      tip.className = 'info-block';
      tip.innerHTML = `
        <strong>–Ø–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–µ–±–µ:</strong>
        <ol class="guide-list">
          <li>–©–æ–± —É–ø–µ–≤–Ω–∏—Ç–∏—Å—å, —â–æ Python –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π, —É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ –≤–≤–µ–¥–∏ <code>python --version</code> (–∞–±–æ <code>py --version</code> –Ω–∞ Windows). –Ø–∫—â–æ –±–∞—á–∏—à –Ω–æ–º–µ—Ä –≤–µ—Ä—Å—ñ—ó ‚Äî –≤—Å–µ –¥–æ–±—Ä–µ.</li>
          <li>Cursor –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –ø—ñ—Å–ª—è –≤—Ö–æ–¥—É ‚Äî —É –Ω—å–æ–º—É –∑‚Äô—è–≤–∏—Ç—å—Å—è —Ä–æ–±–æ—á–µ –≤—ñ–∫–Ω–æ –∑ —á–∞—Ç–∞–º–∏. –Ø–∫—â–æ –ø—Ä–æ—Å–∏—Ç—å –æ–Ω–æ–≤–∏—Ç–∏ –ø–ª–∞–Ω, –Ω–∞—Ç–∏—Å–Ω–∏ <em>Skip</em>.</li>
          <li>–î–ª—è Codespaces GitHub –º–æ–∂–µ —Å–ø–∏—Ç–∞—Ç–∏ –¥–æ–∑–≤—ñ–ª –Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è ‚Äî –ø–æ–≥–æ–¥–∂—É–π—Å—è —Ç–∞ —á–µ–∫–∞–π –∫—ñ–ª—å–∫–∞ —Ö–≤–∏–ª–∏–Ω.</li>
        </ol>
        –Ø–∫—â–æ —â–æ—Å—å –Ω–µ –≤–∏—Ö–æ–¥–∏—Ç—å ‚Äî –Ω–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É ¬´–ü—Ä–æ–±–ª–µ–º–∞?¬ª —É –Ω–∏–∂–Ω—ñ–π –ø–∞–Ω–µ–ª—ñ, –º–∏ —Å—Ñ–æ—Ä–º—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä–∞.
      `;

      container.appendChild(tip);
    }
    function renderCursorStep(container) {
      const card = document.createElement('div');
      card.className = 'card';
      const label = document.createElement('div');
      label.className = 'prompt-label cursor';
      label.textContent = 'Cursor Prompt';
      const promptArea = document.createElement('div');
      promptArea.className = 'prompt-area';
      promptArea.textContent = state.generatedCursorPrompt;

      const actions = document.createElement('div');
      actions.className = 'prompt-actions';
      const copyBtn = document.createElement('button');
      copyBtn.className = 'chat2';
      copyBtn.textContent = '–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –¥–ª—è Cursor';
      copyBtn.addEventListener('click', () => copyText(state.generatedCursorPrompt));
      const whereBtn = document.createElement('button');
      whereBtn.textContent = '–î–µ –≤—Å—Ç–∞–≤–∏—Ç–∏?';
      whereBtn.addEventListener('click', () => {
        const modal = createModal({
          title: '–ö—É–¥–∏ –≤—Å—Ç–∞–≤–ª—è—Ç–∏ –ø—Ä–æ–º–ø—Ç?',
          body: '–£ Cursor –≤—ñ–¥–∫—Ä–∏–π Chat 2 (–∑–µ–ª–µ–Ω–∏–π). –ù–∞—Ç–∏—Å–Ω–∏ + ‚Üí ¬´New Chat¬ª. –í—Å—Ç–∞–≤ –ø—Ä–æ–º–ø—Ç –ø–æ–≤–Ω—ñ—Å—Ç—é —ñ –Ω–∞—Ç–∏—Å–Ω–∏ Enter. –Ø–∫—â–æ Cursor –∑–∞–≤–∏—Å ‚Äî —Å–ø—Ä–æ–±—É–π –≤—Å—Ç–∞–≤–∏—Ç–∏ —â–µ —Ä–∞–∑ —ñ –ø–æ—á–µ–∫–∞–π –ø–∞—Ä—É —Ö–≤–∏–ª–∏–Ω.'
        });
        openModal(modal);
      });
      const afterBtn = document.createElement('button');
      afterBtn.textContent = '–©–æ —Ä–æ–±–∏—Ç–∏ –ø—ñ—Å–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ?';
      afterBtn.addEventListener('click', () => {
        const modal = createModal({
          title: '–Ø–∫ –¥—ñ—è—Ç–∏ –ø—ñ—Å–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ Cursor',
          body: '–ü—Ä–æ—á–∏—Ç–∞–π –≤—ñ–¥–ø–æ–≤—ñ–¥—å Cursor. –Ø–∫—â–æ —î —Ñ–∞–π–ª–∏, –∫–æ–ø—ñ—é–π –∫–æ–¥ —É —Å–≤—ñ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä, –∑–±–µ—Ä–µ–∂–∏ –∑–º—ñ–Ω–∏ —ñ –ø–æ–≤–µ—Ä–Ω–∏—Å—å —Å—é–¥–∏. –Ø–∫—â–æ –Ω–µ–∑—Ä–æ–∑—É–º—ñ–ª–æ ‚Äî –ø–æ–ø—Ä–æ—Å–∏ Cursor –ø–æ—è—Å–Ω–∏—Ç–∏ –ø—Ä–æ—Å—Ç—ñ—à–µ –∞–±–æ –Ω–∞—Ç–∏—Å–Ω–∏ ¬´–ü—Ä–æ–±–ª–µ–º–∞?¬ª. '
        });
        openModal(modal);
      });
      actions.appendChild(copyBtn);
      actions.appendChild(whereBtn);
      actions.appendChild(afterBtn);

      card.appendChild(label);
      card.appendChild(promptArea);
      card.appendChild(actions);

      container.appendChild(card);

      const helper = document.createElement('div');
      helper.className = 'info-block';
      helper.innerHTML = `
        <strong>–ü–∞–º‚Äô—è—Ç–∫–∞:</strong>
        <ol class="guide-list">
          <li>–ü—ñ—Å–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫–æ–¥—É –≤—Å—Ç–∞–≤ main.py —Ç–∞ —ñ–Ω—à—ñ —Ñ–∞–π–ª–∏ —É —Å–≤—ñ–π –ø—Ä–æ—î–∫—Ç.</li>
          <li>–Ø–∫—â–æ Cursor –ø–æ–∫–∞–∑—É—î –ø–æ–º–∏–ª–∫–∏ ‚Äî —Å–∫–æ–ø—ñ—é–π —ó—Ö —Ä–∞–∑–æ–º —ñ–∑ –∫–æ–¥–æ–º —ñ –∑–≤–µ—Ä–Ω–∏—Å—å –¥–æ –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä–∞.</li>
          <li>–ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π —Ü–µ–π –∫—Ä–æ–∫ –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —â–æ—Å—å –∑–¥–∞—î—Ç—å—Å—è —Å–∫–ª–∞–¥–Ω–∏–º ‚Äî –º–∏ –ø–æ—Ä—É—á.</li>
        </ol>
      `;
      container.appendChild(helper);
    }

    function renderLaunchStep(container) {
      const commands = state.environment === 'Codespaces'
        ? ['python --version', 'pip install -r requirements.txt', 'python main.py']
        : ['python --version', 'python -m venv .venv', 'source .venv/bin/activate  # –∞–±–æ .\\.venv\\Scripts\\activate', 'pip install -r requirements.txt', 'python main.py'];

      const card = document.createElement('div');
      card.className = 'card';
      const label = document.createElement('div');
      label.className = 'prompt-label';
      label.textContent = '–ö–æ–º–∞–Ω–¥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫—É';
      const promptArea = document.createElement('div');
      promptArea.className = 'prompt-area';
      promptArea.textContent = commands.join('\n');

      const actions = document.createElement('div');
      actions.className = 'prompt-actions';
      const copyBtn = document.createElement('button');
      copyBtn.textContent = '–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏';
      copyBtn.addEventListener('click', () => copyText(commands.join('\n')));
      const problemBtn = document.createElement('button');
      problemBtn.textContent = '–ü—Ä–æ–±–ª–µ–º–∞?';
      problemBtn.addEventListener('click', renderProblemModal);
      actions.appendChild(copyBtn);
      actions.appendChild(problemBtn);

      card.appendChild(label);
      card.appendChild(promptArea);
      card.appendChild(actions);

      container.appendChild(card);

      const helper = document.createElement('div');
      helper.className = 'info-block';
      helper.innerHTML = `
        <strong>–Ø–∫ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏:</strong>
        <ol class="guide-list">
          <li>–í—ñ–¥–∫—Ä–∏–π —Ç–µ—Ä–º—ñ–Ω–∞–ª, —è–∫–∏–π –º–∏ –ø—ñ–¥–≥–æ—Ç—É–≤–∞–ª–∏ –Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –∫—Ä–æ–∫–∞—Ö. –í Codespaces –≤—ñ–Ω –∑–Ω–∏–∑—É, —É VS Code ‚Äî —Ç–µ–∂ –∑–Ω–∏–∑—É.</li>
          <li>–í—Å—Ç–∞–≤–ª—è–π –∫–æ–º–∞–Ω–¥–∏ <strong>–ø–æ –æ–¥–Ω—ñ–π</strong> —Ç–∞ –Ω–∞—Ç–∏—Å–∫–∞–π Enter –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ—ó. –¢–∞–∫ –ª–µ–≥—à–µ –ø–æ–º—ñ—Ç–∏—Ç–∏ –ø–æ–º–∏–ª–∫–∏.</li>
          <li><code>python --version</code> –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –±–∞—á–∏—Ç—å —Å–∏—Å—Ç–µ–º—É Python. –Ø–∫—â–æ –ø–∏—à–µ, —â–æ –∫–æ–º–∞–Ω–¥–∏ –Ω–µ–º–∞—î ‚Äî –ø–æ–≤–µ—Ä–Ω–∏—Å—å –¥–æ –∫—Ä–æ–∫—É –∑ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏.</li>
          <li><code>pip install -r requirements.txt</code> –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏. –Ø–∫—â–æ –∑‚Äô—è–≤–ª—è—î—Ç—å—Å—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É ‚Äî —Å–∫–æ–ø—ñ—é–π –π–æ–≥–æ —ñ –Ω–∞—Ç–∏—Å–Ω–∏ ¬´–ü—Ä–æ–±–ª–µ–º–∞?¬ª.</li>
          <li><code>python main.py</code> –∑–∞–ø—É—Å–∫–∞—î –±–æ—Ç–∞. –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –∑–∞–ª–∏—à —Ç–µ—Ä–º—ñ–Ω–∞–ª –≤—ñ–¥–∫—Ä–∏—Ç–∏–º, —â–æ–± –±–æ—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–≤ —É Telegram.</li>
        </ol>
        –Ø–∫—â–æ —Ä–∞–ø—Ç–æ–º —â–æ—Å—å –∑—É–ø–∏–Ω–∏–ª–æ—Å—è ‚Äî –Ω—ñ—á–æ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ. –ü—Ä–æ–≥—Ä–∞–º—ñ—Å—Ç–∏ —Ç–µ–∂ —Å—Ç–∏–∫–∞—é—Ç—å—Å—è –∑ –ø–æ–º–∏–ª–∫–∞–º–∏ —â–æ–¥–Ω—è. –ü—Ä–æ—Å—Ç–æ –¥–∞–π –Ω–∞–º –ª–æ–≥ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É ¬´–ü—Ä–æ–±–ª–µ–º–∞?¬ª —ñ –ø—Ä–æ–¥–æ–≤–∂–∏–º–æ —Ä–∞–∑–æ–º.
      `;

      container.appendChild(helper);
    }

    function renderBotFatherStep(container) {
      const commands = state.survey.commands.length ? state.survey.commands : ['/start', '/help'];
      const hints = {
        '/start': '–ü–æ—á–∞—Ç–∏ —Ä–æ–±–æ—Ç—É',
        '/help': '–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è',
        '/add': '–î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å',
        '/list': '–ü–æ–∫–∞–∑–∞—Ç–∏ —Å–ø–∏—Å–æ–∫',
        '/done': '–ü–æ–∑–Ω–∞—á–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–µ',
        '/stats': '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—É',
        '/tips': '–û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ—Ä–∞–¥—É',
        '/pay': '–û–ø–ª–∞—Ç–∞',
        '/admin': '–ê–¥–º—ñ–Ω-–º–µ–Ω—é',
        '/panic': '–®–≤–∏–¥–∫–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞'
      };

      const card = document.createElement('div');
      card.className = 'card';
      const label = document.createElement('div');
      label.className = 'prompt-label chat1';
      label.textContent = '–ö–æ–º–∞–Ω–¥–∏ –¥–ª—è BotFather';
      const prompt = commands
        .map((cmd) => `${cmd} - ${hints[cmd] || '–ö–æ–º–∞–Ω–¥–∞ ' + cmd.replace('/', '')}`)
        .join('\n');
      const area = document.createElement('div');
      area.className = 'prompt-area';
      area.textContent = prompt;

      const actions = document.createElement('div');
      actions.className = 'prompt-actions';
      const copy = document.createElement('button');
      copy.textContent = '–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏';
      copy.addEventListener('click', () => copyText(prompt));
      const open = document.createElement('button');
      open.textContent = '–í—ñ–¥–∫—Ä–∏—Ç–∏ BotFather';
      open.addEventListener('click', () => window.open('https://t.me/BotFather', '_blank'));
      actions.appendChild(copy);
      actions.appendChild(open);

      card.appendChild(label);
      card.appendChild(area);
      card.appendChild(actions);
      container.appendChild(card);

      const helper = document.createElement('div');
      helper.className = 'info-block';
      helper.innerHTML = `
        <strong>–ü–æ—è—Å–Ω–µ–Ω–Ω—è –∫—Ä–æ–∫—É –∑ BotFather:</strong>
        <ol class="guide-list">
          <li>BotFather ‚Äî –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π –±–æ—Ç Telegram –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —ñ–Ω—à–∏—Ö –±–æ—Ç—ñ–≤.</li>
          <li>–ù–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É ¬´–í—ñ–¥–∫—Ä–∏—Ç–∏ BotFather¬ª, –¥–∞–ª—ñ –≤–≤–µ–¥–∏ <code>/setcommands</code>, –æ–±–µ—Ä–∏ —Å–≤–æ–≥–æ –±–æ—Ç–∞ —Ç–∞ –≤—Å—Ç–∞–≤ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫.</li>
          <li>–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–º—ñ–Ω–∏—Ç–∏ –æ–ø–∏—Å ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–∏ <code>/setcommands</code> –∑ –æ–Ω–æ–≤–ª–µ–Ω–∏–º —Ç–µ–∫—Å—Ç–æ–º.</li>
          <li>–ù–µ –∑–∞–±—É–≤–∞–π –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ ¬´–ö–æ–º–∞–Ω–¥–∏ –¥–æ–¥–∞–Ω–æ ‚úÖ¬ª —É Telegram, —â–æ–± –∑–∞—Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —Å–µ–±–µ.</li>
        </ol>
      `;

      container.appendChild(helper);
    }

    function renderTestStep(container) {
      const checklist = [
        { key: 'start', label: '–ù–∞–ø–∏—Å–∞–≤ /start ‚Äî –æ—Ç—Ä–∏–º–∞–≤ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é.' },
        { key: 'help', label: '–ö–æ–º–∞–Ω–¥–∞ /help –ø–æ—è—Å–Ω—é—î, —â–æ —Ä–æ–±–∏—Ç–∏.' },
        { key: 'custom', label: '–ü–µ—Ä–µ–≤—ñ—Ä–∏–≤ –æ–¥–Ω—É –∫–∞—Å—Ç–æ–º–Ω—É –∫–æ–º–∞–Ω–¥—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ /add –∞–±–æ /stats).' }
      ];

      const list = document.createElement('div');
      list.className = 'checklist';

      checklist.forEach((item) => {
        const row = document.createElement('label');
        row.className = 'check-item';
        if (state.testChecklist[item.key]) row.classList.add('completed');
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = !!state.testChecklist[item.key];
        checkbox.addEventListener('change', (event) => {
          state.testChecklist[item.key] = event.target.checked;
          saveState();
          if (event.target.checked) row.classList.add('completed');
          else row.classList.remove('completed');
        });
        const text = document.createElement('div');
        text.innerHTML = item.label;
        row.appendChild(checkbox);
        row.appendChild(text);
        list.appendChild(row);
      });

      const problemBtn = document.createElement('button');
      problemBtn.textContent = '–Ñ –ø—Ä–æ–±–ª–µ–º–∞';
      problemBtn.addEventListener('click', renderProblemModal);

      container.appendChild(list);
      container.appendChild(problemBtn);

      const helper = document.createElement('div');
      helper.className = 'info-block';
      helper.innerHTML = `
        <strong>–Ø–∫—â–æ —â–æ—Å—å –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î:</strong>
        <ol class="guide-list">
          <li>–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω–∏–π —ñ —Ç–µ—Ä–º—ñ–Ω–∞–ª –≤—ñ–¥–∫—Ä–∏—Ç–∏–π. –Ø–∫—â–æ –∑–∞–∫—Ä–∏–≤—Å—è ‚Äî –ø–æ–≤—Ç–æ—Ä–∏ –∫–æ–º–∞–Ω–¥—É <code>python main.py</code>.</li>
          <li>–ü–µ—Ä–µ–≤—ñ—Ä —Ç–æ–∫–µ–Ω —É —Ñ–∞–π–ª—ñ <code>.env</code> ‚Äî –±–µ–∑ –ø—Ä–æ–±—ñ–ª—ñ–≤, –±–µ–∑ –ª–∞–ø–æ–∫.</li>
          <li>–°–∫–æ–ø—ñ—é–π –ª–æ–≥ –∑ —Ç–µ—Ä–º—ñ–Ω–∞–ª–∞ —Ç–∞ –Ω–∞—Ç–∏—Å–Ω–∏ ¬´–Ñ –ø—Ä–æ–±–ª–µ–º–∞¬ª, —â–æ–± –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä –ø–æ—è—Å–Ω–∏–≤, —É —á–æ–º—É —Å–ø—Ä–∞–≤–∞.</li>
        </ol>
        –ü–∞–º‚Äô—è—Ç–∞–π: –ø–æ–º–∏–ª–∫–∏ ‚Äî —Ü–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –ú–∏ —Ä–æ–∑–±–µ—Ä–µ–º–æ—Å—è –∫—Ä–æ–∫ –∑–∞ –∫—Ä–æ–∫–æ–º.
      `;

      container.appendChild(helper);
    }

    function renderFinishStep(container) {
      const grid = document.createElement('div');
      grid.className = 'card-grid';

      const upgrades = [
        {
          title: 'üí¨ –ö–Ω–æ–ø–∫–∏ —Ç–∞ –º–µ–Ω—é',
          text: '–î–æ–¥–∞–π Reply —Ç–∞ Inline –∫–Ω–æ–ø–∫–∏ –¥–ª—è —à–≤–∏–¥–∫–∏—Ö –¥—ñ–π.',
          action: () => showToast('–í—ñ–¥–∫—Ä–∏–π –ë–ª–æ–∫ A —É —Å–∞–π–¥–±–∞—Ä—ñ —Ç–∞ –≤—Å—Ç–∞–≤ –ø—Ä–æ–º–ø—Ç–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫.')
        },
        {
          title: 'üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
          text: '–ü–æ–∫–∞–∑—É–π –ø—Ä–æ–≥—Ä–µ—Å 7/30 –¥–Ω—ñ–≤, –±–∞—Ä–∏ —Ç–∞ –≥—Ä–∞—Ñ—ñ–∫–∏.',
          action: () => showToast('–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π /stats —ñ–∑ –ë–ª–æ–∫—É B, —â–æ–± –¥–æ–¥–∞—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏.')
        },
        {
          title: 'üí∞ –û–ø–ª–∞—Ç–∏',
          text: '–ü—Ä–∏–π–º–∞–π Telegram Stars –∞–±–æ Stripe.',
          action: () => showToast('–ë–ª–æ–∫ C –ø—ñ–¥–∫–∞–∂–µ, —è–∫ –¥–æ–¥–∞—Ç–∏ –ø–ª–∞—Ç–µ–∂—ñ.')
        }
      ];

      upgrades.forEach((item) => {
        const card = document.createElement('div');
        card.className = 'card';
        const title = document.createElement('h3');
        title.textContent = item.title;
        const text = document.createElement('p');
        text.textContent = item.text;
        const btn = document.createElement('button');
        btn.className = 'primary';
        btn.textContent = '–•–æ—á—É —Ü–µ';
        btn.addEventListener('click', item.action);
        card.appendChild(title);
        card.appendChild(text);
        card.appendChild(btn);
        grid.appendChild(card);
      });

      container.appendChild(grid);

      const helper = document.createElement('div');
      helper.className = 'info-block';
      helper.innerHTML = `
        <strong>–Ø–∫ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –ø—ñ—Å–ª—è –±–∞–∑–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫—É:</strong>
        <ol class="guide-list">
          <li>–ö–ª—ñ–∫–Ω–∏ –ø–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ–π –∫–∞—Ä—Ç—Ü—ñ ‚Äî –º–∏ –ø—ñ–¥–∫–∞–∂–µ–º–æ, —è–∫–∏–π –±–ª–æ–∫ (A, B –∞–±–æ C) –≤—ñ–¥–∫—Ä–∏—Ç–∏ –≤ –ª—ñ–≤–æ–º—É –º–µ–Ω—é.</li>
          <li>–ö–æ–∂–µ–Ω –±–ª–æ–∫ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ —Ç–∏—Ö —Å–∞–º–∏—Ö –ø—Ä–æ—Å—Ç–∏—Ö –¥—ñ–π: ¬´–°–∫–æ–ø—ñ—é–π –ø—Ä–æ–º–ø—Ç ‚Üí –≤—Å—Ç–∞–≤ —É Cursor ‚Üí –ø–µ—Ä–µ–Ω–µ—Å–∏ –∫–æ–¥ —É —Ñ–∞–π–ª–∏¬ª.</li>
          <li>–•–æ—á–µ—à –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –∫—Ä–æ–∫–∏? –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π –∫–Ω–æ–ø–∫—É ¬´–ù–∞–∑–∞–¥¬ª –∞–±–æ –≤–∏–±–µ—Ä–∏ –µ—Ç–∞–ø —É —Å–ø–∏—Å–∫—É –∑–ª—ñ–≤–∞.</li>
        </ol>
        –ü–∞–º‚Äô—è—Ç–∞–π: —Ç–∏ –º–æ–∂–µ—à –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è —Å—é–¥–∏ –±—É–¥—å-–∫–æ–ª–∏ —ñ –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –±–æ—Ç—É.
      `;

      container.appendChild(helper);

      const restart = document.createElement('button');
      restart.textContent = '–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –Ω–∞ –≥–æ–ª–æ–≤–Ω—É';
      restart.addEventListener('click', () => setStep(0));
      container.appendChild(restart);
    }
    function gatherProfile() {
      const commands = state.survey.commands.length ? state.survey.commands : ['/start', '/help'];
      return {
        role: state.survey.role || 'Telegram assistant',
        goal: state.survey.goal || 'Help users manage their tasks',
        audience: state.survey.audience || 'general audience',
        commands,
        language: state.survey.language || 'uk',
        channel: state.survey.channel === 'group' ? 'group' : 'dm',
        type: state.autoProfile.type || 'Custom',
        modules: state.autoProfile.modules.length ? state.autoProfile.modules : commands,
        storage: state.autoProfile.storage || 'JSON',
        integrations: state.autoProfile.integrations,
        backend: state.autoProfile.backend || 'None',
        difficulty: state.autoProfile.difficulty || 'L0',
        mode: state.mode || 'AUTO'
      };
    }

    function ensurePrompts() {
      const profile = gatherProfile();
      const autoBrief = generateDevBrief(profile);
      if (state.mode === 'ASSISTED' && state.assistedBrief.trim()) {
        state.generatedBrief = state.assistedBrief.trim();
      } else {
        state.generatedBrief = autoBrief;
      }
      state.generatedCursorPrompt = generateCursorPrompt(profile, state.generatedBrief);
      state.generatedChecklist = generateChecklist(profile);
      saveState();
    }

    function generateDevBrief(profile) {
      const integrations = profile.integrations.length ? profile.integrations.join(', ') : 'no external integrations yet';
      const modules = profile.modules.length ? profile.modules.join(', ') : 'basic onboarding and help flow';
      const channel = profile.channel === 'group' ? 'Telegram group chats' : 'private DM conversations';
      const languageNote = profile.language === 'uk' ? 'Ukrainian UI copy with warm and supportive tone.' : 'English UI copy with friendly tone.';

      return [
        `Project role: ${profile.role}.`,
        `Primary goal: ${profile.goal}. Target audience: ${profile.audience}.`,
        `Conversation channel: ${channel}.`,
        `Commands to support: ${profile.commands.join(', ')}.`,
        `Core modules: ${modules}.`,
        `Data storage: ${profile.storage}.`,
        `Integrations to prepare: ${integrations}.`,
        `Backend expectations: ${profile.backend === 'None' ? 'polling only' : profile.backend}.`,
        `Tone of voice: ${languageNote}`
      ].join('\n');
    }

    function generateCursorPrompt(profile, brief) {
      const envHint = state.environment === 'Codespaces'
        ? 'Assume the project runs inside GitHub Codespaces (Linux).'
        : 'Assume the project runs locally on macOS/Windows with Python 3.11.';
      const modules = profile.modules.length ? profile.modules.join(', ') : 'basic onboarding';
      const integrations = profile.integrations.length ? profile.integrations.join(', ') : 'no external integrations yet';
      const storage = profile.storage === 'None' ? 'in-memory cache only' : profile.storage;

      return [
        'You are an expert Python developer working inside Cursor IDE. Build a production-ready Telegram bot using aiogram v3.',
        envHint,
        '--- Project brief ---',
        brief,
        '--- Requirements ---',
        '1. Use Python 3.11+, aiogram==3.*, python-dotenv and any standard libraries you need.',
        '2. Structure the project with folders: handlers/, keyboards/, services/, utils/, and keep configuration in config.py.',
        `3. Implement commands ${profile.commands.join(', ')} with clear docstrings and logging.`,
        `4. Provide data layer for ${storage}. If storage requires files, include safe load/save helpers.`,
        `5. Cover modules/features: ${modules}.`,
        `6. Prepare integration stubs for: ${integrations}.`,
        '7. Load the bot token from .env, validate it, and handle missing token gracefully.',
        '8. Include a README.md with setup instructions and commands to run the project.',
        '9. Return an .env.example with TOKEN= placeholder and other secrets.',
        '10. After code generation, show a short checklist reminding to run the commands from the brief.'
      ].join('\n\n');
    }

    function generateChecklist(profile) {
      const base = [
        '–°—Ç–≤–æ—Ä–∏ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ.',
        '–°–∫–æ–ø—ñ—é–π —É—Å—ñ —Ñ–∞–π–ª–∏ –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ Cursor —É —Å–≤—ñ–π –ø—Ä–æ—î–∫—Ç —ñ –∑–±–µ—Ä–µ–∂–∏ —ó—Ö.',
        '–°—Ç–≤–æ—Ä–∏ —Ñ–∞–π–ª .env —ñ–∑ TOKEN=, —è–∫–∏–π –≤–∏–¥–∞–≤ BotFather, —Ç–∞ –ø—Ä–∏–∫–ª–∞–¥ .env.example.',
        '–ó–∞–ø—É—Å—Ç–∏ python main.py —ñ –ø–µ—Ä–µ–≤—ñ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ /start —Ç–∞ /help.',
        '–ü–µ—Ä–µ–≥–ª—è–Ω—å /help ‚Äî —á–∏ –∑—Ä–æ–∑—É–º—ñ–ª—ñ –ø–æ—è—Å–Ω–µ–Ω–Ω—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é.'
      ];
      if (profile.integrations.includes('Google Sheets')) {
        base.push('–ü–æ–¥—ñ–ª–∏—Å—è Google Sheet —ñ–∑ —Å–µ—Ä–≤—ñ—Å–Ω–∏–º –∞–∫–∞—É–Ω—Ç–æ–º —ñ –ø—Ä–æ—Ç–µ—Å—Ç—É–π —á–∏—Ç–∞–Ω–Ω—è/–∑–∞–ø–∏—Å –¥–∞–Ω–∏—Ö.');
      }
      if (profile.integrations.includes('Webhook')) {
        base.push('–ù–∞–ª–∞—à—Ç—É–π –∞–¥—Ä–µ—Å—É –≤–µ–±—Ö—É–∫–∞ —Ç–∞ –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ —Å–µ—Ä–≤–µ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Å—Ç–∞—Ç—É—Å–æ–º 200 OK.');
      }
      if (profile.integrations.includes('Stripe') || profile.integrations.includes('OpenAI')) {
        base.push('–î–æ–¥–∞–π –∫–ª—é—á—ñ –¥–æ .env —ñ –≤–∏–∫–æ–Ω–∞–π —Ç–µ—Å—Ç–æ–≤–∏–π –∑–∞–ø–∏—Ç —É –±–µ–∑–ø–µ—á–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ.');
      }
      return base;
    }

    function generateAssistedPrompt() {
      const profile = gatherProfile();
      return [
        'You are a senior product manager helping to craft an English DEV BRIEF for a Telegram bot project.',
        `Input language: Ukrainian. Current bot idea: ${profile.role}.`,
        `Goal: ${profile.goal}. Audience: ${profile.audience}.`,
        `Commands from the user: ${profile.commands.join(', ')}.`,
        'Please return a concise DEV BRIEF in English that contains: purpose, flows, commands, storage, integrations, and tone of voice.',
        'Answer only in English. Keep it short (max 12 sentences).' 
      ].join('\n');
    }

    function generateNavigatorHelpPrompt(issueKey, userDescription = '') {
      const step = steps[state.currentStep] || { title: '–Ω–µ–≤—ñ–¥–æ–º–∏–π –∫—Ä–æ–∫' };
      const preset = PROBLEM_LOOKUP[issueKey] || PROBLEM_LOOKUP.custom;
      const env = state.environment ? state.environment : '—â–µ –Ω–µ –æ–±—Ä–∞–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ';
      const mode = state.mode ? state.mode : '—Ä–µ–∂–∏–º —â–µ –Ω–µ –æ–±—Ä–∞–Ω–æ';
      const description = userDescription && userDescription.trim()
        ? userDescription.trim()
        : '[–æ–ø–∏—à–∏ –ø—Ä–æ–±–ª–µ–º—É —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é]';

      return [
        'Hi Navigator! I use the Zero-to-Bot panel that –Ω–∞–≤—á–∞—î –Ω–æ–≤–∞—á–∫—ñ–≤ —Ä–æ–±–∏—Ç–∏ Telegram-–±–æ—Ç—ñ–≤ –∫—Ä–æ–∫ –∑–∞ –∫—Ä–æ–∫–æ–º.',
        '–ö–æ–Ω—Ç–µ–∫—Å—Ç: —É –º–µ–Ω–µ –¥–≤–∞ —á–∞—Ç–∏ (—Ç–∏ = Navigator –ø–æ—è—Å–Ω—é—î—à, Cursor –ø–∏—à–µ –∫–æ–¥). –Ø –º–æ–∂—É –±—É—Ç–∏ –Ω–∞ –∫–æ–º–ø‚Äô—é—Ç–µ—Ä—ñ –≤–ø–µ—Ä—à–µ, —Ç–æ–∂ –±—É–¥—å –¥—É–∂–µ –¥–æ–±—Ä–æ–∑–∏—á–ª–∏–≤–∏–º —ñ –ø—ñ–¥—Ç—Ä–∏–º–∞–π –º–µ–Ω–µ.',
        `–ü–æ—Ç–æ—á–Ω–∏–π –∫—Ä–æ–∫ –ø–∞–Ω–µ–ª—ñ: ${step.title}.`,
        `–†–µ–∂–∏–º: ${mode}. –°–µ—Ä–µ–¥–æ–≤–∏—â–µ: ${env}.`,
        `–°—É—Ç—å –ø—Ä–æ–±–ª–µ–º–∏: ${preset.navSummary}`,
        `–ú–æ—ó –Ω–æ—Ç–∞—Ç–∫–∏: ${description}`,
        '–î–∞–π –≤—ñ–¥–ø–æ–≤—ñ–¥—å —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –∑ –Ω—É–º–µ—Ä–æ–≤–∞–Ω–∏–º–∏ –¥—ñ—è–º–∏ (1, 2, 3), –ø–æ—è—Å–Ω–∏, –∫—É–¥–∏ –Ω–∞—Ç–∏—Å–∫–∞—Ç–∏ –≤ Cursor/VS Code/—Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ, –∑–∞–ø—Ä–æ–ø–æ–Ω—É–π —â–æ —Ä–æ–±–∏—Ç–∏, —è–∫—â–æ –ø–æ–º–∏–ª–∫–∞ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å—Å—è, —Ç–∞ –∑–∞–≤–µ—Ä—à –º–æ—Ç–∏–≤–∞—Ü—ñ—î—é.',
        '–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—ñ–ª—å—à–µ –¥–∞–Ω–∏—Ö ‚Äî –ø–æ–ø—Ä–æ—Å–∏ –º–µ–Ω–µ —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –∫–æ–¥ –∞–±–æ –ª–æ–≥ –∑ —Ç–µ—Ä–º—ñ–Ω–∞–ª–∞.'
      ].join('\n');
    }

    const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    let systemThemeListenerAttached = false;

    function initTheme() {
      if (!state.theme) {
        state.theme = prefersDarkScheme.matches ? 'dark' : 'light';
        state.themeManual = false;
        saveState();
      }

      setTheme(state.theme);

      if (!systemThemeListenerAttached) {
        const handler = (event) => {
          if (!state.themeManual) {
            state.theme = event.matches ? 'dark' : 'light';
            setTheme(state.theme);
            saveState();
          }
        };
        if (typeof prefersDarkScheme.addEventListener === 'function') {
          prefersDarkScheme.addEventListener('change', handler);
        } else if (typeof prefersDarkScheme.addListener === 'function') {
          prefersDarkScheme.addListener(handler);
        }
        systemThemeListenerAttached = true;
      }
    }

    initTheme();
    ensurePrompts();
    render();
  </script>
</body>
</html>
