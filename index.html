<!-- GP:M0 START ‚Ä¢ THEME + LAYOUT (build 2025-10-29.1) -->
<div id="gp-panel" data-mode="auto" data-theme="light" data-env="local" aria-label="Zero-to-Bot Panel">
  <!-- GP:BEGIN THEME -->
  <style>
    /* ===== Scope only inside #gp-panel ===== */
    #gp-panel, #gp-panel * { box-sizing: border-box; }

    /* ===== Design tokens (Light) ===== */
    #gp-panel{
      --bg:#ffffff; --text:#0f172a; --muted:#667085; --line:#e7eaf3;
      --chip:#f6f7ff; --accent:#2563eb;
      --grad1:#464eeb; --grad2:#5596fe; /* –∑ —Ç–≤–æ—î—ó —Å–∏—Å—Ç–µ–º–∏ */
      --active-bg:#eaf2ff; --active-border:#9ec5ff;
      --success:#16a34a; --warn:#f59e0b; --error:#ef4444;

      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
      color: var(--text); background: var(--bg);
      border:1px solid var(--line); border-radius:16px; padding:12px;
    }

    /* ===== Dark theme tokens ===== */
    #gp-panel[data-theme="dark"]{
      --bg:#0b1220; --text:#e5edff; --muted:#a3b1c6; --line:#1e293b; --chip:#111a2e;
      --active-bg:#0f1f3c; --active-border:#264d9a;
      --accent:#79a6ff;
    }
    /* Page background sync for dark */
    body.gp-dark { background:#0b1220; color-scheme: dark; }

    /* ===== UI atoms ===== */
    #gp-panel .btn{
      cursor:pointer; border:1px solid var(--line); background:#fff; color:var(--text);
      border-radius:10px; padding:8px 12px; display:inline-flex; align-items:center; gap:8px; line-height:1;
    }
    #gp-panel[data-theme="dark"] .btn{ background:#0f172a; border-color:#1f2b45; }
    #gp-panel .btn.primary{ border:0; color:#fff; background:linear-gradient(90deg,var(--grad1),var(--grad2)); }
    #gp-panel .btn.ghost{ background:transparent; }
    #gp-panel .btn.sm{ padding:6px 10px; font-size:12px; }

    #gp-panel .tag{ font-size:12px; color:var(--muted); border:1px solid var(--line); border-radius:999px; padding:4px 8px; }
    #gp-panel .hint{ font-size:12px; color:var(--muted); }
    #gp-panel .chip{ font-size:12px; color:var(--text); background:var(--chip); border:1px solid var(--line); border-radius:6px; padding:4px 6px; }

    #gp-panel .icon{ width:18px; height:18px; display:inline-block; }
    #gp-panel .icon svg{ width:18px; height:18px; fill:none; stroke:currentColor; }

    /* ===== Layout chrome ===== */
    #gp-panel .top {
      display:flex; gap:10px; justify-content:space-between; align-items:center; flex-wrap:wrap;
      padding:6px 6px 8px; border:1px solid var(--line); border-radius:12px; background:transparent;
    }
    #gp-panel .brand{
      display:flex; align-items:center; gap:8px;
    }
    #gp-panel .brand img{ width:28px; height:28px; border-radius:6px; object-fit:cover; }
    #gp-panel .brand b{ font-size:14px; }

    #gp-panel .wrap{
      display:grid; grid-template-columns:280px 1fr; gap:12px; margin-top:10px;
    }
    @media (max-width: 980px){ #gp-panel .wrap{ grid-template-columns:1fr; } }

    #gp-panel .sidebar{
      border:1px solid var(--line); border-radius:12px; padding:10px; max-height:68vh; overflow:auto;
    }
    #gp-panel .main{
      border:1px solid var(--line); border-radius:12px; padding:12px; min-height:240px;
    }

    /* ===== Simple blocks inside sidebar/main ===== */
    #gp-panel .side-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:6px; }
    #gp-panel .search{ display:flex; gap:6px; }
    #gp-panel input[type="text"]{
      width:100%; padding:8px 10px; border:1px solid var(--line); border-radius:10px; background:transparent; color:var(--text);
    }

    #gp-panel h3{ margin:0 0 6px; font-size:18px; }
    #gp-panel p{ margin:6px 0; }
    #gp-panel .progress{ font-size:12px; color:var(--muted); }
  </style>
  <!-- GP:END THEME -->

  <!-- GP:BEGIN LAYOUT -->
  <div class="top">
    <div class="brand">
      <!-- –õ–æ–≥–æ –∑ —Ç–≤–æ–≥–æ URL -->
      <img src="http://46.254.107.103:8080/shop/d26a0a21-85fe-46ea-8469-ce8bad72397b/description/ChatGPT%20Image%2024%20—Å–µ–Ω—Ç.%202025%20–≥.,%2010_49_10.png" alt="Logo" loading="lazy" />
      <b>Zero-to-Bot Panel</b>
      <span class="chip">beta</span>
    </div>
    <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap">
      <span class="tag" id="gp-chat1">Chat 1 ¬∑ –ù–∞–≤—ñ–≥–∞—Ç–æ—Ä</span>
      <span class="tag" id="gp-chat2">Chat 2 ¬∑ Cursor</span>
      <span class="progress" id="gp-progress">0% –≤–∏–∫–æ–Ω–∞–Ω–æ</span>
      <button class="btn" id="gp-guide-btn" title="–ö–æ—Ä–æ—Ç–∫–∏–π –≥–∞–π–¥">
        <span class="icon" aria-hidden="true">
          <svg viewBox="0 0 24 24"><path d="M4 6h16M4 12h10M4 18h16" stroke-width="2" stroke-linecap="round"/></svg>
        </span> –ö–µ—Ä—ñ–≤–Ω–∏—Ü—Ç–≤–æ
      </button>
      <button class="btn" id="gp-settings-btn" title="–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</button>
    </div>
  </div>

  <div class="wrap">
    <aside class="sidebar" aria-label="–ù–∞–≤—ñ–≥–∞—Ü—ñ—è –∫—Ä–æ–∫—ñ–≤">
      <div class="side-head">
        <b class="hint">–ö—Ä–æ–∫–∏</b>
        <span class="chip" id="gp-build">build 2025-10-29.1</span>
      </div>
      <div class="search">
        <input type="text" id="gp-find" placeholder="–ü–æ—à—É–∫ –∫—Ä–æ–∫—ñ–≤‚Ä¶" />
        <button class="btn sm" id="gp-showall">–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–ª–∞–Ω</button>
      </div>
      <div id="gp-sections" class="hint">
        <!-- —Ç—É—Ç –∑ º—è–≤–∏—Ç—å—Å—è –¥–µ—Ä–µ–≤–æ –∫—Ä–æ–∫—ñ–≤ —É M2 -->
        –°–∞–π–¥–±–∞—Ä –∑ –∫—Ä–æ–∫–∞–º–∏ –±—É–¥–µ —Ç—É—Ç (M2).
      </div>
    </aside>

    <main class="main" aria-live="polite">
      <h3 id="gp-title">–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ ????</h3>
      <p class="hint" id="gp-desc">–¶–µ –æ–±–æ–ª–æ–Ω–∫–∞ –ø–∞–Ω–µ–ª—ñ. –ù–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –∫—Ä–æ–∫–∞—Ö –¥–æ–¥–∞–º–æ –ª–æ–≥—ñ–∫—É –µ—Ç–∞–ø—ñ–≤ —ñ –ø—Ä–æ–º–ø—Ç—ñ–≤.</p>
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px">
        <button class="btn primary" id="gp-start">–ü–æ—á–∞—Ç–∏</button>
        <button class="btn" id="gp-how">–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î?</button>
      </div>
    </main>
  </div>
  <!-- GP:END LAYOUT -->

  <!-- GP:BEGIN BOOT -->
  <script>
    (function(){
      const root = document.getElementById('gp-panel');
      const STORE_KEY = 'gpPanel_state_m0';
      const STATE_VERSION = 1;
      const mq = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');

      let state = { v: STATE_VERSION, mode: root?.getAttribute('data-mode') || 'auto', theme: 'light', done: 0 };

      function applyTheme(){
        const selected = state.mode === 'auto' ? (mq && mq.matches ? 'dark' : 'light') : state.mode;
        state.theme = selected;
        root.setAttribute('data-theme', selected);
        document.body.classList.toggle('gp-dark', selected==='dark');
      }

      function save(){ try { localStorage.setItem(STORE_KEY, JSON.stringify(state)); } catch(e){} }
      function load(){ try {
        const raw = localStorage.getItem(STORE_KEY);
        if(!raw) return;
        const prev = JSON.parse(raw);
        if(prev && prev.v === STATE_VERSION){ state = Object.assign(state, prev); }
      } catch(e){} }

      function render(){
        // –ü—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å-–ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä (–æ–Ω–æ–≤–∏—Ç—å—Å—è –≤ M2+)
        const pg = root.querySelector('#gp-progress');
        if(pg) pg.textContent = (state.done|0) + '% –≤–∏–∫–æ–Ω–∞–Ω–æ';
      }

      function bind(){
        const guide = root.querySelector('#gp-guide-btn');
        guide && guide.addEventListener('click', ()=> alert('–ì–∞–π–¥ –∑ º—è–≤–∏—Ç—å—Å—è –≤ M1/M2.'));
        const how = root.querySelector('#gp-how');
        how && how.addEventListener('click', ()=> alert('–ö–æ—Ä–æ—Ç–∫–æ: –Ω–∞—Ç–∏—Å–Ω–∏ ‚Üí —Å–∫–æ–ø—ñ—é–π ‚Üí –≤—Å—Ç–∞–≤. –î–µ—Ç–∞–ª—ñ –¥–æ–¥–∞–º–æ —É –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –º–æ–¥—É–ª—è—Ö.'));
        const start = root.querySelector('#gp-start');
        start && start.addEventListener('click', ()=> alert('–°—Ç–∞—Ä—Ç –º–∞–π—Å—Ç—Ä–∞ –¥–æ–¥–∞–º–æ —É M3 (–ê–Ω–∫–µ—Ç–∞).'));
        if(mq && mq.addEventListener){ mq.addEventListener('change', ()=>{ if(state.mode==='auto'){ applyTheme(); save(); } }); }
      }

      function init(){
        load(); applyTheme(); render(); bind(); save();
      }
      init();
    })();
  </script>
  <!-- GP:END BOOT -->
</div>
<!-- GP:M0 END -->
<!-- GP:M1 START ‚Ä¢ SETTINGS MODAL + LOGIC (build 2025-10-29.2) -->
<!-- GP:BEGIN SETTINGS STYLES -->
<style>
  /* scope –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–∞–Ω–µ–ª—ñ */
  #gp-panel .modal-backdrop{position:fixed;inset:0;background:rgba(15,23,42,.45);display:none;z-index:9998}
  #gp-panel .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:9999}
  #gp-panel .modal .box{
    width:min(720px,92vw);max-height:82vh;overflow:auto;background:var(--bg);
    border:1px solid var(--line);border-radius:16px;padding:14px;color:var(--text)
  }
  #gp-panel .modal .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:8px 0}
  #gp-panel .modal h4{margin:0 0 8px}
  #gp-panel .setting{display:flex;justify-content:space-between;align-items:center;gap:12px;border:1px solid var(--line);border-radius:10px;padding:10px;margin:8px 0}
  #gp-panel .radio{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  #gp-panel .radio label{display:inline-flex;gap:6px;align-items:center;font-size:14px}
  #gp-panel .radio input{accent-color:#4664ff}
  #gp-panel .linklike{color:var(--accent);text-decoration:underline;cursor:pointer}
  #gp-panel .badge{border:1px solid var(--line);border-radius:999px;padding:2px 8px;font-size:12px}
</style>
<!-- GP:END SETTINGS STYLES -->

<!-- GP:BEGIN SETTINGS MODAL -->
<div class="modal-backdrop" id="gp-backdrop-settings"></div>
<div class="modal" id="gp-settings-modal" role="dialog" aria-modal="true" aria-label="–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è">
  <div class="box">
    <div class="row" style="justify-content:space-between">
      <h4>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h4>
      <button class="btn sm ghost" id="gp-settings-close" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">‚úï</button>
    </div>

    <div class="setting">
      <div>
        <b>–ú–æ–≤–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É</b>
        <div class="hint">–î–µ—Ñ–æ–ª—Ç ‚Äî —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞. –Ü–Ω—à—ñ –º–æ–≤–∏ –∑‚Äô—è–≤–ª—è—Ç—å—Å—è –ø—ñ–∑–Ω—ñ—à–µ.</div>
      </div>
      <div class="radio" id="gp-lang-group">
        <label><input type="radio" name="gp-lang" value="uk" checked> –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</label>
        <label><input type="radio" name="gp-lang" value="en"> English</label>
      </div>
    </div>

    <div class="setting">
      <div>
        <b>RU-–≤–µ—Ä—Å—ñ—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏</b>
        <div class="hint">–ó–∞–ª–∏—à –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ RU-–≤–µ—Ä—Å—ñ—é. –ú–∏ –∑–±–µ—Ä–µ–∂–µ–º–æ –π–æ–≥–æ —ñ –ø–æ–∫–∞–∂–µ–º–æ —É —à–∞–ø—Ü—ñ.</div>
        <div id="gp-ru-hint" class="hint"></div>
      </div>
      <div class="row">
        <button class="btn sm" id="gp-add-ru">–î–æ–¥–∞—Ç–∏ RU-–ø–æ—Å–∏–ª–∞–Ω–Ω—è</button>
        <span class="badge" id="gp-ru-badge" style="display:none">–∑–±–µ—Ä–µ–∂–µ–Ω–æ</span>
      </div>
    </div>

    <div class="row" style="justify-content:flex-end">
      <button class="btn" id="gp-settings-cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      <button class="btn primary" id="gp-settings-save">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
    </div>
  </div>
</div>
<!-- GP:END SETTINGS MODAL -->

<!-- GP:BEGIN SETTINGS SCRIPT -->
<script>
(function(){
  const root = document.getElementById('gp-panel');
  if(!root) return;

  // --- storage / –º—ñ–≥—Ä–∞—Ü—ñ—è ---
  const STORE_KEY = 'gpPanel_state_m0';           // —Ç–æ–π —Å–∞–º–∏–π –∫–ª—é—á –∑ M0
  const NEW_STATE_VERSION = 2;                    // bump –≤–µ—Ä—Å—ñ—ó
  let state = { v: NEW_STATE_VERSION, mode: root.getAttribute('data-mode')||'auto', theme:'light', done:0, lang:'uk', ruLink:'' };

  function load(){
    try{
      const raw = localStorage.getItem(STORE_KEY);
      if(!raw) return;
      const prev = JSON.parse(raw);
      if(!prev) return;
      // –º—ñ–≥—Ä–∞—Ü—ñ—è –∑ v1 ‚Üí v2
      if(prev.v && prev.v <= NEW_STATE_VERSION){
        state = Object.assign({}, state, prev);
        if(!state.lang) state.lang = 'uk';
        if(typeof state.ruLink!=='string') state.ruLink='';
        state.v = NEW_STATE_VERSION;
      }
    }catch(e){}
  }
  function save(){
    try{ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }catch(e){}
  }

  // --- modal refs ---
  const backdrop = document.getElementById('gp-backdrop-settings');
  const modal = document.getElementById('gp-settings-modal');
  const btnOpen = document.getElementById('gp-settings-btn');
  const btnClose = document.getElementById('gp-settings-close');
  const btnCancel = document.getElementById('gp-settings-cancel');
  const btnSave = document.getElementById('gp-settings-save');
  const groupLang = document.getElementById('gp-lang-group');
  const addRu = document.getElementById('gp-add-ru');
  const ruHint = document.getElementById('gp-ru-hint');
  const ruBadge = document.getElementById('gp-ru-badge');

  function openModal(){ modal.style.display='flex'; backdrop.style.display='block'; modal.setAttribute('aria-hidden','false'); }
  function closeModal(){ modal.style.display='none'; backdrop.style.display='none'; modal.setAttribute('aria-hidden','true'); }

  function applyHeaderBadges(){
    // –ø–æ–∫–∞–∑–∞—Ç–∏ –º–∞—Ä–∫–µ—Ä –º–æ–≤–∏ –ø–æ—Ä—É—á –∑ ‚ÄúChat 1/Chat 2‚Äù –∞–±–æ —É –ø—Ä–æ–≥—Ä–µ—Å—ñ
    const progress = root.querySelector('#gp-progress');
    if(progress){
      let pct = String(state.done||0)+'% –≤–∏–∫–æ–Ω–∞–Ω–æ';
      progress.textContent = pct + ' ¬∑ –º–æ–≤–∞: ' + (state.lang||'uk').toUpperCase();
    }
    // RU badge hint –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –º–æ–¥–∞–ª–∫–∏
    if(ruHint){
      if(state.ruLink){
        ruHint.textContent = '–ü–æ—Ç–æ—á–Ω–µ RU-–ø–æ—Å–∏–ª–∞–Ω–Ω—è: ' + state.ruLink;
        ruBadge.style.display = 'inline-block';
      }else{
        ruHint.textContent = '–©–µ –Ω–µ –¥–æ–¥–∞–Ω–æ. –ù–∞—Ç–∏—Å–Ω–∏ ‚Äú–î–æ–¥–∞—Ç–∏ RU-–ø–æ—Å–∏–ª–∞–Ω–Ω—è‚Äù.';
        ruBadge.style.display = 'none';
      }
    }
  }

  function bind(){
    // –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è
    btnOpen && btnOpen.addEventListener('click', openModal);
    // –∑–∞–∫—Ä–∏—Ç—Ç—è
    [btnClose, btnCancel, backdrop].forEach(b=> b && b.addEventListener('click', closeModal));
    // —Å–∞–±–º—ñ—Ç
    btnSave && btnSave.addEventListener('click', ()=>{
      // –º–æ–≤–∞
      const checked = groupLang && groupLang.querySelector('input[name="gp-lang"]:checked');
      if(checked) state.lang = checked.value || 'uk';
      save(); applyHeaderBadges(); closeModal();
    });
    // –¥–æ–¥–∞—Ç–∏ RU –ª—ñ–Ω–∫
    addRu && addRu.addEventListener('click', ()=>{
      const url = prompt('–í—Å—Ç–∞–≤ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ RU-–≤–µ—Ä—Å—ñ—é —Å—Ç–æ—Ä—ñ–Ω–∫–∏:', state.ruLink || 'https://genieprompts.net/ru');
      if(url && typeof url === 'string'){
        state.ruLink = url.trim();
        save(); applyHeaderBadges();
        alert('RU-–ø–æ—Å–∏–ª–∞–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ.');
      }
    });
    // —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç–∞–Ω—É –ø–µ—Ä–µ–º–∏–∫–∞—á–∞ –º–æ–≤–∏
    if(groupLang){
      const current = state.lang || 'uk';
      const opt = groupLang.querySelector('input[value="'+current+'"]');
      if(opt) opt.checked = true;
    }
    // Esc –¥–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });
  }

  function init(){
    load(); save(); applyHeaderBadges(); bind();
  }
  init();
})();
</script>
<!-- GP:END SETTINGS SCRIPT -->
<!-- GP:M1 END -->
<!-- GP:M2 START ‚Ä¢ SIDEBAR steps (build 2025-10-29.3) -->
<!-- GP:BEGIN SIDEBAR STYLES -->
<style>
  /* —Ç—ñ–ª—å–∫–∏ –≤ –º–µ–∂–∞—Ö –ø–∞–Ω–µ–ª—ñ */
  #gp-panel .sec{margin:8px 0;border:1px solid var(--line);border-radius:10px;overflow:hidden}
  #gp-panel .sec h4{margin:0;font-size:14px;padding:8px 10px;background:var(--chip);
    display:flex;justify-content:space-between;align-items:center;cursor:pointer}
  #gp-panel .sec .list{display:none;padding:6px 8px}
  #gp-panel .sec.open .list{display:block}
  #gp-panel .item{display:flex;gap:8px;align-items:center;padding:8px;border-radius:8px;
    cursor:pointer;border:1px solid transparent}
  #gp-panel .item .i{width:18px;height:18px;border:1px solid var(--line);border-radius:4px;
    display:inline-flex;align-items:center;justify-content:center;font-size:12px;color:var(--muted)}
  #gp-panel .item .t{flex:1}
  #gp-panel .item .b{font-size:11px;color:var(--muted)}
  #gp-panel .item.active{background:var(--active-bg);border-color:var(--active-border);outline:2px solid var(--active-border)}
  #gp-panel .item.done{opacity:.75}
</style>
<!-- GP:END SIDEBAR STYLES -->

<!-- GP:BEGIN SIDEBAR SCRIPT -->
<script>
(function(){
  const root = document.getElementById('gp-panel');
  if(!root) return;

  // === state / storage (bump –≤–µ—Ä—Å—ñ—ó –¥–æ 3) ===
  const STORE_KEY = 'gpPanel_state_m0';
  const STATE_VERSION = 3;
  let state = {
    v: STATE_VERSION,
    mode: root.getAttribute('data-mode')||'auto',
    theme:'light',
    lang:'uk',
    ruLink:'',
    current: 0,
    done: [],       // —ñ–Ω–¥–µ–∫—Å–∏ –≤–∏–∫–æ–Ω–∞–Ω–∏—Ö –∫—Ä–æ–∫—ñ–≤
    filter: ''
  };

  function load(){
    try{
      const raw = localStorage.getItem(STORE_KEY);
      if(!raw) return;
      const prev = JSON.parse(raw);
      if(prev){
        state = Object.assign(state, prev);
        state.v = STATE_VERSION;
        if(!Array.isArray(state.done)) state.done=[];
        if(typeof state.current!=='number') state.current=0;
        if(typeof state.filter!=='string') state.filter='';
      }
    }catch(e){}
  }
  function save(){ try{ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }catch(e){} }

  // === –∫—Ä–æ–∫–∏ / —Å–µ–∫—Ü—ñ—ó ===
  const sections = [
    { title:'0 ¬∑ –°—Ç–∞—Ä—Ç', open:true, items:[
      {t:'–ü–æ—á–∞—Ç–∏', b:'welcome'},
      {t:'–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î', b:'guide'}
    ]},
    { title:'1 ¬∑ –ê–Ω–∫–µ—Ç–∞', open:true, items:[
      {t:'–ó–∞–ø–æ–≤–Ω–∏—Ç–∏ 5 –ø–æ–ª—ñ–≤', b:'form'},
      {t:'–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∞–Ω–∫–µ—Ç—É', b:'confirm'}
    ]},
    { title:'2 ¬∑ –†–µ–∂–∏–º', open:false, items:[
      {t:'AUTO', b:'auto'},
      {t:'ASSISTED', b:'assisted'}
    ]},
    { title:'3 ¬∑ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä', open:false, items:[
      {t:'–¢–∏–ø / –ú–æ–¥—É–ª—ñ', b:'chips'},
      {t:'–î–∞–Ω—ñ / –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó', b:'storage/integrations'},
      {t:'–ë–µ–∫–µ–Ω–¥ (–æ–ø—Ü.) / –†—ñ–≤–µ–Ω—å', b:'backend/level'}
    ]},
    { title:'4 ¬∑ –û–≥–ª—è–¥', open:false, items:[
      {t:'DEV BRIEF (EN)', b:'brief'},
      {t:'CURSOR PROMPT (EN)', b:'prompt'}
    ]},
    { title:'5 ¬∑ –°–µ—Ä–µ–¥–æ–≤–∏—â–µ', open:false, items:[
      {t:'Local vs Codespaces', b:'env'}
    ]},
    { title:'6 ¬∑ –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ / Files', open:false, items:[
      {t:'–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏/–í—ñ–¥–∫—Ä–∏—Ç–∏', b:'tools'},
      {t:'–ß–µ–∫-–ª–∏—Å—Ç —Ñ–∞–π–ª—ñ–≤', b:'files'}
    ]},
    { title:'7 ¬∑ –í—Å—Ç–∞–≤–∏—Ç–∏ —É Cursor', open:false, items:[
      {t:'–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø—Ä–æ–º–ø—Ç', b:'copy-cursor'},
      {t:'–î–µ –≤—Å—Ç–∞–≤–∏—Ç–∏?', b:'cursor-how'}
    ]},
    { title:'8 ¬∑ –ó–∞–ø—É—Å–∫', open:false, items:[
      {t:'–ö–æ–º–∞–Ω–¥–∏ –∑–∞–ø—É—Å–∫—É', b:'run'},
      {t:'–Ñ –ø—Ä–æ–±–ª–µ–º–∞', b:'troubles'}
    ]},
    { title:'9 ¬∑ BotFather', open:false, items:[
      {t:'/setcommands', b:'bf-commands'}
    ]},
    { title:'10 ¬∑ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞', open:false, items:[
      {t:'/start /help', b:'test'}
    ]},
    { title:'11 ¬∑ –ì–æ—Ç–æ–≤–æ / –ê–ø“ë—Ä–µ–π–¥–∏', open:false, items:[
      {t:'UI-–∫–Ω–æ–ø–∫–∏', b:'upgrade-ui'},
      {t:'–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', b:'upgrade-stats'},
      {t:'–û–ø–ª–∞—Ç–∏', b:'upgrade-pay'}
    ]}
  ];

  // –∑–≤–µ—Å—Ç–∏ –≤ –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è —ñ–Ω–¥–µ–∫—Å—ñ–≤
  let flat = [];
  function flatten(){
    flat = [];
    sections.forEach((sec, si)=>{
      sec.items.forEach((it, idx)=>{
        flat.push({ si, idx, sec: sec.title, title: it.t, badge: it.b });
      });
    });
  }

  // === UI build ===
  const box = root.querySelector('#gp-sections');
  const find = root.querySelector('#gp-find');
  const showAllBtn = root.querySelector('#gp-showall');
  const progressEl = root.querySelector('#gp-progress');

  function buildSidebar(){
    if(!box) return;
    box.innerHTML = '';
    const f = (state.filter||'').toLowerCase();

    sections.forEach((sec, si)=>{
      // —Å–µ–∫—Ü—ñ—è
      const c = document.createElement('div'); c.className = 'sec' + (sec.open? ' open':'');

      const h = document.createElement('h4');
      h.innerHTML = `<span>${sec.title}</span><span>${sec.open?'‚àí':'+'}</span>`;
      h.addEventListener('click', ()=>{ sec.open = !sec.open; save(); buildSidebar(); });
      c.appendChild(h);

      const list = document.createElement('div'); list.className = 'list';

      sec.items.forEach((it, idx)=>{
        const txt = (it.t + ' ' + (it.b||'')).toLowerCase();
        if(f && !txt.includes(f)) return;

        const li = document.createElement('div'); li.className = 'item';
        const flatIndex = flat.findIndex(x=>x.si===si && x.idx===idx);
        if(state.current===flatIndex) li.classList.add('active');
        if(state.done.includes(flatIndex)) li.classList.add('done');

        li.innerHTML =
          `<span class="i">${state.done.includes(flatIndex)?'‚úì':(flatIndex+1)}</span>`+
          `<div class="t"><div>${it.t}</div><div class="b">${it.b||''}</div></div>`;

        li.addEventListener('click', ()=>{
          state.current = flatIndex;
          // –∞–≤—Ç–æ-–≤—ñ–¥–∫—Ä–∏—Ç—Ç—è —Å–µ–∫—Ü—ñ—ó
          sections[si].open = true;
          save(); buildSidebar(); reflectMainHeader();
        });

        list.appendChild(li);
      });

      c.appendChild(list);
      box.appendChild(c);
    });

    // –ø—Ä–æ–≥—Ä–µ—Å
    const pct = Math.round((state.done.length / flat.length)*100) || 0;
    if(progressEl){
      progressEl.textContent = `${pct}% –≤–∏–∫–æ–Ω–∞–Ω–æ ¬∑ –º–æ–≤–∞: ${(state.lang||'uk').toUpperCase()}`;
    }
  }

  // —Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ä–µ—Ñ–ª–µ–∫—Å —É –∑–∞–≥–æ–ª–æ–≤–æ–∫ main (–æ–Ω–æ–≤–∏–º–æ —É M3+)
  function reflectMainHeader(){
    const s = flat[state.current] || flat[0];
    const titleEl = root.querySelector('#gp-title');
    const descEl = root.querySelector('#gp-desc');
    if(titleEl) titleEl.textContent = `–ö—Ä–æ–∫ ${state.current+1}. ${s ? s.title : '...'}`;
    if(descEl) descEl.textContent = s ? s.sec : '';
  }

  // === –ø–æ–¥—ñ—ó ===
  function bind(){
    // –ø–æ—à—É–∫
    find && find.addEventListener('input', (e)=>{ state.filter = e.target.value || ''; save(); buildSidebar(); });
    // –ø–æ–∫–∞–∑–∞—Ç–∏/–∑–≥–æ—Ä–Ω—É—Ç–∏ –≤—Å–µ
    showAllBtn && showAllBtn.addEventListener('click', ()=>{
      const allOpen = sections.every(s=>s.open);
      sections.forEach(s=> s.open = !allOpen);
      save(); buildSidebar();
    });

    // –≥–∞—Ä—è—á–∞ –∫–Ω–æ–ø–∫–∞ "–í–∏–∫–æ–Ω–∞–Ω–æ" (–ø–æ–∫–∏ —â–æ –¥–µ–º–æ: –º–∞—Ä–∫—É—î –ø–æ—Ç–æ—á–Ω–∏–π –∫—Ä–æ–∫ done)
    // —É M3 –∑–∞–º—ñ–Ω–∏–º–æ –Ω–∞ —Å–ø—Ä–∞–≤–∂–Ω—é –∫–Ω–æ–ø–∫—É –≤ main
    root.addEventListener('gp:markDone', ()=>{
      if(!state.done.includes(state.current)) state.done.push(state.current);
      save(); buildSidebar();
    });
  }

  function init(){
    load(); flatten(); buildSidebar(); reflectMainHeader(); bind();
  }
  init();
})();
</script>
<!-- GP:END SIDEBAR SCRIPT -->
<!-- GP:M2 END -->
<!-- GP:M3 START ‚Ä¢ START + FORM (build 2025-10-29.4) -->
<!-- GP:BEGIN FORM STYLES -->
<style>
  #gp-panel .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}
  #gp-panel .form-grid .full{grid-column:1/-1}
  @media(max-width:980px){ #gp-panel .form-grid{grid-template-columns:1fr} }
  #gp-panel .field{display:flex;flex-direction:column;gap:6px}
  #gp-panel .field label{font-size:12px;color:var(--muted)}
  #gp-panel .err{font-size:12px;color:var(--error);display:none}
  #gp-panel .err.show{display:block}
  #gp-panel .block{border:1px solid var(--line);border-radius:12px;padding:10px;margin-top:10px}
  #gp-panel .kbd{margin-top:8px;border:1px solid var(--line);border-radius:10px;padding:10px;
    font:12px/1.5 ui-monospace,SFMono-Regular,Menlo,monospace;white-space:pre-wrap;background:transparent;color:var(--text)}
</style>
<!-- GP:END FORM STYLES -->

<!-- GP:BEGIN START+FORM SCRIPT -->
<script>
(function(){
  const root = document.getElementById('gp-panel'); if(!root) return;

  // === storage (—Å—É–º—ñ—Å–Ω–æ –∑ M0/M1/M2) ===
  const STORE_KEY = 'gpPanel_state_m0';
  const STATE_VERSION = 4;

  // –¥—É–±–ª—å —Å–µ–∫—Ü—ñ–π –¥–ª—è –º–∞–ø–∏ —ñ–Ω–¥–µ–∫—Å—ñ–≤ (—Ç–æ–π —Å–∞–º–∏–π –ø–æ—Ä—è–¥–æ–∫, —â–æ –≤ M2)
  const sections = [
    { title:'0 ¬∑ –°—Ç–∞—Ä—Ç', items:[{t:'–ü–æ—á–∞—Ç–∏', b:'welcome'},{t:'–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î', b:'guide'}]},
    { title:'1 ¬∑ –ê–Ω–∫–µ—Ç–∞', items:[{t:'–ó–∞–ø–æ–≤–Ω–∏—Ç–∏ 5 –ø–æ–ª—ñ–≤', b:'form'},{t:'–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∞–Ω–∫–µ—Ç—É', b:'confirm'}]},
    { title:'2 ¬∑ –†–µ–∂–∏–º', items:[{t:'AUTO', b:'auto'},{t:'ASSISTED', b:'assisted'}]},
    { title:'3 ¬∑ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä', items:[{t:'–¢–∏–ø / –ú–æ–¥—É–ª—ñ', b:'chips'},{t:'–î–∞–Ω—ñ / –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó', b:'storage/integrations'},{t:'–ë–µ–∫–µ–Ω–¥ (–æ–ø—Ü.) / –†—ñ–≤–µ–Ω—å', b:'backend/level'}]},
    { title:'4 ¬∑ –û–≥–ª—è–¥', items:[{t:'DEV BRIEF (EN)', b:'brief'},{t:'CURSOR PROMPT (EN)', b:'prompt'}]},
    { title:'5 ¬∑ –°–µ—Ä–µ–¥–æ–≤–∏—â–µ', items:[{t:'Local vs Codespaces', b:'env'}]},
    { title:'6 ¬∑ –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ / Files', items:[{t:'–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏/–í—ñ–¥–∫—Ä–∏—Ç–∏', b:'tools'},{t:'–ß–µ–∫-–ª–∏—Å—Ç —Ñ–∞–π–ª—ñ–≤', b:'files'}]},
    { title:'7 ¬∑ –í—Å—Ç–∞–≤–∏—Ç–∏ —É Cursor', items:[{t:'–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø—Ä–æ–º–ø—Ç', b:'copy-cursor'},{t:'–î–µ –≤—Å—Ç–∞–≤–∏—Ç–∏?', b:'cursor-how'}]},
    { title:'8 ¬∑ –ó–∞–ø—É—Å–∫', items:[{t:'–ö–æ–º–∞–Ω–¥–∏ –∑–∞–ø—É—Å–∫—É', b:'run'},{t:'–Ñ –ø—Ä–æ–±–ª–µ–º–∞', b:'troubles'}]},
    { title:'9 ¬∑ BotFather', items:[{t:'/setcommands', b:'bf-commands'}]},
    { title:'10 ¬∑ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞', items:[{t:'/start /help', b:'test'}]},
    { title:'11 ¬∑ –ì–æ—Ç–æ–≤–æ / –ê–ø“ë—Ä–µ–π–¥–∏', items:[{t:'UI-–∫–Ω–æ–ø–∫–∏', b:'upgrade-ui'},{t:'–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', b:'upgrade-stats'},{t:'–û–ø–ª–∞—Ç–∏', b:'upgrade-pay'}]}
  ];
  let flat=[]; sections.forEach((sec,si)=>sec.items.forEach((it,idx)=>flat.push({si,idx,key:it.b,title:it.t,sec:sec.title})));

  // —Å—Ç–∞–Ω
  let state = {
    v: STATE_VERSION,
    mode: root.getAttribute('data-mode')||'auto',
    theme: root.getAttribute('data-theme')||'light',
    lang: 'uk',
    ruLink: '',
    current: 0,
    done: [],
    filter: '',
    profile: { role:'', goal:'', cmds:'/start, /help, /add, /list, /done', lang:'uk', channel:'DM' },
    formValid:false
  };

  function load(){
    try{
      const raw = localStorage.getItem(STORE_KEY); if(!raw) return;
      const prev = JSON.parse(raw)||{};
      state = Object.assign(state, prev);
      state.v = STATE_VERSION;
      if(!state.profile) state.profile = { role:'', goal:'', cmds:'/start, /help, /add, /list, /done', lang:'uk', channel:'DM' };
      if(typeof state.formValid!=='boolean') state.formValid=false;
      if(!Array.isArray(state.done)) state.done=[];
    }catch(e){}
  }
  function save(){ try{ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }catch(e){} }

  // —É—Ç–∏–ª—ñ—Ç–∏
  const $ = s => root.querySelector(s);
  function setProgress(){ // –ø—Ä–æ—Å—Ç–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É (M2 —Ç–µ–∂ –ø–æ-—Å–≤–æ—î–º—É –ø–µ—Ä–µ—Ä–∞—Ö—É—î)
    const progressEl = $('#gp-progress');
    const pct = Math.round((state.done.length / flat.length)*100) || 0;
    if(progressEl) progressEl.textContent = `${pct}% –≤–∏–∫–æ–Ω–∞–Ω–æ ¬∑ –º–æ–≤–∞: ${(state.lang||'uk').toUpperCase()}`;
  }
  function markDoneAndGo(nextIndex){
    if(!state.done.includes(state.current)) state.done.push(state.current);
    if(typeof nextIndex==='number') state.current = nextIndex;
    save(); setProgress();
    // –ø–æ–≤—ñ–¥–æ–º–ª—è—î–º–æ —Å–∞–π–¥–±–∞—Ä (M2 —Å–ª—É—Ö–∞—î —Ü—é –ø–æ–¥—ñ—é)
    root.dispatchEvent(new CustomEvent('gp:markDone'));
    renderMain();
  }

  // —Ä–µ–Ω–¥–µ—Ä –≥–æ–ª–æ–≤–Ω–æ—ó –æ–±–ª–∞—Å—Ç—ñ –¥–ª—è –∫–ª—é—á—ñ–≤ welcome/form
  function renderMain(){
    const main = $('.main'); if(!main) return;
    const cur = flat[state.current] || flat[0];
    const key = cur ? cur.key : 'welcome';
    const titleEl = $('#gp-title'); const descEl = $('#gp-desc');

    if(key==='welcome'){
      if(titleEl) titleEl.textContent = '–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ üëã';
      if(descEl) descEl.textContent = '–ù–∞—Ç–∏—Å–Ω–∏ ‚Äú–ü–æ—á–∞—Ç–∏‚Äù ‚Äî –∑–∞–ø–æ–≤–Ω–∏—à 5 –ø–æ–ª—ñ–≤ —ñ –ø—ñ–¥–µ–º–æ –¥–∞–ª—ñ.';
      main.querySelectorAll('.dyn').forEach(n=>n.remove());
      const block = document.createElement('div');
      block.className='dyn';
      block.innerHTML = `
        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px">
          <button class="btn primary" id="gp-start-now">–ü–æ—á–∞—Ç–∏</button>
          <button class="btn" id="gp-see-how">–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î?</button>
        </div>
      `;
      main.appendChild(block);
      $('#gp-start-now')?.addEventListener('click', ()=>{
        // –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –∫—Ä–æ–∫ "–ó–∞–ø–æ–≤–Ω–∏—Ç–∏ 5 –ø–æ–ª—ñ–≤"
        const idx = flat.findIndex(x=>x.key==='form');
        if(idx>=0){ state.current = idx; save(); renderMain(); }
      });
      $('#gp-see-how')?.addEventListener('click', ()=> alert('1) –ó–∞–ø–æ–≤–Ω—é—î—à –∞–Ω–∫–µ—Ç—É ‚Üí 2) –û–±–∏—Ä–∞—î—à —Ä–µ–∂–∏–º ‚Üí 3) –ö–æ–ø—ñ—é—î—à –ø—Ä–æ–º–ø—Ç —É Cursor ‚Üí 4) –ó–∞–ø—É—Å–∫.'));
      return;
    }

    if(key==='form'){
      if(titleEl) titleEl.textContent = '–ê–Ω–∫–µ—Ç–∞: 5 –ø—Ä–æ—Å—Ç–∏—Ö –ø–æ–ª—ñ–≤';
      if(descEl) descEl.textContent = '–¶–µ –±–∞–∑–∞. –ù–∞ —ó—ó –æ—Å–Ω–æ–≤—ñ –∑–±–µ—Ä–µ–º–æ –ø—Ä–æ–º–ø—Ç–∏ —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó.';
      main.querySelectorAll('.dyn').forEach(n=>n.remove());

      const block = document.createElement('div'); block.className='dyn';
      block.innerHTML = `
        <div class="block">
          <div class="form-grid">
            <div class="field">
              <label>–†–æ–ª—å –±–æ—Ç–∞ <span class="hint">(–Ω–∞–ø—Ä.: –ê—Å–∏—Å—Ç–µ–Ω—Ç —Ç—Ä–µ–∫—ñ–Ω–≥—É –∑–≤–∏—á–æ–∫)</span></label>
              <input type="text" id="f-role" value="${escapeHtml(state.profile.role)}" placeholder="–í–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ">
              <div class="err" id="e-role">–í–∫–∞–∂–∏ —Ä–æ–ª—å.</div>
            </div>
            <div class="field">
              <label>–¶—ñ–ª—å <span class="hint">(–æ–¥–Ω–µ —Ä–µ—á–µ–Ω–Ω—è)</span></label>
              <input type="text" id="f-goal" value="${escapeHtml(state.profile.goal)}" placeholder="–©–æ —Å–∞–º–µ –º–∞—î —Ä–æ–±–∏—Ç–∏ –±–æ—Ç?">
              <div class="err" id="e-goal">–û–ø–∏—à–∏ —Ü—ñ–ª—å.</div>
            </div>
            <div class="field">
              <label>–ö–æ–º–∞–Ω–¥–∏ <span class="hint">(—á–µ—Ä–µ–∑ –∫–æ–º—É)</span></label>
              <input type="text" id="f-cmds" value="${escapeHtml(state.profile.cmds)}">
            </div>
            <div class="field">
              <label>–ú–æ–≤–∞ UI</label>
              <input type="text" id="f-lang" value="${escapeHtml(state.profile.lang||'uk')}" placeholder="uk / en">
            </div>
            <div class="field">
              <label>–ö–∞–Ω–∞–ª</label>
              <input type="text" id="f-channel" value="${escapeHtml(state.profile.channel||'DM')}" placeholder="DM –∞–±–æ Group">
            </div>
            <div class="full">
              <div class="hint">–ü–æ—Ä–∞–¥–∞: –Ω–µ —É—Å–∫–ª–∞–¥–Ω—é–π. –ö–æ—Ä–æ—Ç–∫–æ –π –ø–æ —Å—É—Ç—ñ ‚Äî –¥–∞–ª—ñ —Ä–æ–∑–∫–ª–∞–¥–µ–º–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.</div>
            </div>
          </div>
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px">
            <button class="btn primary" id="f-confirm">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∞–Ω–∫–µ—Ç—É</button>
            <button class="btn" id="f-copy-chat1">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –¥–ª—è Chat 1</button>
          </div>
          <div class="kbd" id="f-chat1-preview" style="display:none"></div>
        </div>
      `;
      main.appendChild(block);

      // –±—ñ–Ω–¥–∏
      $('#f-confirm')?.addEventListener('click', onConfirm);
      $('#f-copy-chat1')?.addEventListener('click', ()=>{
        const prompt = buildChat1Prompt();
        const box = $('#f-chat1-preview'); if(box){ box.textContent = prompt; box.style.display='block'; }
        copyText(prompt);
      });
      // live update –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
      ['role','goal','cmds','lang','channel'].forEach(k=>{
        const el = $('#f-'+k);
        el && el.addEventListener('input', (e)=>{
          state.profile[k] = String(e.target.value||'');
          save();
        });
      });
      return;
    }

    // —ñ–Ω—à—ñ –∫—Ä–æ–∫–∏ M4+ –∑–∞–ø–æ–≤–Ω–∏–º–æ –ø—ñ–∑–Ω—ñ—à–µ ‚Äî —Ç—É—Ç –ø—Ä–æ—Å—Ç–æ –Ω–µ —á—ñ–ø–∞—î–º–æ main
  }

  function onConfirm(){
    // –∑—á–∏—Ç–∞—Ç–∏ –ø–æ–ª—è
    const role = $('#f-role').value.trim();
    const goal = $('#f-goal').value.trim();
    const cmds = $('#f-cmds').value.trim() || '/start, /help';
    const lang = $('#f-lang').value.trim() || 'uk';
    const channel = $('#f-channel').value.trim() || 'DM';

    // –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
    let ok = true;
    toggleErr('#e-role', !role); ok = ok && !!role;
    toggleErr('#e-goal', !goal); ok = ok && !!goal;
    if(!ok) return;

    // –∑–±–µ—Ä–µ–≥—Ç–∏
    state.profile = { role, goal, cmds, lang, channel };
    state.lang = lang;
    state.formValid = true;
    save(); setProgress();

    // –≤—ñ–¥–º—ñ—Ç–∏—Ç–∏ done —ñ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –ø—É–Ω–∫—Ç ‚Äú–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∞–Ω–∫–µ—Ç—É‚Äù
    const idxConfirm = flat.findIndex(x=>x.key==='confirm');
    if(idxConfirm>=0){
      state.current = idxConfirm; // –ø–æ–∑–Ω–∞—á–∏–º–æ —è–∫ –ø–æ—Ç–æ—á–Ω–∏–π –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
      save();
      // –º–∞—Ä–∫—É—î–º–æ —è–∫ –≤–∏–∫–æ–Ω–∞–Ω–∏–π –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø—É–Ω–∫—Ç (form)
      const idxForm = flat.findIndex(x=>x.key==='form');
      if(idxForm>=0){ state.current = idxForm; save(); }
      markDoneAndGo(idxConfirm); // rebuild sidebar + jump –Ω–∞ confirm (done)
      // —ñ –æ–¥—Ä–∞–∑—É —à—Ç–æ–≤—Ö–∞—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–∞–ª—ñ ‚Äî –¥–æ –≤–∏–±–æ—Ä—É —Ä–µ–∂–∏–º—É
      const idxAuto = flat.findIndex(x=>x.key==='auto');
      if(idxAuto>=0){ state.current = idxAuto; save(); root.dispatchEvent(new CustomEvent('gp:markDone')); renderMain(); }
      alert('–ê–Ω–∫–µ—Ç—É –ø—Ä–∏–π–Ω—è—Ç–æ. –î–∞–ª—ñ ‚Äî –≤–∏–±—ñ—Ä —Ä–µ–∂–∏–º—É (AUTO/ASSISTED).');
    }
  }

  // –ü–æ–±—É–¥–æ–≤–∞ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è Chat 1 (ASSISTED —Ä–µ–∂–∏–º)
  function buildChat1Prompt(){
    const p = state.profile;
    return [
      '[CHAT 1 | NAVIGATOR] Onboarding survey ‚Üí produce concise English DEV BRIEF.',
      'User answers:',
      '- Role: '+(p.role||'-'),
      '- Goal: '+(p.goal||'-'),
      '- Commands: '+(p.cmds||'-'),
      '- UI Language: '+(p.lang||'uk'),
      '- Channel: '+(p.channel||'DM'),
      '',
      'Deliverables:',
      '1) DEV BRIEF (8‚Äì12 lines, English) for a Telegram bot matching answers.',
      '2) Bullet list of key flows.',
      '3) Data entities and storage suggestion (very brief).',
      'No code yet.'
    ].join('\n');
  }

  // –¥–æ–ø–æ–º—ñ–∂–Ω–µ: –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∑ —Ñ–æ–ª–±–µ–∫–æ–º
  async function copyText(txt){
    try{
      if(navigator.clipboard && window.isSecureContext){ await navigator.clipboard.writeText(txt); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); return; }
    }catch(e){}
    // —Ñ–æ–ª–±–µ–∫
    const ta = document.createElement('textarea'); ta.value = txt; document.body.appendChild(ta); ta.select();
    try{ document.execCommand('copy'); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); }catch(e){ alert('–°–∫–æ–ø—ñ—é–π –≤—Ä—É—á–Ω—É.'); }
    finally{ document.body.removeChild(ta); }
  }
  function toast(msg){
    let t = root.querySelector('#gp-toast-m3');
    if(!t){ t = document.createElement('div'); t.id='gp-toast-m3'; t.className='toast'; t.style.display='none'; root.appendChild(t); }
    t.innerHTML = msg; t.style.display='block'; clearTimeout(window.__gp_to_m3);
    window.__gp_to_m3 = setTimeout(()=> t.style.display='none', 1600);
  }
  function toggleErr(sel, show){ const el = $(sel); if(!el) return; el.classList.toggle('show', !!show); }
  function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

  function init(){
    load(); setProgress();
    // —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–Ω–µ "–ü–æ—á–∞—Ç–∏" –∑ M0 ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–º–æ
    const startBtn = $('#gp-start'); startBtn && startBtn.addEventListener('click', ()=>{
      const idx = flat.findIndex(x=>x.key==='form'); if(idx>=0){ state.current=idx; save(); renderMain(); }
    });
    renderMain();
  }
  init();
})();
</script>
<!-- GP:END START+FORM SCRIPT -->
<!-- GP:M3 END -->
<!-- GP:M4 START ‚Ä¢ MODES: AUTO / ASSISTED (build 2025-10-29.5) -->
<!-- GP:BEGIN MODES STYLES -->
<style>
  #gp-panel .mode-wrap{display:grid;grid-template-columns:1fr;gap:10px}
  #gp-panel .card{border:1px solid var(--line);border-radius:12px;padding:12px}
  #gp-panel .kbd{margin-top:8px;border:1px solid var(--line);border-radius:10px;padding:10px;
    font:12px/1.5 ui-monospace,SFMono-Regular,Menlo,monospace;white-space:pre-wrap;background:transparent;color:var(--text)}
  #gp-panel .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  #gp-panel textarea.kbd{min-height:120px}
</style>
<!-- GP:END MODES STYLES -->

<!-- GP:BEGIN MODES SCRIPT -->
<script>
(function(){
  const root = document.getElementById('gp-panel'); if(!root) return;
  const STORE_KEY = 'gpPanel_state_m0';
  const STATE_VERSION = 5;

  // —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π flat –ø–æ—Ä—è–¥–æ–∫ —è–∫ —É M2/M3
  const sections = [
    { title:'0 ¬∑ –°—Ç–∞—Ä—Ç', items:[{t:'–ü–æ—á–∞—Ç–∏', b:'welcome'},{t:'–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î', b:'guide'}]},
    { title:'1 ¬∑ –ê–Ω–∫–µ—Ç–∞', items:[{t:'–ó–∞–ø–æ–≤–Ω–∏—Ç–∏ 5 –ø–æ–ª—ñ–≤', b:'form'},{t:'–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∞–Ω–∫–µ—Ç—É', b:'confirm'}]},
    { title:'2 ¬∑ –†–µ–∂–∏–º', items:[{t:'AUTO', b:'auto'},{t:'ASSISTED', b:'assisted'}]},
    { title:'3 ¬∑ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä', items:[{t:'–¢–∏–ø / –ú–æ–¥—É–ª—ñ', b:'chips'},{t:'–î–∞–Ω—ñ / –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó', b:'storage/integrations'},{t:'–ë–µ–∫–µ–Ω–¥ (–æ–ø—Ü.) / –†—ñ–≤–µ–Ω—å', b:'backend/level'}]},
    { title:'4 ¬∑ –û–≥–ª—è–¥', items:[{t:'DEV BRIEF (EN)', b:'brief'},{t:'CURSOR PROMPT (EN)', b:'prompt'}]},
    { title:'5 ¬∑ –°–µ—Ä–µ–¥–æ–≤–∏—â–µ', items:[{t:'Local vs Codespaces', b:'env'}]},
    { title:'6 ¬∑ –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ / Files', items:[{t:'–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏/–í—ñ–¥–∫—Ä–∏—Ç–∏', b:'tools'},{t:'–ß–µ–∫-–ª–∏—Å—Ç —Ñ–∞–π–ª—ñ–≤', b:'files'}]},
    { title:'7 ¬∑ –í—Å—Ç–∞–≤–∏—Ç–∏ —É Cursor', items:[{t:'–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø—Ä–æ–º–ø—Ç', b:'copy-cursor'},{t:'–î–µ –≤—Å—Ç–∞–≤–∏—Ç–∏?', b:'cursor-how'}]},
    { title:'8 ¬∑ –ó–∞–ø—É—Å–∫', items:[{t:'–ö–æ–º–∞–Ω–¥–∏ –∑–∞–ø—É—Å–∫—É', b:'run'},{t:'–Ñ –ø—Ä–æ–±–ª–µ–º–∞', b:'troubles'}]},
    { title:'9 ¬∑ BotFather', items:[{t:'/setcommands', b:'bf-commands'}]},
    { title:'10 ¬∑ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞', items:[{t:'/start /help', b:'test'}]},
    { title:'11 ¬∑ –ì–æ—Ç–æ–≤–æ / –ê–ø“ë—Ä–µ–π–¥–∏', items:[{t:'UI-–∫–Ω–æ–ø–∫–∏', b:'upgrade-ui'},{t:'–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', b:'upgrade-stats'},{t:'–û–ø–ª–∞—Ç–∏', b:'upgrade-pay'}]}
  ];
  let flat=[]; sections.forEach((sec,si)=>sec.items.forEach((it,idx)=>flat.push({si,idx,key:it.b,title:it.t,sec:sec.title})));

  let state = {
    v: STATE_VERSION, mode: root.getAttribute('data-mode')||'auto',
    theme: root.getAttribute('data-theme')||'light',
    lang:'uk', ruLink:'', current:0, done:[], filter:'',
    profile:{ role:'', goal:'', cmds:'/start, /help, /add, /list, /done', lang:'uk', channel:'DM' },
    assistedBrief:''  // —Å—é–¥–∏ –≤—Å—Ç–∞–≤–ª—è—î–º–æ DEV BRIEF –≤—ñ–¥ Chat 1
  };

  function load(){
    try{
      const raw = localStorage.getItem(STORE_KEY); if(!raw) return;
      const prev = JSON.parse(raw)||{};
      state = Object.assign(state, prev);
      state.v = STATE_VERSION;
      if(!state.profile) state.profile = { role:'', goal:'', cmds:'/start, /help, /add, /list, /done', lang:'uk', channel:'DM' };
      if(typeof state.assistedBrief!=='string') state.assistedBrief='';
      if(!Array.isArray(state.done)) state.done=[];
      if(typeof state.current!=='number') state.current=0;
    }catch(e){}
  }
  function save(){ try{ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }catch(e){} }

  const $ = s => root.querySelector(s);
  function getKey(){ return (flat[state.current]||flat[0]).key; }
  let lastIdx = -1;

  // –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä DEV BRIEF (EN) –∑ –∞–Ω–∫–µ—Ç–∏ (–¥—É–∂–µ –∫–æ—Ä–æ—Ç–∫–æ —ñ —á—ñ—Ç–∫–æ)
  function makeDevBrief(p){
    return [
      `Goal: Build a Telegram bot ‚Äì ${p.role||'Bot'} ‚Äì whose main purpose is: ${p.goal||'not specified'}.`,
      `Commands: ${p.cmds||'/start, /help'}.`,
      `UI Language: ${p.lang||'uk'}. Channel: ${p.channel||'DM'}.`,
      `Key flows: onboarding (/start), help (/help), core action(s) based on goal.`,
      `Storage: start with lightweight JSON file (local) or Google Sheets if user selects Sheets.`,
      `Tech: Python 3.10+, aiogram v3, python-dotenv for TOKEN.`,
      `Structure: main.py, requirements.txt, .env, data/ (if needed).`,
      `Next steps: generate code skeleton, run locally or in Codespaces, then extend features.`
    ].join('\n');
  }

  // –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä CURSOR PROMPT (EN) —ñ–∑ DEV BRIEF
  function makeCursorPrompt(p, brief){
    return [
`[CHAT 2 | PROGRAMMER] CURRENT STEP: Generate project skeleton`,
`TERMINAL> none`,
`CODE> none`,
`INSTRUCTION:`,
`You are Cursor writing code only. Use Python 3.10+, aiogram v3, python-dotenv.`,
`Create a minimal working bot based on this DEV BRIEF:`,
`----- DEV BRIEF -----`,
brief.trim(),
`---------------------`,
`Deliverables (files):`,
`1) requirements.txt (aiogram==3.*, python-dotenv, loguru)`,
`2) main.py with /start and /help handlers, polling start`,
`3) .env.example with TOKEN=your_token_here`,
`Notes:`,
`- Do not add extra prose. Return code blocks with exact content.`,
`- Keep code runnable with: pip install -r requirements.txt && python main.py`,
`- Language in messages: ${p.lang||'uk'}.`
    ].join('\n');
  }

  // –ø—Ä–æ–º–ø—Ç –¥–ª—è Chat 1 (ASSISTED) ‚Äî –∫–æ—Ä–æ—Ç–∫–∏–π
  function makeAssistedPrompt(p){
    return [
      `[CHAT 1 | NAVIGATOR] Onboarding survey ‚Üí produce concise English DEV BRIEF.`,
      `User answers:`,
      `- Role: ${p.role||'-'}`,
      `- Goal: ${p.goal||'-'}`,
      `- Commands: ${p.cmds||'-'}`,
      `- UI Language: ${p.lang||'uk'}`,
      `- Channel: ${p.channel||'DM'}`,
      ``,
      `Deliverables:`,
      `1) DEV BRIEF (8‚Äì12 lines, English) for a Telegram bot matching answers.`,
      `2) Bullet list of key flows.`,
      `3) Data entities and storage suggestion (very brief).`,
      `No code yet.`
    ].join('\n');
  }

  function copyText(txt){
    (async()=>{
      try{
        if(navigator.clipboard && window.isSecureContext){ await navigator.clipboard.writeText(txt); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); return; }
      }catch(e){}
      const ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta); ta.select();
      try{ document.execCommand('copy'); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); }catch(e){ alert('–°–∫–æ–ø—ñ—é–π –≤—Ä—É—á–Ω—É.'); }
      finally{ document.body.removeChild(ta); }
    })();
  }
  function toast(msg){
    let t = root.querySelector('#gp-toast-m4');
    if(!t){ t=document.createElement('div'); t.id='gp-toast-m4'; t.className='toast'; t.style.display='none'; root.appendChild(t); }
    t.innerHTML = msg; t.style.display='block'; clearTimeout(window.__gp_to_m4);
    window.__gp_to_m4 = setTimeout(()=> t.style.display='none', 1600);
  }

  function markDoneAndGo(nextKey){
    const idx = state.current;
    if(!state.done.includes(idx)) state.done.push(idx);
    // –æ–Ω–æ–≤–∏—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å —É —à–∞–ø—Ü—ñ
    const progressEl = $('#gp-progress');
    if(progressEl){
      const pct = Math.round((state.done.length/flat.length)*100)||0;
      progressEl.textContent = `${pct}% –≤–∏–∫–æ–Ω–∞–Ω–æ ¬∑ –º–æ–≤–∞: ${(state.lang||'uk').toUpperCase()}`;
    }
    save();
    root.dispatchEvent(new CustomEvent('gp:markDone')); // M2 –æ–Ω–æ–≤–∏—Ç—å —Å–∞–π–¥–±–∞—Ä
    if(nextKey){
      const ni = flat.findIndex(x=>x.key===nextKey);
      if(ni>=0){ state.current = ni; save(); renderModes(true); }
    }
  }

  // –æ—Å–Ω–æ–≤–Ω–∏–π —Ä–µ–Ω–¥–µ—Ä –¥–ª—è –∫—Ä–æ–∫—ñ–≤ auto/assisted
  function renderModes(force){
    load(); // –≤–∏—Ç—è–≥–Ω—É—Ç–∏ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π current, —è–∫—â–æ –∑–º—ñ–Ω–∏–≤—Å—è –∑–æ–≤–Ω—ñ
    const curIdx = state.current;
    if(!force && curIdx===lastIdx) return;
    lastIdx = curIdx;

    const key = getKey();
    if(key!=='auto' && key!=='assisted') return; // –ø–æ–∫–∞–∑—É—î–º–æ —Ç—ñ–ª—å–∫–∏ –Ω–∞ —Ü–∏—Ö –µ—Ç–∞–ø–∞—Ö

    const main = root.querySelector('.main'); if(!main) return;
    const titleEl = $('#gp-title'); const descEl = $('#gp-desc');
    main.querySelectorAll('.dyn').forEach(n=>n.remove());

    if(key==='auto'){
      titleEl && (titleEl.textContent = '–†–µ–∂–∏–º AUTO: –≤—Å–µ –≥–æ—Ç–æ–≤–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ');
      descEl && (descEl.textContent = '–ú–∏ –∑–≥–µ–Ω–µ—Ä—É–≤–∞–ª–∏ –∞–Ω–≥–ª–æ–º–æ–≤–Ω–∏–π DEV BRIEF —ñ CURSOR PROMPT. –°–∫–æ–ø—ñ—é–π —É Cursor, –∫–æ–ª–∏ –±—É–¥–µ–º–æ —Ç–∞–º.');

      const devBrief = makeDevBrief(state.profile);
      const cursorPrompt = makeCursorPrompt(state.profile, devBrief);

      const wrap = document.createElement('div'); wrap.className='dyn card mode-wrap';
      wrap.innerHTML = `
        <div class="card">
          <b>DEV BRIEF (EN)</b>
          <div class="kbd" id="m4-brief">${escapeHtml(devBrief)}</div>
          <div class="row">
            <button class="btn" id="m4-copy-brief">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ BRIEF</button>
          </div>
        </div>
        <div class="card">
          <b>CURSOR PROMPT (EN)</b>
          <div class="kbd" id="m4-prompt">${escapeHtml(cursorPrompt)}</div>
          <div class="row">
            <button class="btn primary" id="m4-copy-cursor">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –¥–ª—è Cursor</button>
            <button class="btn" id="m4-next">–ì–æ—Ç–æ–≤–æ ‚Üí –î–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞</button>
          </div>
        </div>
      `;
      main.appendChild(wrap);

      $('#m4-copy-brief')?.addEventListener('click', ()=> copyText(devBrief));
      $('#m4-copy-cursor')?.addEventListener('click', ()=> copyText(cursorPrompt));
      $('#m4-next')?.addEventListener('click', ()=> markDoneAndGo('chips'));
      return;
    }

    if(key==='assisted'){
      titleEl && (titleEl.textContent = '–†–µ–∂–∏–º ASSISTED: —á–µ—Ä–µ–∑ ChatGPT ‚Üí –ø–æ—Ç—ñ–º Cursor');
      descEl && (descEl.textContent = '–ö—Ä–æ–∫ 1: —Å–∫–æ–ø—ñ—é–π –ø—Ä–æ–º–ø—Ç —É Chat 1. –ö—Ä–æ–∫ 2: –≤—Å—Ç–∞–≤ –Ω–∞–∑–∞–¥ DEV BRIEF. –ö—Ä–æ–∫ 3: –æ—Ç—Ä–∏–º–∞—î—à CURSOR PROMPT.');

      const assistedPrompt = makeAssistedPrompt(state.profile);
      const devBrief = (state.assistedBrief||'').trim();
      const cursorPrompt = devBrief ? makeCursorPrompt(state.profile, devBrief) : '';

      const wrap = document.createElement('div'); wrap.className='dyn card mode-wrap';
      wrap.innerHTML = `
        <div class="card">
          <b>–ö—Ä–æ–∫ 1 ‚Äî –ü—Ä–æ–º–ø—Ç –¥–ª—è Chat 1</b>
          <div class="kbd" id="m4-assist">${escapeHtml(assistedPrompt)}</div>
          <div class="row">
            <button class="btn" id="m4-copy-assist">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –¥–ª—è Chat 1</button>
          </div>
        </div>
        <div class="card">
          <b>–ö—Ä–æ–∫ 2 ‚Äî –í—Å—Ç–∞–≤ DEV BRIEF (EN) –≤—ñ–¥ Chat 1</b>
          <textarea class="kbd" id="m4-brief-inp" placeholder="–í—Å—Ç–∞–≤ —Å—é–¥–∏ DEV BRIEF –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é‚Ä¶">${escapeHtml(state.assistedBrief)}</textarea>
          <div class="row">
            <button class="btn" id="m4-save-brief">–ó–±–µ—Ä–µ–≥—Ç–∏ BRIEF</button>
            <span class="hint">–ü—ñ—Å–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑ º—è–≤–∏—Ç—å—Å—è CURSOR PROMPT.</span>
          </div>
        </div>
        <div class="card" id="m4-cursor-card" style="${cursorPrompt?'':'display:none'}">
          <b>–ö—Ä–æ–∫ 3 ‚Äî CURSOR PROMPT (EN)</b>
          <div class="kbd" id="m4-prompt2">${escapeHtml(cursorPrompt)}</div>
          <div class="row">
            <button class="btn primary" id="m4-copy-cursor2">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –¥–ª—è Cursor</button>
            <button class="btn" id="m4-next2">–ì–æ—Ç–æ–≤–æ ‚Üí –î–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞</button>
          </div>
        </div>
      `;
      main.appendChild(wrap);

      $('#m4-copy-assist')?.addEventListener('click', ()=> copyText(assistedPrompt));
      $('#m4-save-brief')?.addEventListener('click', ()=>{
        const val = ($('#m4-brief-inp').value||'').trim();
        if(!val){ alert('–í—Å—Ç–∞–≤ DEV BRIEF –≤—ñ–¥ Chat 1.'); return; }
        state.assistedBrief = val; save();
        // –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –π –ø–æ–∫–∞–∑–∞—Ç–∏ CURSOR PROMPT
        const cp = makeCursorPrompt(state.profile, val);
        const card = $('#m4-cursor-card'); const box=$('#m4-prompt2');
        if(card && box){ box.textContent = cp; card.style.display='block'; }
      });
      $('#m4-copy-cursor2')?.addEventListener('click', ()=>{
        const box = $('#m4-prompt2'); if(!box) return;
        copyText(box.textContent||'');
      });
      $('#m4-next2')?.addEventListener('click', ()=> markDoneAndGo('chips'));
      return;
    }
  }

  // —É—Ç–∏–ª—ñ—Ç–∏
  function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

  // —Ç—Ä–∏–≥–µ—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–æ –π –ø—ñ—Å–ª—è –ø–æ–∑–Ω–∞—á–µ–Ω–Ω—è done
  function init(){
    load();
    renderModes(true);
    // –∫–æ–ª–∏ —Å–∞–π–¥–±–∞—Ä –∞–±–æ —ñ–Ω—à—ñ –º–æ–¥—É–ª—ñ –º—ñ–Ω—è—é—Ç—å current ‚Äî –æ–Ω–æ–≤–ª—é—î–º–æ—Å—å
    root.addEventListener('gp:markDone', ()=> renderModes(true));
    // –ª–µ–≥–∫–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª —è–∫ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –≤—ñ–¥ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –∫–ª—ñ–∫—ñ–≤ —É —Å–∞–π–¥–±–∞—Ä—ñ (M2)
    setInterval(()=> renderModes(false), 400);
  }
  init();
})();
</script>
<!-- GP:END MODES SCRIPT -->
<!-- GP:M4 END -->
<!-- GP:M5 START ‚Ä¢ CHIPS CONSTRUCTOR (build 2025-10-29.6) -->
<!-- GP:BEGIN CHIPS STYLES -->
<style>
  #gp-panel .chips-wrap{display:grid;grid-template-columns:1fr;gap:12px}
  #gp-panel .chip-row{display:flex;flex-wrap:wrap;gap:8px}
  #gp-panel .chipbtn{
    border:1px solid var(--line); border-radius:999px; padding:6px 10px; cursor:pointer; font-size:12px; background:transparent;
  }
  #gp-panel .chipbtn[aria-pressed="true"]{ background:var(--active-bg); border-color:var(--active-border) }
  #gp-panel .card{border:1px solid var(--line); border-radius:12px; padding:12px}
  #gp-panel .kbd{margin-top:8px;border:1px solid var(--line);border-radius:10px;padding:10px;
    font:12px/1.5 ui-monospace,SFMono-Regular,Menlo,monospace;white-space:pre-wrap;background:transparent;color:var(--text)}
  #gp-panel .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
</style>
<!-- GP:END CHIPS STYLES -->

<!-- GP:BEGIN CHIPS SCRIPT -->
<script>
(function(){
  const root = document.getElementById('gp-panel'); if(!root) return;
  const STORE_KEY = 'gpPanel_state_m0';
  const STATE_VERSION = 6;

  // —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ –∑ M2/M3/M4
  const sections = [
    { title:'0 ¬∑ –°—Ç–∞—Ä—Ç', items:[{t:'–ü–æ—á–∞—Ç–∏', b:'welcome'},{t:'–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î', b:'guide'}]},
    { title:'1 ¬∑ –ê–Ω–∫–µ—Ç–∞', items:[{t:'–ó–∞–ø–æ–≤–Ω–∏—Ç–∏ 5 –ø–æ–ª—ñ–≤', b:'form'},{t:'–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∞–Ω–∫–µ—Ç—É', b:'confirm'}]},
    { title:'2 ¬∑ –†–µ–∂–∏–º', items:[{t:'AUTO', b:'auto'},{t:'ASSISTED', b:'assisted'}]},
    { title:'3 ¬∑ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä', items:[{t:'–¢–∏–ø / –ú–æ–¥—É–ª—ñ', b:'chips'},{t:'–î–∞–Ω—ñ / –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó', b:'storage/integrations'},{t:'–ë–µ–∫–µ–Ω–¥ (–æ–ø—Ü.) / –†—ñ–≤–µ–Ω—å', b:'backend/level'}]},
    { title:'4 ¬∑ –û–≥–ª—è–¥', items:[{t:'DEV BRIEF (EN)', b:'brief'},{t:'CURSOR PROMPT (EN)', b:'prompt'}]},
    { title:'5 ¬∑ –°–µ—Ä–µ–¥–æ–≤–∏—â–µ', items:[{t:'Local vs Codespaces', b:'env'}]},
    { title:'6 ¬∑ –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ / Files', items:[{t:'–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏/–í—ñ–¥–∫—Ä–∏—Ç–∏', b:'tools'},{t:'–ß–µ–∫-–ª–∏—Å—Ç —Ñ–∞–π–ª—ñ–≤', b:'files'}]},
    { title:'7 ¬∑ –í—Å—Ç–∞–≤–∏—Ç–∏ —É Cursor', items:[{t:'–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø—Ä–æ–º–ø—Ç', b:'copy-cursor'},{t:'–î–µ –≤—Å—Ç–∞–≤–∏—Ç–∏?', b:'cursor-how'}]},
    { title:'8 ¬∑ –ó–∞–ø—É—Å–∫', items:[{t:'–ö–æ–º–∞–Ω–¥–∏ –∑–∞–ø—É—Å–∫—É', b:'run'},{t:'–Ñ –ø—Ä–æ–±–ª–µ–º–∞', b:'troubles'}]},
    { title:'9 ¬∑ BotFather', items:[{t:'/setcommands', b:'bf-commands'}]},
    { title:'10 ¬∑ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞', items:[{t:'/start /help', b:'test'}]},
    { title:'11 ¬∑ –ì–æ—Ç–æ–≤–æ / –ê–ø“ë—Ä–µ–π–¥–∏', items:[{t:'UI-–∫–Ω–æ–ø–∫–∏', b:'upgrade-ui'},{t:'–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', b:'upgrade-stats'},{t:'–û–ø–ª–∞—Ç–∏', b:'upgrade-pay'}]}
  ];
  const flat=[]; sections.forEach((s,si)=>s.items.forEach((it,idx)=>flat.push({si,idx,key:it.b,title:it.t,sec:s.title})));

  let state = {
    v: STATE_VERSION, mode: root.getAttribute('data-mode')||'auto', theme: root.getAttribute('data-theme')||'light',
    lang:'uk', ruLink:'', current:0, done:[], filter:'',
    profile:{ role:'', goal:'', cmds:'/start, /help, /add, /list, /done', lang:'uk', channel:'DM',
      // –Ω–æ–≤—ñ –ø–æ–ª—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞:
      type:'', modules:[], data:'json', integrations:[], backend:'none', level:'L1'
    },
    assistedBrief:''
  };

  function load(){
    try{
      const raw = localStorage.getItem(STORE_KEY); if(!raw) return;
      const prev = JSON.parse(raw)||{};
      state = Object.assign(state, prev);
      state.v = STATE_VERSION;
      // –¥–µ—Ñ–æ–ª—Ç–∏ –¥–ª—è –Ω–æ–≤–∏—Ö –ø–æ–ª—ñ–≤
      state.profile = Object.assign({
        role:'', goal:'', cmds:'/start, /help, /add, /list, /done', lang:'uk', channel:'DM',
        type:'', modules:[], data:'json', integrations:[], backend:'none', level:'L1'
      }, state.profile||{});
      if(!Array.isArray(state.profile.modules)) state.profile.modules=[];
      if(!Array.isArray(state.profile.integrations)) state.profile.integrations=[];
      if(!state.profile.data) state.profile.data='json';
      if(!state.profile.level) state.profile.level='L1';
    }catch(e){}
  }
  function save(){ try{ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }catch(e){} }

  const $ = s => root.querySelector(s);
  function key(){ return (flat[state.current]||flat[0]).key; }

  // –Ω–∞–±—ñ—Ä —á—ñ–ø—ñ–≤
  const CHIPSETS = {
    type: ['CRM','Task','Habit','FAQ','Shop','Booking','Custom'],
    modules: ['ui-buttons','reminders','roles','admin','payments','stats','files'],
    data: ['no-save','json','sheets','sqlite','postgres'],
    integrations: ['sheets','notion','webhook','stripe','openai'],
    backend: ['none','parser','webhook-receiver','tiny-fastapi'],
    level: ['L0','L1','L2','L3']
  };

  function chip(label, pressed, onClick){
    const b = document.createElement('button');
    b.className='chipbtn';
    b.textContent=label;
    b.setAttribute('aria-pressed', pressed?'true':'false');
    b.addEventListener('click', ()=>{
      onClick && onClick(label, b.getAttribute('aria-pressed')==='true');
    });
    return b;
  }

  function renderChips(){
    const main = root.querySelector('.main'); if(!main) return;
    const k = key();
    if(!['chips','storage/integrations','backend/level'].includes(k)) return;

    const title = $('#gp-title'); const desc = $('#gp-desc');
    title && (title.textContent = '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä: –∑–±–µ—Ä–∏ –∫–æ–Ω—Ñ—ñ–≥ –≤–∞—à–æ–≥–æ –±–æ—Ç–∞');
    desc && (desc.textContent = '–û–±–µ—Ä–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —á—ñ–ø–∏. –ü—Ä–µ–≤ º—é –∞–Ω–≥–ª–æ–º–æ–≤–Ω–æ–≥–æ BRIEF —ñ CURSOR PROMPT –∑–Ω–∏–∑—É.');

    // –æ—á–∏—Å—Ç–∏—Ç–∏ –¥–∏–Ω–∞–º—ñ–∫—É
    main.querySelectorAll('.dyn').forEach(n=>n.remove());

    // –±–ª–æ–∫–∏
    const wrap = document.createElement('div'); wrap.className='dyn chips-wrap';

    // TYPE (single)
    wrap.appendChild(sectionCard('–¢–∏–ø –±–æ—Ç–∞', CHIPSETS.type, (val, was)=>{
      state.profile.type = (state.profile.type===val && was) ? '' : val;
      save(); renderPreview();
    }, (val)=> state.profile.type===val, true));

    // MODULES (multi)
    wrap.appendChild(sectionCard('–ú–æ–¥—É–ª—ñ', CHIPSETS.modules, (val, was)=>{
      toggleIn(state.profile.modules, val, was);
      save(); renderPreview();
    }, (val)=> state.profile.modules.includes(val), false));

    // DATA (single)
    wrap.appendChild(sectionCard('–î–∞–Ω—ñ / –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è', CHIPSETS.data, (val, was)=>{
      state.profile.data = (state.profile.data===val && was) ? 'json' : val;
      save(); renderPreview();
    }, (val)=> state.profile.data===val, true));

    // INTEGRATIONS (multi)
    wrap.appendChild(sectionCard('–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó', CHIPSETS.integrations, (val, was)=>{
      toggleIn(state.profile.integrations, val, was);
      save(); renderPreview();
    }, (val)=> state.profile.integrations.includes(val), false));

    // BACKEND (single)
    wrap.appendChild(sectionCard('–ë–µ–∫–µ–Ω–¥ (–æ–ø—Ü.)', CHIPSETS.backend, (val, was)=>{
      state.profile.backend = (state.profile.backend===val && was) ? 'none' : val;
      save(); renderPreview();
    }, (val)=> state.profile.backend===val, true));

    // LEVEL (single)
    wrap.appendChild(sectionCard('–†—ñ–≤–µ–Ω—å —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ', CHIPSETS.level, (val, was)=>{
      state.profile.level = (state.profile.level===val && was) ? 'L1' : val;
      save(); renderPreview();
    }, (val)=> state.profile.level===val, true));

    // PREVIEW
    const prev = document.createElement('div'); prev.className='card';
    prev.innerHTML = `
      <b>–ü—Ä–µ–≤ º—é ¬∑ DEV BRIEF (EN)</b>
      <div class="kbd" id="m5-brief"></div>
      <div class="row">
        <button class="btn" id="m5-copy-brief">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ BRIEF</button>
      </div>
      <div style="height:8px"></div>
      <b>–ü—Ä–µ–≤ º—é ¬∑ CURSOR PROMPT (EN)</b>
      <div class="kbd" id="m5-prompt"></div>
      <div class="row">
        <button class="btn primary" id="m5-copy-cursor">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –¥–ª—è Cursor</button>
        <button class="btn" id="m5-done">–ì–æ—Ç–æ–≤–æ ‚Üí –û–≥–ª—è–¥</button>
      </div>
    `;
    wrap.appendChild(prev);

    main.appendChild(wrap);
    renderPreview();

    $('#m5-copy-brief')?.addEventListener('click', ()=> copyText(makeBrief(state.profile)));
    $('#m5-copy-cursor')?.addEventListener('click', ()=> copyText(makeCursor(state.profile)));
    $('#m5-done')?.addEventListener('click', ()=> {
      // –ø–æ–º—ñ—Ç–∏—Ç–∏ done —ñ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ ‚ÄúDEV BRIEF (EN)‚Äù
      const idx = state.current;
      if(!state.done.includes(idx)) state.done.push(idx);
      save();
      root.dispatchEvent(new CustomEvent('gp:markDone'));
      const ni = flat.findIndex(x=>x.key==='brief');
      if(ni>=0){ state.current=ni; save(); renderChips(); renderPreview(true); }
    });
  }

  function sectionCard(title, items, onClick, isActive, single){
    const card = document.createElement('div'); card.className='card';
    const row = document.createElement('div'); row.className='chip-row';
    card.innerHTML = `<b>${title}${single?' (–æ–¥–∏–Ω –≤–∏–±—ñ—Ä)':' (–∫—ñ–ª—å–∫–∞)'} </b>`;
    items.forEach(val=>{
      const b = chip(val, isActive(val), (label, wasPressed)=>{
        // —è–∫—â–æ single ‚Äî –∑–Ω—è—Ç–∏ —ñ–Ω—à—ñ
        if(single){
          row.querySelectorAll('.chipbtn').forEach(x=>x.setAttribute('aria-pressed','false'));
          b.setAttribute('aria-pressed', String(!(state.profile[typeByTitle(title)]===label && wasPressed)));
        }else{
          b.setAttribute('aria-pressed', String(!wasPressed));
        }
        onClick(label, wasPressed);
      });
      row.appendChild(b);
    });
    card.appendChild(row);
    return card;
  }

  function typeByTitle(title){
    if(title.startsWith('–¢–∏–ø')) return 'type';
    if(title.startsWith('–î–∞–Ω—ñ')) return 'data';
    if(title.startsWith('–ë–µ–∫–µ–Ω–¥')) return 'backend';
    if(title.startsWith('–†—ñ–≤–µ–Ω—å')) return 'level';
    return '';
  }
  function toggleIn(arr, val, wasPressed){
    const i = arr.indexOf(val);
    if(wasPressed && i>-1) arr.splice(i,1);
    else if(!wasPressed && i===-1) arr.push(val);
  }

  // –ü—Ä–µ–≤ º—é –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∏ (–∫–æ—Ä–æ—Ç–∫—ñ, –±–µ–∑ –∫–æ–¥—É)
  function makeBrief(p){
    const mods = p.modules.length? p.modules.join(', ') : 'basic';
    const ints = p.integrations.length? p.integrations.join(', ') : 'none';
    return [
      `Type: ${p.type||'Custom'} ¬∑ Level: ${p.level||'L1'} ¬∑ Backend: ${p.backend||'none'}`,
      `Goal: ${p.goal||'-'}`,
      `Commands: ${p.cmds||'/start, /help'}`,
      `Modules: ${mods}`,
      `Data: ${p.data} ¬∑ Integrations: ${ints}`,
      `Tech: Python 3.10+, aiogram v3, python-dotenv`,
      `Structure: requirements.txt, main.py, .env(.example), data/ (if needed)`,
      `Run: pip install -r requirements.txt && python main.py`,
      `UI Language: ${p.lang||'uk'} ¬∑ Channel: ${p.channel||'DM'}`
    ].join('\n');
  }
  function makeCursor(p){
    const brief = makeBrief(p);
    return [
`[CHAT 2 | PROGRAMMER] CURRENT STEP: Generate skeleton by profile`,
`TERMINAL> none`,
`CODE> none`,
`INSTRUCTION:`,
`Use Python 3.10+, aiogram v3, python-dotenv.`,
`Implement minimal working bot according to this profile:`,
`----- DEV BRIEF -----`,
brief,
`---------------------`,
`Deliverables:`,
`- requirements.txt (aiogram==3.*, python-dotenv, loguru)`,
`- main.py with /start, /help; start polling`,
`- .env.example (TOKEN=your_token_here)`,
`No extra prose. Keep messages in ${p.lang||'uk'}.`
    ].join('\n');
  }

  function renderPreview(skipSet){
    const b = $('#m5-brief'); const p = $('#m5-prompt');
    if(b) b.textContent = makeBrief(state.profile);
    if(p) p.textContent = makeCursor(state.profile);
    if(!skipSet){
      const title = $('#gp-title'); if(title) title.textContent = '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä: –∑–±–µ—Ä–∏ –∫–æ–Ω—Ñ—ñ–≥ –≤–∞—à–æ–≥–æ –±–æ—Ç–∞';
    }
    // –æ–Ω–æ–≤–∏—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å —É —à–∞–ø—Ü—ñ
    const progressEl = $('#gp-progress');
    if(progressEl){
      const pct = Math.round((state.done.length/flat.length)*100)||0;
      progressEl.textContent = `${pct}% –≤–∏–∫–æ–Ω–∞–Ω–æ ¬∑ –º–æ–≤–∞: ${(state.lang||'uk').toUpperCase()}`;
    }
  }

  function copyText(txt){
    (async()=>{
      try{
        if(navigator.clipboard && window.isSecureContext){ await navigator.clipboard.writeText(txt); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); return; }
      }catch(e){}
      const ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta); ta.select();
      try{ document.execCommand('copy'); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); }catch(e){ alert('–°–∫–æ–ø—ñ—é–π –≤—Ä—É—á–Ω—É.'); }
      finally{ document.body.removeChild(ta); }
    })();
  }
  function toast(msg){
    let t = root.querySelector('#gp-toast-m5');
    if(!t){ t=document.createElement('div'); t.id='gp-toast-m5'; t.className='toast'; t.style.display='none'; root.appendChild(t); }
    t.innerHTML = msg; t.style.display='block'; clearTimeout(window.__gp_to_m5);
    window.__gp_to_m5 = setTimeout(()=> t.style.display='none', 1600);
  }

  function init(){
    load();
    // —Ä–µ–Ω–¥–µ—Ä–∏—Ç–∏, –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞—Ö–æ–¥–∏—Ç—å —É –±—É–¥—å-—è–∫–∏–π –ø—É–Ω–∫—Ç ‚Äú–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞‚Äù
    renderChips();
    // —Å–ª—ñ–¥–∫—É—î–º–æ –∑–∞ –∑–º—ñ–Ω–∞–º–∏ current (–∫–ª—ñ–∫–∏ —É —Å–∞–π–¥–±–∞—Ä—ñ)
    setInterval(()=> renderChips(), 400);
  }
  init();
})();
</script>
<!-- GP:END CHIPS SCRIPT -->
<!-- GP:M5 END -->
<!-- GP:M6 START ‚Ä¢ REVIEW & CONFIRM (build 2025-10-29.7) -->
<!-- GP:BEGIN REVIEW STYLES -->
<style>
  #gp-panel .review-wrap{display:grid;grid-template-columns:1fr;gap:12px}
  #gp-panel .card{border:1px solid var(--line);border-radius:12px;padding:12px}
  #gp-panel .kbd{margin-top:8px;border:1px solid var(--line);border-radius:10px;padding:10px;
    font:12px/1.5 ui-monospace,SFMono-Regular,Menlo,monospace;white-space:pre-wrap;background:transparent;color:var(--text)}
  #gp-panel .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  #gp-panel .check{display:grid;grid-template-columns:1fr;gap:8px;margin-top:6px}
  #gp-panel .check .li{display:flex;gap:8px;align-items:flex-start}
  #gp-panel .check .li .i{width:18px;height:18px;border:1px solid var(--line);border-radius:4px;
    display:inline-flex;align-items:center;justify-content:center;font-size:12px}
</style>
<!-- GP:END REVIEW STYLES -->

<!-- GP:BEGIN REVIEW SCRIPT -->
<script>
(function(){
  const root = document.getElementById('gp-panel'); if(!root) return;
  const STORE_KEY = 'gpPanel_state_m0';
  const STATE_VERSION = 7;

  // flat —è–∫ —É –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –º–æ–¥—É–ª—ñ–≤
  const sections = [
    { title:'0 ¬∑ –°—Ç–∞—Ä—Ç', items:[{t:'–ü–æ—á–∞—Ç–∏', b:'welcome'},{t:'–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î', b:'guide'}]},
    { title:'1 ¬∑ –ê–Ω–∫–µ—Ç–∞', items:[{t:'–ó–∞–ø–æ–≤–Ω–∏—Ç–∏ 5 –ø–æ–ª—ñ–≤', b:'form'},{t:'–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∞–Ω–∫–µ—Ç—É', b:'confirm'}]},
    { title:'2 ¬∑ –†–µ–∂–∏–º', items:[{t:'AUTO', b:'auto'},{t:'ASSISTED', b:'assisted'}]},
    { title:'3 ¬∑ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä', items:[{t:'–¢–∏–ø / –ú–æ–¥—É–ª—ñ', b:'chips'},{t:'–î–∞–Ω—ñ / –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó', b:'storage/integrations'},{t:'–ë–µ–∫–µ–Ω–¥ (–æ–ø—Ü.) / –†—ñ–≤–µ–Ω—å', b:'backend/level'}]},
    { title:'4 ¬∑ –û–≥–ª—è–¥', items:[{t:'DEV BRIEF (EN)', b:'brief'},{t:'CURSOR PROMPT (EN)', b:'prompt'}]},
    { title:'5 ¬∑ –°–µ—Ä–µ–¥–æ–≤–∏—â–µ', items:[{t:'Local vs Codespaces', b:'env'}]},
    { title:'6 ¬∑ –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ / Files', items:[{t:'–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏/–í—ñ–¥–∫—Ä–∏—Ç–∏', b:'tools'},{t:'–ß–µ–∫-–ª–∏—Å—Ç —Ñ–∞–π–ª—ñ–≤', b:'files'}]},
    { title:'7 ¬∑ –í—Å—Ç–∞–≤–∏—Ç–∏ —É Cursor', items:[{t:'–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø—Ä–æ–º–ø—Ç', b:'copy-cursor'},{t:'–î–µ –≤—Å—Ç–∞–≤–∏—Ç–∏?', b:'cursor-how'}]},
    { title:'8 ¬∑ –ó–∞–ø—É—Å–∫', items:[{t:'–ö–æ–º–∞–Ω–¥–∏ –∑–∞–ø—É—Å–∫—É', b:'run'},{t:'–Ñ –ø—Ä–æ–±–ª–µ–º–∞', b:'troubles'}]},
    { title:'9 ¬∑ BotFather', items:[{t:'/setcommands', b:'bf-commands'}]},
    { title:'10 ¬∑ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞', items:[{t:'/start /help', b:'test'}]},
    { title:'11 ¬∑ –ì–æ—Ç–æ–≤–æ / –ê–ø“ë—Ä–µ–π–¥–∏', items:[{t:'UI-–∫–Ω–æ–ø–∫–∏', b:'upgrade-ui'},{t:'–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', b:'upgrade-stats'},{t:'–û–ø–ª–∞—Ç–∏', b:'upgrade-pay'}]}
  ];
  let flat=[]; sections.forEach((s,si)=>s.items.forEach((it,idx)=>flat.push({si,idx,key:it.b,title:it.t,sec:s.title})));

  let state = {
    v: STATE_VERSION, mode: root.getAttribute('data-mode')||'auto',
    theme: root.getAttribute('data-theme')||'light',
    lang:'uk', ruLink:'', current:0, done:[], filter:'',
    profile:{ role:'', goal:'', cmds:'/start, /help, /add, /list, /done', lang:'uk', channel:'DM',
      type:'', modules:[], data:'json', integrations:[], backend:'none', level:'L1'
    },
    assistedBrief:''
  };

  function load(){
    try{
      const raw = localStorage.getItem(STORE_KEY); if(!raw) return;
      const prev = JSON.parse(raw)||{};
      state = Object.assign(state, prev);
      state.v = STATE_VERSION;
      // –¥–µ—Ñ–æ–ª—Ç–∏
      state.profile = Object.assign({
        role:'', goal:'', cmds:'/start, /help, /add, /list, /done', lang:'uk', channel:'DM',
        type:'', modules:[], data:'json', integrations:[], backend:'none', level:'L1'
      }, state.profile||{});
      if(!Array.isArray(state.profile.modules)) state.profile.modules=[];
      if(!Array.isArray(state.profile.integrations)) state.profile.integrations=[];
      if(!state.profile.level) state.profile.level='L1';
    }catch(e){}
  }
  function save(){ try{ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }catch(e){} }

  const $ = s => root.querySelector(s);
  function getKey(){ return (flat[state.current]||flat[0]).key; }

  // –≥–µ–Ω–µ—Ä—É—î–º–æ —Ç–µ–∫—Å—Ç
  function makeBrief(p){
    const mods = p.modules.length? p.modules.join(', ') : 'basic';
    const ints = p.integrations.length? p.integrations.join(', ') : 'none';
    return [
      `Type: ${p.type||'Custom'} ¬∑ Level: ${p.level||'L1'} ¬∑ Backend: ${p.backend||'none'}`,
      `Goal: ${p.goal||'-'}`,
      `Commands: ${p.cmds||'/start, /help'}`,
      `Modules: ${mods}`,
      `Data: ${p.data} ¬∑ Integrations: ${ints}`,
      `Tech: Python 3.10+, aiogram v3, python-dotenv`,
      `Structure: requirements.txt, main.py, .env(.example), data/ (if needed)`,
      `Run: pip install -r requirements.txt && python main.py`,
      `UI Language: ${p.lang||'uk'} ¬∑ Channel: ${p.channel||'DM'}`
    ].join('\n');
  }
  function makeCursor(p, brief){
    return [
`[CHAT 2 | PROGRAMMER] CURRENT STEP: Generate skeleton by profile`,
`TERMINAL> none`,
`CODE> none`,
`INSTRUCTION:`,
`Use Python 3.10+, aiogram v3, python-dotenv.`,
`Implement minimal working bot according to this profile:`,
`----- DEV BRIEF -----`,
brief,
`---------------------`,
`Deliverables:`,
`- requirements.txt (aiogram==3.*, python-dotenv, loguru)`,
`- main.py with /start, /help; start polling`,
`- .env.example (TOKEN=your_token_here)`,
`No extra prose. Keep messages in ${p.lang||'uk'}.`
    ].join('\n');
  }
  function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

  function copyText(txt){
    (async()=>{
      try{
        if(navigator.clipboard && window.isSecureContext){ await navigator.clipboard.writeText(txt); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); return; }
      }catch(e){}
      const ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta); ta.select();
      try{ document.execCommand('copy'); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); }catch(e){ alert('–°–∫–æ–ø—ñ—é–π –≤—Ä—É—á–Ω—É.'); }
      finally{ document.body.removeChild(ta); }
    })();
  }
  function toast(msg){
    let t = root.querySelector('#gp-toast-m6');
    if(!t){ t=document.createElement('div'); t.id='gp-toast-m6'; t.className='toast'; t.style.display='none'; root.appendChild(t); }
    t.innerHTML = msg; t.style.display='block'; clearTimeout(window.__gp_to_m6);
    window.__gp_to_m6 = setTimeout(()=> t.style.display='none', 1600);
  }

  function markDoneAndGo(nextKey){
    const idx = state.current;
    if(!state.done.includes(idx)) state.done.push(idx);
    save();
    root.dispatchEvent(new CustomEvent('gp:markDone')); // M2 –æ–Ω–æ–≤–∏—Ç—å —Å–∞–π–¥–±–∞—Ä
    const ni = flat.findIndex(x=>x.key===nextKey);
    if(ni>=0){ state.current = ni; save(); renderReview(true); }
  }

  function renderReview(force){
    load();
    const key = getKey();
    if(key!=='brief' && key!=='prompt') return;

    const main = root.querySelector('.main'); if(!main) return;
    const title = $('#gp-title'); const desc = $('#gp-desc');
    title && (title.textContent = '–û–≥–ª—è–¥ —Ç–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è');
    desc && (desc.textContent = '–ü–µ—Ä–µ–≤—ñ—Ä BRIEF —ñ CURSOR PROMPT. –Ø–∫—â–æ –≤—Å–µ –æ–∫ ‚Äî –ø—ñ–¥—Ç–≤–µ—Ä–¥—å —ñ —Ä—É—à–∞–π –¥–∞–ª—ñ.');

    // –¥–∞–Ω—ñ
    const p = state.profile;
    const brief = (state.assistedBrief||'').trim() ? state.assistedBrief.trim() : makeBrief(p);
    const cursor = makeCursor(p, brief);

    // —á–∏—Å—Ç–∏–º–æ –¥–∏–Ω–∞–º—ñ–∫—É
    main.querySelectorAll('.dyn').forEach(n=>n.remove());

    // –∫–æ–Ω—Ç–µ–Ω—Ç
    const wrap = document.createElement('div'); wrap.className='dyn review-wrap';
    wrap.innerHTML = `
      <div class="card">
        <b>DEV BRIEF (EN)</b>
        <div class="kbd" id="m6-brief">${escapeHtml(brief)}</div>
        <div class="row">
          <button class="btn" id="m6-copy-brief">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ BRIEF</button>
        </div>
      </div>

      <div class="card">
        <b>CURSOR PROMPT (EN)</b>
        <div class="kbd" id="m6-prompt">${escapeHtml(cursor)}</div>
        <div class="row">
          <button class="btn primary" id="m6-copy-cursor">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –¥–ª—è Cursor</button>
        </div>
      </div>

      <div class="card">
        <b>–©–æ –±—É–¥–µ –∑—Ä–æ–±–ª–µ–Ω–æ</b>
        <div class="check">
          ${[
            '–°—Ç–≤–æ—Ä–∏–º–æ requirements.txt –∑ –ø–æ—Ç—Ä—ñ–±–Ω–∏–º–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞–º–∏',
            '–ó–≥–µ–Ω–µ—Ä—É—î–º–æ main.py –∑ –∫–æ–º–∞–Ω–¥–∞–º–∏ /start —ñ /help',
            '–ü–æ–∫–ª–∞–¥–µ–º–æ .env.example (TOKEN=your_token_here)',
            '–ü–æ—è—Å–Ω–∏–º–æ –¥–µ –≤—Å—Ç–∞–≤–∏—Ç–∏ –ø—Ä–æ–º–ø—Ç —É Cursor —ñ —è–∫ –∑–∞–ø—É—Å—Ç–∏—Ç–∏',
            '–ü—ñ–¥–≥–æ—Ç—É—î–º–æ /setcommands –¥–ª—è BotFather'
          ].map((t,i)=>(
            `<div class="li">
              <span class="i">${i+1}</span>
              <div>${t}</div>
            </div>`
          )).join('')}
        </div>
        <div class="row">
          <button class="btn" id="m6-back">–ù–∞–∑–∞–¥ –¥–æ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞</button>
          <button class="btn primary" id="m6-approve">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ —ñ –¥–∞–ª—ñ ‚Üí –°–µ—Ä–µ–¥–æ–≤–∏—â–µ</button>
        </div>
      </div>
    `;
    main.appendChild(wrap);

    // –¥—ñ—ó
    $('#m6-copy-brief')?.addEventListener('click', ()=> copyText(brief));
    $('#m6-copy-cursor')?.addEventListener('click', ()=> copyText(cursor));
    $('#m6-back')?.addEventListener('click', ()=>{
      const ni = flat.findIndex(x=>x.key==='chips');
      if(ni>=0){ state.current=ni; save(); renderReview(true); }
    });
    $('#m6-approve')?.addEventListener('click', ()=>{
      // –ø–æ–∑–Ω–∞—á–∞—î–º–æ –æ–±–∏–¥–≤–∞ –ø—É–Ω–∫—Ç–∏ —Å–µ–∫—Ü—ñ—ó "–û–≥–ª—è–¥" –≤–∏–∫–æ–Ω–∞–Ω–∏–º–∏ (brief+prompt)
      const iBrief = flat.findIndex(x=>x.key==='brief');
      const iPrompt = flat.findIndex(x=>x.key==='prompt');
      [iBrief,iPrompt].forEach(i=>{ if(i>=0 && !state.done.includes(i)) state.done.push(i); });
      save(); root.dispatchEvent(new CustomEvent('gp:markDone'));
      markDoneAndGo('env'); // –Ω–∞ Local vs Codespaces
    });

    // –æ–Ω–æ–≤–∏—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å —É —à–∞–ø—Ü—ñ
    const progressEl = $('#gp-progress');
    if(progressEl){
      const pct = Math.round((state.done.length/flat.length)*100)||0;
      progressEl.textContent = `${pct}% –≤–∏–∫–æ–Ω–∞–Ω–æ ¬∑ –º–æ–≤–∞: ${(state.lang||'uk').toUpperCase()}`;
    }
  }

  function init(){
    load();
    renderReview(true);
    // —Ä–µ–∞–≥—É—î–º–æ –Ω–∞ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è current —ñ–∑ —Å–∞–π–¥–±–∞—Ä—É
    setInterval(()=> renderReview(false), 400);
  }
  init();
})();
</script>
<!-- GP:END REVIEW SCRIPT -->
<!-- GP:M6 END -->
<!-- GP:M7 START ‚Ä¢ ENV: Local vs Codespaces (build 2025-10-29.8) -->
<!-- GP:BEGIN ENV STYLES -->
<style>
  #gp-panel .env-wrap{display:grid;grid-template-columns:1fr;gap:12px}
  #gp-panel .card{border:1px solid var(--line);border-radius:12px;padding:12px}
  #gp-panel .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  #gp-panel .kbd{margin-top:8px;border:1px solid var(--line);border-radius:10px;padding:10px;
    font:12px/1.5 ui-monospace,SFMono-Regular,Menlo,monospace;white-space:pre-wrap;background:transparent;color:var(--text)}
  #gp-panel .hint-ok{font-size:12px;color:var(--muted)}
  #gp-panel .env-badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);
    border-radius:999px;padding:4px 10px}
</style>
<!-- GP:END ENV STYLES -->

<!-- GP:BEGIN ENV SCRIPT -->
<script>
(function(){
  const root = document.getElementById('gp-panel'); if(!root) return;
  const STORE_KEY = 'gpPanel_state_m0';
  const STATE_VERSION = 8;

  // flat –ø–æ—Ä—è–¥–æ–∫ (—Ç–æ–π —Å–∞–º–∏–π)
  const sections = [
    { title:'0 ¬∑ –°—Ç–∞—Ä—Ç', items:[{t:'–ü–æ—á–∞—Ç–∏', b:'welcome'},{t:'–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î', b:'guide'}]},
    { title:'1 ¬∑ –ê–Ω–∫–µ—Ç–∞', items:[{t:'–ó–∞–ø–æ–≤–Ω–∏—Ç–∏ 5 –ø–æ–ª—ñ–≤', b:'form'},{t:'–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∞–Ω–∫–µ—Ç—É', b:'confirm'}]},
    { title:'2 ¬∑ –†–µ–∂–∏–º', items:[{t:'AUTO', b:'auto'},{t:'ASSISTED', b:'assisted'}]},
    { title:'3 ¬∑ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä', items:[{t:'–¢–∏–ø / –ú–æ–¥—É–ª—ñ', b:'chips'},{t:'–î–∞–Ω—ñ / –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó', b:'storage/integrations'},{t:'–ë–µ–∫–µ–Ω–¥ (–æ–ø—Ü.) / –†—ñ–≤–µ–Ω—å', b:'backend/level'}]},
    { title:'4 ¬∑ –û–≥–ª—è–¥', items:[{t:'DEV BRIEF (EN)', b:'brief'},{t:'CURSOR PROMPT (EN)', b:'prompt'}]},
    { title:'5 ¬∑ –°–µ—Ä–µ–¥–æ–≤–∏—â–µ', items:[{t:'Local vs Codespaces', b:'env'}]},
    { title:'6 ¬∑ –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ / Files', items:[{t:'–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏/–í—ñ–¥–∫—Ä–∏—Ç–∏', b:'tools'},{t:'–ß–µ–∫-–ª–∏—Å—Ç —Ñ–∞–π–ª—ñ–≤', b:'files'}]},
    { title:'7 ¬∑ –í—Å—Ç–∞–≤–∏—Ç–∏ —É Cursor', items:[{t:'–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø—Ä–æ–º–ø—Ç', b:'copy-cursor'},{t:'–î–µ –≤—Å—Ç–∞–≤–∏—Ç–∏?', b:'cursor-how'}]},
    { title:'8 ¬∑ –ó–∞–ø—É—Å–∫', items:[{t:'–ö–æ–º–∞–Ω–¥–∏ –∑–∞–ø—É—Å–∫—É', b:'run'},{t:'–Ñ –ø—Ä–æ–±–ª–µ–º–∞', b:'troubles'}]},
    { title:'9 ¬∑ BotFather', items:[{t:'/setcommands', b:'bf-commands'}]},
    { title:'10 ¬∑ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞', items:[{t:'/start /help', b:'test'}]},
    { title:'11 ¬∑ –ì–æ—Ç–æ–≤–æ / –ê–ø“ë—Ä–µ–π–¥–∏', items:[{t:'UI-–∫–Ω–æ–ø–∫–∏', b:'upgrade-ui'},{t:'–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', b:'upgrade-stats'},{t:'–û–ø–ª–∞—Ç–∏', b:'upgrade-pay'}]}
  ];
  const flat=[]; sections.forEach((s,si)=>s.items.forEach((it,idx)=>flat.push({si,idx,key:it.b,title:it.t,sec:s.title})));

  let state = {
    v: STATE_VERSION,
    mode: root.getAttribute('data-mode')||'auto',   // auto/light/dark theme mode
    theme: root.getAttribute('data-theme')||'light',
    lang:'uk', ruLink:'', current:0, done:[], filter:'',
    env: root.getAttribute('data-env')||'local',    // <-- –≤–∞–∂–ª–∏–≤–æ
    profile:{ role:'', goal:'', cmds:'/start, /help, /add, /list, /done', lang:'uk', channel:'DM',
      type:'', modules:[], data:'json', integrations:[], backend:'none', level:'L1'
    },
    assistedBrief:''
  };

  function load(){
    try{
      const raw = localStorage.getItem(STORE_KEY); if(!raw) return;
      const prev = JSON.parse(raw)||{};
      state = Object.assign(state, prev);
      state.v = STATE_VERSION;
      if(!state.env) state.env = 'local';
      // –¥–µ—Ñ–æ–ª—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—é
      state.profile = Object.assign({
        role:'', goal:'', cmds:'/start, /help, /add, /list, /done', lang:'uk', channel:'DM',
        type:'', modules:[], data:'json', integrations:[], backend:'none', level:'L1'
      }, state.profile||{});
      if(!Array.isArray(state.profile.modules)) state.profile.modules=[];
      if(!Array.isArray(state.profile.integrations)) state.profile.integrations=[];
    }catch(e){}
  }
  function save(){ try{ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }catch(e){} }

  const $ = s => root.querySelector(s);
  function getKey(){ return (flat[state.current]||flat[0]).key; }
  function setEnv(env){
    state.env = env;
    root.setAttribute('data-env', env);
    save();
    renderEnv(true);
  }

  // –∫–æ—Ä–æ—Ç–∫—ñ –ø–æ—Ä–∞–¥–∏ ‚Äú—â–æ –æ–±—Ä–∞—Ç–∏?‚Äù
  function envAdvice(){
    return [
      '‚Ä¢ –Ø–∫—â–æ –Ω–µ —Ö–æ—á–µ—à —Å—Ç–∞–≤–∏—Ç–∏ –Ω—ñ—á–æ–≥–æ ‚Äî –æ–±–∏—Ä–∞–π Codespaces (–≤—Å–µ —É –±—Ä–∞—É–∑–µ—Ä—ñ).',
      '‚Ä¢ –Ø–∫—â–æ –º–∞—î—à Mac/Windows —ñ —Ö–æ—á–µ—à –æ—Ñ–ª–∞–π–Ω ‚Äî –æ–±–∏—Ä–∞–π Local.',
      '‚Ä¢ –ù–∞ —Å–ª–∞–±–∫–æ–º—É –Ω–æ—É—Ç—ñ ‚Äî Codespaces –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ñ—à–µ.',
      '‚Ä¢ –û–±–∏–¥–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –ø—Ä–∞—Ü—é—é—Ç—å –æ–¥–Ω–∞–∫–æ–≤–æ –¥–ª—è –Ω–∞—à–æ—ó —Å–∏—Å—Ç–µ–º–∏.'
    ].join('\n');
  }

  function localChecklist(){
    return [
`1) –í—Å—Ç–∞–Ω–æ–≤–∏ Python 3.10+ (—è–∫—â–æ –≤–∂–µ —î ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏).`,
`2) –í—Å—Ç–∞–Ω–æ–≤–∏ Cursor (–∞–±–æ VS Code).`,
`3) –°—Ç–≤–æ—Ä–∏ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç—É —ñ –≤—ñ–¥–∫—Ä–∏–π —ó—ó —É Cursor.`,
`4) –î–∞–ª—ñ –º–∏ —Å–∫–∏–Ω–µ–º–æ —Ñ–∞–π–ª–∏ (requirements.txt, main.py, .env.example).`,
`5) –ó–∞–ø—É—Å–∫: pip install -r requirements.txt  ‚Üí  python main.py`
    ].join('\n');
  }
  function codesChecklist(){
    return [
`1) –ù–∞—Ç–∏—Å–Ω–∏ ‚ÄúOpen in Codespaces‚Äù (GitHub –∞–∫–∞—É–Ω—Ç –ø–æ—Ç—Ä—ñ–±–µ–Ω).`,
`2) –°—Ç–≤–æ—Ä–∏—Ç—å—Å—è —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ –∑ Python —É –±—Ä–∞—É–∑–µ—Ä—ñ.`,
`3) –í—ñ–¥–∫—Ä–∏–π –≤–±—É–¥–æ–≤–∞–Ω–∏–π Terminal (—Ç–∞–º –∂–µ).`,
`4) –î–∞–ª—ñ –º–∏ —Å–∫–∏–Ω–µ–º–æ —Ñ–∞–π–ª–∏ (requirements.txt, main.py, .env.example).`,
`5) –ó–∞–ø—É—Å–∫: pip install -r requirements.txt  ‚Üí  python main.py`
    ].join('\n');
  }

  function markDoneAndGo(nextKey){
    const idx = state.current;
    if(!state.done.includes(idx)) state.done.push(idx);
    save();
    root.dispatchEvent(new CustomEvent('gp:markDone')); // –æ–Ω–æ–≤–∏—Ç—å —Å–∞–π–¥–±–∞—Ä/–ø—Ä–æ–≥—Ä–µ—Å
    const ni = flat.findIndex(x=>x.key===nextKey);
    if(ni>=0){ state.current = ni; save(); renderEnv(true); }
  }

  function renderEnv(force){
    load();
    const key = getKey();
    if(key!=='env') return;

    const main = root.querySelector('.main'); if(!main) return;
    const title = $('#gp-title'); const desc = $('#gp-desc');
    title && (title.textContent = '–°–µ—Ä–µ–¥–æ–≤–∏—â–µ: Local —á–∏ Codespaces');
    desc && (desc.textContent = '–û–±–µ—Ä–∏ –≤–∞—Ä—ñ–∞–Ω—Ç. –ù–∏–∂—á–µ ‚Äî –ø—Ä–æ—Å—Ç–∏–π —á–µ–∫–ª—ñ—Å—Ç —ñ —à–≤–∏–¥–∫—ñ –∫–Ω–æ–ø–∫–∏.');

    // —á–∏—Å—Ç–∏–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ –±–ª–æ–∫–∏
    main.querySelectorAll('.dyn').forEach(n=>n.remove());

    const wrap = document.createElement('div'); wrap.className='dyn env-wrap';
    wrap.innerHTML = `
      <div class="card">
        <div class="row">
          <span class="env-badge">–ü–æ—Ç–æ—á–Ω–µ: <b id="env-badge">${(state.env||'local').toUpperCase()}</b></span>
          <button class="btn" id="env-choose-local">–û–±—Ä–∞—Ç–∏ Local</button>
          <button class="btn" id="env-choose-codes">–û–±—Ä–∞—Ç–∏ Codespaces</button>
        </div>
        <div class="kbd hint-ok" style="margin-top:8px">${envAdvice()}</div>
      </div>

      <div class="card">
        <b>Local (–æ—Ñ–ª–∞–π–Ω –Ω–∞ —Ç–≤–æ—î–º—É –ü–ö)</b>
        <div class="kbd" id="env-local-steps">${localChecklist()}</div>
        <div class="row">
          <button class="btn" id="open-python">Python.org</button>
          <button class="btn" id="open-cursor">–í—ñ–¥–∫—Ä–∏—Ç–∏ Cursor</button>
          <button class="btn" id="open-folder">–Ø–∫ –≤—ñ–¥–∫—Ä–∏—Ç–∏ –ø–∞–ø–∫—É —É Cursor?</button>
        </div>
      </div>

      <div class="card">
        <b>Codespaces (—É –±—Ä–∞—É–∑–µ—Ä—ñ)</b>
        <div class="kbd" id="env-codes-steps">${codesChecklist()}</div>
        <div class="row">
          <button class="btn" id="open-codes">–í—ñ–¥–∫—Ä–∏—Ç–∏ GitHub Codespaces</button>
          <button class="btn" id="open-gh">–í—ñ–¥–∫—Ä–∏—Ç–∏ GitHub</button>
        </div>
      </div>

      <div class="card">
        <b>–î–∞–ª—ñ</b>
        <div class="hint">–ö–æ–ª–∏ –æ–±–µ—Ä–µ—à —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ ‚Äî —Ç–∏—Å–Ω–∏ ‚Äú–ü–æ–∑–Ω–∞—á–∏—Ç–∏ —è–∫ –≤–∏–∫–æ–Ω–∞–Ω–æ‚Äù —ñ –ø–µ—Ä–µ–π–¥–µ–º–æ –¥–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤/—Ñ–∞–π–ª—ñ–≤.</div>
        <div class="row">
          <button class="btn primary" id="env-done">–ü–æ–∑–Ω–∞—á–∏—Ç–∏ —è–∫ –≤–∏–∫–æ–Ω–∞–Ω–æ ‚Üí –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏/Files</button>
        </div>
      </div>
    `;
    main.appendChild(wrap);

    // bind env switch
    $('#env-choose-local')?.addEventListener('click', ()=> setEnv('local'));
    $('#env-choose-codes')?.addEventListener('click', ()=> setEnv('codespaces'));

    // quick links (–≤—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ —É –Ω–æ–≤—ñ–π –≤–∫–ª–∞–¥—Ü—ñ)
    $('#open-python')?.addEventListener('click', ()=> window.open('https://www.python.org/downloads/','_blank','noopener'));
    $('#open-cursor')?.addEventListener('click', ()=> window.open('https://www.cursor.com/','_blank','noopener'));
    $('#open-folder')?.addEventListener('click', ()=> alert('Cursor ‚Üí File ‚Üí Open‚Ä¶ ‚Üí –æ–±–µ—Ä–∏ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç—É. –î–∞–ª—ñ –ø—Ä–∞—Ü—é—î–º–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ü—ñ—î—ó –ø–∞–ø–∫–∏.'));
    $('#open-codes')?.addEventListener('click', ()=> window.open('https://github.com/codespaces','_blank','noopener'));
    $('#open-gh')?.addEventListener('click', ()=> window.open('https://github.com/','_blank','noopener'));

    // done ‚Üí go next
    $('#env-done')?.addEventListener('click', ()=>{
      // –≤—ñ–¥–º—ñ—Ç–∏—Ç–∏ ‚Äúenv‚Äù —è–∫ done —ñ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ ‚Äútools‚Äù
      markDoneAndGo('tools');
    });

    // –æ–Ω–æ–≤–∏—Ç–∏ –±–µ–π–¥–∂
    const badge = $('#env-badge'); if(badge) badge.textContent = (state.env||'local').toUpperCase();

    // –ª–µ–≥–∫–∏–π –∞–ø–¥–µ–π—Ç –ø—Ä–æ–≥—Ä–µ—Å—É —É —à–∞–ø—Ü—ñ
    const progressEl = $('#gp-progress');
    if(progressEl){
      const pct = Math.round((state.done.length/flat.length)*100)||0;
      progressEl.textContent = `${pct}% –≤–∏–∫–æ–Ω–∞–Ω–æ ¬∑ –º–æ–≤–∞: ${(state.lang||'uk').toUpperCase()}`;
    }
  }

  function init(){
    load();
    renderEnv(true);
    // —Ä–µ–∞–≥—É—î–º–æ –Ω–∞ –∫–ª—ñ–∫–∏ –∑ —Å–∞–π–¥–±–∞—Ä—É
    setInterval(()=> renderEnv(false), 400);
  }
  init();
})();
</script>
<!-- GP:END ENV SCRIPT -->
<!-- GP:M7 END -->
<!-- GP:M8 START ‚Ä¢ TOOLS & FILES (build 2025-10-29.9) -->
<!-- GP:BEGIN TOOLS/FILES STYLES -->
<style>
  #gp-panel .tools-wrap{display:grid;grid-template-columns:1fr;gap:12px}
  #gp-panel .card{border:1px solid var(--line);border-radius:12px;padding:12px}
  #gp-panel .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  #gp-panel .kbd{margin-top:8px;border:1px solid var(--line);border-radius:10px;padding:10px;
    font:12px/1.5 ui-monospace,SFMono-Regular,Menlo,monospace;white-space:pre-wrap;background:transparent;color:var(--text)}
  #gp-panel .listy{display:grid;grid-template-columns:1fr;gap:6px;margin-top:6px}
  #gp-panel .li{display:flex;gap:8px;align-items:flex-start}
  #gp-panel .li .i{width:18px;height:18px;border:1px solid var(--line);border-radius:4px;
    display:inline-flex;align-items:center;justify-content:center;font-size:12px}
</style>
<!-- GP:END TOOLS/FILES STYLES -->

<!-- GP:BEGIN TOOLS/FILES SCRIPT -->
<script>
(function(){
  const root = document.getElementById('gp-panel'); if(!root) return;
  const STORE_KEY = 'gpPanel_state_m0';
  const STATE_VERSION = 9;

  // flat —è–∫ —É –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –º–æ–¥—É–ª—ñ–≤
  const sections = [
    { title:'0 ¬∑ –°—Ç–∞—Ä—Ç', items:[{t:'–ü–æ—á–∞—Ç–∏', b:'welcome'},{t:'–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î', b:'guide'}]},
    { title:'1 ¬∑ –ê–Ω–∫–µ—Ç–∞', items:[{t:'–ó–∞–ø–æ–≤–Ω–∏—Ç–∏ 5 –ø–æ–ª—ñ–≤', b:'form'},{t:'–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∞–Ω–∫–µ—Ç—É', b:'confirm'}]},
    { title:'2 ¬∑ –†–µ–∂–∏–º', items:[{t:'AUTO', b:'auto'},{t:'ASSISTED', b:'assisted'}]},
    { title:'3 ¬∑ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä', items:[{t:'–¢–∏–ø / –ú–æ–¥—É–ª—ñ', b:'chips'},{t:'–î–∞–Ω—ñ / –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó', b:'storage/integrations'},{t:'–ë–µ–∫–µ–Ω–¥ (–æ–ø—Ü.) / –†—ñ–≤–µ–Ω—å', b:'backend/level'}]},
    { title:'4 ¬∑ –û–≥–ª—è–¥', items:[{t:'DEV BRIEF (EN)', b:'brief'},{t:'CURSOR PROMPT (EN)', b:'prompt'}]},
    { title:'5 ¬∑ –°–µ—Ä–µ–¥–æ–≤–∏—â–µ', items:[{t:'Local vs Codespaces', b:'env'}]},
    { title:'6 ¬∑ –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ / Files', items:[{t:'–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏/–í—ñ–¥–∫—Ä–∏—Ç–∏', b:'tools'},{t:'–ß–µ–∫-–ª–∏—Å—Ç —Ñ–∞–π–ª—ñ–≤', b:'files'}]},
    { title:'7 ¬∑ –í—Å—Ç–∞–≤–∏—Ç–∏ —É Cursor', items:[{t:'–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø—Ä–æ–º–ø—Ç', b:'copy-cursor'},{t:'–î–µ –≤—Å—Ç–∞–≤–∏—Ç–∏?', b:'cursor-how'}]},
    { title:'8 ¬∑ –ó–∞–ø—É—Å–∫', items:[{t:'–ö–æ–º–∞–Ω–¥–∏ –∑–∞–ø—É—Å–∫—É', b:'run'},{t:'–Ñ –ø—Ä–æ–±–ª–µ–º–∞', b:'troubles'}]},
    { title:'9 ¬∑ BotFather', items:[{t:'/setcommands', b:'bf-commands'}]},
    { title:'10 ¬∑ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞', items:[{t:'/start /help', b:'test'}]},
    { title:'11 ¬∑ –ì–æ—Ç–æ–≤–æ / –ê–ø“ë—Ä–µ–π–¥–∏', items:[{t:'UI-–∫–Ω–æ–ø–∫–∏', b:'upgrade-ui'},{t:'–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', b:'upgrade-stats'},{t:'–û–ø–ª–∞—Ç–∏', b:'upgrade-pay'}]}
  ];
  const flat=[]; sections.forEach((s,si)=>s.items.forEach((it,idx)=>flat.push({si,idx,key:it.b,title:it.t,sec:s.title})));

  let state = {
    v: STATE_VERSION,
    mode: root.getAttribute('data-mode')||'auto',
    theme: root.getAttribute('data-theme')||'light',
    lang:'uk', ruLink:'', current:0, done:[], filter:'',
    env: root.getAttribute('data-env')||'local',
    profile:{ role:'', goal:'', cmds:'/start, /help, /add, /list, /done', lang:'uk', channel:'DM',
      type:'', modules:[], data:'json', integrations:[], backend:'none', level:'L1'
    },
    assistedBrief:''
  };

  function load(){ try{
    const raw=localStorage.getItem(STORE_KEY); if(!raw) return;
    const prev=JSON.parse(raw)||{}; state=Object.assign(state, prev); state.v=STATE_VERSION;
    if(!state.env) state.env='local';
    state.profile = Object.assign({
      role:'', goal:'', cmds:'/start, /help, /add, /list, /done', lang:'uk', channel:'DM',
      type:'', modules:[], data:'json', integrations:[], backend:'none', level:'L1'
    }, state.profile||{});
    if(!Array.isArray(state.profile.modules)) state.profile.modules=[];
    if(!Array.isArray(state.profile.integrations)) state.profile.integrations=[];
  }catch(e){} }
  function save(){ try{ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }catch(e){} }

  const $ = s => root.querySelector(s);
  function getKey(){ return (flat[state.current]||flat[0]).key; }

  // –ó BRIEF/PROMPT –±–µ—Ä–µ–º–æ –∑ –ø—Ä–æ—Ñ—ñ–ª—é/–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
  function makeBrief(p){
    const mods = p.modules.length? p.modules.join(', ') : 'basic';
    const ints = p.integrations.length? p.integrations.join(', ') : 'none';
    return [
      `Type: ${p.type||'Custom'} ¬∑ Level: ${p.level||'L1'} ¬∑ Backend: ${p.backend||'none'}`,
      `Goal: ${p.goal||'-'}`,
      `Commands: ${p.cmds||'/start, /help'}`,
      `Modules: ${mods}`,
      `Data: ${p.data} ¬∑ Integrations: ${ints}`,
      `Tech: Python 3.10+, aiogram v3, python-dotenv`,
      `Structure: requirements.txt, main.py, .env(.example), data/ (if needed)`,
      `Run: pip install -r requirements.txt && python main.py`,
      `UI Language: ${p.lang||'uk'} ¬∑ Channel: ${p.channel||'DM'}`
    ].join('\n');
  }
  function makeCursorPrompt(p, brief){
    return [
`[CHAT 2 | PROGRAMMER] CURRENT STEP: Generate skeleton by profile`,
`TERMINAL> none`,
`CODE> none`,
`INSTRUCTION:`,
`Use Python 3.10+, aiogram v3, python-dotenv.`,
`Implement minimal working bot according to this profile:`,
`----- DEV BRIEF -----`,
brief,
`---------------------`,
`Deliverables:`,
`- requirements.txt (aiogram==3.*, python-dotenv, loguru)`,
`- main.py with /start, /help; start polling`,
`- .env.example (TOKEN=your_token_here)`,
`No extra prose. Keep messages in ${p.lang||'uk'}.`
    ].join('\n');
  }
  function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

  async function copyText(txt){
    try{
      if(navigator.clipboard && window.isSecureContext){ await navigator.clipboard.writeText(txt); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); return; }
    }catch(e){}
    const ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta); ta.select();
    try{ document.execCommand('copy'); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); }catch(e){ alert('–°–∫–æ–ø—ñ—é–π –≤—Ä—É—á–Ω—É.'); }
    finally{ document.body.removeChild(ta); }
  }
  function toast(msg){
    let t = root.querySelector('#gp-toast-m8');
    if(!t){ t=document.createElement('div'); t.id='gp-toast-m8'; t.className='toast'; t.style.display='none'; root.appendChild(t); }
    t.innerHTML = msg; t.style.display='block'; clearTimeout(window.__gp_to_m8);
    window.__gp_to_m8 = setTimeout(()=> t.style.display='none', 1600);
  }

  function markDoneAndGo(nextKey){
    const idx = state.current;
    if(!state.done.includes(idx)) state.done.push(idx);
    save(); root.dispatchEvent(new CustomEvent('gp:markDone'));
    const ni = flat.findIndex(x=>x.key===nextKey);
    if(ni>=0){ state.current=ni; save(); renderTools(true); }
  }

  function whereToPasteHelp(){
    return [
'–í Cursor –≤—ñ–¥–∫—Ä–∏–π —á–∞—Ç —É –ø—Ä–∞–≤—ñ–π –ø–∞–Ω–µ–ª—ñ (Cmd/Ctrl+I –∞–±–æ —ñ–∫–æ–Ω–∫–∞ ‚ÄúChat‚Äù).',
'–£ –ø–æ–ª—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—Å—Ç–∞–≤–ª—è–π –Ω–∞—à CURSOR PROMPT (–∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é).',
'–£–í–ê–ì–ê: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —á–∞—Ç, —è–∫–∏–π –ø–æ–≤ º—è–∑–∞–Ω–∏–π —ñ–∑ –ø–æ—Ç–æ—á–Ω–æ—é –ø–∞–ø–∫–æ—é –ø—Ä–æ–µ–∫—Ç—É.',
'–î–∞–ª—ñ Cursor —Å–∞–º –∑–≥–µ–Ω–µ—Ä—É—î/–∑–∞–ø—Ä–æ–ø–æ–Ω—É—î —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª–∏. –ü–æ–≥–æ–¥–∂—É–π—Å—è.',
'–Ø–∫—â–æ —á–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –ø—Ä–æ–∑–∞–æ—é ‚Äî –¥–æ–¥–∞–π —É –∫—ñ–Ω—Ü—ñ PROMPT: ‚ÄúNo prose. Return only code blocks.‚Äù'
    ].join('\n');
  }

  function localTools(){
    return [
'‚Ä¢ Python 3.10+ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ? –Ø–∫—â–æ –Ω—ñ ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂ –∑ python.org.',
'‚Ä¢ Cursor –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ? –Ø–∫—â–æ –Ω—ñ ‚Äî cursor.com ‚Üí Install.',
'‚Ä¢ –í—ñ–¥–∫—Ä–∏–π –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç—É —É Cursor: File ‚Üí Open Folder‚Ä¶',
'‚Ä¢ –í—ñ–¥–∫—Ä–∏–π Chat —É Cursor (Cmd/Ctrl+I).'
    ].join('\n');
  }
  function codesTools(){
    return [
'‚Ä¢ –í—ñ–¥–∫—Ä–∏–π GitHub Codespaces (–ø–æ—Ç—Ä—ñ–±–µ–Ω GitHub –∞–∫–∞—É–Ω—Ç).',
'‚Ä¢ –°—Ç–≤–æ—Ä–∏ Codespace ‚Üí –≤—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è VS Code —É –±—Ä–∞—É–∑–µ—Ä—ñ.',
'‚Ä¢ –í—ñ–¥–∫—Ä–∏–π –≤–±—É–¥–æ–≤–∞–Ω–∏–π Terminal (Ctrl+` –∞–±–æ View ‚Üí Terminal).',
'‚Ä¢ –í—ñ–¥–∫—Ä–∏–π GitHub Copilot Chat/Editor Chat ‚Äî –∞–±–æ –≤—Å—Ç–∞–≤ PROMPT —É Codespaces Chat.',
'‚Ä¢ –Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à Cursor —É –ª–æ–∫–∞–ª—å–Ω–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ ‚Äî –ø—Ä–∞—Ü—é–π —É –ª–æ–∫–∞–ª—å–Ω–æ–º—É –≤–∞—Ä—ñ–∞–Ω—Ç—ñ.'
    ].join('\n');
  }

  function renderTools(force){
    load();
    const key = getKey();
    if(key!=='tools' && key!=='files') return;

    const main = root.querySelector('.main'); if(!main) return;
    const title = $('#gp-title'); const desc = $('#gp-desc');
    title && (title.textContent = '–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ —Ç–∞ —Ñ–∞–π–ª–∏');
    desc && (desc.textContent = '–í—ñ–¥–∫—Ä–∏–π –ø–æ—Ç—Ä—ñ–±–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏. –ü–æ—Ç—ñ–º ‚Äî –∑–≥–µ–Ω–µ—Ä—É—î–º–æ —Ñ–∞–π–ª–∏ —á–µ—Ä–µ–∑ Cursor.');

    // –ø—Ä–∏–±–∏—Ä–∞—î–º–æ –¥–∏–Ω–∞–º—ñ–∫—É
    main.querySelectorAll('.dyn').forEach(n=>n.remove());

    const brief = (state.assistedBrief||'').trim() ? state.assistedBrief.trim() : makeBrief(state.profile);
    const cursorPrompt = makeCursorPrompt(state.profile, brief);

    const wrap = document.createElement('div'); wrap.className='dyn tools-wrap';
    wrap.innerHTML = `
      <div class="card">
        <b>–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ / –í—ñ–¥–∫—Ä–∏—Ç–∏</b>
        <div class="kbd" id="m8-tools">${state.env==='codespaces' ? codesTools() : localTools()}</div>
        <div class="row">
          <button class="btn" id="m8-open-python">Python.org</button>
          <button class="btn" id="m8-open-cursor">–í—ñ–¥–∫—Ä–∏—Ç–∏ Cursor</button>
          <button class="btn" id="m8-open-codes">GitHub Codespaces</button>
        </div>
      </div>

      <div class="card">
        <b>–ß–µ–∫-–ª–∏—Å—Ç —Ñ–∞–π–ª—ñ–≤ (–º–∞—é—Ç—å –∑ º—è–≤–∏—Ç–∏—Å—å –ø—ñ—Å–ª—è PROMPT)</b>
        <div class="listy">
          <div class="li"><span class="i">1</span><div><code>requirements.txt</code> –∑ <code>aiogram==3.*</code>, <code>python-dotenv</code>, <code>loguru</code></div></div>
          <div class="li"><span class="i">2</span><div><code>main.py</code> –∑—ñ —Å—Ç–∞—Ä—Ç–æ–≤–∏–º —Å–∫–µ–ª–µ—Ç–æ–º (/start, /help, polling)</div></div>
          <div class="li"><span class="i">3</span><div><code>.env.example</code> –∑ <code>TOKEN=your_token_here</code></div></div>
        </div>
        <div class="row">
          <button class="btn primary" id="m8-copy-cursor">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ PROMPT –¥–ª—è Cursor</button>
          <button class="btn" id="m8-where">–î–µ —Å–∞–º–µ –≤—Å—Ç–∞–≤–∏—Ç–∏?</button>
        </div>
        <div class="kbd" id="m8-prompt" style="display:none"></div>
      </div>

      <div class="card">
        <b>–î–∞–ª—ñ</b>
        <div class="hint">–ö–æ–ª–∏ –≥–æ—Ç–æ–≤–∏–π ‚Äî –ø–æ–∑–Ω–∞—á–∞—î–º–æ —Ä–æ–∑–¥—ñ–ª —è–∫ –≤–∏–∫–æ–Ω–∞–Ω–∏–π —ñ –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ ‚Äú–í—Å—Ç–∞–≤–∏—Ç–∏ —É Cursor‚Äù.</div>
        <div class="row">
          <button class="btn primary" id="m8-done">–ü–æ–∑–Ω–∞—á–∏—Ç–∏ —è–∫ –≤–∏–∫–æ–Ω–∞–Ω–æ ‚Üí –í—Å—Ç–∞–≤–∏—Ç–∏ —É Cursor</button>
        </div>
      </div>
    `;
    main.appendChild(wrap);

    // –∫–Ω–æ–ø–∫–∏
    $('#m8-open-python')?.addEventListener('click', ()=> window.open('https://www.python.org/downloads/','_blank','noopener'));
    $('#m8-open-cursor')?.addEventListener('click', ()=> window.open('https://www.cursor.com/','_blank','noopener'));
    $('#m8-open-codes')?.addEventListener('click', ()=> window.open('https://github.com/codespaces','_blank','noopener'));

    $('#m8-copy-cursor')?.addEventListener('click', async()=>{
      const box = $('#m8-prompt'); if(box){ box.textContent = cursorPrompt; box.style.display='block'; }
      await copyText(cursorPrompt);
    });

    $('#m8-where')?.addEventListener('click', ()=>{
      alert(whereToPasteHelp());
    });

    $('#m8-done')?.addEventListener('click', ()=>{
      // –ø–æ–∑–Ω–∞—á–∏—Ç–∏ current (‚Äútools‚Äù –∞–±–æ ‚Äúfiles‚Äù) —è–∫ done —ñ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ ‚Äúcopy-cursor‚Äù
      const idx = state.current;
      if(!state.done.includes(idx)) state.done.push(idx);
      save(); root.dispatchEvent(new CustomEvent('gp:markDone'));
      const ni = flat.findIndex(x=>x.key==='copy-cursor');
      if(ni>=0){ state.current=ni; save(); renderTools(true); }
    });

    // –æ–Ω–æ–≤–∏—Ç–∏ —à–∞–ø–∫—É-–ø—Ä–æ–≥—Ä–µ—Å
    const progressEl = $('#gp-progress');
    if(progressEl){
      const pct = Math.round((state.done.length/flat.length)*100)||0;
      progressEl.textContent = `${pct}% –≤–∏–∫–æ–Ω–∞–Ω–æ ¬∑ –º–æ–≤–∞: ${(state.lang||'uk').toUpperCase()}`;
    }
  }

  function init(){
    load();
    renderTools(true);
    setInterval(()=> renderTools(false), 400);
  }
  init();
})();
</script>
<!-- GP:END TOOLS/FILES SCRIPT -->
<!-- GP:M8 END -->
<!-- GP:M9 START ‚Ä¢ INSERT INTO CURSOR (build 2025-10-29.10) -->
<!-- GP:BEGIN COPY-CURSOR STYLES -->
<style>
  #gp-panel .cursor-wrap{display:grid;grid-template-columns:1fr;gap:12px}
  #gp-panel .card{border:1px solid var(--line);border-radius:12px;padding:12px}
  #gp-panel .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  #gp-panel .kbd{margin-top:8px;border:1px solid var(--line);border-radius:10px;padding:10px;
    font:12px/1.5 ui-monospace,SFMono-Regular,Menlo,monospace;white-space:pre-wrap;background:transparent;color:var(--text)}
  #gp-panel textarea.kbd{min-height:200px}
  #gp-panel .listy{display:grid;grid-template-columns:1fr;gap:6px;margin-top:6px}
  #gp-panel .li{display:flex;gap:8px;align-items:flex-start}
  #gp-panel .li .i{width:18px;height:18px;border:1px solid var(--line);border-radius:4px;display:inline-flex;align-items:center;justify-content:center;font-size:12px}
</style>
<!-- GP:END COPY-CURSOR STYLES -->

<!-- GP:BEGIN COPY-CURSOR SCRIPT -->
<script>
(function(){
  const root = document.getElementById('gp-panel'); if(!root) return;
  const STORE_KEY = 'gpPanel_state_m0';
  const STATE_VERSION = 10;

  // —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π flat —è–∫ —Ä–∞–Ω—ñ—à–µ
  const sections = [
    { title:'0 ¬∑ –°—Ç–∞—Ä—Ç', items:[{t:'–ü–æ—á–∞—Ç–∏', b:'welcome'},{t:'–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î', b:'guide'}]},
    { title:'1 ¬∑ –ê–Ω–∫–µ—Ç–∞', items:[{t:'–ó–∞–ø–æ–≤–Ω–∏—Ç–∏ 5 –ø–æ–ª—ñ–≤', b:'form'},{t:'–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∞–Ω–∫–µ—Ç—É', b:'confirm'}]},
    { title:'2 ¬∑ –†–µ–∂–∏–º', items:[{t:'AUTO', b:'auto'},{t:'ASSISTED', b:'assisted'}]},
    { title:'3 ¬∑ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä', items:[{t:'–¢–∏–ø / –ú–æ–¥—É–ª—ñ', b:'chips'},{t:'–î–∞–Ω—ñ / –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó', b:'storage/integrations'},{t:'–ë–µ–∫–µ–Ω–¥ (–æ–ø—Ü.) / –†—ñ–≤–µ–Ω—å', b:'backend/level'}]},
    { title:'4 ¬∑ –û–≥–ª—è–¥', items:[{t:'DEV BRIEF (EN)', b:'brief'},{t:'CURSOR PROMPT (EN)', b:'prompt'}]},
    { title:'5 ¬∑ –°–µ—Ä–µ–¥–æ–≤–∏—â–µ', items:[{t:'Local vs Codespaces', b:'env'}]},
    { title:'6 ¬∑ –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ / Files', items:[{t:'–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏/–í—ñ–¥–∫—Ä–∏—Ç–∏', b:'tools'},{t:'–ß–µ–∫-–ª–∏—Å—Ç —Ñ–∞–π–ª—ñ–≤', b:'files'}]},
    { title:'7 ¬∑ –í—Å—Ç–∞–≤–∏—Ç–∏ —É Cursor', items:[{t:'–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø—Ä–æ–º–ø—Ç', b:'copy-cursor'},{t:'–î–µ –≤—Å—Ç–∞–≤–∏—Ç–∏?', b:'cursor-how'}]},
    { title:'8 ¬∑ –ó–∞–ø—É—Å–∫', items:[{t:'–ö–æ–º–∞–Ω–¥–∏ –∑–∞–ø—É—Å–∫—É', b:'run'},{t:'–Ñ –ø—Ä–æ–±–ª–µ–º–∞', b:'troubles'}]},
    { title:'9 ¬∑ BotFather', items:[{t:'/setcommands', b:'bf-commands'}]},
    { title:'10 ¬∑ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞', items:[{t:'/start /help', b:'test'}]},
    { title:'11 ¬∑ –ì–æ—Ç–æ–≤–æ / –ê–ø“ë—Ä–µ–π–¥–∏', items:[{t:'UI-–∫–Ω–æ–ø–∫–∏', b:'upgrade-ui'},{t:'–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', b:'upgrade-stats'},{t:'–û–ø–ª–∞—Ç–∏', b:'upgrade-pay'}]}
  ];
  const flat=[]; sections.forEach((s,si)=>s.items.forEach((it,idx)=>flat.push({si,idx,key:it.b,title:it.t,sec:s.title})));

  let state = {
    v: STATE_VERSION,
    mode: root.getAttribute('data-mode')||'auto',
    theme: root.getAttribute('data-theme')||'light',
    lang:'uk', ruLink:'', current:0, done:[], filter:'',
    env: root.getAttribute('data-env')||'local',
    profile:{ role:'', goal:'', cmds:'/start, /help, /add, /list, /done', lang:'uk', channel:'DM',
      type:'', modules:[], data:'json', integrations:[], backend:'none', level:'L1'
    },
    assistedBrief:''
  };

  function load(){ try{
    const raw=localStorage.getItem(STORE_KEY); if(!raw) return;
    const prev=JSON.parse(raw)||{}; state=Object.assign(state, prev); state.v=STATE_VERSION;
    if(!state.env) state.env='local';
    state.profile = Object.assign({
      role:'', goal:'', cmds:'/start, /help, /add, /list, /done', lang:'uk', channel:'DM',
      type:'', modules:[], data:'json', integrations:[], backend:'none', level:'L1'
    }, state.profile||{});
    if(!Array.isArray(state.profile.modules)) state.profile.modules=[];
    if(!Array.isArray(state.profile.integrations)) state.profile.integrations=[];
    if(typeof state.assistedBrief!=='string') state.assistedBrief='';
  }catch(e){} }
  function save(){ try{ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }catch(e){} }

  const $ = s => root.querySelector(s);
  function getKey(){ return (flat[state.current]||flat[0]).key; }

  // –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∏ —Ç–µ–∫—Å—Ç—ñ–≤
  function makeBrief(p){
    const mods = p.modules.length? p.modules.join(', ') : 'basic';
    const ints = p.integrations.length? p.integrations.join(', ') : 'none';
    return [
      `Type: ${p.type||'Custom'} ¬∑ Level: ${p.level||'L1'} ¬∑ Backend: ${p.backend||'none'}`,
      `Goal: ${p.goal||'-'}`,
      `Commands: ${p.cmds||'/start, /help'}`,
      `Modules: ${mods}`,
      `Data: ${p.data} ¬∑ Integrations: ${ints}`,
      `Tech: Python 3.10+, aiogram v3, python-dotenv`,
      `Structure: requirements.txt, main.py, .env(.example), data/ (if needed)`,
      `Run: pip install -r requirements.txt && python main.py`,
      `UI Language: ${p.lang||'uk'} ¬∑ Channel: ${p.channel||'DM'}`
    ].join('\n');
  }
  function makeCursorPrompt(p, brief){
    return [
`[CHAT 2 | PROGRAMMER] CURRENT STEP: Generate skeleton by profile`,
`TERMINAL> none`,
`CODE> none`,
`INSTRUCTION:`,
`Use Python 3.10+, aiogram v3, python-dotenv.`,
`Implement minimal working bot according to this profile:`,
`----- DEV BRIEF -----`,
brief,
`---------------------`,
`Deliverables:`,
`- requirements.txt (aiogram==3.*, python-dotenv, loguru)`,
`- main.py with /start, /help; start polling`,
`- .env.example (TOKEN=your_token_here)`,
`No extra prose. Return only code blocks. Language in messages: ${p.lang||'uk'}.`
    ].join('\n');
  }

  function whereToPaste(){
    return [
'1) –í Cursor –Ω–∞—Ç–∏—Å–Ω–∏ Cmd/Ctrl+I –∞–±–æ —ñ–∫–æ–Ω–∫—É ‚ÄúChat‚Äù —É –ø—Ä–∞–≤—ñ–π –ø–∞–Ω–µ–ª—ñ.',
'2) –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ —á–∞—Ç –ø—Ä–∏–≤ º—è–∑–∞–Ω–∏–π –¥–æ –ø–æ—Ç–æ—á–Ω–æ—ó –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç—É.',
'3) –í—Å—Ç–∞–≤ –Ω–∞—à CURSOR PROMPT (–∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é) —É –ø–æ–ª–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ç–∞ –Ω–∞–¥—ñ—à–ª–∏.',
'4) –Ø–∫—â–æ Cursor –ø–æ—á–∞–≤ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ ‚Äú–≤–æ–¥–æ—é‚Äù ‚Äî –¥–æ–¥–∞–π —É –∫—ñ–Ω–µ—Ü—å: ‚ÄúNo prose. Return only code blocks.‚Äù',
'5) –ü–æ–≥–æ–¥–∂—É–π —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ (requirements.txt, main.py, .env.example).'
    ].join('\n');
  }

  async function copyText(txt){
    try{
      if(navigator.clipboard && window.isSecureContext){ await navigator.clipboard.writeText(txt); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); return; }
    }catch(e){}
    const ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta); ta.select();
    try{ document.execCommand('copy'); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); }catch(e){ alert('–°–∫–æ–ø—ñ—é–π –≤—Ä—É—á–Ω—É.'); }
    finally{ document.body.removeChild(ta); }
  }
  function toast(msg){
    let t = root.querySelector('#gp-toast-m9');
    if(!t){ t=document.createElement('div'); t.id='gp-toast-m9'; t.className='toast'; t.style.display='none'; root.appendChild(t); }
    t.innerHTML = msg; t.style.display='block'; clearTimeout(window.__gp_to_m9);
    window.__gp_to_m9 = setTimeout(()=> t.style.display='none', 1600);
  }

  function markDoneAndGo(nextKey){
    const idx = state.current;
    if(!state.done.includes(idx)) state.done.push(idx);
    save(); root.dispatchEvent(new CustomEvent('gp:markDone'));
    const ni = flat.findIndex(x=>x.key===nextKey);
    if(ni>=0){ state.current=ni; save(); renderCopy(true); }
  }

  function renderCopy(force){
    load();
    const key = getKey();
    if(key!=='copy-cursor' && key!=='cursor-how') return;

    const main = root.querySelector('.main'); if(!main) return;
    const title = $('#gp-title'); const desc = $('#gp-desc');
    title && (title.textContent = '–í—Å—Ç–∞–≤–ª—è—î–º–æ —É Cursor');
    desc && (desc.textContent = '–°–∫–æ–ø—ñ—é–π PROMPT —ñ –≤—Å—Ç–∞–≤ —É —á–∞—Ç Cursor, —â–æ –ø—Ä–∏–≤ º—è–∑–∞–Ω–∏–π –¥–æ –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç—É.');

    // –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ BRIEF+PROMPT
    const profile = state.profile;
    const brief = (state.assistedBrief||'').trim() ? state.assistedBrief.trim() : makeBrief(profile);
    const prompt = makeCursorPrompt(profile, brief);

    // –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è –¥–∏–Ω–∞–º—ñ–∫–∏
    main.querySelectorAll('.dyn').forEach(n=>n.remove());

    // –≤–µ—Ä—Å—Ç–∫–∞
    const wrap = document.createElement('div'); wrap.className='dyn cursor-wrap';
    wrap.innerHTML = `
      <div class="card">
        <b>CURSOR PROMPT (EN)</b>
        <textarea class="kbd" id="m9-prompt-box" readonly>${escapeHtml(prompt)}</textarea>
        <div class="row">
          <button class="btn primary" id="m9-copy-prompt">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ PROMPT</button>
          <button class="btn" id="m9-copy-both">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ BRIEF + PROMPT</button>
          <button class="btn" id="m9-open-chat">–í—ñ–¥–∫—Ä–∏—Ç–∏ —á–∞—Ç —É Cursor</button>
          <button class="btn" id="m9-where">–î–µ —Å–∞–º–µ –≤—Å—Ç–∞–≤–∏—Ç–∏?</button>
        </div>
      </div>

      <div class="card">
        <b>–©–æ –º–∞—î –∑ º—è–≤–∏—Ç–∏—Å—è –ø—ñ—Å–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ PROMPT</b>
        <div class="listy">
          <div class="li"><span class="i">1</span><div><code>requirements.txt</code> –∑ <code>aiogram==3.*</code>, <code>python-dotenv</code>, <code>loguru</code></div></div>
          <div class="li"><span class="i">2</span><div><code>main.py</code> –∑ /start —ñ /help —Ç–∞ —Å—Ç–∞—Ä—Ç–æ–º polling</div></div>
          <div class="li"><span class="i">3</span><div><code>.env.example</code> –∑ <code>TOKEN=your_token_here</code></div></div>
        </div>
        <div class="row">
          <button class="btn" id="m9-done">–ü–æ–∑–Ω–∞—á–∏—Ç–∏ —è–∫ –≤–∏–∫–æ–Ω–∞–Ω–æ ‚Üí –ó–∞–ø—É—Å–∫</button>
        </div>
      </div>
    `;
    main.appendChild(wrap);

    // –¥—ñ—ó
    $('#m9-copy-prompt')?.addEventListener('click', ()=> copyText(prompt));
    $('#m9-copy-both')?.addEventListener('click', ()=> copyText( ['----- DEV BRIEF -----', brief, '---------------------', '', prompt].join('\n') ));
    $('#m9-open-chat')?.addEventListener('click', ()=> window.open('https://www.cursor.com/','_blank','noopener'));
    $('#m9-where')?.addEventListener('click', ()=> alert(whereToPaste()));
    $('#m9-done')?.addEventListener('click', ()=> markDoneAndGo('run'));

    // –ø—Ä–æ–≥—Ä–µ—Å —É —à–∞–ø—Ü—ñ
    const progressEl = $('#gp-progress');
    if(progressEl){
      const pct = Math.round((state.done.length/flat.length)*100)||0;
      progressEl.textContent = `${pct}% –≤–∏–∫–æ–Ω–∞–Ω–æ ¬∑ –º–æ–≤–∞: ${(state.lang||'uk').toUpperCase()}`;
    }
  }

  function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

  function init(){
    load();
    renderCopy(true);
    setInterval(()=> renderCopy(false), 400);
  }
  init();
})();
</script>
<!-- GP:END COPY-CURSOR SCRIPT -->
<!-- GP:M9 END -->
<!-- GP:M10 START ‚Ä¢ RUN (build 2025-10-29.11) -->
<!-- GP:BEGIN RUN STYLES -->
<style>
  #gp-panel .run-wrap{display:grid;grid-template-columns:1fr;gap:12px}
  #gp-panel .card{border:1px solid var(--line);border-radius:12px;padding:12px}
  #gp-panel .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  #gp-panel .kbd{margin-top:8px;border:1px solid var(--line);border-radius:10px;padding:10px;
    font:12px/1.5 ui-monospace,SFMono-Regular,Menlo,monospace;white-space:pre-wrap;background:transparent;color:var(--text)}
  #gp-panel .hint{font-size:12px;color:var(--muted)}
</style>
<!-- GP:END RUN STYLES -->

<!-- GP:BEGIN RUN SCRIPT -->
<script>
(function(){
  const root = document.getElementById('gp-panel'); if(!root) return;
  const STORE_KEY = 'gpPanel_state_m0';
  const STATE_VERSION = 11;

  // flat —è–∫ —Ä–∞–Ω—ñ—à–µ
  const sections = [
    { title:'0 ¬∑ –°—Ç–∞—Ä—Ç', items:[{t:'–ü–æ—á–∞—Ç–∏', b:'welcome'},{t:'–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î', b:'guide'}]},
    { title:'1 ¬∑ –ê–Ω–∫–µ—Ç–∞', items:[{t:'–ó–∞–ø–æ–≤–Ω–∏—Ç–∏ 5 –ø–æ–ª—ñ–≤', b:'form'},{t:'–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∞–Ω–∫–µ—Ç—É', b:'confirm'}]},
    { title:'2 ¬∑ –†–µ–∂–∏–º', items:[{t:'AUTO', b:'auto'},{t:'ASSISTED', b:'assisted'}]},
    { title:'3 ¬∑ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä', items:[{t:'–¢–∏–ø / –ú–æ–¥—É–ª—ñ', b:'chips'},{t:'–î–∞–Ω—ñ / –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó', b:'storage/integrations'},{t:'–ë–µ–∫–µ–Ω–¥ (–æ–ø—Ü.) / –†—ñ–≤–µ–Ω—å', b:'backend/level'}]},
    { title:'4 ¬∑ –û–≥–ª—è–¥', items:[{t:'DEV BRIEF (EN)', b:'brief'},{t:'CURSOR PROMPT (EN)', b:'prompt'}]},
    { title:'5 ¬∑ –°–µ—Ä–µ–¥–æ–≤–∏—â–µ', items:[{t:'Local vs Codespaces', b:'env'}]},
    { title:'6 ¬∑ –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ / Files', items:[{t:'–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏/–í—ñ–¥–∫—Ä–∏—Ç–∏', b:'tools'},{t:'–ß–µ–∫-–ª–∏—Å—Ç —Ñ–∞–π–ª—ñ–≤', b:'files'}]},
    { title:'7 ¬∑ –í—Å—Ç–∞–≤–∏—Ç–∏ —É Cursor', items:[{t:'–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø—Ä–æ–º–ø—Ç', b:'copy-cursor'},{t:'–î–µ –≤—Å—Ç–∞–≤–∏—Ç–∏?', b:'cursor-how'}]},
    { title:'8 ¬∑ –ó–∞–ø—É—Å–∫', items:[{t:'–ö–æ–º–∞–Ω–¥–∏ –∑–∞–ø—É—Å–∫—É', b:'run'},{t:'–Ñ –ø—Ä–æ–±–ª–µ–º–∞', b:'troubles'}]},
    { title:'9 ¬∑ BotFather', items:[{t:'/setcommands', b:'bf-commands'}]},
    { title:'10 ¬∑ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞', items:[{t:'/start /help', b:'test'}]},
    { title:'11 ¬∑ –ì–æ—Ç–æ–≤–æ / –ê–ø“ë—Ä–µ–π–¥–∏', items:[{t:'UI-–∫–Ω–æ–ø–∫–∏', b:'upgrade-ui'},{t:'–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', b:'upgrade-stats'},{t:'–û–ø–ª–∞—Ç–∏', b:'upgrade-pay'}]}
  ];
  const flat=[]; sections.forEach((s,si)=>s.items.forEach((it,idx)=>flat.push({si,idx,key:it.b,title:it.t,sec:s.title})));

  let state = {
    v: STATE_VERSION,
    mode: root.getAttribute('data-mode')||'auto',
    theme: root.getAttribute('data-theme')||'light',
    lang:'uk', ruLink:'', current:0, done:[], filter:'',
    env: root.getAttribute('data-env')||'local',
    profile:{ role:'', goal:'', cmds:'/start, /help, /add, /list, /done', lang:'uk', channel:'DM',
      type:'', modules:[], data:'json', integrations:[], backend:'none', level:'L1'
    },
    assistedBrief:''
  };

  function load(){ try{
    const raw=localStorage.getItem(STORE_KEY); if(!raw) return;
    const prev=JSON.parse(raw)||{}; state=Object.assign(state, prev); state.v=STATE_VERSION;
    if(!state.env) state.env='local';
  }catch(e){} }
  function save(){ try{ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }catch(e){} }

  const $ = s => root.querySelector(s);
  function getKey(){ return (flat[state.current]||flat[0]).key; }

  // –∫–æ–º–∞–Ω–¥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫—É
  function runLocal(){
    return [
      '# —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞ –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ venv',
      'python -m venv .venv',
      (isWin()?'.\\.venv\\Scripts\\activate':'source .venv/bin/activate'),
      '',
      '# –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ',
      'pip install -r requirements.txt',
      '',
      '# —Å—Ç–≤–æ—Ä–∏—Ç–∏ .env –∑ —Ç–æ–∫–µ–Ω–æ–º',
      'copy .env.example .env  # –∞–±–æ –≤—Ä—É—á–Ω—É (Mac/Linux: cp .env.example .env)',
      '  # –≤—ñ–¥–∫—Ä–∏–π .env —ñ –≤—Å—Ç–∞–≤ TOKEN=123456:ABC...',
      '',
      '# –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –±–æ—Ç–∞',
      'python main.py'
    ].join('\n');
  }
  function runCodes(){
    return [
      '# —É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ Codespaces',
      'python --version',
      '',
      '# —Å—Ç–∞–≤–∏–º–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ',
      'pip install -r requirements.txt',
      '',
      '# —Å—Ç–≤–æ—Ä—é—î–º–æ .env',
      'cp .env.example .env',
      '  # –≤—ñ–¥–∫—Ä–∏–π .env —ñ –≤—Å—Ç–∞–≤ TOKEN=123456:ABC...',
      '',
      '# —Å—Ç–∞—Ä—Ç –±–æ—Ç–∞',
      'python main.py'
    ].join('\n');
  }
  function isWin(){ return navigator.platform && /Win/.test(navigator.platform); }

  async function copyText(txt){
    try{
      if(navigator.clipboard && window.isSecureContext){ await navigator.clipboard.writeText(txt); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); return; }
    }catch(e){}
    const ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta); ta.select();
    try{ document.execCommand('copy'); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); }catch(e){ alert('–°–∫–æ–ø—ñ—é–π –≤—Ä—É—á–Ω—É.'); }
    finally{ document.body.removeChild(ta); }
  }
  function toast(msg){
    let t = root.querySelector('#gp-toast-m10');
    if(!t){ t=document.createElement('div'); t.id='gp-toast-m10'; t.className='toast'; t.style.display='none'; root.appendChild(t); }
    t.innerHTML = msg; t.style.display='block'; clearTimeout(window.__gp_to_m10);
    window.__gp_to_m10 = setTimeout(()=> t.style.display='none', 1600);
  }

  function markDoneAndGo(nextKey){
    const idx = state.current;
    if(!state.done.includes(idx)) state.done.push(idx);
    save(); root.dispatchEvent(new CustomEvent('gp:markDone'));
    const ni = flat.findIndex(x=>x.key===nextKey);
    if(ni>=0){ state.current=ni; save(); renderRun(true); }
  }

  function openTroubles(){
    // –≤—ñ–¥–∫—Ä–∏—Ç–∏ –≤–∞—à —É–∂–µ —ñ—Å–Ω—É—é—á–∏–π –º–æ–¥–∞–ª —Ç—Ä–∞–±–ª—à—É—Ç—É
    const m = document.getElementById('gp-troubles-modal');
    const back = document.getElementById('gp-backdrop');
    if(m && back){ m.style.display='flex'; m.setAttribute('aria-hidden','false'); back.style.display='block'; }
    else { alert('–í—ñ–¥–∫—Ä–∏–π —Ä–æ–∑–¥—ñ–ª "–¢—Ä–∞–±–ª—à—É—Ç—ñ–Ω–≥" —É —à–∞–ø—Ü—ñ.'); }
  }

  function renderRun(force){
    load();
    const key = getKey();
    if(key!=='run' && key!=='troubles') return;

    const main = root.querySelector('.main'); if(!main) return;
    const title = $('#gp-title'); const desc = $('#gp-desc');
    title && (title.textContent = '–ó–∞–ø—É—Å–∫–∞—î–º–æ –±–æ—Ç–∞');
    desc && (desc.textContent = '–°–∫–æ–ø—ñ—é–π –∫–æ–º–∞–Ω–¥–∏ —É —Å–≤—ñ–π —Ç–µ—Ä–º—ñ–Ω–∞–ª. –Ø–∫—â–æ —â–æ—Å—å –Ω–µ —Ç–∞–∫ ‚Äî ‚Äú–ù–µ –ø—Ä–∞—Ü—é—î‚Äù ‚Üí –¢—Ä–∞–±–ª—à—É—Ç.');

    // –ø—Ä–∏–±—Ä–∞—Ç–∏ –¥–∏–Ω–∞–º—ñ–∫—É
    main.querySelectorAll('.dyn').forEach(n=>n.remove());

    const cmds = (state.env==='codespaces') ? runCodes() : runLocal();

    const wrap = document.createElement('div'); wrap.className='dyn run-wrap';
    wrap.innerHTML = `
      <div class="card">
        <b>–ö–æ–º–∞–Ω–¥–∏ –¥–ª—è ${state.env==='codespaces'?'Codespaces':'Local'}</b>
        <div class="kbd" id="m10-cmds">${cmds}</div>
        <div class="row">
          <button class="btn primary" id="m10-copy">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –≤—Å—ñ –∫–æ–º–∞–Ω–¥–∏</button>
          <button class="btn" id="m10-troubles">–ù–µ –ø—Ä–∞—Ü—é—î ‚Äî –¢—Ä–∞–±–ª—à—É—Ç</button>
        </div>
        <div class="hint">–ü—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É –Ω–∞–ø–∏—à–∏ —É Telegram –∫–æ–º–∞–Ω–¥—É <code>/start</code> ‚Äî –±–æ—Ç –º–∞—î –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏.</div>
      </div>

      <div class="card">
        <b>–î–∞–ª—ñ</b>
        <div class="hint">–ö–æ–ª–∏ –±–æ—Ç —Å—Ç–∞—Ä—Ç—É—î –±–µ–∑ –ø–æ–º–∏–ª–æ–∫ ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ–¥–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏ —É BotFather.</div>
        <div class="row">
          <button class="btn" id="m10-done">–ü–æ–∑–Ω–∞—á–∏—Ç–∏ —è–∫ –≤–∏–∫–æ–Ω–∞–Ω–æ ‚Üí BotFather</button>
        </div>
      </div>
    `;
    main.appendChild(wrap);

    // bind
    $('#m10-copy')?.addEventListener('click', ()=> copyText(cmds));
    $('#m10-troubles')?.addEventListener('click', openTroubles);
    $('#m10-done')?.addEventListener('click', ()=> markDoneAndGo('bf-commands'));

    // –ø—Ä–æ–≥—Ä–µ—Å
    const progressEl = $('#gp-progress');
    if(progressEl){
      const pct = Math.round((state.done.length/flat.length)*100)||0;
      progressEl.textContent = `${pct}% –≤–∏–∫–æ–Ω–∞–Ω–æ ¬∑ –º–æ–≤–∞: ${(state.lang||'uk').toUpperCase()}`;
    }
  }

  function init(){
    load();
    renderRun(true);
    setInterval(()=> renderRun(false), 400);
  }
  init();
})();
</script>
<!-- GP:END RUN SCRIPT -->
<!-- GP:M10 END -->
<!-- GP:M11 START ‚Ä¢ BOTFATHER & TEST (build 2025-10-29.12) -->
<!-- GP:BEGIN BF/TEST STYLES -->
<style>
  #gp-panel .bf-wrap, #gp-panel .test-wrap{display:grid;grid-template-columns:1fr;gap:12px}
  #gp-panel .card{border:1px solid var(--line);border-radius:12px;padding:12px}
  #gp-panel .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  #gp-panel .kbd{margin-top:8px;border:1px solid var(--line);border-radius:10px;padding:10px;
    font:12px/1.5 ui-monospace,SFMono-Regular,Menlo,monospace;white-space:pre-wrap;background:transparent;color:var(--text)}
  #gp-panel .listy{display:grid;grid-template-columns:1fr;gap:6px;margin-top:6px}
  #gp-panel .li{display:flex;gap:8px;align-items:flex-start}
  #gp-panel .li .i{width:18px;height:18px;border:1px solid var(--line);border-radius:4px;
    display:inline-flex;align-items:center;justify-content:center;font-size:12px}
  #gp-panel .hint{font-size:12px;color:var(--muted)}
</style>
<!-- GP:END BF/TEST STYLES -->

<!-- GP:BEGIN BF/TEST SCRIPT -->
<script>
(function(){
  const root = document.getElementById('gp-panel'); if(!root) return;
  const STORE_KEY = 'gpPanel_state_m0';
  const STATE_VERSION = 12;

  const sections = [
    { title:'0 ¬∑ –°—Ç–∞—Ä—Ç', items:[{t:'–ü–æ—á–∞—Ç–∏', b:'welcome'},{t:'–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î', b:'guide'}]},
    { title:'1 ¬∑ –ê–Ω–∫–µ—Ç–∞', items:[{t:'–ó–∞–ø–æ–≤–Ω–∏—Ç–∏ 5 –ø–æ–ª—ñ–≤', b:'form'},{t:'–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∞–Ω–∫–µ—Ç—É', b:'confirm'}]},
    { title:'2 ¬∑ –†–µ–∂–∏–º', items:[{t:'AUTO', b:'auto'},{t:'ASSISTED', b:'assisted'}]},
    { title:'3 ¬∑ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä', items:[{t:'–¢–∏–ø / –ú–æ–¥—É–ª—ñ', b:'chips'},{t:'–î–∞–Ω—ñ / –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó', b:'storage/integrations'},{t:'–ë–µ–∫–µ–Ω–¥ (–æ–ø—Ü.) / –†—ñ–≤–µ–Ω—å', b:'backend/level'}]},
    { title:'4 ¬∑ –û–≥–ª—è–¥', items:[{t:'DEV BRIEF (EN)', b:'brief'},{t:'CURSOR PROMPT (EN)', b:'prompt'}]},
    { title:'5 ¬∑ –°–µ—Ä–µ–¥–æ–≤–∏—â–µ', items:[{t:'Local vs Codespaces', b:'env'}]},
    { title:'6 ¬∑ –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ / Files', items:[{t:'–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏/–í—ñ–¥–∫—Ä–∏—Ç–∏', b:'tools'},{t:'–ß–µ–∫-–ª–∏—Å—Ç —Ñ–∞–π–ª—ñ–≤', b:'files'}]},
    { title:'7 ¬∑ –í—Å—Ç–∞–≤–∏—Ç–∏ —É Cursor', items:[{t:'–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø—Ä–æ–º–ø—Ç', b:'copy-cursor'},{t:'–î–µ –≤—Å—Ç–∞–≤–∏—Ç–∏?', b:'cursor-how'}]},
    { title:'8 ¬∑ –ó–∞–ø—É—Å–∫', items:[{t:'–ö–æ–º–∞–Ω–¥–∏ –∑–∞–ø—É—Å–∫—É', b:'run'},{t:'–Ñ –ø—Ä–æ–±–ª–µ–º–∞', b:'troubles'}]},
    { title:'9 ¬∑ BotFather', items:[{t:'/setcommands', b:'bf-commands'}]},
    { title:'10 ¬∑ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞', items:[{t:'/start /help', b:'test'}]},
    { title:'11 ¬∑ –ì–æ—Ç–æ–≤–æ / –ê–ø“ë—Ä–µ–π–¥–∏', items:[{t:'UI-–∫–Ω–æ–ø–∫–∏', b:'upgrade-ui'},{t:'–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', b:'upgrade-stats'},{t:'–û–ø–ª–∞—Ç–∏', b:'upgrade-pay'}]}
  ];
  const flat=[]; sections.forEach((s,si)=>s.items.forEach((it,idx)=>flat.push({si,idx,key:it.b,title:it.t,sec:s.title})));

  let state = {
    v: STATE_VERSION,
    mode: root.getAttribute('data-mode')||'auto',
    theme: root.getAttribute('data-theme')||'light',
    lang:'uk', ruLink:'', current:0, done:[], filter:'',
    env: root.getAttribute('data-env')||'local',
    profile:{ role:'', goal:'', cmds:'/start, /help, /add, /list, /done, /skip, /stats, /tips', lang:'uk', channel:'DM',
      type:'', modules:[], data:'json', integrations:[], backend:'none', level:'L1'
    },
    assistedBrief:''
  };

  function load(){ try{
    const raw=localStorage.getItem(STORE_KEY); if(!raw) return;
    const prev=JSON.parse(raw)||{}; state=Object.assign(state, prev); state.v=STATE_VERSION;
    if(!state.env) state.env='local';
    if(!state.profile) state.profile={};
    if(!state.profile.cmds) state.profile.cmds='/start, /help';
  }catch(e){} }
  function save(){ try{ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }catch(e){} }

  const $ = s => root.querySelector(s);
  function getKey(){ return (flat[state.current]||flat[0]).key; }

  // ---- –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è /setcommands
  function parseCmds(raw){
    return (raw||'')
      .split(/[,\n]/).map(s=>s.trim()).filter(Boolean)
      .map(s=> s.startsWith('/')? s : '/'+s);
  }
  function defaultDesc(cmd){
    const map = {
      '/start':'–ó–∞–ø—É—Å–∫ —Ç–∞ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è',
      '/help':'–ü—ñ–¥–∫–∞–∑–∫–∏ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º',
      '/add':'–î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å/—Ç–∞—Å–∫',
      '/list':'–ü–æ–∫–∞–∑–∞—Ç–∏ —Å–ø–∏—Å–æ–∫',
      '/done':'–ü–æ–∑–Ω–∞—á–∏—Ç–∏ —è–∫ –≤–∏–∫–æ–Ω–∞–Ω–æ',
      '/skip':'–ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏/–≤—ñ–¥–∫–ª–∞—Å—Ç–∏',
      '/stats':'–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 7/30 –¥–Ω—ñ–≤',
      '/tips':'–ü–æ—Ä–∞–¥–∏',
      '/panic':'–®–≤–∏–¥–∫–∞ –¥–æ–ø–æ–º–æ–≥–∞'
    };
    return map[cmd] || '–ö–æ–º–∞–Ω–¥–∞';
  }
  function makeSetCommands(cmdsStr){
    const cmds = parseCmds(cmdsStr);
    const lines = cmds.map(c => `${c} - ${defaultDesc(c)}`);
    return lines.join('\n');
  }
  function whereSetCommands(){
    return [
'1) –í—ñ–¥–∫—Ä–∏–π @BotFather',
'2) –ù–∞—Ç–∏—Å–Ω–∏ /setcommands ‚Üí –æ–±–µ—Ä–∏ —Å–≤–æ–≥–æ –±–æ—Ç–∞',
'3) –í—Å—Ç–∞–≤ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ —ñ –Ω–∞–¥—ñ—à–ª–∏',
'4) –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –∫–ª—ñ—î–Ω—Ç Telegram (–∞–±–æ –∑–∞—á–µ–∫–∞–π 1‚Äì2 —Ö–≤), —â–æ–± –∑ º—è–≤–∏–ª–∏—Å—è –ø—ñ–¥–∫–∞–∑–∫–∏'
    ].join('\n');
  }

  // –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è/—Ç–æ—Å—Ç
  async function copyText(txt){
    try{
      if(navigator.clipboard && window.isSecureContext){ await navigator.clipboard.writeText(txt); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); return; }
    }catch(e){}
    const ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta); ta.select();
    try{ document.execCommand('copy'); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); }catch(e){ alert('–°–∫–æ–ø—ñ—é–π –≤—Ä—É—á–Ω—É.'); }
    finally{ document.body.removeChild(ta); }
  }
  function toast(msg){
    let t = root.querySelector('#gp-toast-m11');
    if(!t){ t=document.createElement('div'); t.id='gp-toast-m11'; t.className='toast'; t.style.display='none'; root.appendChild(t); }
    t.innerHTML = msg; t.style.display='block'; clearTimeout(window.__gp_to_m11);
    window.__gp_to_m11 = setTimeout(()=> t.style.display='none', 1600);
  }

  function markDoneAndGo(nextKey){
    const idx = state.current;
    if(!state.done.includes(idx)) state.done.push(idx);
    save(); root.dispatchEvent(new CustomEvent('gp:markDone'));
    const ni = flat.findIndex(x=>x.key===nextKey);
    if(ni>=0){ state.current=ni; save(); renderBF(true); renderTest(true); }
  }

  // ---- RENDER: BotFather
  function renderBF(force){
    load();
    if(getKey()!=='bf-commands') return;

    const main = root.querySelector('.main'); if(!main) return;
    const title = $('#gp-title'); const desc = $('#gp-desc');
    title && (title.textContent = 'BotFather: –¥–æ–¥–∞—î–º–æ –∫–æ–º–∞–Ω–¥–∏');
    desc && (desc.textContent = '–ó–≥–µ–Ω–µ—Ä—É–π /setcommands —ñ –≤—Å—Ç–∞–≤ —É @BotFather. –ü—ñ—Å–ª—è ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ —Ç–µ—Å—Ç—É.');

    // –ø—Ä–∏–±—Ä–∞—Ç–∏ –¥–∏–Ω–∞–º—ñ–∫—É
    main.querySelectorAll('.dyn').forEach(n=>n.remove());

    const setCmds = makeSetCommands(state.profile.cmds||'/start, /help');

    const wrap = document.createElement('div'); wrap.className='dyn bf-wrap';
    wrap.innerHTML = `
      <div class="card">
        <b>/setcommands (${(state.profile.lang||'uk').toUpperCase()})</b>
        <div class="kbd" id="m11-commands">${setCmds}</div>
        <div class="row">
          <button class="btn primary" id="m11-copy">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ /setcommands</button>
          <button class="btn" id="m11-open-bf">–í—ñ–¥–∫—Ä–∏—Ç–∏ BotFather</button>
          <button class="btn" id="m11-how">–î–µ —Ü–µ –≤—Å—Ç–∞–≤–∏—Ç–∏?</button>
        </div>
        <div class="hint">–ü–æ—Ä–∞–¥–∞: –∫–æ—Ä–æ—Ç–∫—ñ –æ–ø–∏—Å–∏ –ø—Ä–∞—Ü—é—é—Ç—å –∫—Ä–∞—â–µ (–¥–æ ~40 —Å–∏–º–≤–æ–ª—ñ–≤).</div>
      </div>

      <div class="card">
        <b>–î–∞–ª—ñ</b>
        <div class="hint">–ö–æ–ª–∏ –≤—Å—Ç–∞–≤–∏—à –∫–æ–º–∞–Ω–¥–∏ –≤ BotFather ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤ Telegram.</div>
        <div class="row">
          <button class="btn" id="m11-done">–ü–æ–∑–Ω–∞—á–∏—Ç–∏ —è–∫ –≤–∏–∫–æ–Ω–∞–Ω–æ ‚Üí –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞</button>
        </div>
      </div>
    `;
    main.appendChild(wrap);

    // –¥—ñ—ó
    $('#m11-copy')?.addEventListener('click', ()=> copyText(setCmds));
    $('#m11-open-bf')?.addEventListener('click', ()=> window.open('https://t.me/BotFather','_blank','noopener'));
    $('#m11-how')?.addEventListener('click', ()=> alert(whereSetCommands()));
    $('#m11-done')?.addEventListener('click', ()=> markDoneAndGo('test'));

    // –ø—Ä–æ–≥—Ä–µ—Å
    const progressEl = $('#gp-progress');
    if(progressEl){
      const pct = Math.round((state.done.length/flat.length)*100)||0;
      progressEl.textContent = `${pct}% –≤–∏–∫–æ–Ω–∞–Ω–æ ¬∑ –º–æ–≤–∞: ${(state.lang||'uk').toUpperCase()}`;
    }
  }

  // ---- RENDER: Test
  function testChecklist(){
    return [
      '–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ /start ‚Üí –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è (–±–µ–∑ –ø–æ–º–∏–ª–æ–∫ —É –∫–æ–Ω—Å–æ–ª—ñ)',
      '–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ /help ‚Üí —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –∫–æ–º–∞–Ω–¥',
      '–ö–æ–º–∞–Ω–¥–∏ /add —ñ /list (—è–∫—â–æ –¥–æ–¥–∞–Ω—ñ) –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å –±–µ–∑ –ø–∞–¥—ñ–Ω—å',
      '–ë–æ—Ç –æ–Ω–ª–∞–π–Ω ‚â• 2 —Ö–≤ (–±–µ–∑ Traceback —É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ)'
    ].map((t,i)=>`<div class="li"><span class="i">${i+1}</span><div>${t}</div></div>`).join('');
  }
  function renderTest(force){
    load();
    if(getKey()!=='test') return;

    const main = root.querySelector('.main'); if(!main) return;
    const title = $('#gp-title'); const desc = $('#gp-desc');
    title && (title.textContent = '–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–æ—Ç–∞');
    desc && (desc.textContent = '–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ /start —ñ /help –ø—Ä–∞—Ü—é—é—Ç—å, –∞ –±–æ—Ç –Ω–µ –ø–∞–¥–∞—î.');

    // –ø–æ—á–∏—Å—Ç–∏—Ç–∏ –¥–∏–Ω–∞–º—ñ–∫—É
    main.querySelectorAll('.dyn').forEach(n=>n.remove());

    const wrap = document.createElement('div'); wrap.className='dyn test-wrap';
    wrap.innerHTML = `
      <div class="card">
        <b>–©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ</b>
        <div class="listy">${testChecklist()}</div>
        <div class="row">
          <button class="btn" id="m11-open-telegram">–í—ñ–¥–∫—Ä–∏—Ç–∏ Telegram Web</button>
          <button class="btn" id="m11-troubles">–ù–µ –ø—Ä–∞—Ü—é—î ‚Äî –¢—Ä–∞–±–ª—à—É—Ç</button>
        </div>
        <div class="hint">–Ø–∫—â–æ —î –ø–æ–º–∏–ª–∫–∞ ‚Äî —Å–∫–æ–ø—ñ—é–π –æ—Å—Ç–∞–Ω–Ω—ñ 50 —Ä—è–¥–∫—ñ–≤ —ñ–∑ —Ç–µ—Ä–º—ñ–Ω–∞–ª—É —Ç–∞ –≤—Å—Ç–∞–≤ —É ‚Äú–ù–∞–≤—ñ–≥–∞—Ç–æ—Ä‚Äù.</div>
      </div>

      <div class="card">
        <b>–§—ñ–Ω—ñ—à</b>
        <div class="hint">–í—Å–µ –ø—Ä–∞—Ü—é—î? –ü–æ–ª–µ—Ç—ñ–ª–∏ –≤ –∞–ø“ë—Ä–µ–π–¥–∏: UI-–∫–Ω–æ–ø–∫–∏, –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –û–ø–ª–∞—Ç–∏.</div>
        <div class="row">
          <button class="btn primary" id="m11-finish">–§—ñ–Ω—ñ—à ‚Üí –ì–æ—Ç–æ–≤–æ / –ê–ø“ë—Ä–µ–π–¥–∏</button>
        </div>
      </div>
    `;
    main.appendChild(wrap);

    // –¥—ñ—ó
    $('#m11-open-telegram')?.addEventListener('click', ()=> window.open('https://web.telegram.org/','_blank','noopener'));
    $('#m11-troubles')?.addEventListener('click', ()=>{
      const m = document.getElementById('gp-troubles-modal');
      const back = document.getElementById('gp-backdrop');
      if(m && back){ m.style.display='flex'; m.setAttribute('aria-hidden','false'); back.style.display='block'; }
      else { alert('–í—ñ–¥–∫—Ä–∏–π ‚Äú–¢—Ä–∞–±–ª—à—É—Ç—ñ–Ω–≥‚Äù —É —à–∞–ø—Ü—ñ.'); }
    });
    $('#m11-finish')?.addEventListener('click', ()=>{
      const iTest = flat.findIndex(x=>x.key==='test');
      if(iTest>=0 && !state.done.includes(iTest)) state.done.push(iTest);
      save(); root.dispatchEvent(new CustomEvent('gp:markDone'));
      const up = flat.findIndex(x=>x.key==='upgrade-ui');
      if(up>=0){ state.current=up; save(); renderBF(true); renderTest(true); }
    });

    // –ø—Ä–æ–≥—Ä–µ—Å
    const progressEl = $('#gp-progress');
    if(progressEl){
      const pct = Math.round((state.done.length/flat.length)*100)||0;
      progressEl.textContent = `${pct}% –≤–∏–∫–æ–Ω–∞–Ω–æ ¬∑ –º–æ–≤–∞: ${(state.lang||'uk').toUpperCase()}`;
    }
  }

  function init(){
    load();
    renderBF(true);
    renderTest(true);
    // –ø–∞—Å–∏–≤–Ω–∏–π —Ä–µ—Å–≤—ñ–∑–∏—Ç –ø—Ä–∏ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó —Å–∞–π–¥–±–∞—Ä–æ–º
    setInterval(()=>{ renderBF(false); renderTest(false); }, 400);
  }
  init();
})();
</script>
<!-- GP:END BF/TEST SCRIPT -->
<!-- GP:M11 END -->
<!-- GP:M12 START ‚Ä¢ UPGRADE: UI BUTTONS (build 2025-10-29.u1) -->
<!-- GP:BEGIN UPGRADE UI STYLES -->
<style>
  #gp-panel .upui-wrap{display:grid;grid-template-columns:1fr;gap:12px}
  #gp-panel .card{border:1px solid var(--line);border-radius:12px;padding:12px}
  #gp-panel .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  #gp-panel .hint{font-size:12px;color:var(--muted)}
  #gp-panel .kbd{margin-top:8px;border:1px solid var(--line);border-radius:10px;padding:10px;
    font:12px/1.5 ui-monospace,SFMono-Regular,Menlo,monospace;white-space:pre-wrap;background:transparent;color:var(--text)}
  #gp-panel .chipset{display:flex;gap:6px;flex-wrap:wrap}
  #gp-panel .chip{border:1px solid var(--line);border-radius:999px;padding:6px 10px;cursor:pointer}
  #gp-panel .chip[aria-pressed="true"]{background:var(--active-bg);border-color:var(--active-border)}
  #gp-panel .preview{display:inline-grid;grid-auto-flow:row;gap:6px;margin-top:8px}
  #gp-panel .badge{display:inline-flex;gap:6px;align-items:center;border:1px dashed var(--line);border-radius:8px;padding:4px 8px}
</style>
<!-- GP:END UPGRADE UI STYLES -->

<!-- GP:BEGIN UPGRADE UI SCRIPT -->
<script>
(function(){
  const root = document.getElementById('gp-panel'); if(!root) return;
  const STORE_KEY = 'gpPanel_state_m0';
  const STATE_VERSION = 1201;

  const sections = [
    { title:'11 ¬∑ –ì–æ—Ç–æ–≤–æ / –ê–ø“ë—Ä–µ–π–¥–∏', items:[{t:'UI-–∫–Ω–æ–ø–∫–∏', b:'upgrade-ui'},{t:'–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', b:'upgrade-stats'},{t:'–û–ø–ª–∞—Ç–∏', b:'upgrade-pay'}]}
  ];
  const flat=[]; sections.forEach((s,si)=>s.items.forEach((it,idx)=>flat.push({si,idx,key:it.b,title:it.t,sec:s.title})));

  let state = {
    v: STATE_VERSION,
    lang:'uk',
    profile:{ role:'', goal:'', cmds:'/start, /help, /add, /list, /done', lang:'uk' },
    ui:{ kind:'reply', layout:'simple', emojis:true, confirmOnDone:true }
  };

  function load(){ try{
    const raw = localStorage.getItem(STORE_KEY); if(!raw) return;
    const prev = JSON.parse(raw)||{};
    // –∑–±–µ—Ä—ñ–≥–∞—î–º–æ —á—É–∂—ñ –ø–æ–ª—è (env, done, current —Ç–æ—â–æ)
    state = Object.assign({}, prev, { v: STATE_VERSION, ui: (prev.ui||state.ui), profile: Object.assign({}, state.profile, (prev.profile||{})) });
  }catch(e){} }
  function save(){ try{
    const prev = JSON.parse(localStorage.getItem(STORE_KEY)||'{}');
    const merged = Object.assign({}, prev, { v: STATE_VERSION, ui: state.ui, profile: state.profile });
    localStorage.setItem(STORE_KEY, JSON.stringify(merged));
  }catch(e){} }

  const $ = s => root.querySelector(s);
  function getKey(){
    const all = (root.__flatAll || []).filter(Boolean);
    const idx = (JSON.parse(localStorage.getItem(STORE_KEY)||'{}').current) ?? 0;
    return (all[idx]&&all[idx].key) || '';
  }

  // ---- –ü—Ä–µ—Å–µ—Ç–∏ –º–∞–∫–µ—Ç—ñ–≤
  const PRESETS = {
    reply: {
      simple: ['‚úÖ Done','‚ûñ Skip','üìä Stats'],
      compact: ['‚úÖ','‚ûñ','üìä'],
      extended: ['‚úÖ Done','‚ûñ Skip','üìä Stats','‚ùì Help']
    },
    inline:{
      simple: ['‚ûï Add','üßæ List','‚úÖ Done','üìä Stats'],
      compact: ['‚ûï','üßæ','‚úÖ','üìä'],
      confirm: ['‚úÖ Done','‚Ü©Ô∏è Undo','‚ÑπÔ∏è Help']
    }
  };

  // ---- –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è PROMPT –¥–ª—è Cursor
  function makePrompt(ui){
    const kb = (ui.kind==='reply') ? 'Reply Keyboard' : 'Inline Keyboard';
    const buttons = PRESETS[ui.kind][ui.layout] || [];
    const btnList = buttons.map(b=>`- ${b}`).join('\n');
    const lang = (state.profile.lang||'uk');

    return [
`[CHAT 2 | PROGRAMMER] CURRENT STEP: Add ${kb} to existing aiogram v3 bot`,
`TERMINAL> none`,
`CODE> none`,
`INSTRUCTION:`,
`1) Keep current features. Add ${kb} with these labels:`,
btnList,
`2) For /done require optional confirmation = ${ui.confirmOnDone?'true':'false'}.`,
`3) Messages must remain in ${lang}.`,
`4) Return only code blocks (no prose).`
    ].join('\n');
  }

  function updatePreview(){
    const p = $('#m12-preview'); if(!p) return;
    const s = state.ui;
    const arr = PRESETS[s.kind][s.layout] || [];
    p.innerHTML = arr.map(x=>`<span class="badge">${x}</span>`).join(' ');
  }

  function renderUI(force){
    load();
    // –ø–æ–∫–∞–∑—É—î–º–æ –ª–∏—à–µ –Ω–∞ –∫—Ä–æ—Ü—ñ 'upgrade-ui'
    const all = (root.__flatAll || []);
    const current = JSON.parse(localStorage.getItem(STORE_KEY)||'{}').current ?? 0;
    if(!(all[current] && all[current].key==='upgrade-ui')) return;

    const main = root.querySelector('.main'); if(!main) return;
    const title = $('#gp-title'), desc = $('#gp-desc');
    title && (title.textContent = '–ê–ø“ë—Ä–µ–π–¥: UI-–∫–Ω–æ–ø–∫–∏');
    desc && (desc.textContent = '–û–±–µ—Ä–∏ —Ç–∏–ø —ñ –º–∞–∫–µ—Ç –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏. –ó–≥–µ–Ω–µ—Ä—É—î–º–æ –≥–æ—Ç–æ–≤–∏–π PROMPT –¥–ª—è Cursor.');

    // –ø—Ä–∏–±—Ä–∞—Ç–∏ –¥–∏–Ω–∞–º—ñ–∫—É
    main.querySelectorAll('.dyn').forEach(n=>n.remove());

    const wrap = document.createElement('div'); wrap.className='dyn upui-wrap';
    wrap.innerHTML = `
      <div class="card">
        <b>1) –¢–∏–ø –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏</b>
        <div class="chipset" role="group">
          <button class="chip" id="ui-kind-reply" aria-pressed="${state.ui.kind==='reply'}">Reply</button>
          <button class="chip" id="ui-kind-inline" aria-pressed="${state.ui.kind==='inline'}">Inline</button>
        </div>
        <div class="hint" style="margin-top:6px">
          Reply ‚Äî –≤–µ–ª–∏–∫—ñ –∫–Ω–æ–ø–∫–∏ –ø—ñ–¥ –ø–æ–ª–µ–º –≤–≤–æ–¥—É. Inline ‚Äî –º–∞–ª–µ–Ω—å–∫—ñ –ø—ñ–¥ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º.
        </div>
      </div>

      <div class="card">
        <b>2) –ú–∞–∫–µ—Ç</b>
        <div class="chipset" role="group" id="m12-layouts"></div>
        <div class="preview" id="m12-preview"></div>
      </div>

      <div class="card">
        <b>3) –ü–∞—Ä–∞–º–µ—Ç—Ä–∏</b>
        <label><input type="checkbox" id="ui-emojis" ${state.ui.emojis?'checked':''}> –î–æ–¥–∞–≤–∞—Ç–∏ –µ–º–æ–¥–∑—ñ</label><br>
        <label><input type="checkbox" id="ui-confirm" ${state.ui.confirmOnDone?'checked':''}> –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø—Ä–∏ ‚ÄúDone‚Äù</label>
        <div class="hint">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∑–Ω–∏–∂—É—î –≤–∏–ø–∞–¥–∫–æ–≤—ñ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è.</div>
      </div>

      <div class="card">
        <b>4) PROMPT –¥–ª—è Cursor</b>
        <div class="kbd" id="m12-prompt">${makePrompt(state.ui)}</div>
        <div class="row">
          <button class="btn primary" id="m12-copy">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ PROMPT</button>
          <button class="btn" id="m12-where">–î–µ –≤—Å—Ç–∞–≤–∏—Ç–∏?</button>
        </div>
      </div>

      <div class="card">
        <b>–î–∞–ª—ñ</b>
        <div class="hint">–ì–æ—Ç–æ–≤–æ? –î–æ–¥–∞—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (/stats) ‚Äî –ø—Ä–æ—Å—Ç—ñ –ø—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä–∏ 7/30.</div>
        <div class="row">
          <button class="btn" id="m12-done">–ü–æ–∑–Ω–∞—á–∏—Ç–∏ —è–∫ –≤–∏–∫–æ–Ω–∞–Ω–æ ‚Üí –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        </div>
      </div>
    `;
    main.appendChild(wrap);

    // –ø–æ–±—É–¥—É–≤–∞—Ç–∏ –º–∞–∫–µ—Ç–∏
    function renderLayouts(){
      const box = $('#m12-layouts'); if(!box) return;
      const keys = Object.keys(PRESETS[state.ui.kind]);
      box.innerHTML = keys.map(k=>`<button class="chip" data-layout="${k}" aria-pressed="${state.ui.layout===k}">${k}</button>`).join('');
      box.querySelectorAll('.chip').forEach(ch=>{
        ch.addEventListener('click',()=>{
          state.ui.layout = ch.getAttribute('data-layout');
          save(); renderLayouts(); updatePreview();
          $('#m12-prompt').textContent = makePrompt(state.ui);
        });
      });
    }

    // bind —Ç–∏–ø
    $('#ui-kind-reply')?.addEventListener('click',()=>{
      state.ui.kind='reply'; state.ui.layout = state.ui.layout in PRESETS.reply ? state.ui.layout : 'simple';
      save(); renderUI(true);
    });
    $('#ui-kind-inline')?.addEventListener('click',()=>{
      state.ui.kind='inline'; state.ui.layout = state.ui.layout in PRESETS.inline ? state.ui.layout : 'simple';
      save(); renderUI(true);
    });

    // bind –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
    $('#ui-emojis')?.addEventListener('change',e=>{
      state.ui.emojis = !!e.target.checked; save(); $('#m12-prompt').textContent = makePrompt(state.ui);
    });
    $('#ui-confirm')?.addEventListener('change',e=>{
      state.ui.confirmOnDone = !!e.target.checked; save(); $('#m12-prompt').textContent = makePrompt(state.ui);
    });

    // –∫–Ω–æ–ø–∫–∏
    $('#m12-copy')?.addEventListener('click', async()=>{
      await (async()=>{
        try{
          await navigator.clipboard.writeText($('#m12-prompt').textContent); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.');
        }catch(e){
          const ta=document.createElement('textarea'); ta.value=$('#m12-prompt').textContent; document.body.appendChild(ta); ta.select();
          try{ document.execCommand('copy'); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); }finally{ document.body.removeChild(ta); }
        }
      })();
    });
    $('#m12-where')?.addEventListener('click', ()=>{
      alert('–í—ñ–¥–∫—Ä–∏–π —á–∞—Ç —É Cursor (Cmd/Ctrl+I) ‚Üí –≤—Å—Ç–∞–≤ PROMPT ‚Üí –Ω–∞–¥—ñ—à–ª–∏. –ü–æ–≥–æ–¥–∂—É–π –∑–º—ñ–Ω–∏ —É —Ñ–∞–π–ª–∞—Ö.');
    });
    $('#m12-done')?.addEventListener('click', ()=>{
      const store=JSON.parse(localStorage.getItem(STORE_KEY)||'{}');
      if(!Array.isArray(store.done)) store.done=[];
      const all = root.__flatAll||[];
      const idx = store.current ?? 0;
      if(!store.done.includes(idx)) store.done.push(idx);
      // –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ upgrade-stats
      const to = all.findIndex(x=>x.key==='upgrade-stats');
      if(to>=0) store.current = to;
      localStorage.setItem(STORE_KEY, JSON.stringify(store));
      toast('–ü–æ–∑–Ω–∞—á–µ–Ω–æ. –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.');
    });

    // —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
    renderLayouts();
    updatePreview();
  }

  function toast(msg){
    let t = root.querySelector('#gp-toast-m12');
    if(!t){ t=document.createElement('div'); t.id='gp-toast-m12'; t.className='toast'; t.style.display='none'; root.appendChild(t); }
    t.innerHTML = msg; t.style.display='block'; clearTimeout(window.__gp_to_m12);
    window.__gp_to_m12 = setTimeout(()=> t.style.display='none', 1600);
  }

  function init(){
    // –ø—ñ–¥—Ö–æ–ø–ª—é—î–º–æ –≥–ª–æ–±–∞–ª—å–Ω–∏–π flat –∑ –±–∞–∑–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è
    if(!root.__flatAll){
      // –∑–±–µ—Ä–µ–º–æ –∫–æ—Ä–æ—Ç–∫–∏–π flat –∑—ñ –≤—Å—ñ—Ö —Å–µ–∫—Ü—ñ–π, —è–∫—â–æ –±–∞–∑–æ–≤–∏–π –Ω–µ –∑–∞–ø–∏—Å–∞–≤
      const base = JSON.parse(localStorage.getItem(STORE_KEY)||'{}');
      root.__flatAll = (base.flat||[]); // —è–∫—â–æ —î
    }
    renderUI(true);
    setInterval(()=> renderUI(false), 400);
  }
  init();
})();
</script>
<!-- GP:END UPGRADE UI SCRIPT -->
<!-- GP:M12 END -->
<!-- GP:M13 START ‚Ä¢ UPGRADE: STATS (build 2025-10-29.u2) -->
<!-- GP:BEGIN UPGRADE STATS STYLES -->
<style>
  #gp-panel .upstats-wrap{display:grid;grid-template-columns:1fr;gap:12px}
  #gp-panel .card{border:1px solid var(--line);border-radius:12px;padding:12px}
  #gp-panel .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  #gp-panel .hint{font-size:12px;color:var(--muted)}
  #gp-panel .kbd{margin-top:8px;border:1px solid var(--line);border-radius:10px;padding:10px;
    font:12px/1.5 ui-monospace,SFMono-Regular,Menlo,monospace;white-space:pre-wrap;background:transparent;color:var(--text)}
  #gp-panel .chipset{display:flex;gap:6px;flex-wrap:wrap}
  #gp-panel .chip{border:1px solid var(--line);border-radius:999px;padding:6px 10px;cursor:pointer}
  #gp-panel .chip[aria-pressed="true"]{background:var(--active-bg);border-color:var(--active-border)}
  #gp-panel .inputline{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  #gp-panel .inputline input{padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:transparent;color:var(--text)}
  #gp-panel .demo{font:12px/1.6 ui-monospace,SFMono-Regular,Menlo,monospace;white-space:pre}
</style>
<!-- GP:END UPGRADE STATS STYLES -->

<!-- GP:BEGIN UPGRADE STATS SCRIPT -->
<script>
(function(){
  const root = document.getElementById('gp-panel'); if(!root) return;
  const STORE_KEY = 'gpPanel_state_m0';
  const STATE_VERSION = 1302;

  const sections=[{ title:'11 ¬∑ –ì–æ—Ç–æ–≤–æ / –ê–ø“ë—Ä–µ–π–¥–∏', items:[{t:'UI-–∫–Ω–æ–ø–∫–∏', b:'upgrade-ui'},{t:'–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', b:'upgrade-stats'},{t:'–û–ø–ª–∞—Ç–∏', b:'upgrade-pay'}]}];
  const flat=[]; sections.forEach((s,si)=>s.items.forEach((it,idx)=>flat.push({si,idx,key:it.b,title:it.t,sec:s.title})));

  let state = {
    v: STATE_VERSION,
    lang:'uk',
    profile:{ lang:'uk' },
    stats:{ mode:'count', period:7, metric:'–í–∏–∫–æ–Ω–∞–Ω—å', asciiWidth:20 }
  };

  function load(){ try{
    const raw=localStorage.getItem(STORE_KEY); if(!raw) return;
    const prev=JSON.parse(raw)||{};
    state = Object.assign(state, prev.stats? { stats: Object.assign(state.stats, prev.stats) } : {}, { v: STATE_VERSION });
    // –ø—ñ–¥—Ö–æ–ø–ª—é—î–º–æ –º–æ–≤—É –ø—Ä–æ—Ñ—ñ–ª—é —è–∫—â–æ —î
    if(prev.profile && prev.profile.lang) state.profile={ lang: prev.profile.lang };
  }catch(e){} }
  function save(){ try{
    const prev=JSON.parse(localStorage.getItem(STORE_KEY)||'{}');
    const merged=Object.assign({}, prev, { stats: state.stats });
    localStorage.setItem(STORE_KEY, JSON.stringify(merged));
  }catch(e){} }

  const $ = s => root.querySelector(s);
  function getKey(){
    const all = (root.__flatAll || []);
    const idx = (JSON.parse(localStorage.getItem(STORE_KEY)||'{}').current) ?? 0;
    return (all[idx]&&all[idx].key) || '';
  }

  // –ø—Ä–æ—Å—Ç–∏–π ASCII-–±–∞—Ä
  function makeBar(pct,width){
    const w = Math.max(10, Math.min(60, width||20));
    const fill = Math.round(w * Math.max(0, Math.min(100, pct))/100);
    return '[' + '#'.repeat(fill) + '-'.repeat(w-fill) + `] ${pct}%`;
    }

  // –¥–µ–º–æ –ø—Ä–µ–≤‚Äô—é (—Ä–∞–Ω–¥–æ–º–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è –≤–∏–≥–ª—è–¥—É)
  function demoPreview(period, mode){
    const days = period===30?30:7;
    const arr = Array.from({length:days},()=> Math.floor(Math.random()*100));
    const nowPct = Math.floor((arr.reduce((a,b)=>a+b,0) / (days*100)) * 100);
    const streak = Math.floor(Math.random()*10)+1;
    const head = (mode==='count')
      ? `–ú–µ—Ç—Ä–∏–∫–∞: –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–∫–æ–Ω–∞–Ω—å –∑–∞ ${days} –¥–Ω—ñ–≤`
      : `–ú–µ—Ç—Ä–∏–∫–∞: —Å–µ—Ä—ñ—è (streak) –∑–∞ ${days} –¥–Ω—ñ–≤`;
    const line = makeBar(nowPct, state.stats.asciiWidth);
    return head + '\n' + line + (mode==='streak'?`\nCurrent streak: ${streak}`:'');
  }

  // PROMPT –¥–ª—è Cursor
  function makePrompt(stats){
    const lang = (state.profile.lang||'uk');
    const period = stats.period===30?30:7;
    const mode = stats.mode==='streak'?'streak':'count';
    return [
`[CHAT 2 | PROGRAMMER] CURRENT STEP: Add /stats to existing aiogram v3 bot`,
`TERMINAL> none`,
`CODE> none`,
`INSTRUCTION:`,
`1) Add command /stats that returns text-based progress for the last ${period} days.`,
`2) Metric mode: ${mode} (${mode==='count'?'sum of completed actions per day':'longest/current streak of consecutive days with success'}).`,
`3) Render ASCII progress bar with width ${stats.asciiWidth} chars.`,
`4) Keep messages in ${lang}.`,
`5) Keep existing features and commands; no breaking changes.`,
`6) Return only code blocks (no prose).`
    ].join('\n');
  }

  function renderStats(force){
    load();
    // –ø–æ–∫–∞–∑—É—î–º–æ –ª–∏—à–µ –Ω–∞ –∫—Ä–æ—Ü—ñ 'upgrade-stats'
    const all = (root.__flatAll || []);
    const current = JSON.parse(localStorage.getItem(STORE_KEY)||'{}').current ?? 0;
    if(!(all[current] && all[current].key==='upgrade-stats')) return;

    const main = root.querySelector('.main'); if(!main) return;
    const title = $('#gp-title'), desc = $('#gp-desc');
    title && (title.textContent = '–ê–ø“ë—Ä–µ–π–¥: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (/stats)');
    desc && (desc.textContent = '–û–±–µ—Ä–∏ –º–µ—Ç—Ä–∏–∫—É —ñ –ø–µ—Ä—ñ–æ–¥. –ó–≥–µ–Ω–µ—Ä—É—î–º–æ PROMPT ‚Äî Cursor –¥–æ–¥–∞—Å—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ñ –ø—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä–∏ 7/30.');

    // –ø—Ä–∏–±—Ä–∞—Ç–∏ –¥–∏–Ω–∞–º—ñ–∫—É
    main.querySelectorAll('.dyn').forEach(n=>n.remove());

    const wrap = document.createElement('div'); wrap.className='dyn upstats-wrap';
    wrap.innerHTML = `
      <div class="card">
        <b>1) –ú–µ—Ç—Ä–∏–∫–∞</b>
        <div class="chipset" role="group">
          <button class="chip" id="st-mode-count" aria-pressed="${state.stats.mode==='count'}">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–∫–æ–Ω–∞–Ω—å</button>
          <button class="chip" id="st-mode-streak" aria-pressed="${state.stats.mode==='streak'}">–°–µ—Ä—ñ—è (streak)</button>
        </div>
        <div class="hint">‚Äú–ö—ñ–ª—å–∫—ñ—Å—Ç—å‚Äù ‚Äî —Å–∫—ñ–ª—å–∫–∏ —Ä–∞–∑—ñ–≤ –≤–∏–∫–æ–Ω–∞–Ω–æ. ‚Äú–°–µ—Ä—ñ—è‚Äù ‚Äî —Å–∫—ñ–ª—å–∫–∏ –¥–Ω—ñ–≤ –ø—ñ–¥—Ä—è–¥ –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫—ñ–≤.</div>
      </div>

      <div class="card">
        <b>2) –ü–µ—Ä—ñ–æ–¥</b>
        <div class="chipset" role="group">
          <button class="chip" id="st-per-7" aria-pressed="${state.stats.period===7}">7 –¥–Ω—ñ–≤</button>
          <button class="chip" id="st-per-30" aria-pressed="${state.stats.period===30}">30 –¥–Ω—ñ–≤</button>
        </div>
      </div>

      <div class="card">
        <b>3) –ü–∞—Ä–∞–º–µ—Ç—Ä–∏</b>
        <div class="inputline">
          <label>–ù–∞–∑–≤–∞ –º–µ—Ç—Ä–∏–∫–∏:</label>
          <input type="text" id="st-metric" placeholder="–í–∏–∫–æ–Ω–∞–Ω—å" value="${state.stats.metric||'–í–∏–∫–æ–Ω–∞–Ω—å'}">
          <label>–®–∏—Ä–∏–Ω–∞ ASCII:</label>
          <input type="number" id="st-width" min="10" max="60" step="1" value="${state.stats.asciiWidth}">
        </div>
        <div class="hint">–®–∏—Ä–∏–Ω–∞ ‚Äî –¥–æ–≤–∂–∏–Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä—É —É —Å–∏–º–≤–æ–ª–∞—Ö (# —ñ -).</div>
      </div>

      <div class="card">
        <b>4) –ü—Ä–µ–≤ º—é</b>
        <div class="kbd demo" id="st-preview">${demoPreview(state.stats.period, state.stats.mode)}</div>
      </div>

      <div class="card">
        <b>5) PROMPT –¥–ª—è Cursor</b>
        <div class="kbd" id="st-prompt">${makePrompt(state.stats)}</div>
        <div class="row">
          <button class="btn primary" id="st-copy">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ PROMPT</button>
          <button class="btn" id="st-where">–î–µ –≤—Å—Ç–∞–≤–∏—Ç–∏?</button>
        </div>
      </div>

      <div class="card">
        <b>–î–∞–ª—ñ</b>
        <div class="hint">–ì–æ—Ç–æ–≤–æ? –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –æ–ø–ª–∞—Ç (Telegram Stars/Stripe/Fondy) ‚Äî –∑–∞ –±–∞–∂–∞–Ω–Ω—è–º.</div>
        <div class="row">
          <button class="btn" id="st-done">–ü–æ–∑–Ω–∞—á–∏—Ç–∏ —è–∫ –≤–∏–∫–æ–Ω–∞–Ω–æ ‚Üí –û–ø–ª–∞—Ç–∏</button>
        </div>
      </div>
    `;
    main.appendChild(wrap);

    // binds
    $('#st-mode-count')?.addEventListener('click', ()=>{ state.stats.mode='count'; save(); renderStats(true); });
    $('#st-mode-streak')?.addEventListener('click', ()=>{ state.stats.mode='streak'; save(); renderStats(true); });
    $('#st-per-7')?.addEventListener('click', ()=>{ state.stats.period=7; save(); renderStats(true); });
    $('#st-per-30')?.addEventListener('click', ()=>{ state.stats.period=30; save(); renderStats(true); });

    $('#st-metric')?.addEventListener('input', e=>{
      state.stats.metric = e.target.value || '–í–∏–∫–æ–Ω–∞–Ω—å'; save();
    });
    $('#st-width')?.addEventListener('input', e=>{
      let v = parseInt(e.target.value||20,10); v = isNaN(v)?20:Math.max(10,Math.min(60,v));
      state.stats.asciiWidth = v; save();
      $('#st-preview').textContent = demoPreview(state.stats.period, state.stats.mode);
      $('#st-prompt').textContent = makePrompt(state.stats);
    });

    $('#st-copy')?.addEventListener('click', async()=>{
      const txt = $('#st-prompt').textContent;
      try{ await navigator.clipboard.writeText(txt); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); }
      catch(e){ const ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); }
    });

    $('#st-where')?.addEventListener('click', ()=> alert('–í—ñ–¥–∫—Ä–∏–π —á–∞—Ç —É Cursor (Cmd/Ctrl+I) ‚Üí –≤—Å—Ç–∞–≤ PROMPT ‚Üí –Ω–∞–¥—ñ—à–ª–∏. –ü–æ–≥–æ–¥—å –∑–º—ñ–Ω–∏ —É —Ñ–∞–π–ª–∞—Ö.'));

    $('#st-done')?.addEventListener('click', ()=>{
      const store=JSON.parse(localStorage.getItem(STORE_KEY)||'{}');
      if(!Array.isArray(store.done)) store.done=[];
      const all = root.__flatAll||[];
      const idx = store.current ?? 0;
      if(!store.done.includes(idx)) store.done.push(idx);
      const to = all.findIndex(x=>x.key==='upgrade-pay');
      if(to>=0) store.current = to;
      localStorage.setItem(STORE_KEY, JSON.stringify(store));
      toast('–ü–æ–∑–Ω–∞—á–µ–Ω–æ. –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –æ–ø–ª–∞—Ç.');
    });

    // –æ–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–µ–≤ º—é/–ø—Ä–æ–º–ø—Ç –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É —Ä–µ–Ω–¥–µ—Ä—ñ
    $('#st-preview').textContent = demoPreview(state.stats.period, state.stats.mode);
    $('#st-prompt').textContent = makePrompt(state.stats);
  }

  function toast(msg){
    let t = root.querySelector('#gp-toast-m13');
    if(!t){ t=document.createElement('div'); t.id='gp-toast-m13'; t.className='toast'; t.style.display='none'; root.appendChild(t); }
    t.innerHTML = msg; t.style.display='block'; clearTimeout(window.__gp_to_m13);
    window.__gp_to_m13 = setTimeout(()=> t.style.display='none', 1600);
  }

  function init(){
    if(!root.__flatAll){
      const base = JSON.parse(localStorage.getItem(STORE_KEY)||'{}');
      root.__flatAll = (base.flat||[]);
    }
    renderStats(true);
    setInterval(()=> renderStats(false), 400);
  }
  init();
})();
</script>
<!-- GP:END UPGRADE STATS SCRIPT -->
<!-- GP:M13 END -->
<!-- GP:M14 START ‚Ä¢ UPGRADE: PAYMENTS (build 2025-10-29.u3) -->
<!-- GP:BEGIN UPGRADE PAY STYLES -->
<style>
  #gp-panel .uppay-wrap{display:grid;grid-template-columns:1fr;gap:12px}
  #gp-panel .card{border:1px solid var(--line);border-radius:12px;padding:12px}
  #gp-panel .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  #gp-panel .hint{font-size:12px;color:var(--muted)}
  #gp-panel .kbd{margin-top:8px;border:1px solid var(--line);border-radius:10px;padding:10px;
    font:12px/1.5 ui-monospace,SFMono-Regular,Menlo,monospace;white-space:pre-wrap;background:transparent;color:var(--text)}
  #gp-panel .chipset{display:flex;gap:6px;flex-wrap:wrap}
  #gp-panel .chip{border:1px solid var(--line);border-radius:999px;padding:6px 10px;cursor:pointer}
  #gp-panel .chip[aria-pressed="true"]{background:var(--active-bg);border-color:var(--active-border)}
  #gp-panel .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media(max-width:980px){#gp-panel .grid2{grid-template-columns:1fr}}
  #gp-panel .input{display:flex;flex-direction:column;gap:6px}
  #gp-panel .input input{padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:transparent;color:var(--text)}
  #gp-panel .badge{display:inline-flex;gap:6px;align-items:center;border:1px dashed var(--line);border-radius:8px;padding:4px 8px}
</style>
<!-- GP:END UPGRADE PAY STYLES -->

<!-- GP:BEGIN UPGRADE PAY SCRIPT -->
<script>
(function(){
  const root = document.getElementById('gp-panel'); if(!root) return;
  const STORE_KEY = 'gpPanel_state_m0';
  const STATE_VERSION = 1403;

  const sections=[{ title:'11 ¬∑ –ì–æ—Ç–æ–≤–æ / –ê–ø“ë—Ä–µ–π–¥–∏', items:[{t:'UI-–∫–Ω–æ–ø–∫–∏', b:'upgrade-ui'},{t:'–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', b:'upgrade-stats'},{t:'–û–ø–ª–∞—Ç–∏', b:'upgrade-pay'}]}];
  const flat=[]; sections.forEach((s,si)=>s.items.forEach((it,idx)=>flat.push({si,idx,key:it.b,title:it.t,sec:s.title})));

  let state = {
    v: STATE_VERSION,
    profile:{ lang:'uk' },
    pay:{
      provider:'stars',   // 'stars' | 'stripe'
      currency:'USD',
      price:'5.00',
      planName:'Pro Upgrade',
      // Stars
      tg_app_name:'',     // –Ω–∞–∑–≤–∞ –º—ñ–Ω—ñ-–∞–ø–∫–∏/–±–æ—Ç–∞, —è–∫—â–æ —Ç—Ä–µ–±–∞
      // Stripe/Fondy
      stripe_pk:'', stripe_sk:'', success_url:'https://example.com/success', cancel_url:'https://example.com/cancel',
      fondy_merchant_id:'', fondy_secret:''
    }
  };

  function load(){ try{
    const raw=localStorage.getItem(STORE_KEY); if(!raw) return;
    const prev=JSON.parse(raw)||{};
    state = Object.assign(state, { v: STATE_VERSION }, prev.pay? { pay:Object.assign(state.pay, prev.pay) } : {});
  }catch(e){} }
  function save(){ try{
    const prev=JSON.parse(localStorage.getItem(STORE_KEY)||'{}');
    const merged=Object.assign({}, prev, { pay: state.pay });
    localStorage.setItem(STORE_KEY, JSON.stringify(merged));
  }catch(e){} }

  const $ = s => root.querySelector(s);
  function getKey(){
    const all=(root.__flatAll||[]);
    const idx=(JSON.parse(localStorage.getItem(STORE_KEY)||'{}').current) ?? 0;
    return (all[idx]&&all[idx].key) || '';
  }

  // ---- –ß–µ–∫-–ª–∏—Å—Ç –≤–µ–±—Ö—É–∫–∞
  function webhookChecklist(){
    const usingStars = state.pay.provider==='stars';
    return [
      usingStars ? '‚Ä¢ –£ Bot Settings –≤–∫–ª—é—á–∏ Payments/Stars —É BotFather (—è–∫—â–æ –∑–∞—Å—Ç–æ—Å–æ–≤–Ω–æ).' : '‚Ä¢ –°—Ç–≤–æ—Ä–∏ Stripe/Fondy –º–µ—Ä—á–∞–Ω—Ç —ñ –æ—Ç—Ä–∏–º–∞–π –∫–ª—é—á—ñ.',
      '‚Ä¢ –°—Ç–≤–æ—Ä–∏ endpoint —É –∫–æ–¥—ñ (/payment_webhook).',
      '‚Ä¢ –í–∫–∞–∂–∏ URL –≤–µ–±—Ö—É–∫–∞ —É –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ (ngrok/–≤–∞—à –¥–æ–º–µ–Ω).',
      '‚Ä¢ –ü–µ—Ä–µ–≤—ñ—Ä –ø—ñ–¥–ø–∏—Å (—Å–µ–∫—Ä–µ—Ç) —ñ –æ–±—Ä–æ–±–ª—è–π —Å—Ç–∞—Ç—É—Å–∏: created ‚Üí paid ‚Üí failed/refund.',
      '‚Ä¢ –ó–∞–Ω–æ—Å—å –ø–æ–∫—É–ø–∫—É –≤ –ª–æ–∫–∞–ª—å–Ω—É –ë–î/JSON (user_id, —Ç–æ–≤–∞—Ä, —Å—É–º–∞, —á–∞—Å).'
    ].join('\n');
  }

  // ---- PROMPT –¥–ª—è Cursor
  function makePrompt(pay){
    const lang = (state.profile.lang||'uk');
    if(pay.provider==='stars'){
      return [
`[CHAT 2 | PROGRAMMER] CURRENT STEP: Add Telegram Stars payments`,
`TERMINAL> none`,
`CODE> none`,
`INSTRUCTION:`,
`1) Add module payments.py for Telegram Stars (aiogram v3).`,
`2) Add /buy command and "Upgrade" button; create invoice (amount=${pay.price} ${pay.currency}, title="${pay.planName}").`,
`3) Implement webhook/updates handler to mark user as premium on successful payment.`,
`4) ENV: TG_BOT_TOKEN (already), OPTIONAL: APP_NAME=${pay.tg_app_name||'my_app'}, PRICE=${pay.price}, CURRENCY=${pay.currency}.`,
`5) Persist purchases in a local JSON (data/purchases.json).`,
`6) Messages must remain in ${lang}.`,
`7) Return only code blocks (no prose).`
      ].join('\n');
    }
    // stripe/fondy
    return [
`[CHAT 2 | PROGRAMMER] CURRENT STEP: Add card payments (${pay.provider==='stripe'?'Stripe':'Fondy'})`,
`TERMINAL> none`,
`CODE> none`,
`INSTRUCTION:`,
`1) Add payments.py with endpoints: /create_checkout and /payment_webhook.`,
`2) /buy command returns payment URL (Checkout) for plan "${pay.planName}" at ${pay.price} ${pay.currency}.`,
`3) ENV for Stripe: STRIPE_PK=${pay.stripe_pk||'pk_live_...'}, STRIPE_SK=${pay.stripe_sk||'sk_live_...'}, SUCCESS_URL=${pay.success_url}, CANCEL_URL=${pay.cancel_url}.`,
`   ENV for Fondy: FONDY_MERCHANT_ID=${pay.fondy_merchant_id||'xxxx'}, FONDY_SECRET=${pay.fondy_secret||'xxxx'}.`,
`4) On webhook "paid" ‚Üí mark user premium; save purchase to data/purchases.json (user_id, plan, amount, ts).`,
`5) Messages in ${lang}; keep existing bot features; no breaking changes.`,
`6) Return only code blocks (no prose).`
    ].join('\n');
  }

  function providerDocUrl(){
    return state.pay.provider==='stars'
      ? 'https://core.telegram.org/bots/payments'
      : (state.pay.provider==='stripe' ? 'https://stripe.com/docs/payments/checkout' : 'https://fondy.io/en/docs/');
  }

  function renderPay(force){
    load();
    const all=(root.__flatAll||[]);
    const current=(JSON.parse(localStorage.getItem(STORE_KEY)||'{}').current) ?? 0;
    if(!(all[current] && all[current].key==='upgrade-pay')) return;

    const main=root.querySelector('.main'); if(!main) return;
    const title=$('#gp-title'), desc=$('#gp-desc');
    title && (title.textContent='–ê–ø“ë—Ä–µ–π–¥: –û–ø–ª–∞—Ç–∏ (–æ–ø—Ü—ñ–π–Ω–æ)');
    desc && (desc.textContent='–û–±–µ—Ä–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞, –∑–∞–ø–æ–≤–Ω–∏ –∫–ª—é—á—ñ, –∑–≥–µ–Ω–µ—Ä—É–π PROMPT ‚Äî Cursor –¥–æ–¥–∞—Å—Ç—å –º–æ–¥—É–ª—å –æ–ø–ª–∞—Ç.');

    // –ø—Ä–∏–±—Ä–∞—Ç–∏ –¥–∏–Ω–∞–º—ñ–∫—É
    main.querySelectorAll('.dyn').forEach(n=>n.remove());

    const wrap=document.createElement('div'); wrap.className='dyn uppay-wrap';
    wrap.innerHTML = `
      <div class="card">
        <b>1) –ü—Ä–æ–≤–∞–π–¥–µ—Ä</b>
        <div class="chipset" role="group">
          <button class="chip" id="pay-stars" aria-pressed="${state.pay.provider==='stars'}">Telegram Stars</button>
          <button class="chip" id="pay-stripe" aria-pressed="${state.pay.provider==='stripe'}">Stripe/Fondy</button>
        </div>
        <div class="hint">Stars ‚Äî –Ω–∞—Ç–∏–≤–Ω—ñ –ø–ª–∞—Ç–µ–∂—ñ Telegram. Stripe/Fondy ‚Äî –∫–ª–∞—Å–∏—á–Ω—ñ –∫–∞—Ä—Ç–∫–∏/Apple Pay/Google Pay (—á–µ—Ä–µ–∑ Checkout).</div>
      </div>

      <div class="card">
        <b>2) –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</b>
        <div class="grid2">
          <div class="input">
            <label>–ù–∞–∑–≤–∞ –ø–ª–∞–Ω—É</label>
            <input id="pay-plan" type="text" value="${state.pay.planName}">
          </div>
          <div class="input">
            <label>–¶—ñ–Ω–∞</label>
            <input id="pay-price" type="text" value="${state.pay.price}">
          </div>
          <div class="input">
            <label>–í–∞–ª—é—Ç–∞</label>
            <input id="pay-cur" type="text" value="${state.pay.currency}">
          </div>
          <div class="input">
            <label>${state.pay.provider==='stars'?'Telegram App Name (–æ–ø—Ü.)':'Success URL'}</label>
            <input id="pay-extra1" type="text" value="${state.pay.provider==='stars'? (state.pay.tg_app_name||'') : state.pay.success_url}">
          </div>
          <div class="input">
            <label>${state.pay.provider==='stars'?'(Stars ‚Äî —ñ–Ω—à–µ –ø–æ–ª–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–µ)':'Cancel URL'}</label>
            <input id="pay-extra2" type="text" ${state.pay.provider==='stars'?'disabled':''} value="${state.pay.cancel_url}">
          </div>
          <div class="input">
            <label>${state.pay.provider==='stripe'?'Stripe PK':'Fondy merchant id'}</label>
            <input id="pay-k1" type="text" value="${state.pay.provider==='stripe'?state.pay.stripe_pk:state.pay.fondy_merchant_id}">
          </div>
          <div class="input">
            <label>${state.pay.provider==='stripe'?'Stripe SK':'Fondy secret'}</label>
            <input id="pay-k2" type="text" value="${state.pay.provider==='stripe'?state.pay.stripe_sk:state.pay.fondy_secret}">
          </div>
        </div>
        <div class="hint">–ó–∞–ª–∏—à —è–∫ —î, —è–∫—â–æ —Ç—ñ–ª—å–∫–∏ –¥–µ–º–æ. –°–ø—Ä–∞–≤–∂–Ω—ñ –∫–ª—é—á—ñ –ø—ñ–¥—Å—Ç–∞–≤–∏—à —É .env –ø—ñ–∑–Ω—ñ—à–µ.</div>
      </div>

      <div class="card">
        <b>3) –í–µ–±—Ö—É–∫ ‚Äî —â–æ –∑—Ä–æ–±–∏—Ç–∏</b>
        <div class="kbd">${webhookChecklist()}</div>
        <div class="row">
          <span class="badge">–ü—ñ–¥–∫–∞–∑–∫–∞: –¥–ª—è –ª–æ–∫–∞–ª—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π ngrok ‚Üí HTTPS URL</span>
        </div>
      </div>

      <div class="card">
        <b>4) PROMPT –¥–ª—è Cursor</b>
        <div class="kbd" id="pay-prompt">${makePrompt(state.pay)}</div>
        <div class="row">
          <button class="btn primary" id="pay-copy">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ PROMPT</button>
          <button class="btn" id="pay-doc">–í—ñ–¥–∫—Ä–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é</button>
        </div>
      </div>

      <div class="card">
        <b>–§—ñ–Ω—ñ—à</b>
        <div class="hint">–ü—ñ—Å–ª—è –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –æ–ø–ª–∞—Ç ‚Äî —Ç–≤—ñ–π –±–æ—Ç –≥–æ—Ç–æ–≤–∏–π –¥–æ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü—ñ—ó. –î–∞–ª—ñ ‚Äî –¥—Ä—ñ–±–Ω—ñ –ø—Ä–∞–≤–∫–∏/–±—Ä–µ–Ω–¥–∏–Ω–≥.</div>
        <div class="row">
          <button class="btn" id="pay-done">–ü–æ–∑–Ω–∞—á–∏—Ç–∏ —è–∫ –≤–∏–∫–æ–Ω–∞–Ω–æ ‚Üí –ì–æ—Ç–æ–≤–æ</button>
        </div>
      </div>
    `;
    main.appendChild(wrap);

    // binds
    $('#pay-stars')?.addEventListener('click', ()=>{ state.pay.provider='stars'; save(); renderPay(true); });
    $('#pay-stripe')?.addEventListener('click', ()=>{ state.pay.provider='stripe'; save(); renderPay(true); });

    $('#pay-plan')?.addEventListener('input', e=>{ state.pay.planName=e.target.value; save(); $('#pay-prompt').textContent = makePrompt(state.pay); });
    $('#pay-price')?.addEventListener('input', e=>{ state.pay.price=e.target.value; save(); $('#pay-prompt').textContent = makePrompt(state.pay); });
    $('#pay-cur')?.addEventListener('input', e=>{ state.pay.currency=e.target.value; save(); $('#pay-prompt').textContent = makePrompt(state.pay); });

    $('#pay-extra1')?.addEventListener('input', e=>{
      if(state.pay.provider==='stars'){ state.pay.tg_app_name=e.target.value; }
      else { state.pay.success_url=e.target.value; }
      save(); $('#pay-prompt').textContent = makePrompt(state.pay);
    });
    $('#pay-extra2')?.addEventListener('input', e=>{
      if(state.pay.provider!=='stars'){ state.pay.cancel_url=e.target.value; save(); $('#pay-prompt').textContent = makePrompt(state.pay); }
    });
    $('#pay-k1')?.addEventListener('input', e=>{
      if(state.pay.provider==='stripe'){ state.pay.stripe_pk=e.target.value; }
      else { state.pay.fondy_merchant_id=e.target.value; }
      save(); $('#pay-prompt').textContent = makePrompt(state.pay);
    });
    $('#pay-k2')?.addEventListener('input', e=>{
      if(state.pay.provider==='stripe'){ state.pay.stripe_sk=e.target.value; }
      else { state.pay.fondy_secret=e.target.value; }
      save(); $('#pay-prompt').textContent = makePrompt(state.pay);
    });

    $('#pay-copy')?.addEventListener('click', async()=>{
      const txt = $('#pay-prompt').textContent;
      try{ await navigator.clipboard.writeText(txt); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); }
      catch(e){ const ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ.'); }
    });

    $('#pay-doc')?.addEventListener('click', ()=> window.open(providerDocUrl(), '_blank', 'noopener'));

    $('#pay-done')?.addEventListener('click', ()=>{
      const store=JSON.parse(localStorage.getItem(STORE_KEY)||'{}');
      if(!Array.isArray(store.done)) store.done=[];
      const all = root.__flatAll||[];
      const idx = store.current ?? 0;
      if(!store.done.includes(idx)) store.done.push(idx);
      // –ø–µ—Ä–µ–π—Ç–∏ –¥–æ "–ì–æ—Ç–æ–≤–æ" (–ø–µ—Ä—à–∏–π –ø—É–Ω–∫—Ç —Å–µ–∫—Ü—ñ—ó –∞–ø“ë—Ä–µ–π–¥—ñ–≤ –∞–±–æ –∑–∞–ª–∏—à–∏—Ç–∏—Å—å)
      localStorage.setItem(STORE_KEY, JSON.stringify(store));
      toast('–ü–æ–∑–Ω–∞—á–µ–Ω–æ. –ê–ø“ë—Ä–µ–π–¥–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ.');
    });

    // –æ–Ω–æ–≤–∏—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å —É —à–∞–ø—Ü—ñ (—è–∫—â–æ –≥–ª–æ–±–∞–ª—å–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç —î)
    const progressEl = $('#gp-progress');
    if(progressEl){
      const base=JSON.parse(localStorage.getItem(STORE_KEY)||'{}');
      const done=(base.done||[]).length, total=(base.flat||[]).length||1;
      const pct=Math.round((done/total)*100)||0;
      progressEl.textContent = `${pct}% –≤–∏–∫–æ–Ω–∞–Ω–æ ¬∑ –º–æ–≤–∞: ${(base.lang||'uk').toUpperCase?.()||'UK'}`;
    }
  }

  function toast(msg){
    let t = root.querySelector('#gp-toast-m14');
    if(!t){ t=document.createElement('div'); t.id='gp-toast-m14'; t.className='toast'; t.style.display='none'; root.appendChild(t); }
    t.innerHTML = msg; t.style.display='block'; clearTimeout(window.__gp_to_m14);
    window.__gp_to_m14 = setTimeout(()=> t.style.display='none', 1600);
  }

  function init(){
    if(!root.__flatAll){
      const base = JSON.parse(localStorage.getItem(STORE_KEY)||'{}');
      root.__flatAll = (base.flat||[]);
    }
    renderPay(true);
    setInterval(()=> renderPay(false), 400);
  }
  init();
})();
</script>
<!-- GP:END UPGRADE PAY SCRIPT -->
<!-- GP:M14 END -->
<!-- GP:M15 START ‚Ä¢ POLISH (build 2025-10-29.p1) -->
<style>
  /* –ú–æ–±—ñ–ª—å–Ω—ñ –¥—Ä—ñ–±–Ω–∏—Ü—ñ + –∫—Ä–∞—â—ñ —Ç–∞–ø-–∑–æ–Ω–∏ */
  #gp-panel .btn{ align-items:center; gap:8px; }
  #gp-panel .btn .ico{ font-style:normal; font-size:14px; }
  @media (max-width:780px){
    #gp-panel .top{ position:sticky; top:0; z-index:9; background:var(--bg); padding:8px 0; border-bottom:1px solid var(--line) }
    #gp-panel .btn{ padding:10px 12px; border-radius:12px }
    #gp-panel .qbtn{ padding:8px 12px; border-radius:999px }
    #gp-panel .kbd{ font-size:11px }
  }

  /* –•—ñ–Ω—Ç–∏ –ø—ñ–¥ –∫–Ω–æ–ø–∫–∞–º–∏ */
  #gp-panel .hintline{display:flex;gap:8px;align-items:center;margin-top:6px;color:var(--muted);font-size:12px}
  #gp-panel .hintline .dot{width:6px;height:6px;border-radius:50%;background:var(--muted);opacity:.6}

  /* –ú—ñ–Ω—ñ-–¥–∞—à–±–æ—Ä–¥ —É —à–∞–ø—Ü—ñ */
  #gp-pulse{display:inline-flex;gap:10px;align-items:center;border:1px dashed var(--line);
    border-radius:999px;padding:6px 10px;margin-left:6px;font-size:12px;color:var(--muted)}
  #gp-pulse b{color:var(--text)}
</style>

<script>
(function(){
  const root=document.getElementById('gp-panel'); if(!root) return;

  /* ===== –ê–ù–ê–õ–Ü–¢–ò–ö–ê (–¥—É–∂–µ –ø—Ä–æ—Å—Ç–∞, –±–µ–∑ –º–µ—Ä–µ–∂—ñ) ===== */
  const AKEY='gpPanel_analytics_v1';
  const an = loadA();

  function loadA(){ try{ return JSON.parse(localStorage.getItem(AKEY)||'{}'); }catch(e){ return {}; } }
  function saveA(){ try{ localStorage.setItem(AKEY, JSON.stringify(an)); }catch(e){} }
  function inc(path){
    // path —Ç–∏–ø—É "click.copy_prompt" –∞–±–æ "step.done" –∞–±–æ "modal.troubles"
    const now = Date.now();
    an.__last = now;
    const seg = path.split('.');
    let ref = an;
    for(const s of seg){ if(!ref[s]) ref[s]={}; ref=ref[s]; }
    ref._n = (ref._n||0)+1;
    saveA();
  }
  // —Å–ª—É—Ö–∞—á—ñ –∑ –±–∞–∑–æ–≤–∏—Ö –º–æ–¥—É–ª—ñ–≤ (–∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ–∑–Ω–∞—á–∞—î –∫—Ä–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–∏–º)
  root.addEventListener('gp:markDone', ()=> inc('step.done'));

  // –ø–µ—Ä–µ—Ö–æ–ø–ª—é—î–º–æ –∫–ª—ñ–∫–∏ –Ω–∞ –∫–ª—é—á–æ–≤–∏—Ö –∫–Ω–æ–ø–∫–∞—Ö (–¥–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è)
  document.addEventListener('click', (e)=>{
    const id = (e.target.closest('button')||{}).id||'';
    if(!id) return;
    if(/copy|m9-copy|m10-copy|st-copy|pay-copy|gp-copy/.test(id)) inc('click.copy_prompt');
    if(/open|m11-open-telegram|m11-open-bf|m9-open-chat/.test(id)) inc('click.open');
    if(/done|m9-done|m10-done|m11-done|st-done|pay-done/.test(id)) inc('click.done');
    if(/troubles|gp-troubles/.test(id)) inc('modal.troubles');
  });

  /* ===== –ü–£–õ–¨–° –ü–†–û–ì–†–ï–°–£ –≤ —à–∞–ø—Ü—ñ ===== */
  ensurePulse();
  renderPulse(); // –æ–¥—Ä–∞–∑—É
  // –æ–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –∫–ª—ñ–∫—É/–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ
  setInterval(renderPulse, 1000);

  function ensurePulse(){
    const top = root.querySelector('.switch'); if(!top) return;
    if(!document.getElementById('gp-pulse')){
      const span = document.createElement('span');
      span.id='gp-pulse';
      span.innerHTML = `<span class="ico">üìà</span><span>–ü—É–ª—å—Å: <b id="gp-pulse-done">0</b>/<span id="gp-pulse-total">0</span> ¬∑ CTR –∫–æ–ø—ñ–π: <b id="gp-pulse-ctr">0%</b></span>`;
      // –¥–æ–¥–∞—î–º–æ –¥–æ –ø–µ—Ä—à–æ—ó –≥—Ä—É–ø–∏ —É —à–∞–ø—Ü—ñ (–ø–æ—Ä—É—á —ñ–∑ –ø—Ä–æ–≥—Ä–µ—Å–æ–º)
      const prog = document.getElementById('gp-progress');
      (prog && prog.parentNode) ? prog.parentNode.appendChild(span) : top.appendChild(span);
    }
  }
  function renderPulse(){
    const store = JSON.parse(localStorage.getItem('gpPanel_v3_hotfix')||'{}');
    const done = (store.done||[]).length||0;
    const total = (store.flat||[]).length||0;
    const copyN = (((an||{}).click||{}).copy_prompt||{})._n||0;
    const openN = (((an||{}).click||{}).open||{})._n||1; // —â–æ–± –Ω–µ –¥—ñ–ª–∏–ª–∏ –Ω–∞ 0
    const ctr = Math.min(100, Math.round( (copyN/openN)*100 ));
    setText('#gp-pulse-done', done);
    setText('#gp-pulse-total', total);
    setText('#gp-pulse-ctr', ctr+'%');
  }
  function setText(sel, val){ const el=document.querySelector(sel); if(el) el.textContent=val; }

  /* ===== –ú–Ü–ö–†–û–¢–ï–ö–°–¢–ò / –Ü–ö–û–ù–ö–ò (–±–µ–∑ –ª–æ–º—É —ñ—Å–Ω—É—é—á–æ–≥–æ UI) ===== */
  // 1) –î–æ–¥–∞—î–º–æ –ø—ñ–¥–∫–∞–∑–∫–∏ –ø—ñ–¥ –∫–ª—é—á–æ–≤—ñ –∫–Ω–æ–ø–∫–∏, —è–∫—â–æ —ó—Ö —â–µ –Ω–µ–º–∞—î
  function hintUnder(btnSel, text){
    const btn = root.querySelector(btnSel); if(!btn) return;
    // —è–∫—â–æ –≤–∂–µ —î –ø—ñ–¥–∫–∞–∑–∫–∞ –ø–æ—Ä—É—á ‚Äî –Ω–µ –¥—É–±–ª—é—î–º–æ
    if(btn.nextElementSibling && btn.nextElementSibling.classList && btn.nextElementSibling.classList.contains('hintline')) return;
    const line = document.createElement('div'); line.className='hintline';
    line.innerHTML = `<span class="dot"></span><span>${text}</span>`;
    btn.parentNode && btn.parentNode.appendChild(line);
  }
  // 2) –õ–µ–≥–∫—ñ –µ–º–æ–¥–∑—ñ-—ñ–∫–æ–Ω–∏ –¥–æ —Ç–µ–∫—Å—Ç—É –∫–Ω–æ–ø–æ–∫ (–ª–∏—à–µ —è–∫—â–æ –Ω–µ–º–∞—î –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ svg)
  function addIcon(btnSel, emoji){
    const btn = root.querySelector(btnSel); if(!btn) return;
    if(btn.querySelector('svg')) return; // –Ω–µ —á—ñ–ø–∞—î–º–æ –≤–∞—à—ñ svg
    if(btn.querySelector('.ico')) return; // –≤–∂–µ –¥–æ–¥–∞–Ω–æ
    const span = document.createElement('span'); span.className='ico'; span.textContent=emoji;
    btn.insertBefore(span, btn.firstChild);
  }

  // –Ü–ù–Ü–¶–Ü–ê–õ–¨–ù–ê –î–û–ü–û–õ–Ü–†–û–í–ö–ê (–∑ –ø–æ–≤–∞–≥–æ—é –¥–æ –≤–∂–µ —ñ—Å–Ω—É—é—á–æ–≥–æ DOM)
  function polishPass(){
    // –®–∞–ø–∫–∞
    addIcon('#gp-guide-open','üìò');
    addIcon('#gp-help','‚ùì');
    addIcon('#gp-troubles','üõ†Ô∏è');
    addIcon('#gp-toggle','üóÇÔ∏è');
    addIcon('#gp-settings','‚öôÔ∏è');
    addIcon('#gp-reset','‚ôªÔ∏è');

    // –ì–æ–ª–æ–≤–Ω—ñ —Ä–æ–±–æ—á—ñ –¥—ñ—ó
    addIcon('#gp-copy1','üìã'); addIcon('#gp-copy2','üìã'); addIcon('#gp-copy-both','üìë');
    addIcon('#gp-open','üîó');  addIcon('#gp-done','‚úÖ');

    // –ü—ñ–¥–∫–∞–∑–∫–∏ –ø—ñ–¥ –Ω–∞–π–∫—Ä–∏—Ç–∏—á–Ω—ñ—à—ñ –∫–Ω–æ–ø–∫–∏
    hintUnder('#gp-copy-both','–°–∫–æ–ø—ñ—é—î –æ–±–∏–¥–≤–∞ –ø—Ä–æ–º–ø—Ç–∏ –æ–¥—Ä–∞–∑—É. –í—Å—Ç–∞–≤ —É Chat1/Chat2.');
    hintUnder('#gp-done','–Ø–∫—â–æ –∫—Ä–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–æ –π –≤—Å–µ –æ–∫ ‚Äî —Ç–∏—Å–Ω–∏ ‚Äú–í–∏–∫–æ–Ω–∞–Ω–æ‚Äù.');
    hintUnder('#gp-troubles','–ù–∞–π—á–∞—Å—Ç—ñ—à—ñ —Ñ–µ–π–ª–∏: –≤—ñ–¥—Å—É—Ç–Ω—ñ–π .env, –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏–π venv, –∑–∞–±—É—Ç–∏–π pip install.');

    // –ï–∫—Ä–∞–Ω–∏ M9‚ÄìM14 (—è–∫—â–æ –ø—Ä–∏—Å—É—Ç–Ω—ñ)
    addIcon('#m9-copy-prompt','üìã'); addIcon('#m9-copy-both','üìë'); addIcon('#m9-open-chat','üí¨'); addIcon('#m9-done','‚úÖ');
    hintUnder('#m9-copy-prompt','–í—Å—Ç–∞–≤ —É —á–∞—Ç Cursor, —â–æ –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–∏–π –¥–æ –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç—É.');

    addIcon('#m10-copy','üìã'); addIcon('#m10-troubles','üõ†Ô∏è'); addIcon('#m10-done','‚úÖ');
    hintUnder('#m10-copy','–°–∫–æ–ø—ñ—é—î –≤—Å—ñ –∫–æ–º–∞–Ω–¥–∏ ‚Äî –≤—Å—Ç–∞–≤ —É —Å–≤—ñ–π —Ç–µ—Ä–º—ñ–Ω–∞–ª.');

    addIcon('#m11-copy','üìã'); addIcon('#m11-open-bf','ü§ñ'); addIcon('#m11-done','‚úÖ');

    addIcon('#m12-copy','üìã'); addIcon('#m12-done','‚úÖ');

    addIcon('#st-copy','üìã'); addIcon('#st-done','‚úÖ');

    addIcon('#pay-copy','üìã'); addIcon('#pay-doc','üìö'); addIcon('#pay-done','‚úÖ');
  }

  // —Ä–∞–∑–æ–≤–æ —ñ –¥–∞–ª—ñ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–æ (–±–æ DOM —É —Ç–µ–±–µ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π –º—ñ–∂ –º–æ–¥—É–ª—è–º–∏)
  polishPass();
  const __polishObserver = new MutationObserver(()=>polishPass());
  __polishObserver.observe(root, { childList:true, subtree:true });

})();
</script>
<!-- GP:M15 END -->


