const API_URL = 'https://gp-panel-api.onrender.com';

async function api(path, options = {}) {
  const res = await fetch(API_URL + path, {
    credentials: 'include',
    headers: {
      'Content-Type': 'application/json',
      ...(options.headers || {})
    },
    ...options
  });

  const data = await res.json().catch(() => null);
  if (!res.ok) {
    console.error('API error', res.status, data);
    throw new Error(data?.message || 'API error');
  }
  return data;
}
async function handleLoginSubmit(e) {
  e.preventDefault();
  const email = document.querySelector('#login-email').value.trim();
  const password = document.querySelector('#login-password').value.trim();

  try {
    const result = await api('/auth/login', {
      method: 'POST',
      body: JSON.stringify({ email, password })
    });

    console.log('Logged in', result.user);
    // Ð·Ð±ÐµÑ€Ñ–Ð³Ð°Ñ”Ð¼Ð¾ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð° Ñ‚Ð° Ð¿Ð¾ÐºÐ°Ð·ÑƒÑ”Ð¼Ð¾ Ð¿Ð°Ð½ÐµÐ»ÑŒ
    window.currentUser = result.user;
    const loginScreen = document.getElementById('login-screen');
    const appShell = document.getElementById('app');
    if (loginScreen) loginScreen.hidden = true;
    if (appShell) appShell.hidden = false;

    // Ð¿Ñ–Ð´Ñ‚ÑÐ³ÑƒÑ”Ð¼Ð¾ Ð´Ð°Ð½Ñ– Ð´Ð»Ñ Ð¿Ð°Ð½ÐµÐ»Ñ–
    await loadBots();
  } catch (err) {
    alert('ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ° Ð²Ñ…Ð¾Ð´Ñƒ');
  }
}

document
  .querySelector('#login-form')
  .addEventListener('submit', handleLoginSubmit);
async function loadBots() {
  const bots = await api('/bots', { method: 'GET' });
  console.log('Bots:', bots);
  // Ñ‚ÑƒÑ‚ Ð·Ð°Ð¼Ñ–ÑÑ‚ÑŒ Ð·Ð°Ñ…Ð°Ñ€Ð´ÐºÐ¾Ð¶ÐµÐ½Ð¸Ñ… ÐºÐ½Ð¾Ð¿Ð¾Ðº Ñ€ÐµÐ½Ð´ÐµÑ€Ð¸Ñˆ Ñ—Ñ… Ð· Ð¼Ð°ÑÐ¸Ð²Ñƒ bots
}
async function handlePay(botId) {
  const res = await api('/payments/create', {
    method: 'POST',
    body: JSON.stringify({ botId })
  });

  if (res.status === 'free') {
    // free / test
    await loadBots(); // Ð°Ð±Ð¾ Ð¾Ð½Ð¾Ð²Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿ / ÐºÑ€Ð¾ÐºÐ¸
    return;
  }

  if (res.status === 'pending' && res.redirectUrl) {
    window.location.href = res.redirectUrl;
  }
}

const STORAGE_KEY = "ztb_v4_state";

// --- Ð”Ð¾Ð²Ñ–Ð´ÐºÐ¾Ð²Ñ– Ð´Ð°Ð½Ñ– ---
const BOT_TYPES = [
  {
    id: "crm",
    title: "CRM",
    description: "Ð’ÐµÐ´Ðµ ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ñ–Ð² Ñ– Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ",
    commands: [
      "/start",
      "/help",
      "/add",
      "/clients",
      "/tasks",
      "/done",
      "/stats",
    ],
    tips: [
      "Ð—Ð±ÐµÑ€Ñ–Ð³Ð°Ð¹ ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ñ–Ð² Ñ‚Ð° Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ Ð· Ð¿Ð¾Ð»ÑÐ¼Ð¸: Ñ–Ð¼â€™Ñ, ÑÑ‚Ð°Ñ‚ÑƒÑ, Ð½Ð°ÑÑ‚ÑƒÐ¿Ð½Ð¸Ð¹ ÐºÑ€Ð¾Ðº.",
      "ÐšÐ¾Ð¼Ð±Ñ–Ð½Ð°Ñ†Ñ–Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´: /add â†’ /clients â†’ /tasks â†’ /done.",
      "Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð¾Ð²Ð°Ð½Ð¸Ð¹ Ð±ÐµÐºÐµÐ½Ð´: SQLite Ð°Ð±Ð¾ Postgres.",
    ],
    ui: {
      reply: {
        variants: [
          {
            id: "default",
            title: "ÐŸÐ¾Ð²Ð½Ðµ Ð¼ÐµÐ½ÑŽ CRM",
            description: "Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ð´Ð¾ Ð±Ð°Ð·Ð¸ ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ñ–Ð², Ð·Ð°Ð²Ð´Ð°Ð½ÑŒ Ñ– Ð°Ð½Ð°Ð»Ñ–Ñ‚Ð¸ÐºÐ¸.",
            buttons: [
              {
                text: "ðŸ“‹ ÐšÐ»Ñ–Ñ”Ð½Ñ‚Ð¸",
                purpose: "Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ ÑÐ¿Ð¸ÑÐ¾Ðº Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¸Ñ… ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ñ–Ð²",
              },
              { text: "âž• ÐÐ¾Ð²Ð¸Ð¹ ÐºÐ»Ñ–Ñ”Ð½Ñ‚", purpose: "ÑÑ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð½Ð¾Ð²Ñƒ Ð·Ð°ÑÐ²ÐºÑƒ" },
              {
                text: "âœ… Ð—Ð°Ð²Ð´Ð°Ð½Ð½Ñ",
                purpose: "Ð¿ÐµÑ€ÐµÐ¹Ð´Ñ–Ñ‚ÑŒ Ð´Ð¾ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¸Ñ… Ð·Ð°Ð²Ð´Ð°Ð½ÑŒ",
              },
              {
                text: "ðŸ“ˆ Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°",
                purpose: "Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ð¹ Ð·Ð²Ñ–Ñ‚ Ð¿Ð¾ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð°Ñ…",
              },
            ],
          },
          {
            id: "minimal",
            title: "ÐœÑ–Ð½Ñ–Ð¼Ð°Ð»ÑŒÐ½Ðµ Ð¼ÐµÐ½ÑŽ",
            description: "Ð”Ð»Ñ ÑÑ‚Ð°Ñ€Ñ‚Ñƒ Ð· ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ð¼ Ð¿ÐµÑ€ÐµÐ»Ñ–ÐºÐ¾Ð¼ Ð´Ñ–Ð¹.",
            buttons: [
              { text: "ðŸ“‹ ÐšÐ»Ñ–Ñ”Ð½Ñ‚Ð¸", purpose: "Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ– ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð¸" },
              { text: "ðŸ“ Ð—Ð°Ð²Ð´Ð°Ð½Ð½Ñ", purpose: "ÑÐ¿Ð¸ÑÐ¾Ðº Ð·Ð°Ð²Ð´Ð°Ð½ÑŒ" },
              {
                text: "âž• Ð”Ð¾Ð´Ð°Ñ‚Ð¸",
                purpose: "ÑˆÐ²Ð¸Ð´ÐºÐ¾ Ð´Ð¾Ð´Ð°Ñ‚Ð¸ ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð° Ð°Ð±Ð¾ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ",
              },
            ],
            notes: "ÐŸÑ–Ð´Ñ–Ð¹Ð´Ðµ, ÑÐºÑ‰Ð¾ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð¿Ñ€Ð°Ñ†ÑŽÑ” Ð»Ð¸ÑˆÐµ Ð· Ð±Ð°Ð·Ð¾Ð²Ð¸Ð¼Ð¸ ÑÑ†ÐµÐ½Ð°Ñ€Ñ–ÑÐ¼Ð¸.",
          },
        ],
        discoveryHint:
          "Ð¡Ñ„Ð¾ÐºÑƒÑÑƒÐ¹ÑÑ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ°Ñ… Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ñ–Ð²: ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð¸, Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ, Ð°Ð½Ð°Ð»Ñ–Ñ‚Ð¸ÐºÐ°.",
      },
      inline: {
        variants: [
          {
            id: "default",
            title: "ÐœÐµÐ½ÐµÐ´Ð¶Ð¼ÐµÐ½Ñ‚ Ð»Ñ–Ð´Ð°",
            description: "ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð² ÐºÐ°Ñ€Ñ‚Ñ†Ñ– ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð° Ð°Ð±Ð¾ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ.",
            buttons: [
              {
                text: "âœ… Ð’Ð·ÑÑ‚Ð¸ Ð² Ñ€Ð¾Ð±Ð¾Ñ‚Ñƒ",
                purpose: "Ð¿ÐµÑ€ÐµÐ²ÐµÑÑ‚Ð¸ Ð»Ñ–Ð´ Ñƒ Ñ€Ð¾Ð±Ð¾Ñ‚Ñƒ",
                callback: "lead_take",
              },
              {
                text: "âž• ÐšÐ¾Ð¼ÐµÐ½Ñ‚Ð°Ñ€",
                purpose: "Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ð½Ð¾Ñ‚Ð°Ñ‚ÐºÑƒ Ð´Ð¾ ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð°",
                callback: "lead_add_note",
              },
              {
                text: "ðŸ“… ÐÐ°Ð³Ð°Ð´Ð°Ñ‚Ð¸",
                purpose: "ÑÑ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð½Ð°Ð³Ð°Ð´ÑƒÐ²Ð°Ð½Ð½Ñ",
                callback: "lead_remind",
              },
              {
                text: "âŒ Ð—Ð°ÐºÑ€Ð¸Ñ‚Ð¸",
                purpose: "Ð¿Ð¾Ð·Ð½Ð°Ñ‡Ð¸Ñ‚Ð¸ Ð»Ñ–Ð´ ÑÐº Ð·Ð°ÐºÑ€Ð¸Ñ‚Ð¸Ð¹",
                callback: "lead_close",
              },
            ],
          },
          {
            id: "minimal",
            title: "ÐšÐµÑ€ÑƒÐ²Ð°Ð½Ð½Ñ Ð·Ð°Ð²Ð´Ð°Ð½Ð½ÑÐ¼",
            description: "Ð¡Ñ‚Ð¸ÑÐ»Ð° Ð¿Ð°Ð½ÐµÐ»ÑŒ Ð´Ð»Ñ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ ÑÑ‚Ð°Ñ‚ÑƒÑÑƒ.",
            buttons: [
              {
                text: "âœ… Ð“Ð¾Ñ‚Ð¾Ð²Ð¾",
                purpose: "Ð¿Ð¾Ð·Ð½Ð°Ñ‡Ð¸Ñ‚Ð¸ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ Ð²Ð¸ÐºÐ¾Ð½Ð°Ð½Ð¸Ð¼",
                callback: "task_done",
              },
              {
                text: "â†©ï¸ ÐÐ°Ð·Ð°Ð´",
                purpose: "Ð¿Ð¾Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ÑÑ Ð´Ð¾ Ð¿ÐµÑ€ÐµÐ»Ñ–ÐºÑƒ Ð·Ð°Ð²Ð´Ð°Ð½ÑŒ",
                callback: "task_back",
              },
            ],
          },
        ],
        discoveryHint:
          "ÐÐ°Ð´Ñ–ÑˆÐ»Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð´Ð»Ñ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ð· Ð»Ñ–Ð´Ð°Ð¼Ð¸: Ð±Ñ€Ð°Ñ‚Ð¸ Ð² Ñ€Ð¾Ð±Ð¾Ñ‚Ñƒ, Ð·Ð°Ð»Ð¸ÑˆÐ°Ñ‚Ð¸ ÐºÐ¾Ð¼ÐµÐ½Ñ‚Ð°Ñ€, Ð½Ð°Ð³Ð°Ð´ÑƒÐ²Ð°Ð½Ð½Ñ.",
      },
    },
  },
  {
    id: "task",
    title: "Task Manager",
    description: "Ð¡Ð¿Ð¸ÑÐ¾Ðº ÑÐ¿Ñ€Ð°Ð² Ð´Ð»Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸",
    commands: ["/start", "/help", "/add", "/list", "/done", "/skip", "/stats"],
    tips: [
      "Ð¤Ñ–ÐºÑÑƒÐ¹ Ð²Ð¸ÐºÐ¾Ð½Ð°Ð²Ñ†Ñ, Ð´ÐµÐ´Ð»Ð°Ð¹Ð½ Ñ‚Ð° ÑÑ‚Ð°Ñ‚ÑƒÑ.",
      "Ð¡Ñ‚Ð°Ñ€Ñ‚ÑƒÐ¹ Ñ–Ð· JSON, Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑŒ Ð½Ð° SQLite, ÐºÐ¾Ð»Ð¸ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð²Ð¸Ñ€Ð¾ÑÑ‚Ðµ.",
      "Ð”Ð¾Ð´Ð°Ð¹ Ð½Ð°Ð³Ð°Ð´ÑƒÐ²Ð°Ð½Ð½Ñ Ð¿Ñ€Ð¾ Ð´ÐµÐ´Ð»Ð°Ð¹Ð½Ð¸.",
    ],
    ui: {
      reply: {
        variants: [
          {
            id: "default",
            title: "ÐšÐ¾Ð¼Ð°Ð½Ð´Ð½Ðµ Ð¼ÐµÐ½ÑŽ",
            description: "ÐŸÐ¾Ð²Ð½Ð¸Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ð´Ð¾ Ð·Ð°Ð²Ð´Ð°Ð½ÑŒ Ñ– Ð¿Ð»Ð°Ð½Ñƒ Ð½Ð° Ð´ÐµÐ½ÑŒ.",
            buttons: [
              { text: "ðŸ†• Ð”Ð¾Ð´Ð°Ñ‚Ð¸", purpose: "ÑÑ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð½Ð¾Ð²Ðµ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ" },
              { text: "ðŸ“‹ Ð¡Ð¿Ð¸ÑÐ¾Ðº", purpose: "Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ð²ÑÑ– Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ– Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ" },
              {
                text: "ðŸ”¥ Ð¡ÑŒÐ¾Ð³Ð¾Ð´Ð½Ñ–",
                purpose: "Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ½ÑƒÑ‚Ð¸ Ð·Ð°Ð´Ð°Ñ‡Ñ– Ð½Ð° ÑÑŒÐ¾Ð³Ð¾Ð´Ð½Ñ–",
              },
              {
                text: "âš™ï¸ ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ",
                purpose: "ÑƒÐ²Ñ–Ð¼ÐºÐ½ÑƒÑ‚Ð¸ Ð½Ð°Ð³Ð°Ð´ÑƒÐ²Ð°Ð½Ð½Ñ Ñ‚Ð° Ñ€Ð¾Ð»Ñ–",
              },
            ],
          },
          {
            id: "minimal",
            title: "ÐœÑ–Ð½Ñ–Ð¼Ð°Ð»Ñ–ÑÑ‚Ð¸Ñ‡Ð½Ðµ Ð¼ÐµÐ½ÑŽ",
            description: "ÐšÐ¾Ð»Ð¸ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ñ– Ð»Ð¸ÑˆÐµ Ð±Ð°Ð·Ð¾Ð²Ñ– Ð´Ñ–Ñ—.",
            buttons: [
              { text: "ðŸ†• Ð”Ð¾Ð´Ð°Ñ‚Ð¸", purpose: "Ð½Ð¾Ð²Ðµ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ" },
              { text: "ðŸ“‹ Ð—Ð°Ð²Ð´Ð°Ð½Ð½Ñ", purpose: "Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¸Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº" },
              { text: "âœ… Ð“Ð¾Ñ‚Ð¾Ð²Ñ–", purpose: "Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ½ÑƒÑ‚Ð¸ Ð²Ð¸ÐºÐ¾Ð½Ð°Ð½Ñ– Ð·Ð°Ð´Ð°Ñ‡Ñ–" },
            ],
          },
        ],
        discoveryHint:
          "ÐŸÑ–Ð´ÐºÐ°Ð¶Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð´Ð»Ñ ÑÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ, Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ´Ñƒ Ñ‚Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð½Ñ Ð·Ð°Ð²Ð´Ð°Ð½ÑŒ.",
      },
      inline: {
        variants: [
          {
            id: "default",
            title: "ÐšÐµÑ€ÑƒÐ²Ð°Ð½Ð½Ñ Ð·Ð°Ð²Ð´Ð°Ð½Ð½ÑÐ¼",
            description: "Ð”Ð»Ñ ÐºÐ°Ñ€Ñ‚ÐºÐ¸ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ.",
            buttons: [
              {
                text: "âœ… Ð“Ð¾Ñ‚Ð¾Ð²Ð¾",
                purpose: "Ð·Ð°ÐºÑ€Ð¸Ñ‚Ð¸ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ",
                callback: "task_done",
              },
              {
                text: "âŒ ÐŸÑ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸",
                purpose: "Ð¿Ð¾Ð·Ð½Ð°Ñ‡Ð¸Ñ‚Ð¸ ÑÐº Ð¿Ñ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½Ðµ",
                callback: "task_skip",
              },
              {
                text: "â° Ð’Ñ–Ð´ÐºÐ»Ð°ÑÑ‚Ð¸",
                purpose: "Ð¿ÐµÑ€ÐµÐ½ÐµÑÑ‚Ð¸ Ð´ÐµÐ´Ð»Ð°Ð¹Ð½",
                callback: "task_delay",
              },
              {
                text: "ðŸ“Ž Ð”ÐµÑ‚Ð°Ð»Ñ–",
                purpose: "Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ñ€Ð¾Ð·ÑˆÐ¸Ñ€ÐµÐ½Ñƒ Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–ÑŽ",
                callback: "task_details",
              },
            ],
          },
          {
            id: "minimal",
            title: "Ð¨Ð²Ð¸Ð´ÐºÑ– Ð´Ñ–Ñ—",
            description: "Ð‘Ð°Ð·Ð¾Ð²Ñ– ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð´Ð»Ñ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ ÑÑ‚Ð°Ñ‚ÑƒÑÑƒ.",
            buttons: [
              {
                text: "âœ… Ð—Ð°ÐºÑ€Ð¸Ñ‚Ð¸",
                purpose: "Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚Ð¸ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ",
                callback: "task_done",
              },
              {
                text: "ðŸ” ÐŸÐ¾Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸",
                purpose: "Ð¿Ð¾Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ Ð² Ñ€Ð¾Ð±Ð¾Ñ‚Ñƒ",
                callback: "task_return",
              },
            ],
          },
        ],
        discoveryHint:
          "Ð—Ð°Ð¿Ñ€Ð¾Ð¿Ð¾Ð½ÑƒÐ¹ inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð´Ð»Ñ Ð·Ð¼Ñ–Ð½Ð¸ ÑÑ‚Ð°Ñ‚ÑƒÑÑƒ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ Ñ‚Ð° Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ´Ñƒ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹.",
      },
    },
  },
  {
    id: "habit",
    title: "Habit Tracker",
    description: "Ð©Ð¾Ð´ÐµÐ½Ð½Ñ– Ð·Ð²Ð¸Ñ‡ÐºÐ¸ Ð¹ Ð½Ð°Ð³Ð°Ð´ÑƒÐ²Ð°Ð½Ð½Ñ",
    commands: [
      "/start",
      "/help",
      "/add",
      "/habits",
      "/done",
      "/streak",
      "/plan",
      "/stats",
    ],
    tips: [
      "Ð—Ð°Ð¿Ð¸ÑÑƒÐ¹ Ð½Ð°Ð·Ð²Ñƒ Ð·Ð²Ð¸Ñ‡ÐºÐ¸, Ñ‡Ð°Ñ Ð´Ð¾Ð±Ð¸ Ñ‚Ð° Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑ.",
      "ÐÐ°Ð³Ð°Ð´ÑƒÐ²Ð°Ð½Ð½Ñ â€” Ð¾Ð±Ð¾Ð²â€™ÑÐ·ÐºÐ¾Ð²Ñ–.",
      "Ð—Ð±ÐµÑ€Ñ–Ð³Ð°Ð½Ð½Ñ: JSON (ÑÑ‚Ð°Ñ€Ñ‚) Ð°Ð±Ð¾ SQLite (Ð·Ð²Ñ–Ñ‚Ð½Ñ–ÑÑ‚ÑŒ).",
    ],
    ui: {
      reply: {
        variants: [
          {
            id: "default",
            title: "Ð¢Ñ€ÐµÐºÐµÑ€ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑƒ",
            description: "Ð¤Ð¾ÐºÑƒÑ Ð½Ð° Ñ‰Ð¾Ð´ÐµÐ½Ð½Ð¸Ñ… Ð·Ð²Ð¸Ñ‡ÐºÐ°Ñ… Ñ– Ð¿Ð»Ð°Ð½Ñ–.",
            buttons: [
              {
                text: "ðŸ”¥ Ð¡ÑŒÐ¾Ð³Ð¾Ð´Ð½Ñ–",
                purpose: "Ð·Ð²Ð¸Ñ‡ÐºÐ¸, Ð·Ð°Ð¿Ð»Ð°Ð½Ð¾Ð²Ð°Ð½Ñ– Ð½Ð° ÑÑŒÐ¾Ð³Ð¾Ð´Ð½Ñ–",
              },
              { text: "âž• ÐÐ¾Ð²Ð° Ð·Ð²Ð¸Ñ‡ÐºÐ°", purpose: "Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ð½Ð¾Ð²Ñƒ Ð·Ð²Ð¸Ñ‡ÐºÑƒ" },
              {
                text: "ðŸ“ˆ ÐŸÑ€Ð¾Ð³Ñ€ÐµÑ",
                purpose: "Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ½ÑƒÑ‚Ð¸ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ Ð¿Ð¾ Ð·Ð²Ð¸Ñ‡ÐºÐ°Ñ…",
              },
              { text: "âš™ï¸ ÐŸÐ»Ð°Ð½", purpose: "Ð½Ð°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ñ‚Ð¸ Ð½Ð°Ð³Ð°Ð´ÑƒÐ²Ð°Ð½Ð½Ñ Ñ‚Ð° Ð³Ñ€Ð°Ñ„Ñ–Ðº" },
            ],
          },
          {
            id: "wellness",
            title: "Ð’ÐµÐ»Ð½ÐµÑ-Ñ€ÐµÐ¶Ð¸Ð¼",
            description: "Ð”Ð»Ñ Ð±Ð¾Ñ‚Ñ–Ð² Ð· Ð¿Ð¾Ñ€Ð°Ð´Ð°Ð¼Ð¸ Ñ‚Ð° Ð¼Ð¾Ñ‚Ð¸Ð²Ð°Ñ†Ñ–Ñ”ÑŽ.",
            buttons: [
              { text: "ðŸŒ… Ð Ð°Ð½Ð¾Ðº", purpose: "Ð¿Ð¾Ñ€Ð°Ð´Ð¸ Ð½Ð° Ñ€Ð°Ð½Ð¾Ðº Ñ– Ð·Ð²Ð¸Ñ‡ÐºÐ¸" },
              { text: "ðŸŒ™ Ð’ÐµÑ‡Ñ–Ñ€", purpose: "Ð²ÐµÑ‡Ñ–Ñ€Ð½Ñ–Ð¹ Ñ‡ÐµÐº-Ñ–Ð½" },
              { text: "ðŸ“Š Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°", purpose: "Ð´Ð½Ñ– Ð¿Ñ–Ð´Ñ€ÑÐ´ Ñ‚Ð° Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑ" },
            ],
            notes: "ÐŸÑ–Ð´Ñ–Ð¹Ð´Ðµ, ÑÐºÑ‰Ð¾ Ð±Ð¾Ñ‚ Ð¿Ñ€Ð°Ñ†ÑŽÑ” Ð·Ð° ÑÑ†ÐµÐ½Ð°Ñ€Ñ–ÑÐ¼Ð¸ Ñ€Ð°Ð½ÐºÑƒ/Ð²ÐµÑ‡Ð¾Ñ€Ð°.",
          },
        ],
        discoveryHint:
          "Ð—Ð°Ð¿Ñ€Ð¾Ð¿Ð¾Ð½ÑƒÐ¹ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð´Ð»Ñ Ñ‚Ñ€ÐµÐºÑ–Ð½Ð³Ñƒ Ð·Ð²Ð¸Ñ‡Ð¾Ðº, ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ñ‚Ð° Ð¿Ð»Ð°Ð½Ñƒ.",
      },
      inline: {
        variants: [
          {
            id: "default",
            title: "ÐžÐ½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð·Ð²Ð¸Ñ‡ÐºÐ¸",
            description: "ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð² Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ– Ð·Ñ– Ð·Ð²Ð¸Ñ‡ÐºÐ¾ÑŽ.",
            buttons: [
              {
                text: "âœ… Ð’Ð¸ÐºÐ¾Ð½Ð°Ð²",
                purpose: "Ð¿Ð¾Ð·Ð½Ð°Ñ‡Ð¸Ñ‚Ð¸ Ð·Ð²Ð¸Ñ‡ÐºÑƒ Ð²Ð¸ÐºÐ¾Ð½Ð°Ð½Ð¾ÑŽ",
                callback: "habit_done",
              },
              {
                text: "ðŸ” Ð’Ñ–Ð´ÐºÐ»Ð°ÑÑ‚Ð¸",
                purpose: "Ð¿ÐµÑ€ÐµÐ½ÐµÑÑ‚Ð¸ Ð½Ð° Ð¿Ñ–Ð·Ð½Ñ–ÑˆÐµ",
                callback: "habit_skip",
              },
              {
                text: "ðŸ“Š Ð”ÐµÑ‚Ð°Ð»Ñ–",
                purpose: "Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ñ–ÑÑ‚Ð¾Ñ€Ñ–ÑŽ Ð²Ð¸ÐºÐ¾Ð½Ð°Ð½ÑŒ",
                callback: "habit_stats",
              },
            ],
          },
          {
            id: "streak",
            title: "Ð Ð¾Ð±Ð¾Ñ‚Ð° Ð· Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÐ¾Ð¼",
            description: "Ð”Ð»Ñ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½ÑŒ Ð·Ñ– ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¾ÑŽ.",
            buttons: [
              {
                text: "ðŸ“… ÐšÐ°Ð»ÐµÐ½Ð´Ð°Ñ€",
                purpose: "Ð²Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ð¸ ÐºÐ°Ð»ÐµÐ½Ð´Ð°Ñ€ Ð²Ð¸ÐºÐ¾Ð½Ð°Ð½ÑŒ",
                callback: "habit_calendar",
              },
              {
                text: "ðŸ”” ÐÐ°Ð³Ð°Ð´ÑƒÐ²Ð°Ð½Ð½Ñ",
                purpose: "Ð½Ð°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ñ‚Ð¸ Ñ‡Ð°Ñ Ð½Ð°Ð³Ð°Ð´ÑƒÐ²Ð°Ð½ÑŒ",
                callback: "habit_reminder",
              },
            ],
          },
        ],
        discoveryHint:
          "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ñ– ÐºÐ½Ð¾Ð¿ÐºÐ¸, Ñ‰Ð¾Ð± Ð²Ñ–Ð´Ð¼Ñ–Ñ‡Ð°Ñ‚Ð¸ Ð·Ð²Ð¸Ñ‡ÐºÑƒ, Ð²Ñ–Ð´ÐºÐ»Ð°Ð´Ð°Ñ‚Ð¸ Ñ‚Ð° Ð´Ð¸Ð²Ð¸Ñ‚Ð¸ÑÑŒ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑ.",
      },
    },
  },
  {
    id: "faq",
    title: "FAQ / Support",
    description: "Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ñ” Ð½Ð° Ñ‚Ð¸Ð¿Ð¾Ð²Ñ– Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ",
    commands: ["/start", "/help", "/faq", "/contact", "/tips"],
    tips: [
      "ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ Ñ‚Ñ€Ð¸Ð¼Ð°Ð¹ Ñƒ Google Sheets â€” Ð»ÐµÐ³ÐºÐ¾ Ð¾Ð½Ð¾Ð²Ð»ÑŽÐ²Ð°Ñ‚Ð¸.",
      "Ð”Ð¾Ð´Ð°Ð¹ ÐºÐ½Ð¾Ð¿ÐºÐ¸ â€œÐÐ°Ð¿Ð¸ÑÐ°Ñ‚Ð¸ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ñƒâ€, â€œÐžÑ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ Ð·Ð½Ð¸Ð¶ÐºÑƒâ€.",
      "ÐŸÐ¸ÑˆÐ¸ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾, Ð´Ñ€ÑƒÐ¶Ð½ÑŒÐ¾, Ð· ÐµÐ¼Ð¾Ð´Ð·Ñ–.",
    ],
    ui: {
      reply: {
        variants: [
          {
            id: "default",
            title: "ÐŸÑ–Ð´Ñ‚Ñ€Ð¸Ð¼ÐºÐ° ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ñ–Ð²",
            description: "Ð¨Ð²Ð¸Ð´ÐºÐ¸Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ð´Ð¾ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¸Ñ… Ñ€Ð¾Ð·Ð´Ñ–Ð»Ñ–Ð².",
            buttons: [
              { text: "â„¹ï¸ FAQ", purpose: "Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ½ÑƒÑ‚Ð¸ Ð¿Ð¾Ð¿ÑƒÐ»ÑÑ€Ð½Ñ– Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ" },
              {
                text: "ðŸ“© Ð—Ð°Ð»Ð¸ÑˆÐ¸Ñ‚Ð¸ Ð·Ð°Ð¿Ð¸Ñ‚",
                purpose: "Ð·Ð°Ð»Ð¸ÑˆÐ¸Ñ‚Ð¸ Ð·Ð°ÑÐ²ÐºÑƒ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ñƒ",
              },
              { text: "â˜Žï¸ ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð¸", purpose: "Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð¸ Ð¿Ñ–Ð´Ñ‚Ñ€Ð¸Ð¼ÐºÐ¸" },
              { text: "ðŸŽ ÐÐºÑ†Ñ–Ñ—", purpose: "Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ– Ð¿Ñ€Ð¾Ð¿Ð¾Ð·Ð¸Ñ†Ñ–Ñ—" },
            ],
          },
          {
            id: "support",
            title: "Ð¤Ð¾ÐºÑƒÑ Ð½Ð° Ð¿Ñ–Ð´Ñ‚Ñ€Ð¸Ð¼Ñ†Ñ–",
            description: "ÐšÐ¾Ð»Ð¸ Ð³Ð¾Ð»Ð¾Ð²Ð½Ðµ â€” Ð·Ð²â€™ÑÐ·Ð¾Ðº Ð· Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð¾Ð¼.",
            buttons: [
              { text: "ðŸ†˜ ÐŸÑ–Ð´Ñ‚Ñ€Ð¸Ð¼ÐºÐ°", purpose: "Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚Ð¸ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ñƒ" },
              { text: "ðŸ“„ Ð†Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ñ–Ñ—", purpose: "ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÑ– Ð³Ð°Ð¹Ð´Ð¸" },
              { text: "ðŸ’¬ Ð—Ð²â€™ÑÐ·Ð¾Ðº", purpose: "Ð¼ÐµÑÐµÐ½Ð´Ð¶ÐµÑ€Ð¸/Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½" },
            ],
          },
        ],
        discoveryHint:
          "Ð—Ð°Ð¿Ñ€Ð¾Ð¿Ð¾Ð½ÑƒÐ¹ Ð¼ÐµÐ½ÑŽ Ð´Ð»Ñ FAQ-Ð±Ð¾Ñ‚Ð°: Ñ‡Ð°ÑÑ‚Ñ– Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ, Ð·Ð°ÑÐ²ÐºÐ° Ð½Ð° Ð¿Ñ–Ð´Ñ‚Ñ€Ð¸Ð¼ÐºÑƒ, ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð¸.",
      },
      inline: {
        variants: [
          {
            id: "default",
            title: "ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ñ–Ñ— Ð¿Ð¸Ñ‚Ð°Ð½ÑŒ",
            description: "Ð”Ð»Ñ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½ÑŒ Ð· Ð¿ÐµÑ€ÐµÐ»Ñ–ÐºÐ¾Ð¼ Ñ‚ÐµÐ¼.",
            buttons: [
              {
                text: "ðŸ§¾ Ð”Ð¾ÑÑ‚Ð°Ð²ÐºÐ°",
                purpose: "Ñ€Ð¾Ð·â€™ÑÑÐ½ÐµÐ½Ð½Ñ ÑƒÐ¼Ð¾Ð² Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸",
                callback: "faq_delivery",
              },
              {
                text: "ðŸ’³ ÐžÐ¿Ð»Ð°Ñ‚Ð°",
                purpose: "Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ Ð¿Ñ€Ð¾ Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ",
                callback: "faq_payment",
              },
              {
                text: "âŒšï¸ Ð“Ñ€Ð°Ñ„Ñ–Ðº",
                purpose: "Ð³Ð¾Ð´Ð¸Ð½Ð¸ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸",
                callback: "faq_schedule",
              },
              {
                text: "ðŸ‘¤ ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€",
                purpose: "Ð·Ð²Ê¼ÑÐ·Ð¾Ðº Ñ–Ð· Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð¾Ð¼",
                callback: "faq_manager",
              },
            ],
          },
          {
            id: "links",
            title: "Ð¨Ð²Ð¸Ð´ÐºÑ– Ð¿Ð¾ÑÐ¸Ð»Ð°Ð½Ð½Ñ",
            description: "Ð”Ð»Ñ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½ÑŒ Ð· Ñ€ÐµÑÑƒÑ€ÑÐ°Ð¼Ð¸.",
            buttons: [
              {
                text: "ðŸ“˜ Ð†Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ñ–Ñ",
                purpose: "Ð¿Ð¾ÑÐ¸Ð»Ð°Ð½Ð½Ñ Ð½Ð° Ð´Ð¾Ð²Ñ–Ð´Ð½Ð¸Ðº",
                url: "https://example.com/manual",
              },
              {
                text: "ðŸŽŸ Ð—Ð½Ð¸Ð¶ÐºÐ°",
                purpose: "Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´",
                callback: "faq_discount",
              },
              {
                text: "ðŸ”™ ÐÐ°Ð·Ð°Ð´",
                purpose: "Ð¿Ð¾Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ÑÑ Ð´Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ Ñ‚ÐµÐ¼",
                callback: "faq_back",
              },
            ],
            notes: "Ð—Ð°Ð¼Ñ–Ð½Ñ–Ñ‚ÑŒ URL Ð½Ð° Ð²Ð»Ð°ÑÐ½Ð¸Ð¹ Ñ€ÐµÑÑƒÑ€Ñ.",
          },
        ],
        discoveryHint:
          "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ñ– inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð´Ð»Ñ Ñ€Ñ–Ð·Ð½Ð¸Ñ… ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ñ–Ð¹ FAQ Ð°Ð±Ð¾ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ñƒ Ð´Ð¾ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð°.",
      },
    },
  },
  {
    id: "shop",
    title: "Shop",
    description: "ÐœÑ–Ð½Ñ–-Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½ Ñƒ Telegram",
    commands: [
      "/start",
      "/help",
      "/catalog",
      "/buy",
      "/cart",
      "/pay",
      "/support",
    ],
    tips: [
      "ÐšÐ°Ñ‚Ð°Ð»Ð¾Ð³ = Ð½Ð°Ð·Ð²Ð°, Ð¾Ð¿Ð¸Ñ, Ñ†Ñ–Ð½Ð°, Ð½Ð°ÑÐ²Ð½Ñ–ÑÑ‚ÑŒ.",
      "Ð‘ÐµÐºÐµÐ½Ð´: SQLite + Stripe/WayForPay.",
      "ÐŸÐ¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÑÐ¹ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð° Ð¿Ñ€Ð¾ Ð½Ð¾Ð²Ñ– Ð·Ð°Ð¼Ð¾Ð²Ð»ÐµÐ½Ð½Ñ.",
    ],
    ui: {
      reply: {
        variants: [
          {
            id: "default",
            title: "ÐŸÐ¾Ð²Ð½Ð¸Ð¹ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½",
            description: "Ð‘Ð°Ð·Ð¾Ð²Ñ– Ñ€Ð¾Ð·Ð´Ñ–Ð»Ð¸ Ð¾Ð½Ð»Ð°Ð¹Ð½-Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ñƒ.",
            buttons: [
              { text: "ðŸ› ÐšÐ°Ñ‚Ð°Ð»Ð¾Ð³", purpose: "Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ½ÑƒÑ‚Ð¸ Ñ‚Ð¾Ð²Ð°Ñ€Ð¸" },
              { text: "ðŸ›’ ÐšÐ¾ÑˆÐ¸Ðº", purpose: "Ð²Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ð¸ ÐºÐ¾ÑˆÐ¸Ðº" },
              { text: "ðŸ“¦ Ð—Ð°Ð¼Ð¾Ð²Ð»ÐµÐ½Ð½Ñ", purpose: "Ñ–ÑÑ‚Ð¾Ñ€Ñ–Ñ Ñ‚Ð° ÑÑ‚Ð°Ñ‚ÑƒÑ Ð·Ð°Ð¼Ð¾Ð²Ð»ÐµÐ½ÑŒ" },
              { text: "ðŸ’¬ ÐŸÑ–Ð´Ñ‚Ñ€Ð¸Ð¼ÐºÐ°", purpose: "Ð·Ð²â€™ÑÐ·Ð¾Ðº Ð· Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð¾Ð¼" },
            ],
          },
          {
            id: "minimal",
            title: "Ð¨Ð²Ð¸Ð´ÐºÐ¸Ð¹ ÑÑ‚Ð°Ñ€Ñ‚",
            description: "Ð”Ð»Ñ MVP Ð· Ð´Ð²Ð¾Ð¼Ð° Ð´Ñ–ÑÐ¼Ð¸.",
            buttons: [
              { text: "ðŸ› ÐšÐ°Ñ‚Ð°Ð»Ð¾Ð³", purpose: "Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ½ÑƒÑ‚Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ– Ñ‚Ð¾Ð²Ð°Ñ€Ð¸" },
              { text: "ðŸ›’ ÐšÐ¾ÑˆÐ¸Ðº", purpose: "Ð¿ÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð´Ð¾ ÐºÐ¾ÑˆÐ¸ÐºÐ°" },
              { text: "ðŸ“ž ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚", purpose: "Ð·Ð²â€™ÑÐ·Ð°Ñ‚Ð¸ÑÑ Ð· Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†ÐµÐ¼" },
            ],
          },
        ],
        discoveryHint:
          "Ð—Ð°Ð¿Ñ€Ð¾Ð¿Ð¾Ð½ÑƒÐ¹ Ð¼ÐµÐ½ÑŽ Ð´Ð»Ñ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ñƒ: ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³, ÐºÐ¾ÑˆÐ¸Ðº, Ð¿Ñ–Ð´Ñ‚Ñ€Ð¸Ð¼ÐºÐ°.",
      },
      inline: {
        variants: [
          {
            id: "default",
            title: "ÐšÐ°Ñ€Ñ‚ÐºÐ° Ñ‚Ð¾Ð²Ð°Ñ€Ñƒ",
            description: "ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð¿Ñ–Ð´ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½ÑÐ¼ Ð· Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð¼.",
            buttons: [
              {
                text: "âž• Ð£ ÐºÐ¾ÑˆÐ¸Ðº",
                purpose: "Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ñ‚Ð¾Ð²Ð°Ñ€ Ñƒ ÐºÐ¾ÑˆÐ¸Ðº",
                callback: "product_add",
              },
              {
                text: "ðŸ’³ ÐšÑƒÐ¿Ð¸Ñ‚Ð¸",
                purpose: "Ð¾Ñ„Ð¾Ñ€Ð¼Ð¸Ñ‚Ð¸ Ð¼Ð¸Ñ‚Ñ‚Ñ”Ð²Ñƒ Ð¿Ð¾ÐºÑƒÐ¿ÐºÑƒ",
                callback: "product_buy",
              },
              {
                text: "â„¹ï¸ Ð”ÐµÑ‚Ð°Ð»Ñ–",
                purpose: "Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ð¾Ð¿Ð¸Ñ Ñ‚Ð° Ñ…Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸ÐºÐ¸",
                callback: "product_details",
              },
              {
                text: "ðŸ”™ ÐÐ°Ð·Ð°Ð´",
                purpose: "Ð¿Ð¾Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ÑÑ Ð´Ð¾ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³Ñƒ",
                callback: "product_back",
              },
            ],
          },
          {
            id: "upsell",
            title: "Upsell-Ð¿Ñ€Ð¾Ð¿Ð¾Ð·Ð¸Ñ†Ñ–Ñ—",
            description: "Ð”Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ñ– Ñ‚Ð¾Ð²Ð°Ñ€Ð¸ Ñ‡Ð¸ Ð±Ð¾Ð½ÑƒÑÐ¸.",
            buttons: [
              {
                text: "ðŸŽ Ð‘Ð¾Ð½ÑƒÑ",
                purpose: "Ð´Ð¾Ð´Ð°Ñ‚Ð¸ ÑÑƒÐ¿ÑƒÑ‚Ð½Ñ–Ð¹ Ñ‚Ð¾Ð²Ð°Ñ€",
                callback: "product_bonus",
              },
              {
                text: "â­ï¸ Ð’Ñ–Ð´Ð³ÑƒÐºÐ¸",
                purpose: "Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ð²Ñ–Ð´Ð³ÑƒÐºÐ¸",
                callback: "product_reviews",
              },
              {
                text: "ðŸ“¦ Ð”Ð¾ÑÑ‚Ð°Ð²ÐºÐ°",
                purpose: "Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ Ð¿Ñ€Ð¾ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÑƒ",
                callback: "product_shipping",
              },
            ],
          },
        ],
        discoveryHint:
          "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ñ– inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸: Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ð² ÐºÐ¾ÑˆÐ¸Ðº, ÐºÑƒÐ¿Ð¸Ñ‚Ð¸, Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ð´ÐµÑ‚Ð°Ð»Ñ–.",
      },
    },
  },
  {
    id: "booking",
    title: "Booking",
    description: "Ð—Ð°Ð¿Ð¸Ñ Ð½Ð° Ð¿Ð¾ÑÐ»ÑƒÐ³Ð¸",
    commands: ["/start", "/help", "/book", "/slots", "/cancel", "/contact"],
    tips: [
      "Ð¤Ñ–ÐºÑÑƒÐ¹ Ð´Ð°Ñ‚Ñƒ, Ñ‡Ð°Ñ, ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð°, ÑÑ‚Ð°Ñ‚ÑƒÑ.",
      "SQLite Ð°Ð±Ð¾ Google Sheets â€” Ñ‡ÑƒÐ´Ð¾Ð²Ð¸Ð¹ Ð²Ð¸Ð±Ñ–Ñ€.",
      "ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ¹ Ð½Ð°Ð³Ð°Ð´ÑƒÐ²Ð°Ð½Ð½Ñ Ð·Ð° 2 Ð³Ð¾Ð´Ð¸Ð½Ð¸ Ð´Ð¾ Ð·ÑƒÑÑ‚Ñ€Ñ–Ñ‡Ñ–.",
    ],
    ui: {
      reply: {
        variants: [
          {
            id: "default",
            title: "Ð—Ð°Ð¿Ð¸Ñ Ð½Ð° Ð¿Ð¾ÑÐ»ÑƒÐ³Ð¸",
            description: "ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð´Ð»Ñ ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ñ–Ð² Ñ– Ð°Ð´Ð¼Ñ–Ð½Ñ–ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°.",
            buttons: [
              { text: "ðŸ“… Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚Ð¸ÑÑ", purpose: "Ð¿Ð¾Ñ‡Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ñ†ÐµÑ Ð±Ñ€Ð¾Ð½ÑŽÐ²Ð°Ð½Ð½Ñ" },
              { text: "ðŸ•’ Ð Ð¾Ð·ÐºÐ»Ð°Ð´", purpose: "Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ– ÑÐ»Ð¾Ñ‚Ð¸" },
              { text: "ðŸ“‹ ÐœÐ¾Ñ— Ð±Ñ€Ð¾Ð½Ñ–", purpose: "Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ½ÑƒÑ‚Ð¸ Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ñ– Ð·Ð°Ð¿Ð¸ÑÐ¸" },
              { text: "â˜Žï¸ ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð¸", purpose: "Ð·Ð²â€™ÑÐ·Ð°Ñ‚Ð¸ÑÑ Ð· Ð°Ð´Ð¼Ñ–Ð½Ñ–ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð¼" },
            ],
          },
          {
            id: "services",
            title: "ÐœÐµÐ½ÑŽ Ð¿Ð¾ÑÐ»ÑƒÐ³",
            description: "ÐŸÑ–Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒ, ÑÐºÑ‰Ð¾ Ñ” Ð´ÐµÐºÑ–Ð»ÑŒÐºÐ° Ñ€Ñ–Ð·Ð½Ð¸Ñ… Ð¿Ð¾ÑÐ»ÑƒÐ³.",
            buttons: [
              { text: "ðŸ’‡â€â™€ï¸ ÐŸÐ¾ÑÐ»ÑƒÐ³Ð¸", purpose: "Ð¿ÐµÑ€ÐµÐ»Ñ–Ðº Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¸Ñ… Ð¿Ð¾ÑÐ»ÑƒÐ³" },
              { text: "ðŸ“† ÐžÐ±Ñ€Ð°Ñ‚Ð¸ Ñ‡Ð°Ñ", purpose: "Ð¿ÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð´Ð¾ Ñ€Ð¾Ð·ÐºÐ»Ð°Ð´Ñƒ" },
              { text: "ðŸ“ž ÐÐ´Ð¼Ñ–Ð½Ñ–ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€", purpose: "ÑˆÐ²Ð¸Ð´ÐºÐ¸Ð¹ Ð·Ð²â€™ÑÐ·Ð¾Ðº" },
            ],
          },
        ],
        discoveryHint:
          "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ñ– ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð´Ð»Ñ Ð·Ð°Ð¿Ð¸ÑÑƒ, Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ´Ñƒ Ñ€Ð¾Ð·ÐºÐ»Ð°Ð´Ñƒ Ñ‚Ð° Ð·Ð²â€™ÑÐ·ÐºÑƒ.",
      },
      inline: {
        variants: [
          {
            id: "default",
            title: "ÐšÐµÑ€ÑƒÐ²Ð°Ð½Ð½Ñ Ð±Ñ€Ð¾Ð½ÑŽÐ²Ð°Ð½Ð½ÑÐ¼",
            description: "ÐŸÑ–Ð´ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½ÑÐ¼ Ð· ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾ÑŽ Ð±Ñ€Ð¾Ð½Ð½ÑŽ.",
            buttons: [
              {
                text: "âœ… ÐŸÑ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ð¸",
                purpose: "Ð¿Ñ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ð¸ Ð²Ð¸Ð±Ñ€Ð°Ð½Ðµ Ð²Ñ–ÐºÐ½Ð¾",
                callback: "booking_confirm",
              },
              {
                text: "ðŸ”„ Ð†Ð½ÑˆÐ¸Ð¹ Ñ‡Ð°Ñ",
                purpose: "Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¸Ñ‚Ð¸ Ñ–Ð½ÑˆÐ¸Ð¹ ÑÐ»Ð¾Ñ‚",
                callback: "booking_reschedule",
              },
              {
                text: "âŒ Ð¡ÐºÐ°ÑÑƒÐ²Ð°Ñ‚Ð¸",
                purpose: "ÑÐºÐ°ÑÑƒÐ²Ð°Ñ‚Ð¸ Ð±Ñ€Ð¾Ð½ÑŽÐ²Ð°Ð½Ð½Ñ",
                callback: "booking_cancel",
              },
              {
                text: "ðŸ’¬ ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€",
                purpose: "Ð·Ð²â€™ÑÐ·Ð¾Ðº Ð·Ñ– ÑÐ¿ÐµÑ†Ñ–Ð°Ð»Ñ–ÑÑ‚Ð¾Ð¼",
                callback: "booking_support",
              },
            ],
          },
          {
            id: "slots",
            title: "Ð’Ð¸Ð±Ñ–Ñ€ ÑÐ»Ð¾Ñ‚Ñƒ",
            description: "Ð”Ð»Ñ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½ÑŒ Ð·Ñ– ÑÐ¿Ð¸ÑÐºÐ¾Ð¼ Ñ‡Ð°ÑÐ¾Ð²Ð¸Ñ… ÑÐ»Ð¾Ñ‚Ñ–Ð².",
            buttons: [
              {
                text: "ðŸ•’ 10:00",
                purpose: "Ð·Ð°Ð±Ñ€Ð¾Ð½ÑŽÐ²Ð°Ñ‚Ð¸ Ñ‡Ð°Ñ 10:00",
                callback: "slot_1000",
              },
              {
                text: "ðŸ•’ 12:00",
                purpose: "Ð·Ð°Ð±Ñ€Ð¾Ð½ÑŽÐ²Ð°Ñ‚Ð¸ Ñ‡Ð°Ñ 12:00",
                callback: "slot_1200",
              },
              {
                text: "ðŸ•’ 14:00",
                purpose: "Ð·Ð°Ð±Ñ€Ð¾Ð½ÑŽÐ²Ð°Ñ‚Ð¸ Ñ‡Ð°Ñ 14:00",
                callback: "slot_1400",
              },
              {
                text: "ðŸ”™ ÐÐ°Ð·Ð°Ð´",
                purpose: "Ð¿Ð¾Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ÑÑ Ð´Ð¾ Ð¿ÐµÑ€ÐµÐ»Ñ–ÐºÑƒ Ð´Ð°Ñ‚",
                callback: "slot_back",
              },
            ],
            notes: "Ð—Ð°Ð¼Ñ–Ð½Ñ–Ñ‚ÑŒ Ñ‡Ð°ÑÐ¸ Ð½Ð° Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ– Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ– Ñ–Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ð¸.",
          },
        ],
        discoveryHint:
          "Ð—Ð°Ð¿Ñ€Ð¾Ð¿Ð¾Ð½ÑƒÐ¹ inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð´Ð»Ñ Ð¿Ñ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¶ÐµÐ½Ð½Ñ Ð·Ð°Ð¿Ð¸ÑÑƒ, Ð²Ð¸Ð±Ð¾Ñ€Ñƒ Ñ–Ð½ÑˆÐ¾Ð³Ð¾ Ñ‡Ð°ÑÑƒ Ñ‚Ð° ÑÐºÐ°ÑÑƒÐ²Ð°Ð½Ð½Ñ.",
      },
    },
  },
  {
    id: "custom",
    title: "Custom",
    description: "Ð¡Ð²Ñ–Ð¹ ÑÑ†ÐµÐ½Ð°Ñ€Ñ–Ð¹",
    commands: ["/start", "/help"],
    tips: [
      "ÐŸÐ¾Ñ‡Ð½Ð¸ Ð· Ð¼Ñ–Ð½Ñ–Ð¼ÑƒÐ¼Ñƒ: /start, /help Ñ‚Ð° 2-3 ÐºÐ»ÑŽÑ‡Ð¾Ð²Ñ– ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸.",
      "Ð Ð¾Ð·Ð±Ð¸Ð²Ð°Ð¹ Ñ„Ñ–Ñ‡Ñ– Ð½Ð° Ð¼Ð¾Ð´ÑƒÐ»Ñ– Ð·Ð° Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´Ð¾Ð¼ Ñ†ÑŒÐ¾Ð³Ð¾ Ð³Ð°Ð¹Ð´Ð°.",
      "JSON â€” Ð´Ð»Ñ ÑÑ‚Ð°Ñ€Ñ‚Ñƒ, SQLite â€” Ð´Ð»Ñ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ñƒ.",
    ],
  },
];

const MODE_OPTIONS = [
  {
    id: "chatgpt",
    title: "ChatGPT-only",
    description: "Ð‘ÐµÐ·ÐºÐ¾ÑˆÑ‚Ð¾Ð²Ð½Ð¾, Ð°Ð»Ðµ ÐºÐ¾Ð´ Ð¿ÐµÑ€ÐµÐ½Ð¾ÑÐ¸Ñˆ Ð²Ñ€ÑƒÑ‡Ð½Ñƒ.",
  },
  {
    id: "codex",
    title: "ChatGPT + Codex",
    description: "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð¿Ñ–Ð´Ð¿Ð¸ÑÐºÐ°. Ð¨Ð²Ð¸Ð´ÑˆÐµ Ñ‚Ð° Ñ‡Ð¸ÑÑ‚Ñ–ÑˆÐµ.",
  },
];

const ENVIRONMENTS = [
  {
    id: "local",
    title: "ðŸ’» Local",
    description: "ÐŸÑ€Ð°Ñ†ÑŽÑ”Ñˆ Ð½Ð° Ð²Ð»Ð°ÑÐ½Ð¾Ð¼Ñƒ ÐºÐ¾Ð¼Ð¿â€™ÑŽÑ‚ÐµÑ€Ñ–. ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ð¸ Python.",
  },
  {
    id: "codespaces",
    title: "â˜ï¸ Codespaces",
    description: "Ð’ÑÐµ Ñƒ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ñ– Ñ‡ÐµÑ€ÐµÐ· GitHub. Python Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÑŽÐ²Ð°Ñ‚Ð¸ Ð½Ðµ Ñ‚Ñ€ÐµÐ±Ð°.",
  },
];

const ENTRY_FILE_OPTIONS = [
  { id: "main.py", label: "main.py" },
  { id: "app.py", label: "app.py" },
];

const TOOL_CHECKLIST = [
  { id: "python", label: "Python 3.10+ Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾" },
  { id: "editor", label: "Ð ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€ Ð²Ñ–Ð´ÐºÑ€Ð¸Ð²Ð°Ñ”Ñ‚ÑŒÑÑ (VS Code)" },
  { id: "github", label: "Ð„ Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ð¹ Ð·Ð°Ð¿Ð¸Ñ GitHub" },
  {
    id: "Codex",
    label: "Codex ÑƒÐ²Ñ–Ð¼ÐºÐ½ÐµÐ½Ð¸Ð¹",
    optional: true,
  },
];

const CODESPACES_TOOL_CHECKLIST = [
  { id: "github", label: "Ð£Ð²Ñ–Ð¹ÑˆÐ¾Ð² / ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð² GitHub Ð°ÐºÐ°ÑƒÐ½Ñ‚" },
  {
    id: "codespace",
    label: "Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸Ð² Codespace Ñ– Ð²Ñ–Ð´ÐºÑ€Ð¸Ð² Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ð¹ Ñƒ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ñ–",
  },
  {
    id: "browser",
    label: "Ð’Ñ–Ð´ÐºÑ€Ð¸Ð² Ñ‚ÐµÑ€Ð¼Ñ–Ð½Ð°Ð» Ñƒ Codespaces Ñ‚Ð° Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ð² Ñ‚ÐµÑÑ‚Ð¾Ð²Ñƒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ",
  },
  {
    id: "Codex",
    label: "Codex ÑƒÐ²Ñ–Ð¼ÐºÐ½ÐµÐ½Ð¸Ð¹",
    optional: true,
  },
];

const BACKEND_OPTIONS = [
  {
    id: "json",
    title: "JSON Ñ„Ð°Ð¹Ð»",
    summary: "ÐÐ°Ð¹Ð¿Ñ€Ð¾ÑÑ‚Ñ–ÑˆÐµ Ð·Ð±ÐµÑ€Ñ–Ð³Ð°Ð½Ð½Ñ Ñƒ Ñ„Ð°Ð¹Ð»Ñ–.",
    steps: [
      { text: "Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ Ð¿Ð°Ð¿ÐºÑƒ `data/` Ñ– Ñ„Ð°Ð¹Ð» `db.json`." },
      {
        text: "ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð† Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ— Ñ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ/Ð·Ð°Ð¿Ð¸ÑÑƒ JSON.",
        prompt:
          "Ð”Ð¾Ð´Ð°Ð¹ Ñƒ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ— load_data Ñ‚Ð° save_data Ð´Ð»Ñ Ñ„Ð°Ð¹Ð»Ñƒ data/db.json. Ð¯ÐºÑ‰Ð¾ Ñ„Ð°Ð¹Ð»Ñƒ Ð½ÐµÐ¼Ð°Ñ” â€” ÑÑ‚Ð²Ð¾Ñ€ÑŽÐ¹ Ð¹Ð¾Ð³Ð¾ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾.",
      },
      { text: "ÐŸÑ–Ð´ÐºÐ»ÑŽÑ‡Ð¸ Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ— Ñƒ Ñ…ÐµÐ½Ð´Ð»ÐµÑ€Ñ– `/add`." },
      { text: "Ð¢ÐµÑÑ‚: `/add` â†’ Ð·Ð°Ð¿Ð¸Ñ Ð·â€™ÑÐ²Ð¸Ð²ÑÑ Ñƒ `db.json`." },
    ],
  },
  {
    id: "sqlite",
    title: "SQLite",
    summary: "Ð‘Ð°Ð·Ð° Ñƒ Ñ„Ð°Ð¹Ð»Ñ–. Ð†Ð´ÐµÐ°Ð»ÑŒÐ½Ð° Ð´Ð»Ñ Ð½ÐµÐ²ÐµÐ»Ð¸ÐºÐ¸Ñ… Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñ–Ð².",
    steps: [
      { text: "Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ Ñ„Ð°Ð¹Ð» `db.sqlite3`." },
      {
        text: "ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð† ÑÑ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ñ‚Ð°Ð±Ð»Ð¸Ñ†ÑŽ tasks (id, name, status).",
        prompt:
          "Ð”Ð¾Ð´Ð°Ð¹ SQLite Ð· Ñ‚Ð°Ð±Ð»Ð¸Ñ†ÐµÑŽ tasks (id INTEGER PK, name TEXT, status TEXT) Ñ‚Ð° CRUD-Ñ„ÑƒÐ½ÐºÑ†Ñ–ÑÐ¼Ð¸.",
      },
      { text: "ÐŸÑ–Ð´ÐºÐ»ÑŽÑ‡Ð¸ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ð¹ Ð´Ð¾ ÐºÐ¾Ð¼Ð°Ð½Ð´ /add, /list, /done." },
      { text: "Ð¢ÐµÑÑ‚: `/add` â†’ Ð·Ð°Ð¿Ð¸Ñ Ñƒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ–." },
    ],
  },
  {
    id: "gsheets",
    title: "Google Sheets",
    summary: "ÐžÐ½Ð»Ð°Ð¹Ð½-Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ ÑÐº Ð±Ð°Ð·Ð° Ð´Ð°Ð½Ð¸Ñ….",
    steps: [
      { text: "Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ Google Sheet, ÑƒÐ²Ñ–Ð¼ÐºÐ½Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿ â€œÐ·Ð° Ð¿Ð¾ÑÐ¸Ð»Ð°Ð½Ð½ÑÐ¼â€." },
      {
        text: "ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð† Ð¿Ñ–Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ð¸ gspread Ð´Ð¾ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ–.",
        prompt:
          "ÐŸÑ–Ð´ÐºÐ»ÑŽÑ‡Ð¸ gspread Ð´Ð¾ Google Sheets. Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹ .env: GOOGLE_CREDENTIALS (JSON), SHEET_ID.",
      },
      { text: "Ð”Ð¾Ð´Ð°Ð¹ Ñ„ÑƒÐ½ÐºÑ†Ñ–ÑŽ Ð·Ð°Ð¿Ð¸ÑÑƒ Ñ€ÑÐ´ÐºÑ–Ð²." },
      { text: "Ð¢ÐµÑÑ‚: `/add` â†’ Ð½Ð¾Ð²Ð¸Ð¹ Ñ€ÑÐ´Ð¾Ðº Ñƒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ–." },
    ],
  },
  {
    id: "postgres",
    title: "Postgres (Docker)",
    summary: "ÐŸÐ¾Ñ‚ÑƒÐ¶Ð½Ð° Ð±Ð°Ð·Ð° Ð´Ð»Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð½Ð¸Ñ… Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñ–Ð².",
    steps: [
      { text: "Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸ Docker Desktop." },
      {
        text: "Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ `docker-compose.yml` Ð· Postgres.",
        prompt:
          "Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ docker-compose.yml Ð· Postgres (POSTGRES_PASSWORD=postgres, Ð¿Ð¾Ñ€Ñ‚ 5432) Ñ‚Ð° ÑÐµÑ€Ð²Ñ–ÑÐ¾Ð¼ Ð´Ð»Ñ Ð±Ð¾Ñ‚Ð°.",
      },
      {
        text: "ÐŸÑ–Ð´ÐºÐ»ÑŽÑ‡Ð¸ Postgres Ð´Ð¾ aiogram.",
        prompt:
          "Ð”Ð¾Ð´Ð°Ð¹ Ð¿Ñ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ Ð´Ð¾ Postgres Ñ– CRUD Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ– tasks. Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹ psycopg2 Ð°Ð±Ð¾ SQLAlchemy.",
      },
      { text: "Ð†Ð½Ñ‚ÐµÐ³Ñ€ÑƒÐ¹ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ð¹ Ñƒ Ñ…ÐµÐ½Ð´Ð»ÐµÑ€Ð¸." },
      { text: "Ð¢ÐµÑÑ‚: `/add` â†’ Ð·Ð°Ð¿Ð¸Ñ Ñƒ Ð±Ð°Ð·Ñ–." },
    ],
  },
];



const FILE_STRUCTURE_BACKEND_MAP = {
  json: [
    {
      type: "dir",
      path: "data/",
      description: "ÐŸÐ°Ð¿ÐºÐ° Ð¿Ñ–Ð´ JSON-Ð±Ð°Ð·Ñƒ. Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ Ð¿Ð¾Ñ€ÑƒÑ‡ Ñ–Ð· Ð¾ÑÐ½Ð¾Ð²Ð½Ð¸Ð¼ Ñ„Ð°Ð¹Ð»Ð¾Ð¼.",
    },
    {
      type: "static",
      path: "data/db.json",
      description: "ÐŸÐ¾Ñ€Ð¾Ð¶Ð½Ñ–Ð¹ Ñ„Ð°Ð¹Ð», Ð±Ð¾Ñ‚ Ð·Ð°Ð¿Ð¾Ð²Ð½Ð¸Ñ‚ÑŒ Ð¹Ð¾Ð³Ð¾ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾.",
      content: "[]",
    },
  ],
  sqlite: [
    {
      type: "info",
      path: "db.sqlite3",
      description:
        "SQLite ÑÑ‚Ð²Ð¾Ñ€Ð¸Ñ‚ÑŒ Ñ„Ð°Ð¹Ð» ÑÐ°Ð¼ Ð¿Ñ–Ð´ Ñ‡Ð°Ñ Ð·Ð°Ð¿ÑƒÑÐºÑƒ. ÐŸÐµÑ€ÐµÐºÐ¾Ð½Ð°Ð¹ÑÑ, Ñ‰Ð¾ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¸Ð¹ Ð´Ð»Ñ Ð·Ð°Ð¿Ð¸ÑÑƒ.",
    },
  ],
  gsheets: [
    {
      type: "note",
      description:
        "Google Sheets Ð½Ðµ Ð²Ð¸Ð¼Ð°Ð³Ð°Ñ” Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ð¸Ñ… Ñ„Ð°Ð¹Ð»Ñ–Ð²: Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð·Ð±ÐµÑ€ÐµÐ¶Ð¸ Ð´Ð°Ð½Ñ– Ð´Ð»Ñ Ð¿Ñ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ Ñƒ `.env`.",
    },
  ],
  postgres: [
    {
      type: "ai",
      path: "docker-compose.yml",
      description:
        "Ð¨Ð°Ð±Ð»Ð¾Ð½ Docker Ð´Ð»Ñ Postgres + ÑÐµÑ€Ð²Ñ–ÑÑƒ Ð±Ð¾Ñ‚Ð°. Ð—Ð³ÐµÐ½ÐµÑ€ÑƒÐ¹ Ñ‡ÐµÑ€ÐµÐ· Ð¨Ð† Ñ‚Ð° Ð·Ð±ÐµÑ€ÐµÐ¶Ð¸ Ð¿Ð¾Ñ€ÑƒÑ‡ Ñ–Ð· Ð¾ÑÐ½Ð¾Ð²Ð½Ð¸Ð¼ Ñ„Ð°Ð¹Ð»Ð¾Ð¼.",
      prompt:
        "ÐœÐµÐ½Ñ– Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ñ„Ð°Ð¹Ð» docker-compose.yml. Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ ÑÐµÑ€Ð²Ñ–Ñ postgres (POSTGRES_PASSWORD=postgres, Ð¿Ð¾Ñ€Ñ‚ 5432) Ñ– ÑÐµÑ€Ð²Ñ–Ñ Ð´Ð»Ñ Ð±Ð¾Ñ‚Ð°. ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ð²ÐµÑÑŒ Ñ„Ð°Ð¹Ð» Ð¾Ð´Ð½Ð¸Ð¼ Ð±Ð»Ð¾ÐºÐ¾Ð¼.",
    },
  ],
};

const defaultCustomState = {
  requirements: "",
  briefText: "",
  brief: null,
  files: [],
  commandsText: "",
  diag: {
    description: "",
    logs: "",
    prompt: "",
  },
};

const defaultUiState = {
  replyVariant: "default",
  inlineVariant: "default",
  replyCustomSpec: "",
  inlineCustomSpec: "",
};

const DESIGN_STEPS = [
  {
    title: "Ð©Ð¾ Ñ‚Ð°ÐºÐµ Ð´Ð¸Ð·Ð°Ð¹Ð½",
    items: [
      "Ð”Ð¸Ð·Ð°Ð¹Ð½ â€” Ð²Ð¸Ð³Ð»ÑÐ´ Ð±Ð¾Ñ‚Ð°: ÐºÐ½Ð¾Ð¿ÐºÐ¸, Ð¼ÐµÐ½ÑŽ, Ñ‚ÐµÐºÑÑ‚Ð¸. Ð Ð¾Ð±Ð¸Ð¼Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ñ‚Ð° Ð·Ñ€Ð¾Ð·ÑƒÐ¼Ñ–Ð»Ð¾.",
    ],
  },
  {
    title: "Ð“Ð¾Ð»Ð¾Ð²Ð½Ðµ Ð¼ÐµÐ½ÑŽ (Reply-ÐºÐ½Ð¾Ð¿ÐºÐ¸)",
    items: [
      "ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð†: Â«Ð”Ð¾Ð´Ð°Ð¹ Ð¼ÐµÐ½ÑŽ Ð· ÐºÐ½Ð¾Ð¿ÐºÐ°Ð¼Ð¸: ðŸ“‹ Ð—Ð°Ð²Ð´Ð°Ð½Ð½Ñ, ðŸ§  ÐŸÐ¾Ñ€Ð°Ð´Ð¸, âš™ï¸ ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ. ÐŸÐ¾ÑÑÐ½Ð¸, ÐºÑƒÐ´Ð¸ Ð²ÑÑ‚Ð°Ð²Ð¸Ñ‚Ð¸ ÐºÐ¾Ð´.Â»",
      "Ð’ÑÑ‚Ð°Ð² ÐºÐ¾Ð´ â†’ Ð·Ð±ÐµÑ€ÐµÐ¶Ð¸ â†’ Ñƒ Telegram Ð²Ð²ÐµÐ´Ð¸ `/start`.",
    ],
  },
  {
    title: "Inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸",
    items: [
      "ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð†: Â«Ð”Ð¾Ð´Ð°Ð¹ inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð½Ð° ÑÑ‚Ð¾Ñ€Ñ–Ð½Ñ†Ñ– â€œÐ—Ð°Ð²Ð´Ð°Ð½Ð½Ñâ€: [âœ… Ð“Ð¾Ñ‚Ð¾Ð²Ð¾] [âŒ ÐŸÑ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸] [ðŸ“Š Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°]. ÐžÐ¿Ð¸ÑˆÐ¸ Ð·Ð¼Ñ–Ð½Ð¸ Ñƒ ÐºÐ¾Ð´Ñ–.Â»",
      "Ð’ÑÑ‚Ð°Ð² ÐºÐ¾Ð´ â†’ Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚ÑƒÐ¹ Ñƒ Ñ‡Ð°Ñ‚Ñ–.",
    ],
  },
  {
    title: "Ð“Ð°Ñ€Ð½Ñ– Ñ‚ÐµÐºÑÑ‚Ð¸",
    items: [
      "ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð†: Â«Ð—Ñ€Ð¾Ð±Ð¸ Ð´Ñ€ÑƒÐ¶Ð½Ñ– Ñ‚ÐµÐºÑÑ‚Ð¸ Ð· ÐµÐ¼Ð¾Ð´Ð·Ñ– Ð´Ð»Ñ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ– /stats.Â»",
      "ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€, ÑÐº Ð²Ð¸Ð³Ð»ÑÐ´Ð°Ñ” Ñƒ Ñ‡Ð°Ñ‚Ñ–.",
    ],
  },
];

const STATS_STEPS = [
  {
    title: "ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° /stats",
    items: [
      "ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð†: Â«Ð”Ð¾Ð´Ð°Ð¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /stats, ÑÐºÐ° Ð¿Ð¾ÐºÐ°Ð·ÑƒÑ” Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑ Ð·Ð° ÑÑŒÐ¾Ð³Ð¾Ð´Ð½Ñ–, Ñ‚Ð¸Ð¶Ð´ÐµÐ½ÑŒ Ñ– Ð·Ð°Ð³Ð°Ð»Ð¾Ð¼. ÐŸÐ¾ÐºÐ°Ð¶Ð¸, Ð´Ðµ Ð² main.py Ñ—Ñ— Ñ€Ð¾Ð·Ð¼Ñ–ÑÑ‚Ð¸Ñ‚Ð¸.Â»",
      "Ð’ÑÑ‚Ð°Ð² ÐºÐ¾Ð´ â†’ Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€ Ñƒ Telegram.",
    ],
  },
  {
    title: "ÐšÑ€Ð°ÑÐ¸Ð²Ð¸Ð¹ Ð·Ð²Ñ–Ñ‚",
    items: [
      "ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð†: Â«Ð”Ð¾Ð´Ð°Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¾Ð²Ð°Ð½Ð¸Ð¹ Ð·Ð²Ñ–Ñ‚ Ð· ÐµÐ¼Ð¾Ð´Ð·Ñ– Ñ‚Ð° Ð²Ñ–Ð´ÑÐ¾Ñ‚ÐºÐ°Ð¼Ð¸.Â»",
      "ÐŸÐµÑ€ÐµÐºÐ¾Ð½Ð°Ð¹ÑÑ, Ñ‰Ð¾ Ñ‚ÐµÐºÑÑ‚ Ð»ÐµÐ³ÐºÐ¾ Ñ‡Ð¸Ñ‚Ð°Ñ‚Ð¸.",
    ],
  },
  {
    title: "Ð©Ð¾Ð´ÐµÐ½Ð½Ñ– Ð½Ð°Ð³Ð°Ð´ÑƒÐ²Ð°Ð½Ð½Ñ",
    items: [
      "ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð†: Â«ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ¹ Ñ‰Ð¾Ð´ÐµÐ½Ð½Ð¸Ð¹ Ð·Ð²Ñ–Ñ‚ Ð¾ 20:00 (apscheduler Ð°Ð±Ð¾ asyncio). ÐŸÐ¾ÑÑÐ½Ð¸, ÐºÑƒÐ´Ð¸ Ð´Ð¾Ð´Ð°Ñ‚Ð¸ ÐºÐ¾Ð´.Â»",
      "ÐŸÐµÑ€ÐµÐºÐ¾Ð½Ð°Ð¹ÑÑ, Ñ‰Ð¾ Ð¿Ð»Ð°Ð½ÑƒÐ²Ð°Ð»ÑŒÐ½Ð¸Ðº Ð½Ðµ Ð±Ð»Ð¾ÐºÑƒÑ” Ð¾ÑÐ½Ð¾Ð²Ð½Ð¸Ð¹ Ñ†Ð¸ÐºÐ».",
    ],
  },
];

const PAYMENT_METHODS = [
  {
    id: "stripe",
    title: "Stripe",
    description: "ÐœÑ–Ð¶Ð½Ð°Ñ€Ð¾Ð´Ð½Ñ– ÐºÐ°Ñ€Ñ‚ÐºÐ¸ (USD Ñ‚Ð° Ñ–Ð½ÑˆÑ– Ð²Ð°Ð»ÑŽÑ‚Ð¸).",
    steps: [
      {
        text: "ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð†: Â«Ð”Ð¾Ð´Ð°Ð¹ Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ Stripe Ð½Ð° $5 Ñ– ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /buy. ÐŸÑ–ÑÐ»Ñ ÑƒÑÐ¿Ñ–Ñ…Ñƒ Ð½Ð°Ð´Ñ–ÑˆÐ»Ð¸ â€œÐ”ÑÐºÑƒÑŽ Ð·Ð° Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ!â€. ÐŸÐ¾ÑÑÐ½Ð¸, ÐºÑƒÐ´Ð¸ Ð²ÑÑ‚Ð°Ð²Ð¸Ñ‚Ð¸ ÐºÐ¾Ð´.Â»",
        prompt:
          "Ð”Ð¾Ð´Ð°Ð¹ Ñƒ Ð±Ð¾Ñ‚Ð° Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ Stripe Ð½Ð° $5: ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° /buy, ÑƒÑÐ¿Ñ–ÑˆÐ½Ð° Ð¾Ð¿Ð»Ð°Ñ‚Ð° â†’ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ â€œÐ”ÑÐºÑƒÑŽ Ð·Ð° Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ!â€. ÐžÐ¿Ð¸ÑˆÐ¸ Ð½ÐµÐ¾Ð±Ñ…Ñ–Ð´Ð½Ñ– Ñ„Ð°Ð¹Ð»Ð¸/Ð±Ð»Ð¾ÐºÐ¸.",
      },
      { text: "Ð¢ÐµÑÑ‚: Ð¿Ð¾ÑÐ¸Ð»Ð°Ð½Ð½Ñ Ð½Ð° Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ Ð¿Ñ€Ð°Ñ†ÑŽÑ”, Ð¾Ð¿Ð»Ð°Ñ‚Ð° Ð¿Ñ€Ð¾Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒ." },
    ],
  },
  {
    id: "wayforpay",
    title: "WayForPay",
    description: "Ð£ÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ° Ð¿Ð»Ð°Ñ‚Ñ–Ð¶ÐºÐ° (Ð³Ñ€Ð¸Ð²Ð½Ñ).",
    steps: [
      {
        text: "ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð†: Â«Ð”Ð¾Ð´Ð°Ð¹ WayForPay Ð½Ð° 100 Ð³Ñ€Ð½ Ð´Ð»Ñ â€œÐŸÑ€ÐµÐ¼Ñ–ÑƒÐ¼-Ð´Ð¾ÑÑ‚ÑƒÐ¿â€. ÐŸÑ–ÑÐ»Ñ Ð¾Ð¿Ð»Ð°Ñ‚Ð¸ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð² â€œÐ”ÑÐºÑƒÑŽ!â€. ÐžÐ¿Ð¸ÑˆÐ¸ ÐºÑ€Ð¾ÐºÐ¸ Ñ–Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ñ–Ñ—.Â»",
        prompt:
          "Ð”Ð¾Ð´Ð°Ð¹ WayForPay Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ Ð½Ð° 100 Ð³Ñ€Ð½ Ð´Ð»Ñ â€œÐŸÑ€ÐµÐ¼Ñ–ÑƒÐ¼-Ð´Ð¾ÑÑ‚ÑƒÐ¿â€. ÐŸÑ–ÑÐ»Ñ ÑƒÑÐ¿Ñ–Ñ…Ñƒ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð² â€œÐ”ÑÐºÑƒÑŽ!â€. Ð”Ð¾Ð´Ð°Ð¹ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ñ–ÑŽ, ÑÐºÑ– Ñ„Ð°Ð¹Ð»Ð¸ / ÐµÐ½Ð´Ð¿Ð¾Ñ–Ð½Ñ‚Ð¸ Ð·Ð¼Ñ–Ð½ÑŽÑ”Ð¼Ð¾.",
      },
      { text: "Ð¢ÐµÑÑ‚: Ñ„Ð¾Ñ€Ð¼Ð° Ð¾Ð¿Ð»Ð°Ñ‚Ð¸ Ð²Ñ–Ð´ÐºÑ€Ð¸Ð²Ð°Ñ”Ñ‚ÑŒÑÑ Ñ– Ð¿Ñ€Ð°Ñ†ÑŽÑ”." },
    ],
  },
];

const PAYMENT_INTRO = [
  "Ð—Ð°Ñ€ÐµÑ”ÑÑ‚Ñ€ÑƒÐ¹ÑÑ Ñƒ Stripe (stripe.com) Ð°Ð±Ð¾ WayForPay (wayforpay.com).",
  "Ð”Ð¾Ð´Ð°Ð¹ Ñƒ `.env` ÐºÐ»ÑŽÑ‡Ñ– STRIPE_KEY Ð°Ð±Ð¾ WAYFORPAY_KEY.",
  "API-ÐºÐ»ÑŽÑ‡ â€” ÑÐµÐºÑ€ÐµÑ‚. ÐÐµ Ð´Ñ–Ð»Ð¸ÑÑŒ Ð½Ð¸Ð¼ Ñƒ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ñ—.",
];

const STEP_DETAILS = {
  requirements: [
    {
      title: "Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ Ñ„Ð°Ð¹Ð»Ð°",
      description:
        "Ð£ VS Code Ð½Ð°Ñ‚Ð¸ÑÐ½Ð¸ `File â†’ New File`, Ð½Ð°Ð·Ð²Ð¸ Ð¹Ð¾Ð³Ð¾ `requirements.txt` Ñ‚Ð° Ð·Ð±ÐµÑ€ÐµÐ¶Ð¸ Ð¿Ð¾Ñ€ÑƒÑ‡ Ñ–Ð· Ð¾ÑÐ½Ð¾Ð²Ð½Ð¸Ð¼ Ñ„Ð°Ð¹Ð»Ð¾Ð¼ Ð±Ð¾Ñ‚Ð°.",
      gif: "assets/details/requirements-create.gif",
    },
    {
      title: "Ð”Ð¾Ð´Ð°Ð²Ð°Ð½Ð½Ñ Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚ÐµÐ¹",
      description:
        "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ¹ Ñ€ÑÐ´ÐºÐ¸ Ð· ÐºÑ€Ð¾ÐºÑƒ Ñ‚Ð° Ð²ÑÑ‚Ð°Ð² Ñƒ Ñ„Ð°Ð¹Ð». Ð—Ð±ÐµÑ€ÐµÐ¶Ð¸, Ñ‰Ð¾Ð± pip Ð¼Ñ–Ð³ Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ð¸ Ð±Ñ–Ð±Ð»Ñ–Ð¾Ñ‚ÐµÐºÐ¸.",
      gif: "assets/details/requirements-fill.gif",
    },
  ],
  "env-file": [
    {
      title: "Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ .env",
      description:
        "Ð£ ÐºÐ¾Ñ€ÐµÐ½Ñ– Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ ÑÑ‚Ð²Ð¾Ñ€Ð¸ Ñ„Ð°Ð¹Ð» `.env`. Ð£ Ð½ÑŒÐ¾Ð¼Ñƒ Ð±ÑƒÐ´ÐµÐ¼Ð¾ Ñ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ ÑÐµÐºÑ€ÐµÑ‚Ð½Ñ– Ð·Ð¼Ñ–Ð½Ð½Ñ–.",
      gif: "assets/details/env-create.gif",
    },
    {
      title: "Ð”Ð¾Ð´Ð°Ð²Ð°Ð½Ð½Ñ BOT_TOKEN",
      description:
        "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ¹ Ñ‚Ð¾ÐºÐµÐ½ Ñ–Ð· BotFather Ñ‚Ð° Ð²ÑÑ‚Ð°Ð² Ñ€ÑÐ´Ð¾Ðº `BOT_TOKEN=Ñ‚ÑƒÑ‚_Ñ‚Ð²Ñ–Ð¹_Ñ‚Ð¾ÐºÐµÐ½`. Ð¤Ð°Ð¹Ð» Ð¿Ð¾Ð²Ð¸Ð½ÐµÐ½ Ð±ÑƒÑ‚Ð¸ Ð² .gitignore.",
      gif: "assets/details/env-fill.gif",
    },
  ],
};

const LAUNCH_STEPS = [
  {
    title: "Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ Ð±Ð¾Ñ‚Ð° Ñƒ BotFather",
    items: [
      "ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸ Ñƒ `@BotFather` â†’ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° `/newbot`.",
      "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ¹ Ñ‚Ð¾ÐºÐµÐ½ Ñ‚Ð° Ð´Ð¾Ð´Ð°Ð¹ Ñƒ `.env` ÑÐº `BOT_TOKEN=Ñ‚ÑƒÑ‚_Ñ‚Ð²Ñ–Ð¹_Ñ‚Ð¾ÐºÐµÐ½`.",
    ],
  },
  {
    title: "Ð—Ð°Ð¿ÑƒÑÐº",
    items: [
      "Ð’Ð¸ÐºÐ¾Ð½Ð°Ð¹ Ñƒ Ñ‚ÐµÑ€Ð¼Ñ–Ð½Ð°Ð»Ñ–: `python main.py`.",
      "Ð¯ÐºÑ‰Ð¾ Ð±Ð°Ñ‡Ð¸Ñˆ â€œBot startedâ€ â€” ÑƒÑÐµ Ð´Ð¾Ð±Ñ€Ðµ.",
    ],
  },
  {
    title: "ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸",
    type: "commands",
  },
  {
    title: "Ð ÐµÐ·ÐµÑ€Ð²Ð½Ð° ÐºÐ¾Ð¿Ñ–Ñ",
    items: [
      "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ¹ ÐºÐ¾Ð´ Ñƒ Ñ…Ð¼Ð°Ñ€Ñƒ Ð°Ð±Ð¾ Ð½Ð° GitHub (Ð±ÐµÐ· `.env`).",
      "ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸ Ð±Ð¾Ñ‚Ð° Ñ‚Ð° Ð¿ÐµÑ€ÐµÐºÐ¾Ð½Ð°Ð¹ÑÑ, Ñ‰Ð¾ Ð²ÑÐµ Ð¿Ñ€Ð°Ñ†ÑŽÑ”.",
    ],
  },
];

const EXTRA_MODULE_OPTIONS = [
  {
    id: "autosave",
    title: "ÐÐ²Ñ‚Ð¾Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ",
    description: "Ð—Ð±ÐµÑ€Ñ–Ð³Ð°Ñ” Ñ‚Ð° Ð²Ñ–Ð´Ð½Ð¾Ð²Ð»ÑŽÑ” ÑÑ‚Ð°Ð½ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ñ–Ð² Ñƒ Ð½Ð°ÑÐ²Ð½Ð¾Ð¼Ñƒ ÑÑ…Ð¾Ð²Ð¸Ñ‰Ñ–.",
    icon: "ðŸ”",
  },
  {
    id: "adminPanel",
    title: "ÐÐ´Ð¼Ñ–Ð½-Ð¿Ð°Ð½ÐµÐ»ÑŒ",
    description: "ÐžÐºÑ€ÐµÐ¼Ð¸Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ Ñ–Ð· Ð¼ÐµÐ½ÑŽ, ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¾ÑŽ Ñ‚Ð° ÐºÐµÑ€ÑƒÐ²Ð°Ð½Ð½ÑÐ¼ Ð·Ð°ÑÐ²ÐºÐ°Ð¼Ð¸.",
    icon: "ðŸ§©",
  },
  {
    id: "i18n",
    title: "Ð‘Ð°Ð³Ð°Ñ‚Ð¾Ð¼Ð¾Ð²Ð½Ñ–ÑÑ‚ÑŒ",
    description: "Ð¡Ð»Ð¾Ð²Ð½Ð¸ÐºÐ¸ Ð¼Ð¾Ð² + Ð¿ÐµÑ€ÐµÐ¼Ð¸ÐºÐ°Ñ‡ Ð¼Ð¾Ð²Ð¸ Ð´Ð»Ñ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð° (UA/PL/EN).",
    icon: "ðŸŒ",
  },
];

const defaultExtraModulesState = {
  autosave: false,
  adminPanel: false,
  i18n: false,
};

const defaultExtraModuleData = {
  autosave: {
    storage: { file: "storage.py", code: "" },
    hooks: { file: "main.py", code: "" },
    restore: { file: "main.py", code: "" },
  },
  adminPanel: {
    config: { file: "config.py", code: "" },
    envSnippet: "",
    handlers: { file: "handlers_admin.py", code: "" },
    leads: { file: "handlers_admin.py", code: "" },
    security: { file: "handlers_admin.py", code: "" },
  },
  i18n: {
    helper: { file: "i18n.py", code: "" },
    locales: {
      ua: { file: "locales/ua.json", code: "" },
      pl: { file: "locales/pl.json", code: "" },
      en: { file: "locales/en.json", code: "" },
    },
    storage: { file: "storage.py", code: "" },
    language: { file: "main.py", code: "" },
    usage: { file: "main.py", code: "" },
  },
};

const FINISH_STEP = {
  title: "Ð¤Ñ–Ð½Ñ–Ñˆ",
  items: [
    "ÐŸÐ¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ: Â«Ð“Ð¾Ñ‚Ð¾Ð²Ð¾! Ð¢Ð¸ ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð² ÑÐ²Ð¾Ð³Ð¾ Telegram-Ð±Ð¾Ñ‚Ð°.Â»",
    "ÐšÐ½Ð¾Ð¿ÐºÐ¸: ðŸ”„ Â«Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð±Ð¾Ñ‚Ð°Â», ðŸš€ Â«ÐŸÐ¾ÐºÑ€Ð°Ñ‰Ð¸Ñ‚Ð¸ Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ð¾Ð³Ð¾Â».",
  ],
};

const defaultTools = TOOL_CHECKLIST.reduce(
  (acc, tool) => {
    acc[tool.id] = false;
    return acc;
  },
  { requirements: false, env: false }
);
defaultTools.codespace = false;
defaultTools.browser = false;

const defaultState = {
  currentStep: 0,
  choices: {
    botType: null,
    mode: null,
    environment: null,
    backend: null,
    entryFile: ENTRY_FILE_OPTIONS[0].id,
    payment: "none",
  },
  tools: structuredClone(defaultTools),
  commands: ["/start", "/help"],
  ui: structuredClone(defaultUiState),
  custom: structuredClone(defaultCustomState),
  extraModules: structuredClone(defaultExtraModulesState),
  extraModuleData: structuredClone(defaultExtraModuleData),
};

const AI_LINKS = {
  chatgpt: "https://chat.openai.com/",
  codex: "https://chatgpt.com/codex/",
};

function getEntryFile(currentState = state) {
  const available = ENTRY_FILE_OPTIONS.map((item) => item.id);
  const value = currentState?.choices?.entryFile;
  return available.includes(value) ? value : ENTRY_FILE_OPTIONS[0].id;
}

function ensureCustomState(targetState = state) {
  if (!targetState.custom) {
    targetState.custom = structuredClone(defaultCustomState);
  } else {
    if (targetState.custom.diag === undefined)
      targetState.custom.diag = { description: "", logs: "", prompt: "" };
    if (targetState.custom.files === undefined) targetState.custom.files = [];
  }
  return targetState.custom;
}

function ensureUiState(targetState = state) {
  if (!targetState.ui) {
    targetState.ui = structuredClone(defaultUiState);
  } else {
    if (!targetState.ui.replyVariant) targetState.ui.replyVariant = "default";
    if (!targetState.ui.inlineVariant) targetState.ui.inlineVariant = "default";
    if (typeof targetState.ui.replyCustomSpec !== "string")
      targetState.ui.replyCustomSpec = "";
    if (typeof targetState.ui.inlineCustomSpec !== "string")
      targetState.ui.inlineCustomSpec = "";
  }
  return targetState.ui;
}

function ensureExtraModules(targetState = state) {
  if (!targetState.extraModules) {
    targetState.extraModules = structuredClone(defaultExtraModulesState);
  } else {
    targetState.extraModules = Object.assign(
      {},
      defaultExtraModulesState,
      targetState.extraModules
    );
  }
  return targetState.extraModules;
}

function ensureExtraModuleData(targetState = state) {
  if (!targetState.extraModuleData) {
    targetState.extraModuleData = structuredClone(defaultExtraModuleData);
  } else {
    const base = structuredClone(defaultExtraModuleData);
    mergePlainObject(base, targetState.extraModuleData);
    targetState.extraModuleData = base;
  }
  const data = targetState.extraModuleData;
  const entryFile = getEntryFile(targetState);

  if (!data.autosave.hooks.file) data.autosave.hooks.file = entryFile;
  if (!data.autosave.restore.file) data.autosave.restore.file = entryFile;
  if (!data.adminPanel.handlers.file) data.adminPanel.handlers.file = entryFile;
  if (!data.adminPanel.leads.file) data.adminPanel.leads.file =
    data.adminPanel.handlers.file || entryFile;
  if (!data.adminPanel.security.file) data.adminPanel.security.file =
    data.adminPanel.handlers.file || entryFile;
  if (!data.i18n.language.file) data.i18n.language.file = entryFile;
  if (!data.i18n.usage.file) data.i18n.usage.file = entryFile;

  return data;
}

function mergePlainObject(target, source) {
  if (!source || typeof source !== "object" || Array.isArray(source)) return;
  Object.keys(source).forEach((key) => {
    const value = source[key];
    if (
      value &&
      typeof value === "object" &&
      !Array.isArray(value) &&
      typeof target[key] === "object" &&
      target[key] !== null &&
      !Array.isArray(target[key])
    ) {
      mergePlainObject(target[key], value);
    } else {
      target[key] = value;
    }
  });
}

function isCustomBot(currentState = state) {
  return currentState?.choices?.botType === "custom";
}

function generateCustomBriefPrompt() {
  const custom = ensureCustomState();
  const requirements = custom.requirements?.trim() || "ÐžÐ¿Ð¸Ñ Ñ‰Ðµ Ð½Ðµ Ð´Ð¾Ð´Ð°Ð½Ð¾.";
  return `Ð¢Ð—: ${requirements}.
Ð—Ñ€Ð¾Ð±Ð¸ Ð±Ñ€Ð¸Ñ„ Ð´Ð»Ñ Ñ€Ð¾Ð·Ñ€Ð¾Ð±ÐºÐ¸ Ð±Ð¾Ñ‚Ð°. Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ð¹ ÑÑ‚Ñ€Ð¾Ð³Ð¾ Ð²Ð°Ð»Ñ–Ð´Ð½Ð¸Ð¼ JSON Ð±ÐµÐ· ÐºÐ¾Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ñ–Ð² Ñ– Ð·Ð°Ð¹Ð²Ð¾Ð³Ð¾ Ñ‚ÐµÐºÑÑ‚Ñƒ:
{
  "commands": [...],
  "files": [
    {"path": "...", "purpose": "...", "isSimple": true|false}
  ],
  "backend": {"language": "...", "framework": "...", "notes": "..."},
  "storage": {"type": "...", "details": "...", "reason": "..."},
  "ui": {
    "reply": {
      "needed": true|false,
      "buttons": [
        {"text": "...", "purpose": "..."}
      ],
      "notes": "..."
    },
    "inline": {
      "needed": true|false,
      "buttons": [
        {"text": "...", "purpose": "...", "callback": "..."}
      ],
      "notes": "..."
    }
  }
}`;
}

function generateManualFilePromptForSpec(brief, fileSpec) {
  const serializedBrief = JSON.stringify(brief, null, 2);
  const path = fileSpec.path || "main.py";
  const purpose = fileSpec.purpose || "ÐžÑÐ½Ð¾Ð²Ð½Ð° Ð»Ð¾Ð³Ñ–ÐºÐ°";
  return [
    `ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð±Ð¾Ñ‚Ð°: ${serializedBrief}.`,
    `Ð¤Ð°Ð¹Ð»: ${path}. ÐŸÑ€Ð¸Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ: ${purpose}.`,
    "Ð—Ð³ÐµÐ½ÐµÑ€ÑƒÐ¹ Ð¿Ð¾Ð²Ð½Ð¸Ð¹ Ð²Ð¼Ñ–ÑÑ‚ Ñ„Ð°Ð¹Ð»Ñƒ, ÑÐ°Ð¼Ð¾Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð½Ñ–Ð¹, Ð±ÐµÐ· Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÑ–Ð².",
  ].join("\n");
}

function createSimpleFileInstructions(fileSpec) {
  const path = fileSpec.path || "file.txt";
  const purpose = fileSpec.purpose || "Ð”Ð¾Ð¿Ð¾Ð¼Ñ–Ð¶Ð½Ð¸Ð¹ Ñ„Ð°Ð¹Ð»";
  return `Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ Ñ„Ð°Ð¹Ð» ${path}. ÐŸÑ€Ð¸Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ: ${purpose}. Ð—Ð°Ð¿Ð¾Ð²Ð½Ð¸ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð½Ð¾ Ð´Ð¾ Ð±Ñ€Ð¸Ñ„Ñƒ Ñ‚Ð° Ð·Ð±ÐµÑ€ÐµÐ¶Ð¸ Ñƒ Ð·Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ñ–Ð¹ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ñ–Ñ—.`;
}

function updateCustomFilePlan(parsedBrief) {
  const custom = ensureCustomState();
  const previousStatus = new Map(
    custom.files.map((item) => [item.path, !!item.done])
  );
  const files = Array.isArray(parsedBrief?.files) ? parsedBrief.files : [];
  custom.files = files.map((fileSpec, index) => {
    const path = fileSpec?.path || `file_${index + 1}.txt`;
    const isSimple = !!fileSpec?.isSimple;
    return {
      id: `${index}-${path}`,
      path,
      purpose: fileSpec?.purpose || "",
      isSimple,
      instructions: isSimple ? createSimpleFileInstructions(fileSpec) : null,
      prompt: isSimple
        ? null
        : generateManualFilePromptForSpec(parsedBrief, fileSpec),
      done: previousStatus.get(path) || false,
    };
  });
}

function deriveDefaultCommands(customState, entryFile) {
  const commands = [];
  const hasRequirements = customState.files.some(
    (file) => file.path === "requirements.txt"
  );
  if (hasRequirements) commands.push("pip install -r requirements.txt");
  const pythonFile =
    customState.files.find((file) => /\.py$/i.test(file.path) && !file.isSimple)
      ?.path ||
    entryFile ||
    "main.py";
  commands.push(`python ${pythonFile}`);
  return commands.join("\n");
}

function composeCustomDiagnosticPrompt(customState) {
  const briefText = customState.brief
    ? JSON.stringify(customState.brief, null, 2)
    : "Ð‘Ñ€Ð¸Ñ„ Ñ‰Ðµ Ð½Ðµ Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð¾.";
  const knownFiles = customState.files.length
    ? customState.files
        .map((file) => `${file.path} â€” ${file.isSimple ? "simple" : "code"}`)
        .join("\n")
    : "Ð¤Ð°Ð¹Ð»Ð¸ Ñ‰Ðµ Ð½Ðµ ÑÑ„Ð¾Ñ€Ð¼Ð¾Ð²Ð°Ð½Ð¾.";
  return [
    `ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð±Ð¾Ñ‚Ð°: ${briefText}.`,
    `ÐžÐ¿Ð¸Ñ Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ¸: ${customState.diag.description || "Ð½Ðµ Ð²ÐºÐ°Ð·Ð°Ð½Ð¾"}.`,
    `Ð›Ð¾Ð³Ð¸ Ñ‚ÐµÑ€Ð¼Ñ–Ð½Ð°Ð»Ñƒ: ${customState.diag.logs || "Ð½Ðµ Ð½Ð°Ð´Ð°Ð½Ð¾"}.`,
    `ÐŸÐ¾Ñ‚Ð¾Ñ‡Ð½Ð° ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ñ„Ð°Ð¹Ð»Ñ–Ð²: ${knownFiles}.`,
    "ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ð¿Ð¾Ð²Ð½Ñ–ÑÑ‚ÑŽ Ð²Ð¸Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ð¹ ÐºÐ¾Ð´ Ñ– Ñ‡Ñ–Ñ‚ÐºÐ¾ Ð²ÐºÐ°Ð¶Ð¸, Ð² ÑÐºÑ– Ñ„Ð°Ð¹Ð»Ð¸ Ð¹Ð¾Ð³Ð¾ Ð²ÑÑ‚Ð°Ð²Ð¸Ñ‚Ð¸.",
  ].join("\n");
}

function getCustomCommandsList(customState) {
  return customState.commandsText
    .split("\n")
    .map((item) => item.trim())
    .filter(Boolean);
}

function getRecommendedBackendId(currentState = state) {
  if (!isCustomBot(currentState)) return null;
  const custom = ensureCustomState(currentState);
  const brief = custom.brief || {};
  const candidates = [
    brief.storage?.type,
    brief.backend?.type,
    brief.storage?.name,
    brief.storage?.id,
  ].map((value) => (typeof value === "string" ? value.toLowerCase() : ""));

  const text = candidates.filter(Boolean).join(" ");
  const map = [
    { key: "postgresql", value: "postgres" },
    { key: "postgres", value: "postgres" },
    { key: "sqlite", value: "sqlite" },
    { key: "google sheets", value: "gsheets" },
    { key: "gsheets", value: "gsheets" },
    { key: "sheets", value: "gsheets" },
    { key: "json", value: "json" },
  ];
  for (const item of map) {
    if (text.includes(item.key)) return item.value;
  }
  return null;
}

function normalizeCommand(command) {
  if (typeof command !== "string") return "";
  const trimmed = command.trim();
  if (!trimmed) return "";
  return trimmed.startsWith("/") ? trimmed : `/${trimmed}`;
}

function customBriefHasCommand(command) {
  const custom = ensureCustomState();
  const target = normalizeCommand(command);
  if (!target) return false;
  const commands = Array.isArray(custom.brief?.commands)
    ? custom.brief.commands
    : state.commands;
  return commands.some(
    (cmd) => normalizeCommand(cmd).toLowerCase() === target.toLowerCase()
  );
}

function customBriefHasReminder() {
  const custom = ensureCustomState();
  const commands = Array.isArray(custom.brief?.commands)
    ? custom.brief.commands
    : state.commands;
  const commandMatch = commands.some((cmd) => {
    const normalized = normalizeCommand(cmd).toLowerCase();
    return (
      normalized.includes("remind") ||
      normalized.includes("daily") ||
      normalized.includes("schedule")
    );
  });
  if (commandMatch) return true;
  const featuresCandidates = [].concat(
    Array.isArray(custom.brief?.features) ? custom.brief.features : [],
    Array.isArray(custom.brief?.modules) ? custom.brief.modules : [],
    Array.isArray(custom.brief?.capabilities) ? custom.brief.capabilities : []
  );
  return featuresCandidates.some(
    (item) =>
      typeof item === "string" && /Ð½Ð°Ð³Ð°Ð´|remind|schedule|daily/i.test(item)
  );
}

function generateCommandFixPrompt(customState) {
  const briefText = customState.brief
    ? JSON.stringify(customState.brief, null, 2)
    : "Ð‘Ñ€Ð¸Ñ„ Ñ‰Ðµ Ð½Ðµ Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð¾.";
  const commands = (state.commands || [])
    .map((cmd) => normalizeCommand(cmd))
    .filter(Boolean)
    .join(", ");
  const lines = [
    `ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð±Ð¾Ñ‚Ð°: ${briefText}.`,
    `ÐŸÐ¾Ñ‚Ð¾Ñ‡Ð½Ð¸Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº ÐºÐ¾Ð¼Ð°Ð½Ð´: ${commands || "Ð½Ðµ Ð²Ð¸Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¾"}.`,
    "ÐžÐ¿Ð¸ÑˆÐ¸, ÑÐºÐ° ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð°Ð±Ð¾ Ð½Ð°Ð±Ñ–Ñ€ ÐºÐ¾Ð¼Ð°Ð½Ð´ Ð¿Ñ€Ð°Ñ†ÑŽÑ” Ð½ÐµÐºÐ¾Ñ€ÐµÐºÑ‚Ð½Ð¾.",
  ];
  if (state.choices.mode === "chatgpt") {
    lines.push(
      "ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð† Ð¿Ð¾Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ Ð¿Ð¾Ð²Ð½Ñ– Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ñ– Ð²ÐµÑ€ÑÑ–Ñ— Ð·Ð¼Ñ–Ð½ÐµÐ½Ð¸Ñ… Ñ„Ð°Ð¹Ð»Ñ–Ð² (Ñ†Ñ–Ð»ÐºÐ¾Ð¼), Ñ‰Ð¾Ð± Ñ—Ñ… Ð¼Ð¾Ð¶Ð½Ð° Ð±ÑƒÐ»Ð¾ Ð²ÑÑ‚Ð°Ð²Ð¸Ñ‚Ð¸ Ð±ÐµÐ· Ð¿Ñ€Ð°Ð²Ð¾Ðº."
    );
  } else {
    lines.push(
      "ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð† Ð¿Ð¾ÑÑÐ½Ð¸Ñ‚Ð¸, ÑÐºÑ– Ð·Ð¼Ñ–Ð½Ð¸ Ð²Ð½ÐµÑÑ‚Ð¸, Ñ‚Ð° Ð½Ð°Ð´Ð°Ñ‚Ð¸ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹ ÐºÐ¾Ð´ Ð´Ð»Ñ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð½Ð¸Ñ… Ñ„Ð°Ð¹Ð»Ñ–Ð²."
    );
  }
  return lines.join("\n");
}

function getUiSection(section, currentState = state) {
  const custom = ensureCustomState(currentState);
  const ui = custom.brief?.ui;
  if (!ui || typeof ui !== "object") return null;
  const data = ui[section];
  if (!data || typeof data !== "object") return null;
  const needed = data.needed;
  const buttons = Array.isArray(data.buttons) ? data.buttons : [];
  const notes = typeof data.notes === "string" ? data.notes : "";
  return { needed, buttons, notes };
}

function generateUiCodePrompt(section, buttons) {
  const custom = ensureCustomState();
  const briefText = custom.brief
    ? JSON.stringify(custom.brief, null, 2)
    : "Ð‘Ñ€Ð¸Ñ„ Ñ‰Ðµ Ð½Ðµ Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð¾.";
  const entryFile = getEntryFile();
  const mode = state.choices.mode;
  const spec = JSON.stringify(buttons, null, 2);
  const readable = section === "reply" ? "reply-Ð¼ÐµÐ½ÑŽ" : "inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸";
  const lines = [
    `ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð±Ð¾Ñ‚Ð°: ${briefText}.`,
    `Ð¡Ð¿ÐµÑ†Ð¸Ñ„Ñ–ÐºÐ°Ñ†Ñ–Ñ ${readable}:`,
    spec,
    `ÐžÐ½Ð¾Ð²Ð¸ Ñ„Ð°Ð¹Ð» ${entryFile}, Ð´Ð¾Ð´Ð°Ð²ÑˆÐ¸ ${readable} Ñ‚Ð° Ð½ÐµÐ¾Ð±Ñ…Ñ–Ð´Ð½Ñ– Ð¾Ð±Ñ€Ð¾Ð±Ð½Ð¸ÐºÐ¸.`,
    "Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹ ÑƒÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÑ– Ð¿Ñ–Ð´Ð¿Ð¸ÑÐ¸ Ñ‚Ð° Ð´Ñ€ÑƒÐ¶Ð½Ñ– Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ.",
  ];
  if (mode === "chatgpt") {
    lines.push(
      `ÐŸÐ¾Ð²ÐµÑ€Ð½Ð¸ Ð¿Ð¾Ð²Ð½Ð¸Ð¹ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹ ÐºÐ¾Ð´ Ñ„Ð°Ð¹Ð»Ð° ${entryFile} Ð¾Ð´Ð½Ð¸Ð¼ Ð±Ð»Ð¾ÐºÐ¾Ð¼ Ð±ÐµÐ· Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÑ–Ð².`
    );
  } else {
    lines.push(
      `ÐžÐ¿Ð¸ÑˆÐ¸ Ð²Ð½ÐµÑÐµÐ½Ñ– Ð·Ð¼Ñ–Ð½Ð¸ Ñ‚Ð° Ð½Ð°Ð²ÐµÐ´Ð¸ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹ ÐºÐ¾Ð´ Ð´Ð»Ñ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð½Ð¸Ñ… Ñ‡Ð°ÑÑ‚Ð¸Ð½ ${entryFile}.`
    );
  }
  return lines.join("\n");
}

function generateUiDiscoveryPrompt(section) {
  const custom = ensureCustomState();
  const briefText = custom.brief
    ? JSON.stringify(custom.brief, null, 2)
    : "Ð‘Ñ€Ð¸Ñ„ Ñ‰Ðµ Ð½Ðµ Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð¾.";
  const entryFile = getEntryFile();
  const mode = state.choices.mode;
  const readable = section === "reply" ? "reply-Ð¼ÐµÐ½ÑŽ" : "inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸";
  const elementFormat =
    section === "reply"
      ? '{"text": "...", "purpose": "..."}'
      : '{"text": "...", "purpose": "...", "callback": "..."}';
  const lines = [
    `ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð±Ð¾Ñ‚Ð°: ${briefText}.`,
    `Ð—Ð°Ð¿Ñ€Ð¾Ð¿Ð¾Ð½ÑƒÐ¹, Ñ‡Ð¸ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ðµ ${readable}. Ð¯ÐºÑ‰Ð¾ Ñ‚Ð°Ðº, ÑÑ„Ð¾Ñ€Ð¼ÑƒÐ¹ Ð¼Ð°ÑÐ¸Ð² Ð¾Ð±â€™Ñ”ÐºÑ‚Ñ–Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñƒ ${elementFormat}.`,
    `ÐŸÑ–ÑÐ»Ñ Ñ†ÑŒÐ¾Ð³Ð¾ Ð¾Ð½Ð¾Ð²Ð¸ Ñ„Ð°Ð¹Ð» ${entryFile}, Ð´Ð¾Ð´Ð°Ð²ÑˆÐ¸ ${readable} Ñ‚Ð° Ð½ÐµÐ¾Ð±Ñ…Ñ–Ð´Ð½Ñƒ Ð»Ð¾Ð³Ñ–ÐºÑƒ.`,
    "Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹ ÑƒÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÑ– Ð¿Ñ–Ð´Ð¿Ð¸ÑÐ¸.",
  ];
  if (mode === "chatgpt") {
    lines.push(`ÐŸÐ¾Ð²ÐµÑ€Ð½Ð¸ Ð¿Ð¾Ð²Ð½Ð¸Ð¹ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹ ÐºÐ¾Ð´ Ñ„Ð°Ð¹Ð»Ð° ${entryFile} Ð¾Ð´Ð½Ð¸Ð¼ Ð±Ð»Ð¾ÐºÐ¾Ð¼.`);
  } else {
    lines.push(
      `ÐŸÐ¾ÑÑÐ½Ð¸, ÑÐºÑ– Ð·Ð¼Ñ–Ð½Ð¸ Ñ‚Ñ€ÐµÐ±Ð° Ð²Ð½ÐµÑÑ‚Ð¸ Ñƒ ${entryFile}, Ñ‚Ð° Ð´Ð¾Ð´Ð°Ð¹ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹ ÐºÐ¾Ð´ Ð´Ð»Ñ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð½Ð¸Ñ… Ñ‡Ð°ÑÑ‚Ð¸Ð½.`
    );
  }
  return lines.join("\n");
}

function getPresetUiSpec(section, currentState = state) {
  const typeId = currentState?.choices?.botType;
  if (!typeId) return null;
  const type = BOT_TYPES.find((item) => item.id === typeId);
  if (!type || !type.ui) return null;
  const config = type.ui[section];
  if (!config) return null;

  const baseNotes = typeof config.notes === "string" ? config.notes : "";
  const discoveryHint =
    typeof config.discoveryHint === "string" ? config.discoveryHint : "";

  let variants = [];
  if (Array.isArray(config.variants) && config.variants.length) {
    variants = config.variants.map((variant, index) => ({
      id: variant.id || `variant-${index}`,
      title: variant.title || "Ð’Ð°Ñ€Ñ–Ð°Ð½Ñ‚",
      description: variant.description || "",
      buttons: Array.isArray(variant.buttons) ? variant.buttons : [],
      notes: typeof variant.notes === "string" ? variant.notes : "",
    }));
  } else if (Array.isArray(config.buttons) && config.buttons.length) {
    variants = [
      {
        id: "default",
        title: "Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð¾Ð²Ð°Ð½Ñ– ÐºÐ½Ð¾Ð¿ÐºÐ¸",
        description: "",
        buttons: config.buttons,
        notes: baseNotes,
      },
    ];
  }

  return {
    needed: config.needed !== false,
    variants,
    notes: baseNotes,
    discoveryHint,
    type,
  };
}

function generatePresetUiCodePrompt(section, variant, type) {
  const entryFile = getEntryFile();
  const mode = state.choices.mode;
  const commands = state.commands.length
    ? state.commands.join(", ")
    : "/start, /help";
  const readable = section === "reply" ? "reply-Ð¼ÐµÐ½ÑŽ" : "inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸";
  const spec = JSON.stringify(variant.buttons, null, 2);
  const lines = [
    `Ð¢Ð¸Ð¿ Ð±Ð¾Ñ‚Ð°: ${type.title}.`,
    `ÐžÐ¿Ð¸Ñ: ${type.description}.`,
    `Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ– ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸: ${commands}.`,
    `ÐžÐ½Ð¾Ð²Ð¸ Ñ„Ð°Ð¹Ð» ${entryFile}, Ð´Ð¾Ð´Ð°Ð²ÑˆÐ¸ ${readable} Ð·Ð° Ñ†Ñ–Ñ”ÑŽ ÑÐ¿ÐµÑ†Ð¸Ñ„Ñ–ÐºÐ°Ñ†Ñ–Ñ”ÑŽ:`,
    spec,
    "Ð”Ð¾Ð´Ð°Ð¹ Ð¾Ð±Ñ€Ð¾Ð±Ð½Ð¸ÐºÐ¸ Ð½Ð°Ñ‚Ð¸ÑÐºÐ°Ð½ÑŒ Ñ‚Ð° Ð´Ñ€ÑƒÐ¶Ð½Ñ– ÑƒÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÑ– Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ.",
    "Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹ aiogram v3.",
  ];
  if (variant.notes) lines.push(`ÐŸÑ€Ð¸Ð¼Ñ–Ñ‚ÐºÐ°: ${variant.notes}`);
  if (mode === "chatgpt") {
    lines.push(
      `ÐŸÐ¾Ð²ÐµÑ€Ð½Ð¸ Ð¿Ð¾Ð²Ð½Ð¸Ð¹ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹ ÐºÐ¾Ð´ Ñ„Ð°Ð¹Ð»Ð° ${entryFile} Ð¾Ð´Ð½Ð¸Ð¼ Ð±Ð»Ð¾ÐºÐ¾Ð¼ Ð±ÐµÐ· ÑÐºÐ¾Ñ€Ð¾Ñ‡ÐµÐ½ÑŒ.`
    );
  } else {
    lines.push(
      `ÐžÐ¿Ð¸ÑˆÐ¸, ÑÐºÑ– Ñ‡Ð°ÑÑ‚Ð¸Ð½Ð¸ ${entryFile} Ñ‚Ñ€ÐµÐ±Ð° Ð·Ð¼Ñ–Ð½Ð¸Ñ‚Ð¸, Ñ– Ð´Ð¾Ð´Ð°Ð¹ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ñ– Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð¸ ÐºÐ¾Ð´Ñƒ.`
    );
  }
  return lines.join("\n");
}

function generatePresetUiDiscoveryPrompt(section, type) {
  const entryFile = getEntryFile();
  const mode = state.choices.mode;
  const commands = state.commands.length
    ? state.commands.join(", ")
    : "/start, /help";
  const readable = section === "reply" ? "reply-Ð¼ÐµÐ½ÑŽ" : "inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸";
  const format =
    section === "reply"
      ? '{"text": "...", "purpose": "..."}'
      : '{"text": "...", "purpose": "...", "callback": "..."}';
  const lines = [
    `Ð¢Ð¸Ð¿ Ð±Ð¾Ñ‚Ð°: ${type.title}.`,
    `ÐžÐ¿Ð¸Ñ: ${type.description}.`,
    `ÐšÐ¾Ð¼Ð°Ð½Ð´Ð¸: ${commands}.`,
    `Ð—Ð°Ð¿Ñ€Ð¾Ð¿Ð¾Ð½ÑƒÐ¹ ÐºÑ–Ð»ÑŒÐºÐ° Ð²Ð°Ñ€Ñ–Ð°Ð½Ñ‚Ñ–Ð² ${readable} Ñƒ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñ– Ð¼Ð°ÑÐ¸Ð²Ñƒ Ð¾Ð±â€™Ñ”ÐºÑ‚Ñ–Ð² ${format}.`,
    `ÐŸÑ–ÑÐ»Ñ ÑƒÐ·Ð³Ð¾Ð´Ð¶ÐµÐ½Ð½Ñ Ð´Ð¾Ð´Ð°Ð¹ ${readable} Ð´Ð¾ Ñ„Ð°Ð¹Ð»Ð° ${entryFile} (aiogram v3).`,
    "Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹ ÑƒÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÑ– Ñ‚ÐµÐºÑÑ‚Ð¸ ÐºÐ½Ð¾Ð¿Ð¾Ðº.",
  ];
  if (mode === "chatgpt") {
    lines.push(`ÐŸÐ¾Ð²ÐµÑ€Ð½Ð¸ Ð¿Ð¾Ð²Ð½Ð¸Ð¹ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹ ÐºÐ¾Ð´ Ñ„Ð°Ð¹Ð»Ð° ${entryFile} Ð¾Ð´Ð½Ð¸Ð¼ Ð±Ð»Ð¾ÐºÐ¾Ð¼.`);
  } else {
    lines.push(`ÐžÐ¿Ð¸ÑˆÐ¸ Ð·Ð¼Ñ–Ð½Ð¸ Ñƒ ${entryFile} Ñ‚Ð° Ð´Ð¾Ð´Ð°Ð¹ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ñ– Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð¸ ÐºÐ¾Ð´Ñƒ.`);
  }
  return lines.join("\n");
}

function generatePresetUiCustomPrompt(section, rawSpec, type) {
  const spec = rawSpec.trim();
  if (!spec) return "";
  const entryFile = getEntryFile();
  const mode = state.choices.mode;
  const readable = section === "reply" ? "reply-Ð¼ÐµÐ½ÑŽ" : "inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸";
  const lines = [
    `Ð¢Ð¸Ð¿ Ð±Ð¾Ñ‚Ð°: ${type.title}.`,
    `ÐžÐ¿Ð¸Ñ: ${type.description}.`,
    `ÐÐµÐ¾Ð±Ñ…Ñ–Ð´Ð½Ð¾ Ð´Ð¾Ð´Ð°Ñ‚Ð¸ ${readable} Ð´Ð¾ Ñ„Ð°Ð¹Ð»Ð° ${entryFile} Ð·Ð° Ð½Ð°ÑÑ‚ÑƒÐ¿Ð½Ð¸Ð¼ Ð¾Ð¿Ð¸ÑÐ¾Ð¼ (Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ "ÐÐ°Ð·Ð²Ð° â€” Ð¿Ñ€Ð¸Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ â€” callback/URL"):`,
    spec,
    "Ð—Ð±ÑƒÐ´ÑƒÐ¹ ÐºÐ¾Ð»Ð±ÐµÐºÐ¸, Ð¾Ð½Ð¾Ð²Ð¸ Ñ…ÐµÐ½Ð´Ð»ÐµÑ€Ð¸ Ñ‚Ð° Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ– ÑƒÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ¾ÑŽ.",
    "Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹ aiogram v3.",
  ];
  if (mode === "chatgpt") {
    lines.push(
      `ÐŸÐ¾Ð²ÐµÑ€Ð½Ð¸ Ð¿Ð¾Ð²Ð½Ð¸Ð¹ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹ ÐºÐ¾Ð´ Ñ„Ð°Ð¹Ð»Ð° ${entryFile} Ð¾Ð´Ð½Ð¸Ð¼ Ð±Ð»Ð¾ÐºÐ¾Ð¼ Ð±ÐµÐ· ÑÐºÐ¾Ñ€Ð¾Ñ‡ÐµÐ½ÑŒ.`
    );
  } else {
    lines.push(`ÐžÐ¿Ð¸ÑˆÐ¸ Ð·Ð¼Ñ–Ð½Ð¸ Ñƒ ${entryFile} Ñ‚Ð° Ð´Ð¾Ð´Ð°Ð¹ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ñ– Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð¸ ÐºÐ¾Ð´Ñƒ.`);
  }
  return lines.join("\n");
}

function parseCustomBrief(rawText) {
  if (!rawText) throw new Error("Ð‘Ñ€Ð¸Ñ„ Ð¿Ð¾Ñ€Ð¾Ð¶Ð½Ñ–Ð¹.");
  let normalized = rawText.trim();
  if (normalized.startsWith("```")) {
    const fenceEnd = normalized.lastIndexOf("```");
    normalized = normalized
      .slice(normalized.indexOf("\n") + 1, fenceEnd)
      .trim();
  }
  return JSON.parse(normalized);
}

const elements = {
  section: document.getElementById("section-label"),
  progressInner: document.getElementById("progress-inner"),
  progressLabel: document.getElementById("progress-label"),
  stepIndex: document.getElementById("step-index"),
  stepTitle: document.getElementById("step-title"),
  stepBody: document.getElementById("step-body"),
  prev: document.getElementById("prev-btn"),
  next: document.getElementById("next-btn"),
  reset: document.getElementById("reset-btn"),
  navToggle: document.getElementById("nav-toggle"),
  navMenu: document.getElementById("nav-menu"),
  navBackdrop: document.getElementById("nav-backdrop"),
  topNav: document.querySelector(".top-nav"),
  navSummary: document.getElementById("nav-summary"),
  docsBtn: document.getElementById("docs-btn"),
  docsBackdrop: document.getElementById("docs-backdrop"),
  docsClose: document.getElementById("docs-close"),
  jumpSelect: document.getElementById("jump-select"),
  jumpButton: document.getElementById("jump-btn"),
  footer: document.querySelector("footer.controls"),
  toast: document.getElementById("toast"),
};

let state = loadState();
let steps = [];

elements.prev.addEventListener("click", () => {
  if (state.currentStep === 0) return;
  state.currentStep -= 1;
  saveState();
  draw(false);
});

elements.next.addEventListener("click", () => {
  const step = steps[state.currentStep];
  const validation = validateStep(step);
  if (!validation.allow) {
    showToast(validation.message);
    return;
  }
  if (state.currentStep < steps.length - 1) {
    state.currentStep += 1;
    saveState();
    draw(false);
  } else {
    showToast("Ð“Ð¾Ñ‚Ð¾Ð²Ð¾! ÐœÐ¾Ð¶ÐµÑˆ Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ´Ð°Ñ‚Ð¸ Ð¿Ð¾Ð¿ÐµÑ€ÐµÐ´Ð½Ñ– ÐºÑ€Ð¾ÐºÐ¸.");
  }
});

if (elements.reset) {
  elements.reset.addEventListener("click", () => {
    if (!confirm("Ð¡ÐºÐ¸Ð½ÑƒÑ‚Ð¸ Ð²ÑÑ– ÐºÑ€Ð¾ÐºÐ¸ Ñ‚Ð° Ð¿Ð¾Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ÑÑ Ð´Ð¾ Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ?")) return;
    closeDocs();
    closeNavMenu();
    state = structuredClone(defaultState);
    saveState();
    draw(true);
    updateNavOnScroll();
    showToast("ÐœÐ°Ð¹ÑÑ‚ÐµÑ€ ÑÐºÐ¸Ð½ÑƒÑ‚Ð¾.");
  });
}

if (elements.jumpButton) {
  elements.jumpButton.addEventListener("click", () => {
    jumpToSelectedStep();
  });
}

if (elements.jumpSelect) {
  elements.jumpSelect.addEventListener("keydown", (event) => {
    if (event.key === "Enter") {
      event.preventDefault();
      jumpToSelectedStep();
    }
  });
}

if (elements.docsBtn && elements.docsBackdrop) {
  elements.docsBtn.addEventListener("click", openDocs);
}

if (elements.docsClose) {
  elements.docsClose.addEventListener("click", closeDocs);
}

if (elements.navToggle) {
  elements.navToggle.addEventListener("click", () => {
    if (elements.navMenu?.classList.contains("open")) {
      closeNavMenu();
    } else {
      openNavMenu();
    }
  });
}

if (elements.navBackdrop) {
  elements.navBackdrop.addEventListener("click", () => {
    closeNavMenu();
  });
}

document.addEventListener("keydown", (event) => {
  if (event.key === "Escape") {
    closeDocs();
    closeNavMenu();
  }
});

function jumpToSelectedStep() {
  if (!elements.jumpSelect) return;
  const value = elements.jumpSelect.value;
  if (!value) return;
  const index = steps.findIndex((step) => step.id === value);
  if (index === -1) return;
  state.currentStep = index;
  saveState();
  draw(false);
}

function openDocs() {
  elements.docsBackdrop.hidden = false;
  document.body.classList.add("docs-open");
}

function closeDocs() {
  elements.docsBackdrop.hidden = true;
  document.body.classList.remove("docs-open");
}

function openNavMenu() {
  if (!elements.navMenu || !elements.navToggle) return;
  elements.navMenu.classList.add("open");
  elements.navToggle.classList.add("open");
  elements.navToggle.setAttribute("aria-expanded", "true");
  elements.topNav?.classList.add("menu-active");
  elements.topNav?.classList.remove("scrolled");
  if (elements.navBackdrop) elements.navBackdrop.hidden = false;
  document.body.classList.add("nav-open");
}

function closeNavMenu() {
  if (!elements.navMenu || !elements.navToggle) return;
  elements.navMenu.classList.remove("open");
  elements.navToggle.classList.remove("open");
  elements.navToggle.setAttribute("aria-expanded", "false");
  if (elements.navBackdrop) elements.navBackdrop.hidden = true;
  document.body.classList.remove("nav-open");
  elements.topNav?.classList.remove("menu-active");
  updateNavOnScroll();
}

function isMobileNav() {
  return window.matchMedia("(max-width: 720px)").matches;
}

window.addEventListener("scroll", updateNavOnScroll, { passive: true });
updateNavOnScroll();

function updateNavOnScroll() {
  if (!elements.topNav) return;
  const scrolled = window.scrollY > 24;
  elements.topNav.classList.toggle(
    "scrolled",
    scrolled && !document.body.classList.contains("nav-open")
  );
}

function updateNavSummary() {
  if (!elements.navSummary) return;
  const type =
    BOT_TYPES.find((item) => item.id === state.choices.botType)?.title ||
    "Ð½Ðµ Ð¾Ð±Ñ€Ð°Ð½Ð¾";
  const environment =
    ENVIRONMENTS.find((item) => item.id === state.choices.environment)?.title ||
    "Ð½Ðµ Ð¾Ð±Ñ€Ð°Ð½Ð¾";
  const mode =
    MODE_OPTIONS.find((item) => item.id === state.choices.mode)?.title ||
    "Ð½Ðµ Ð¾Ð±Ñ€Ð°Ð½Ð¾";
  elements.navSummary.innerHTML = `Ð¢Ð¸Ð¿: <span>${type}</span> | Ð¡ÐµÑ€ÐµÐ´Ð¾Ð²Ð¸Ñ‰Ðµ: <span>${environment}</span> | Ð¨Ð†: <span>${mode}</span>`;
}

draw(true);

// --- Ð“Ð¾Ð»Ð¾Ð²Ð½Ñ– Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ— ---
function draw(rebuild) {
  if (rebuild) rebuildSteps();
  updateJumpControls();
  updateNavSummary();
  if (!steps.length) return;
  const step = steps[state.currentStep];

  elements.section.textContent = step.section;
  elements.stepIndex.textContent = `ÐšÑ€Ð¾Ðº ${step.number}`;
  elements.stepTitle.textContent = step.title;
  elements.stepBody.innerHTML = "";
  step.render(elements.stepBody);
  renderStepDetails(elements.stepBody, step.id);

  const progress = ((state.currentStep + 1) / steps.length) * 100;
  elements.progressInner.style.width = `${progress}%`;
  elements.progressLabel.textContent = `${state.currentStep + 1} / ${
    steps.length
  }`;

  elements.prev.disabled = state.currentStep === 0;
  elements.next.textContent =
    state.currentStep === steps.length - 1 ? "Ð—Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚Ð¸" : "Ð”Ð°Ð»Ñ– âž¡ï¸";
  elements.footer.style.display = step.hideNav ? "none" : "";
}

function rebuildSteps() {
  const currentId = steps[state.currentStep]?.id ?? null;
  steps = buildSteps(state);
  if (!steps.length) return;

  if (currentId) {
    const idx = steps.findIndex((step) => step.id === currentId);
    if (idx >= 0) {
      state.currentStep = idx;
      return;
    }
    if (isCustomBot(state)) {
      const customStart = steps.findIndex(
        (step) => step.id === "custom-requirements"
      );
      if (customStart >= 0) {
        state.currentStep = customStart;
        return;
      }
    }
  }
  state.currentStep = Math.min(state.currentStep, steps.length - 1);
}

function updateJumpControls() {
  if (!elements.jumpSelect || !elements.jumpButton) return;

  const select = elements.jumpSelect;
  const button = elements.jumpButton;
  const previousValue = select.value;

  select.innerHTML = "";

  const placeholder = document.createElement("option");
  placeholder.value = "";
  placeholder.textContent = "ÐŸÐ¾Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ÑÑ Ð´Ð¾ ÐºÑ€Ð¾ÐºÑƒ";
  placeholder.disabled = true;
  placeholder.selected = true;
  select.appendChild(placeholder);

  steps.forEach((step) => {
    const option = document.createElement("option");
    option.value = step.id;
    option.textContent = `ÐšÑ€Ð¾Ðº ${step.number}. ${step.title}`;
    select.appendChild(option);
  });

  const availableValues = new Set(steps.map((step) => step.id));
  if (availableValues.has(previousValue)) {
    select.value = previousValue;
  } else {
    select.value = "";
    select.selectedIndex = 0;
  }

  const disabled = steps.length === 0;
  select.disabled = disabled;
  button.disabled = disabled;
}

function buildSteps(currentState) {
  const result = [];
  const entryFile = getEntryFile(currentState);
  const customBot = isCustomBot(currentState);
  if (customBot) ensureCustomState(currentState);
  const extraModules = ensureExtraModules(currentState);
  ensureExtraModuleData(currentState);

  // I. Ð¡Ñ‚Ð°Ñ€Ñ‚
  result.push(
    createStep("start", "I. Ð¡Ñ‚Ð°Ñ€Ñ‚", "ÐŸÑ€Ð¸Ð²Ñ–Ñ‚Ð°Ð½Ð½Ñ", renderStartStep, {
      hideNav: true,
    })
  );
  result.push(
    createStep("bot-type", "I. Ð¡Ñ‚Ð°Ñ€Ñ‚", "Ð’Ð¸Ð±Ñ–Ñ€ Ñ‚Ð¸Ð¿Ñƒ Ð±Ð¾Ñ‚Ð°", renderBotTypeStep)
  );
  result.push(
    createStep("mode", "I. Ð¡Ñ‚Ð°Ñ€Ñ‚", "Ð’Ð¸Ð±Ñ–Ñ€ Ñ€ÐµÐ¶Ð¸Ð¼Ñƒ Ð¨Ð†", renderModeStep)
  );
  result.push(
    createStep(
      "environment",
      "I. Ð¡Ñ‚Ð°Ñ€Ñ‚",
      "Ð’Ð¸Ð±Ñ–Ñ€ ÑÐµÑ€ÐµÐ´Ð¾Ð²Ð¸Ñ‰Ð°",
      renderEnvironmentStep
    )
  );
  result.push(
    createStep("tools", "I. Ð¡Ñ‚Ð°Ñ€Ñ‚", "ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ–Ð²", renderToolsStep)
  );

// II. ÐŸÑ–Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ
result.push(
  createStep(
    "folder",
    "II. ÐŸÑ–Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ",
    "Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ Ñ€Ð¾Ð±Ð¾Ñ‡Ð¾Ð³Ð¾ ÑÐµÑ€ÐµÐ´Ð¾Ð²Ð¸Ñ‰Ð°",
    (container) => {
      const env = state.choices.environment; // 'local' Ð°Ð±Ð¾ 'codespaces'

      if (env === "codespaces") {
        // Ð¢Ð†Ð›Ð¬ÐšÐ˜ Ñ‚ÐµÐºÑÑ‚, Ð±ÐµÐ· ÐºÐ¾Ð¿Ñ–-ÐºÐ½Ð¾Ð¿Ð¾Ðº
        renderInfo(
          container,
          [
            "1. Ð—Ð°Ð¹Ð´Ð¸ Ð½Ð° ÑÐ²Ñ–Ð¹ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ð¹ Ð½Ð° GitHub.",
            "2. ÐÐ°Ñ‚Ð¸ÑÐ½Ð¸ ÐºÐ½Ð¾Ð¿ÐºÑƒ `Code`.",
            "3. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸ Ð½Ð° Ð²ÐºÐ»Ð°Ð´ÐºÑƒ `Codespaces`.",
            "4. ÐÐ°Ñ‚Ð¸ÑÐ½Ð¸ `Create codespace on main`.",
            "5. Ð”Ð¾Ñ‡ÐµÐºÐ°Ð¹ÑÑ, Ð¿Ð¾ÐºÐ¸ Ð²Ñ–Ð´ÐºÑ€Ð¸Ñ”Ñ‚ÑŒÑÑ Ð²ÐµÐ±-VS Code â€” Ñ†Ðµ Ñ– Ñ” Ñ‚Ð²Ñ–Ð¹ Codespace."
          ],
          "ÐœÐµÑ‚Ð°: Ð²Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ð¸ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ð¹ Ñƒ Codespaces Ñ– Ð¿Ñ€Ð°Ñ†ÑŽÐ²Ð°Ñ‚Ð¸ Ñ‚Ð°Ð¼ Ð· Ñ„Ð°Ð¹Ð»Ð°Ð¼Ð¸ Ð±Ð¾Ñ‚Ð° (main.py, requirements.txt, .env Ñ‚Ð¾Ñ‰Ð¾)."
        );
      } else {
        // LOCAL ÑÐº Ð±ÑƒÐ»Ð¾
        renderInfo(
          container,
          [
            "â€¢ Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ Ð¿Ð°Ð¿ÐºÑƒ `mybot` Ñƒ ÑÐµÐ±Ðµ Ð½Ð° ÐºÐ¾Ð¼Ð¿Ê¼ÑŽÑ‚ÐµÑ€Ñ–.",
            "â€¢ Ð’Ñ–Ð´ÐºÑ€Ð¸Ð¹ Ñ—Ñ— Ñƒ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€Ñ– (VS Code)."
          ],
          "ÐœÐµÑ‚Ð°: Ð¼Ð°Ñ‚Ð¸ Ñ‡Ð¸ÑÑ‚Ðµ Ð¼Ñ–ÑÑ†Ðµ Ð´Ð»Ñ Ñ„Ð°Ð¹Ð»Ñ–Ð² Ð±Ð¾Ñ‚Ð°."
        );
      }
    }
  )
);



  if (customBot) {
    result.push(
      createStep(
        "custom-requirements",
        "II. ÐŸÑ–Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ",
        "ÐžÐ¿Ð¸Ñ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ð¾Ð³Ð¾ Ð±Ð¾Ñ‚Ð°",
        renderCustomRequirementsStep
      )
    );
    result.push(
      createStep(
        "custom-brief-prompt",
        "II. ÐŸÑ–Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ",
        "ÐŸÑ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ Ð±Ñ€Ð¸Ñ„Ñƒ",
        renderCustomBriefPromptStep
      )
    );
    result.push(
      createStep(
        "custom-brief-import",
        "II. ÐŸÑ–Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ",
        "Ð—Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ Ð±Ñ€Ð¸Ñ„Ñƒ",
        renderCustomBriefInputStep
      )
    );
    result.push(
      createStep(
        "custom-files",
        "III. Ð¤Ð°Ð¹Ð»Ð¸",
        "Ð¤Ð°Ð¹Ð»Ð¸ Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ",
        renderCustomFilesStep
      )
    );
    result.push(
      createStep(
        "custom-terminal",
        "IV. Ð—Ð°Ð¿ÑƒÑÐº",
        "ÐšÐ¾Ð¼Ð°Ð½Ð´Ð¸ Ð´Ð»Ñ Ñ‚ÐµÑ€Ð¼Ñ–Ð½Ð°Ð»Ñƒ",
        renderCustomTerminalStep
      )
    );
    result.push(
      createStep(
        "custom-diagnostics",
        "IV. Ð—Ð°Ð¿ÑƒÑÐº",
        "Ð”Ñ–Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° Ð¿Ð¾Ð¼Ð¸Ð»Ð¾Ðº",
        renderCustomDiagnosticsStep
      )
    );
  } else {
    result.push(
      createStep(
        "main-file",
        "II. ÐŸÑ–Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ",
        `Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ ${entryFile}`,
        (c) =>
          renderInfo(c, [
            `â€¢ Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ Ñ„Ð°Ð¹Ð» \`${entryFile}\` Ñƒ ÐºÐ¾Ñ€ÐµÐ½Ñ–.`,
            "â€¢ ÐŸÐ¾ÐºÐ¸ Ð·Ð°Ð»Ð¸Ñˆ Ð¿Ð¾Ñ€Ð¾Ð¶Ð½Ñ–Ð¼ â€” ÐºÐ¾Ð´ Ð´Ð¾Ð´Ð°Ð¼Ð¾ Ð´Ð°Ð»Ñ–.",
          ])
      )
    );
    result.push(
      createStep(
        "file-structure",
        "II. ÐŸÑ–Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ",
        "Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ñ„Ð°Ð¹Ð»Ñ–Ð²",
        renderFileStructureStep
      )
    );
    result.push(
      createStep(
        "dev-brief",
        "II. ÐŸÑ–Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ",
        "DEV BRIEF",
        renderDevBriefStep
      )
    );
    result.push(
      createStep(
        "code-prompt",
        "II. ÐŸÑ–Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ",
        "ÐŸÑ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ ÐºÐ¾Ð´Ñƒ",
        renderCodePromptStep
      )
    );
    result.push(
      createStep(
        "requirements",
        "II. ÐŸÑ–Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ",
        "Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ requirements.txt",
        renderRequirementsStep
      )
    );
    result.push(
      createStep(
        "env-file",
        "II. ÐŸÑ–Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ",
        "Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ .env",
        renderEnvStep
      )
    );
  }

  // III. Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð¸Ñ…
  result.push(
    createStep(
      "backend-explain",
      "III. Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð¸Ñ…",
      "ÐŸÐ¾ÑÑÐ½ÐµÐ½Ð½Ñ Ð²Ñ–Ð´ Ð¿Ð°Ð½ÐµÐ»Ñ–",
      (c) =>
        renderInfo(c, [
          "â€¢ Ð‘ÐµÐ· Ð·Ð±ÐµÑ€Ñ–Ð³Ð°Ð½Ð½Ñ Ð±Ð¾Ñ‚ â€œÐ·Ð°Ð±ÑƒÐ²Ð°Ñ”â€ Ð²ÑÐµ Ð¿Ñ–ÑÐ»Ñ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÑƒ.",
          "â€¢ ÐžÐ±ÐµÑ€Ð¸ Ð¾Ð´Ð¸Ð½ Ð²Ð°Ñ€Ñ–Ð°Ð½Ñ‚ Ñ– Ð´Ð¾Ð²ÐµÐ´Ð¸ Ð¹Ð¾Ð³Ð¾ Ð´Ð¾ Ñ‚ÐµÑÑ‚Ñƒ.",
        ])
    )
  );
  result.push(
    createStep(
      "backend-choice",
      "III. Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð¸Ñ…",
      "Ð’Ð¸Ð±Ñ–Ñ€ Ñ‚Ð¸Ð¿Ñƒ Ð·Ð±ÐµÑ€Ñ–Ð³Ð°Ð½Ð½Ñ",
      renderBackendChoiceStep
    )
  );
  result.push(
    createStep(
      "backend-confirm",
      "III. Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð¸Ñ…",
      "ÐŸÑ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¶ÐµÐ½Ð½Ñ Ð²Ð¸Ð±Ð¾Ñ€Ñƒ",
      renderBackendConfirmStep
    )
  );

  const backend = BACKEND_OPTIONS.find(
    (option) => option.id === currentState.choices.backend
  );
  if (backend) {
    backend.steps.forEach((step, index) => {
      result.push(
        createStep(
          `backend-${backend.id}-${index}`,
          "III. Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð¸Ñ…",
          step.text.split(".")[0],
          (c) => renderBackendStep(c, backend.title, step)
        )
      );
    });
  }

  // IV. Ð”Ð¸Ð·Ð°Ð¹Ð½
  if (customBot) {
    result.push(
      createStep(
        "design-reply",
        "IV. Ð”Ð¸Ð·Ð°Ð¹Ð½",
        "Ð“Ð¾Ð»Ð¾Ð²Ð½Ðµ Ð¼ÐµÐ½ÑŽ (Reply-ÐºÐ½Ð¾Ð¿ÐºÐ¸)",
        renderCustomReplyStep
      )
    );
    result.push(
      createStep(
        "design-inline",
        "IV. Ð”Ð¸Ð·Ð°Ð¹Ð½",
        "Inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸",
        renderCustomInlineStep
      )
    );
  } else {
    result.push(
      createStep("design-overview", "IV. Ð”Ð¸Ð·Ð°Ð¹Ð½", DESIGN_STEPS[0].title, (c) =>
        renderInfo(c, DESIGN_STEPS[0].items)
      )
    );
    result.push(
      createStep(
        "design-reply",
        "IV. Ð”Ð¸Ð·Ð°Ð¹Ð½",
        "Ð“Ð¾Ð»Ð¾Ð²Ð½Ðµ Ð¼ÐµÐ½ÑŽ (Reply-ÐºÐ½Ð¾Ð¿ÐºÐ¸)",
        renderPresetReplyStep
      )
    );
    result.push(
      createStep(
        "design-inline",
        "IV. Ð”Ð¸Ð·Ð°Ð¹Ð½",
        "Inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸",
        renderPresetInlineStep
      )
    );
    result.push(
      createStep("design-copy", "IV. Ð”Ð¸Ð·Ð°Ð¹Ð½", DESIGN_STEPS[3].title, (c) =>
        renderInfo(c, DESIGN_STEPS[3].items)
      )
    );
  }

  // V. Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°
  if (customBot) {
    if (customBriefHasCommand("/stats")) {
      result.push(
        createStep(
          "stats-commands",
          "V. Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°",
          STATS_STEPS[0].title,
          (c) => renderInfo(c, STATS_STEPS[0].items)
        )
      );
      result.push(
        createStep("stats-report", "V. Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°", STATS_STEPS[1].title, (c) =>
          renderInfo(c, STATS_STEPS[1].items)
        )
      );
    }
    if (customBriefHasReminder()) {
      result.push(
        createStep(
          "stats-reminder",
          "V. Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°",
          STATS_STEPS[2].title,
          (c) => renderInfo(c, STATS_STEPS[2].items)
        )
      );
    }
  } else {
    STATS_STEPS.forEach((item, index) => {
      result.push(
        createStep(`stats-${index}`, "V. Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°", item.title, (c) =>
          renderInfo(c, item.items)
        )
      );
    });
  }

  // VI. ÐžÐ¿Ð»Ð°Ñ‚Ð¸
  result.push(
    createStep(
      "payments-choice",
      "VI. ÐžÐ¿Ð»Ð°Ñ‚Ð¸",
      "Ð’Ð¸Ð±Ñ–Ñ€ ÑÐ¸ÑÑ‚ÐµÐ¼Ð¸ Ð¾Ð¿Ð»Ð°Ñ‚Ð¸",
      renderPaymentsChoiceStep
    )
  );
  result.push(
    createStep(
      "payments-prep",
      "VI. ÐžÐ¿Ð»Ð°Ñ‚Ð¸",
      "ÐŸÑ–Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° ÐºÐ»ÑŽÑ‡Ñ–Ð²",
      renderPaymentPrepStep
    )
  );
  const payment = PAYMENT_METHODS.find(
    (option) => option.id === currentState.choices.payment
  );
  if (payment && payment.id !== "none") {
    payment.steps.forEach((step, index) => {
      result.push(
        createStep(
          `payment-${payment.id}-${index}`,
          "VI. ÐžÐ¿Ð»Ð°Ñ‚Ð¸",
          step.text.split(".")[0],
          (c) => renderPaymentStep(c, payment.title, step)
        )
      );
    });
  }

  // VII. Ð—Ð°Ð¿ÑƒÑÐº
  LAUNCH_STEPS.forEach((item, index) => {
    result.push(
      createStep(`launch-${index}`, "VII. Ð—Ð°Ð¿ÑƒÑÐº", item.title, (c) =>
        renderLaunchStep(c, item)
      )
    );
  });

  // VIII. Ð Ð¾Ð·Ð²Ð¸Ñ‚Ð¾Ðº
  result.push(
    createStep(
      "extra-modules",
      "VIII. Ð Ð¾Ð·Ð²Ð¸Ñ‚Ð¾Ðº",
      "Ð”Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ñ– Ð¼Ð¾Ð´ÑƒÐ»Ñ–",
      renderExtraModulesStep
    )
  );

  EXTRA_MODULE_OPTIONS.forEach((option) => {
    if (!extraModules[option.id]) return;
    const moduleSteps = getExtraModuleStepDefinitions(option.id);
    moduleSteps.forEach((step) => {
      result.push(
        createStep(step.id, "VIII. Ð Ð¾Ð·Ð²Ð¸Ñ‚Ð¾Ðº", step.title, step.render)
      );
    });
  });

  result.push(
    createStep("finish", "VIII. Ð Ð¾Ð·Ð²Ð¸Ñ‚Ð¾Ðº", FINISH_STEP.title, (c) =>
      renderInfo(c, FINISH_STEP.items)
    )
  );

  result.forEach((step, index) => {
    step.number = index + 1;
  });

  return result;
}

function createStep(id, section, title, renderFn, extras = {}) {
  const step = {
    id,
    section,
    title,
    render: renderFn,
    number: 0,
  };
  Object.assign(step, extras);
  return step;
}

function renderStartStep(container) {
  const block = document.createElement("div");
  block.className = "start-screen";

  const img = document.createElement("img");
  img.src = "assets/intro.gif";
  img.alt = "Onboarding";
  img.className = "start-gif";
  img.loading = "lazy";
  block.appendChild(img);

  const title = document.createElement("h3");
  title.textContent = "Ð—Ð°Ð¿ÑƒÑÐºÐ°Ñ”Ð¼Ð¾ Ð¼Ð°Ð¹ÑÑ‚ÐµÑ€ ÑÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ Ð²Ð»Ð°ÑÐ½Ð¾Ð³Ð¾ Telegram-Ð±Ð¾Ñ‚Ð°.";
  block.appendChild(title);

  const desc = document.createElement("p");
  desc.textContent =
    "ÐŸÑ€Ð¸Ð½Ñ†Ð¸Ð¿: Ð¾Ð´Ð½Ð° Ð´Ñ–Ñ = Ð¾Ð´Ð¸Ð½ ÐºÑ€Ð¾Ðº. Ð“Ð¾Ñ‚Ð¾Ð²Ñ–? ÐÐ°Ñ‚Ð¸ÑÐ½Ð¸ ÐºÐ½Ð¾Ð¿ÐºÑƒ â€” Ñ€ÑƒÑ…Ð°Ñ”Ð¼Ð¾ÑÑŒ.";
  block.appendChild(desc);

  const button = document.createElement("button");
  button.className = "primary";
  button.textContent = "ÐŸÐ¾Ñ‡Ð°Ñ‚Ð¸";
  button.addEventListener("click", () => {
    state.currentStep += 1;
    saveState();
    draw(true);
  });
  block.appendChild(button);

  container.appendChild(block);
}

function renderBotTypeStep(container) {
  const tableWrap = document.createElement("div");
  tableWrap.className = "table-wrapper";
  const table = document.createElement("table");
  table.innerHTML = `
    <thead>
      <tr>
        <th>Ð¢Ð¸Ð¿</th>
        <th>ÐžÐ¿Ð¸Ñ</th>
        <th>Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð¾Ð²Ð°Ð½Ñ– ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸</th>
      </tr>
    </thead>
    <tbody>
      ${BOT_TYPES.map(
        (type) => `
        <tr>
          <td>
            <label>
              <input type="radio" name="bot-type" value="${type.id}" ${
          state.choices.botType === type.id ? "checked" : ""
        } />
              <span>${type.title}</span>
            </label>
          </td>
          <td>${type.description}</td>
          <td>${type.commands.join(", ")}</td>
        </tr>
      `
      ).join("")}
    </tbody>
  `;
  table.addEventListener("change", (event) => {
    if (event.target.name === "bot-type") {
      const previous = state.choices.botType;
      const value = event.target.value;
      state.choices.botType = value;
      state.ui = structuredClone(defaultUiState);
      const type = BOT_TYPES.find((item) => item.id === state.choices.botType);
      if (type) state.commands = [...type.commands];
      if (value === "custom" && previous !== "custom") {
        state.custom = structuredClone(defaultCustomState);
        state.choices.entryFile = ENTRY_FILE_OPTIONS[0].id;
      }
      if (previous === "custom" && value !== "custom") {
        state.custom = structuredClone(defaultCustomState);
        state.choices.entryFile = ENTRY_FILE_OPTIONS[0].id;
      }
      saveState();
      draw(true);
    }
  });
  tableWrap.appendChild(table);
  container.appendChild(tableWrap);

  renderInfo(container, [
    "â€¢ ÐžÐ±ÐµÑ€Ð¸ ÑÑ†ÐµÐ½Ð°Ñ€Ñ–Ð¹, ÑÐºÐ¸Ð¹ Ð½Ð°Ð¹Ð±Ð»Ð¸Ð¶Ñ‡Ð¸Ð¹ Ð´Ð¾ Ñ‚Ð²Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ.",
  ]);
}

function renderModeStep(container) {
  const cards = document.createElement("div");
  cards.className = "card-grid";
  MODE_OPTIONS.forEach((option) => {
    const card = document.createElement("div");
    card.className = "card";
    if (state.choices.mode === option.id) card.classList.add("active");
    card.innerHTML = `<h3>${option.title}</h3><p>${option.description}</p>`;
    card.addEventListener("click", () => {
      state.choices.mode = option.id;
      saveState();
      draw(false);
    });
    cards.appendChild(card);
  });
  container.appendChild(cards);

  renderInfo(container, [
    "â€¢ Ð ÐµÐ¶Ð¸Ð¼ Ð²Ð¿Ð»Ð¸Ð²Ð°Ñ” Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ¸ Â«Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð´Ð»Ñ ChatGPT / CodexÂ».",
  ]);
}

function renderEnvironmentStep(container) {
  const cards = document.createElement("div");
  cards.className = "card-grid";
  ENVIRONMENTS.forEach((env) => {
    const card = document.createElement("div");
    card.className = "card";
    if (state.choices.environment === env.id) card.classList.add("active");
    card.innerHTML = `<h3>${env.title}</h3><p>${env.description}</p>`;
    card.addEventListener("click", () => {
      state.choices.environment = env.id;
      saveState();
      draw(false);
    });
    cards.appendChild(card);
  });
  container.appendChild(cards);

  renderInfo(container, ["â€¢ Ð’Ð¸Ð±Ñ–Ñ€ ÑÐµÑ€ÐµÐ´Ð¾Ð²Ð¸Ñ‰Ð° Ð¿Ñ–Ð´Ð»Ð°ÑˆÑ‚ÑƒÑ” Ð¿Ñ–Ð´ÐºÐ°Ð·ÐºÐ¸ Ñ‚Ð° ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸."]);
}

function renderToolsStep(container) {
  const isCodespaces = state.choices.environment === "codespaces";
  const aiTarget = getPromptAiTarget("instructions");

  if (isCodespaces) {
    const infoLines = [
      "â€¢ Ð£Ð²Ñ–Ð¹Ð´Ð¸ Ñƒ ÑÐ²Ñ–Ð¹ Ð°ÐºÐ°ÑƒÐ½Ñ‚ GitHub â€” Codespaces Ð¿Ñ€Ð°Ñ†ÑŽÑ” Ñ‡ÐµÑ€ÐµÐ· Ð½ÑŒÐ¾Ð³Ð¾.",
      "â€¢ Ð£ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ñ— Ð½Ð°Ñ‚Ð¸ÑÐ½Ð¸ Â«<> CodeÂ» â†’ Ð²ÐºÐ»Ð°Ð´ÐºÑƒ Â«CodespacesÂ» â†’ Â«Create codespace on mainÂ».",
      "â€¢ Ð”Ð¾Ñ‡ÐµÐºÐ°Ð¹ÑÑ Ð·Ð°Ð¿ÑƒÑÐºÑƒ ÑÐµÑ€ÐµÐ´Ð¾Ð²Ð¸Ñ‰Ð°: Python, git Ñ– Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€ ÑƒÐ¶Ðµ Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ–, Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ– Ñ–Ð½ÑÑ‚Ð°Ð»ÑÑ†Ñ–Ñ— Ð½Ðµ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ñ–.",
      "â€¢ Ð’Ñ–Ð´ÐºÑ€Ð¸Ð¹ Ñ‚ÐµÑ€Ð¼Ñ–Ð½Ð°Ð» Ñƒ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ñ– (Terminal â†’ New Terminal) Ñ‚Ð° Ð·Ð°Ð¿ÑƒÑÐºÐ°Ð¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸ Ð¿Ñ€ÑÐ¼Ð¾ Ð² Codespaces.",
      "â€¢ Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹ Ð²ÐºÐ»Ð°Ð´ÐºÑƒ Ports, Ñ‰Ð¾Ð± Ð²Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ð¸ Ð¿Ñ€Ð¾ÐºÐ¸Ð½ÑƒÑ‚Ñ– Ð²ÐµÐ±-Ð¿Ð¾Ñ€Ñ‚Ð¸ Ñƒ Ð½Ð¾Ð²Ð¾Ð¼Ñƒ Ð²Ñ–ÐºÐ½Ñ–.",
    ];
    if (state.choices.mode === "codex") {
      infoLines.push(
        "â€¢ Ð”Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð´Ð¾Ð¿Ð¾Ð²Ð½ÐµÐ½Ð½Ñ Ð²Ñ–Ð´ÐºÑ€Ð¸Ð¹ View â†’ Extensions, Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸ Codex Ñ– Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·ÑƒÐ¹ÑÑ Ð²ÑÐµÑ€ÐµÐ´Ð¸Ð½Ñ– Codespaces."
      );
    }
    renderInfo(container, infoLines);
  } else {
    renderInfo(
      container,
      [
        "â€¢ Python 3.10+ â€” Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸ Ð¾ÑÑ‚Ð°Ð½Ð½ÑŽ Ð²ÐµÑ€ÑÑ–ÑŽ Ñ–Ð· Ð¾Ñ„Ñ–Ñ†Ñ–Ð¹Ð½Ð¾Ð³Ð¾ ÑÐ°Ð¹Ñ‚Ñƒ.",
        "â€¢ IDE â€” VS Code Ð· Ñ€Ð¾Ð·ÑˆÐ¸Ñ€ÐµÐ½Ð½ÑÐ¼Ð¸ Python, Pylance.",
        "â€¢ GitHub â€” Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·ÑƒÐ¹ÑÑ Ð°Ð±Ð¾ ÑÑ‚Ð²Ð¾Ñ€Ð¸ Ð°ÐºÐ°ÑƒÐ½Ñ‚.",
      ].concat(
        state.choices.mode === "codex"
          ? ["â€¢ Codex â€” ÑƒÐ²Ñ–Ð¼ÐºÐ½Ð¸ Codex Ñƒ VS Code."]
          : []
      )
    );
  }

  const grid = document.createElement("div");
  grid.className = "card-grid";

  if (isCodespaces) {
    grid.appendChild(
      createToolCard({
        title: "GitHub Ð°ÐºÐ°ÑƒÐ½Ñ‚",
        description: "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ð´Ð»Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ñƒ Ð´Ð¾ Codespaces Ñ– Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ ÐºÐ¾Ð´Ñƒ.",
        link: "https://github.com/",
        prompt:
          "ÐŸÐ¾ÑÑÐ½Ð¸, ÑÐº Ð·Ð°Ñ€ÐµÑ”ÑÑ‚Ñ€ÑƒÐ²Ð°Ñ‚Ð¸ÑÑ Ð½Ð° GitHub, ÑƒÐ²Ñ–Ð¼ÐºÐ½ÑƒÑ‚Ð¸ Ð´Ð²Ð¾Ñ„Ð°ÐºÑ‚Ð¾Ñ€Ð½Ñƒ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ°Ñ†Ñ–ÑŽ Ñ‚Ð° Ð½Ð°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ñ„Ñ–Ð»ÑŒ.",
        ai: aiTarget,
      })
    );

    grid.appendChild(
      createToolCard({
        title: "Quickstart Ð· Codespaces",
        description: "Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ Ñ€Ð¾Ð±Ð¾Ñ‡Ðµ ÑÐµÑ€ÐµÐ´Ð¾Ð²Ð¸Ñ‰Ðµ Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ñ– Ð·Ð° ÐºÑ–Ð»ÑŒÐºÐ° Ñ…Ð²Ð¸Ð»Ð¸Ð½.",
        link: "https://docs.github.com/en/codespaces/getting-started/quickstart",
        prompt:
          "Ð Ð¾Ð·ÐºÐ°Ð¶Ð¸, ÑÐº Ñƒ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ñ— Ð²Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ð¸ Ð²ÐºÐ»Ð°Ð´ÐºÑƒ Codespaces Ñ– ÑÑ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð½Ð¾Ð²Ð¸Ð¹ codespace Ð½Ð° Ð³Ñ–Ð»Ñ†Ñ– main. Ð”Ð¾Ð´Ð°Ð¹ ÐºÑ€Ð¾ÐºÐ¸ Ð·Ð°Ð¿ÑƒÑÐºÑƒ Ñ‚ÐµÑ€Ð¼Ñ–Ð½Ð°Ð»Ñƒ.",
        ai: aiTarget,
      })
    );

    grid.appendChild(
      createToolCard({
        title: "Ð Ð¾Ð±Ð¾Ñ‚Ð° Ð²ÑÐµÑ€ÐµÐ´Ð¸Ð½Ñ– Codespaces",
        description: "Ð¢ÐµÑ€Ð¼Ñ–Ð½Ð°Ð», Ð¿Ð¾Ñ€Ñ‚Ð¸, ÑÐµÐºÑ€ÐµÑ‚Ð¸ Ñ‚Ð° Ð·ÑƒÐ¿Ð¸Ð½ÐºÐ° ÑÐµÑ€ÐµÐ´Ð¾Ð²Ð¸Ñ‰Ð°.",
        link: "https://docs.github.com/en/codespaces/troubleshooting/troubleshooting-codespaces",
        prompt:
          "ÐžÐ¿Ð¸ÑˆÐ¸, ÑÐº Ñƒ Codespaces Ð²Ñ–Ð´ÐºÑ€Ð¸Ð²Ð°Ñ‚Ð¸ Ð½Ð¾Ð²Ð¸Ð¹ Ñ‚ÐµÑ€Ð¼Ñ–Ð½Ð°Ð», Ð¿Ñ€Ð¾ÐºÐ¸Ð´Ð°Ñ‚Ð¸ Ð¿Ð¾Ñ€Ñ‚ Ñ– Ð·ÑƒÐ¿Ð¸Ð½ÑÑ‚Ð¸ ÑÐµÑ€ÐµÐ´Ð¾Ð²Ð¸Ñ‰Ðµ Ð¿Ñ–ÑÐ»Ñ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸.",
        ai: aiTarget,
      })
    );

    if (state.choices.mode === "codex") {
      grid.appendChild(
        createToolCard({
          title: "Codex Ñƒ Codespaces",
          description:
            "Ð£Ð²Ñ–Ð¼ÐºÐ½Ð¸ Ñ€Ð¾Ð·ÑˆÐ¸Ñ€ÐµÐ½Ð½Ñ Codex Ð¿Ñ€ÑÐ¼Ð¾ Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð½Ð¾Ð¼Ñƒ VS Code.",
          link: "https://marketplace.visualstudio.com/items?itemName=openai.chatgpt",
          prompt:
            "ÐŸÐ¾ÑÑÐ½Ð¸, ÑÐº Ñƒ Codespaces Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ð¸ Ñ€Ð¾Ð·ÑˆÐ¸Ñ€ÐµÐ½Ð½Ñ GitHub Codex, ÑƒÐ²Ñ–Ð¹Ñ‚Ð¸ Ñ‚Ð° Ð°ÐºÑ‚Ð¸Ð²ÑƒÐ²Ð°Ñ‚Ð¸ Ð°Ð²Ñ‚Ð¾Ð´Ð¾Ð¿Ð¾Ð²Ð½ÐµÐ½Ð½Ñ.",
          ai: aiTarget,
        })
      );
    }
  } else {
    grid.appendChild(
      createToolCard({
        title: "Python 3.12",
        description: "ÐžÑ„Ñ–Ñ†Ñ–Ð¹Ð½Ð¸Ð¹ Ñ–Ð½ÑÑ‚Ð°Ð»ÑÑ‚Ð¾Ñ€ Ð´Ð»Ñ Windows / macOS / Linux.",
        link: "https://www.python.org/downloads/",
        prompt:
          "ÐŸÐ¾ÑÑÐ½Ð¸, ÑÐº Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ð¸ Python 3.12 Ð½Ð° Ð¼Ð¾ÑŽ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ. Ð”Ð¾Ð´Ð°Ð¹ ÐºÑ€Ð¾ÐºÐ¸ Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ¸ python --version.",
        ai: aiTarget,
      })
    );

    grid.appendChild(
      createToolCard({
        title: "VS Code",
        description:
          "Ð ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€ Ñ–Ð· Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¸Ð¼Ð¸ Ð¿Ð»Ð°Ð³Ñ–Ð½Ð°Ð¼Ð¸: Python, Pylance, Codex.",
        link: "https://code.visualstudio.com/",
        prompt:
          "ÐŸÐ¾ÑÑÐ½Ð¸, ÑÐº Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ð¸ VS Code Ñ‚Ð° Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ñ€Ð¾Ð·ÑˆÐ¸Ñ€ÐµÐ½Ð½Ñ Python, Pylance Ñ– Codex.",
        ai: aiTarget,
      })
    );

    grid.appendChild(
      createToolCard({
        title: "GitHub",
        description: "Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ Ð°Ð±Ð¾ ÑƒÐ²Ñ–Ð¹Ð´Ð¸ Ñƒ ÑÐ²Ñ–Ð¹ Ð°ÐºÐ°ÑƒÐ½Ñ‚.",
        link: "https://github.com/",
        prompt:
          "ÐŸÐ¾ÑÑÐ½Ð¸, ÑÐº Ð·Ð°Ñ€ÐµÑ”ÑÑ‚Ñ€ÑƒÐ²Ð°Ñ‚Ð¸ÑÑ Ð½Ð° GitHub, ÑƒÐ²Ñ–Ð¼ÐºÐ½ÑƒÑ‚Ð¸ 2FA Ñ‚Ð° Ð½Ð°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ñ‚Ð¸ git config.",
        ai: aiTarget,
      })
    );

    if (state.choices.mode === "codex") {
      grid.appendChild(
        createToolCard({
          title: "Codex",
          description: "ÐÐºÑ‚Ð¸Ð²ÑƒÐ¹ Codex Ñƒ VS Code, Ñ‰Ð¾Ð± Ð¿Ñ€Ð°Ñ†ÑŽÐ²Ð°Ñ‚Ð¸.",
          link: "https://marketplace.visualstudio.com/items?itemName=openai.chatgpt",
          prompt:
            "ÐŸÐ¾ÑÑÐ½Ð¸, ÑÐº ÑƒÐ²Ñ–Ð¼ÐºÐ½ÑƒÑ‚Ð¸ GitHub Codex Ñƒ VS Code Ñ‚Ð° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·ÑƒÐ²Ð°Ñ‚Ð¸ÑÑ.",
          ai: aiTarget,
        })
      );
    }
  }

  container.appendChild(grid);

  const checklist = document.createElement("div");
  checklist.className = "checklist";

  const checklistItems = isCodespaces
    ? CODESPACES_TOOL_CHECKLIST
    : TOOL_CHECKLIST;

  if (isCodespaces) {
    state.tools.python = false;
    state.tools.editor = false;
  } else {
    state.tools.codespace = false;
    state.tools.browser = false;
  }

  checklistItems.forEach((tool) => {
    if (tool.optional && state.choices.mode !== "codex") {
      state.tools[tool.id] = false;
      return;
    }
    if (state.tools[tool.id] === undefined) state.tools[tool.id] = false;
    const row = document.createElement("div");
    row.className = "check-item";
    const label = document.createElement("label");
    const input = document.createElement("input");
    input.type = "checkbox";
    input.checked = !!state.tools[tool.id];
    input.addEventListener("change", (event) => {
      state.tools[tool.id] = event.target.checked;
      saveState();
    });
    label.append(input, document.createTextNode(tool.label));
    row.appendChild(label);
    checklist.appendChild(row);
  });

  container.appendChild(checklist);
}

function renderFileStructureStep(container) {
  const entryFile = getEntryFile();

  const selector = document.createElement("div");
  selector.className = "file-structure-selector";

  const selectorLabel = document.createElement("label");
  selectorLabel.textContent = "ÐžÑÐ½Ð¾Ð²Ð½Ð¸Ð¹ Ñ„Ð°Ð¹Ð» Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ:";
  selector.appendChild(selectorLabel);

  const select = document.createElement("select");
  select.id = "entry-file-select";
  selectorLabel.setAttribute("for", select.id);
  ENTRY_FILE_OPTIONS.forEach((option) => {
    const opt = document.createElement("option");
    opt.value = option.id;
    opt.textContent = option.label;
    select.appendChild(opt);
  });
  select.value = entryFile;
  select.addEventListener("change", (event) => {
    state.choices.entryFile = event.target.value;
    saveState();
    draw(true);
  });
  selector.appendChild(select);

  container.appendChild(selector);

  // Ð¡ÐµÐºÑ†Ñ–Ñ Ð· Ñ–Ð½Ð´Ð¸Ð²Ñ–Ð´ÑƒÐ°Ð»ÑŒÐ½Ð¸Ð¼ ÐºÐ¾Ð´Ð¾Ð¼
  const manualSection = createFileSection(
    "Ð¤Ð°Ð¹Ð»Ð¸ Ð· Ñ–Ð½Ð´Ð¸Ð²Ñ–Ð´ÑƒÐ°Ð»ÑŒÐ½Ð¸Ð¼ ÐºÐ¾Ð´Ð¾Ð¼",
    "ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð† Ð·Ð³ÐµÐ½ÐµÑ€ÑƒÐ²Ð°Ñ‚Ð¸ Ñ†Ñ– Ñ„Ð°Ð¹Ð»Ð¸ Ñ‚Ð° Ð²ÑÑ‚Ð°Ð² Ñ—Ñ… Ð²Ñ€ÑƒÑ‡Ð½Ñƒ."
  );
  const manualList = document.createElement("div");
  manualList.className = "file-card-stack";
  manualList.appendChild(createManualFileCard(entryFile));
  manualSection.appendChild(manualList);
  container.appendChild(manualSection);

  // Ð¡Ñ‚Ð°Ñ‚Ð¸Ñ‡Ð½Ñ– Ñ„Ð°Ð¹Ð»Ð¸
  const staticSection = createFileSection(
    "Ð“Ð¾Ñ‚Ð¾Ð²Ñ– Ð·Ð°Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ¸",
    "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ¹ Ð²ÐºÐ°Ð·Ð°Ð½Ð¸Ð¹ ÐºÐ¾Ð´ Ñ‚Ð° Ð²ÑÑ‚Ð°Ð² Ñƒ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð½Ñ– Ñ„Ð°Ð¹Ð»Ð¸ Ð±ÐµÐ· Ð·Ð¼Ñ–Ð½."
  );
  const staticList = document.createElement("div");
  staticList.className = "file-card-stack";
  FILE_STRUCTURE_STATIC_FILES.forEach((item) => {
    staticList.appendChild(createStaticFileCard(item));
  });
  staticSection.appendChild(staticList);
  container.appendChild(staticSection);

  // Ð‘ÐµÐºÐµÐ½Ð´-ÑÐ¿ÐµÑ†Ð¸Ñ„Ñ–Ñ‡Ð½Ñ– Ñ„Ð°Ð¹Ð»Ð¸
  const backend = state.choices.backend;
  const backendEntries = FILE_STRUCTURE_BACKEND_MAP[backend] || [];
  const backendSection = createFileSection(
    "Ð”Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ð¾ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð½Ð¾Ð³Ð¾ Ð±ÐµÐºÐµÐ½Ð´Ñƒ",
    backend
      ? "Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ Ñ†Ñ– ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¸, Ñ‰Ð¾Ð± ÑÑ…Ð¾Ð²Ð¸Ñ‰Ðµ Ð¿Ñ€Ð°Ñ†ÑŽÐ²Ð°Ð»Ð¾ ÐºÐ¾Ñ€ÐµÐºÑ‚Ð½Ð¾."
      : "ÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ð±ÐµÐºÐµÐ½Ð´, Ñ‰Ð¾Ð± Ð¿Ð¾Ð±Ð°Ñ‡Ð¸Ñ‚Ð¸ Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ñ– Ñ„Ð°Ð¹Ð»Ð¸/Ð¿Ð°Ð¿ÐºÐ¸."
  );

  if (!backend) {
    const info = document.createElement("p");
    info.className = "file-section-hint";
    info.textContent =
      "Ð‘ÐµÐºÐµÐ½Ð´ Ñ‰Ðµ Ð½Ðµ Ð¾Ð±Ñ€Ð°Ð½Ð¾. ÐŸÐµÑ€ÐµÐ¹Ð´Ñ–Ñ‚ÑŒ Ð½Ð° ÐºÑ€Ð¾Ðº Â«Ð’Ð¸Ð±Ñ–Ñ€ Ñ‚Ð¸Ð¿Ñƒ Ð·Ð±ÐµÑ€Ñ–Ð³Ð°Ð½Ð½ÑÂ».";
    backendSection.appendChild(info);
  } else if (!backendEntries.length) {
    const info = document.createElement("p");
    info.className = "file-section-hint";
    info.textContent =
      "Ð”Ð»Ñ Ñ†ÑŒÐ¾Ð³Ð¾ Ð±ÐµÐºÐµÐ½Ð´Ñƒ Ð½ÐµÐ¼Ð°Ñ” Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ð¸Ñ… Ñ„Ð°Ð¹Ð»Ñ–Ð² â€” Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð½ÑŒÐ¾ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ñ— ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸.";
    backendSection.appendChild(info);
  } else {
    const backendList = document.createElement("div");
    backendList.className = "file-card-stack";
    backendEntries.forEach((item) => {
      backendList.appendChild(createBackendCard(item));
    });
    backendSection.appendChild(backendList);
  }

  container.appendChild(backendSection);

  function createFileSection(title, subtitle) {
    const section = document.createElement("section");
    section.className = "file-structure-section";

    const head = document.createElement("header");
    head.className = "file-section-head";

    const h3 = document.createElement("h3");
    h3.textContent = title;
    head.appendChild(h3);

    if (subtitle) {
      const p = document.createElement("p");
      p.textContent = subtitle;
      head.appendChild(p);
    }

    section.appendChild(head);
    return section;
  }

  function createManualFileCard(fileName) {
    const wrapper = document.createElement("article");
    wrapper.className = "file-card manual";

    const title = document.createElement("header");
    title.className = "file-card-path";
    title.textContent = fileName;
    wrapper.appendChild(title);

    const desc = document.createElement("p");
    desc.className = "file-card-description";
    desc.textContent =
      "Ð¦ÐµÐ¹ Ñ„Ð°Ð¹Ð» Ð¼Ñ–ÑÑ‚Ð¸Ñ‚ÑŒ Ð±Ñ–Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ñ–ÐºÑƒ Ð±Ð¾Ñ‚Ð°. Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¸ Ñƒ Ð¨Ð† Ð¿Ð¾Ð²Ð½Ð¸Ð¹ Ð²Ð¼Ñ–ÑÑ‚ Ñ– Ð²ÑÑ‚Ð°Ð² Ð¹Ð¾Ð³Ð¾ Ð² Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€.";
    wrapper.appendChild(desc);

    const prompt = generateManualFilePrompt(fileName);
    const aiTarget = getPromptAiTarget("code");
    wrapper.appendChild(
      createPromptBlock(prompt, {
        copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ Ð¨Ð†",
        ai: aiTarget,
        openLabel: getAiLabel(aiTarget),
      })
    );

    const note = document.createElement("p");
    note.className = "file-card-note";
    note.textContent =
      "ÐŸÑ–ÑÐ»Ñ Ð²ÑÑ‚Ð°Ð²ÐºÐ¸ ÐºÐ¾Ð´Ñƒ Ð·Ð±ÐµÑ€ÐµÐ¶Ð¸ Ñ„Ð°Ð¹Ð» Ñ‚Ð° Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑŒ Ð´Ð¾ Ð½Ð°ÑÑ‚ÑƒÐ¿Ð½Ð¸Ñ… ÐºÑ€Ð¾ÐºÑ–Ð².";
    wrapper.appendChild(note);

    return wrapper;
  }

  function createStaticFileCard(item) {
    const card = document.createElement("article");
    card.className = "file-card static";

    const title = document.createElement("header");
    title.className = "file-card-path";
    title.textContent = item.title;
    card.appendChild(title);

    if (item.description) {
      const desc = document.createElement("p");
      desc.className = "file-card-description";
      desc.textContent = item.description;
      card.appendChild(desc);
    }

    if (item.content) {
      const code = document.createElement("pre");
      code.className = "file-card-code";
      code.textContent = item.content;
      card.appendChild(code);

      const actions = document.createElement("div");
      actions.className = "file-card-actions";
      const copyBtn = document.createElement("button");
      copyBtn.type = "button";
      copyBtn.className = "ghost copy-btn";
      copyBtn.textContent = "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð²Ð¼Ñ–ÑÑ‚";
      copyBtn.addEventListener("click", () => copyText(item.content));
      actions.appendChild(copyBtn);
      card.appendChild(actions);
    }

    return card;
  }

  function createBackendCard(item) {
    if (item.type === "note") {
      const note = document.createElement("p");
      note.className = "file-section-hint";
      note.textContent = item.description;
      return note;
    }

    const card = document.createElement("article");
    card.className = `file-card backend ${item.type || "info"}`;

    if (item.path) {
      const title = document.createElement("header");
      title.className = "file-card-path";
      title.textContent = item.path;
      card.appendChild(title);
    }

    if (item.description) {
      const desc = document.createElement("p");
      desc.className = "file-card-description";
      desc.textContent = item.description;
      card.appendChild(desc);
    }

    if (item.type === "static" && item.content) {
      const code = document.createElement("pre");
      code.className = "file-card-code";
      code.textContent = item.content;
      card.appendChild(code);

      const actions = document.createElement("div");
      actions.className = "file-card-actions";
      const copyBtn = document.createElement("button");
      copyBtn.type = "button";
      copyBtn.className = "ghost copy-btn";
      copyBtn.textContent = "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð²Ð¼Ñ–ÑÑ‚";
      copyBtn.addEventListener("click", () => copyText(item.content));
      actions.appendChild(copyBtn);
      card.appendChild(actions);
    }

    if (item.type === "dir" || item.type === "info") {
      const actions = document.createElement("div");
      actions.className = "file-card-actions";
      const copyBtn = document.createElement("button");
      copyBtn.type = "button";
      copyBtn.className = "ghost copy-btn";
      copyBtn.textContent = "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ ÑˆÐ»ÑÑ…";
      copyBtn.addEventListener("click", () => copyText(item.path));
      actions.appendChild(copyBtn);
      card.appendChild(actions);
    }

    if (item.type === "ai" && item.prompt) {
      const aiTarget = getPromptAiTarget("code");
      card.appendChild(
        createPromptBlock(item.prompt, {
          copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚",
          ai: aiTarget,
          openLabel: getAiLabel(aiTarget),
        })
      );
    }

    return card;
  }
}

function renderDevBriefStep(container) {
  const panel = document.createElement("div");
  panel.className = "review-card";

  const h = document.createElement("h3");
  h.textContent = "ÐžÐ³Ð»ÑÐ´ Ð²Ð¸Ð±Ð¾Ñ€Ñ–Ð² Ñ‚Ð° ÑˆÐ²Ð¸Ð´ÐºÐµ Ñ€ÐµÐ´Ð°Ð³ÑƒÐ²Ð°Ð½Ð½Ñ";
  panel.appendChild(h);

  panel.appendChild(
    makeRow(
      "Ð¢Ð¸Ð¿ Ð±Ð¾Ñ‚Ð°",
      makeSelect(
        BOT_TYPES.map((t) => [t.id, `${t.title} â€” ${t.description}`]),
        state.choices.botType,
        (value) => {
          const previous = state.choices.botType;
          state.choices.botType = value;
          state.ui = structuredClone(defaultUiState);
          const type = BOT_TYPES.find((item) => item.id === value);
          if (type) state.commands = [...type.commands];
          if (value === "custom" && previous !== "custom") {
            state.custom = structuredClone(defaultCustomState);
            state.choices.entryFile = ENTRY_FILE_OPTIONS[0].id;
          }
          if (previous === "custom" && value !== "custom") {
            state.custom = structuredClone(defaultCustomState);
            state.choices.entryFile = ENTRY_FILE_OPTIONS[0].id;
          }
          saveState();
          draw(true);
        }
      )
    )
  );

  panel.appendChild(
    makeRow(
      "Ð ÐµÐ¶Ð¸Ð¼ Ð¨Ð†",
      makeSelect(
        MODE_OPTIONS.map((m) => [m.id, m.title]),
        state.choices.mode,
        (value) => {
          state.choices.mode = value;
          if (value !== "codex") state.tools.Ñodex = false;
          saveState();
          draw(false);
        }
      )
    )
  );

  panel.appendChild(
    makeRow(
      "Ð¡ÐµÑ€ÐµÐ´Ð¾Ð²Ð¸Ñ‰Ðµ",
      makeSelect(
        ENVIRONMENTS.map((env) => [env.id, env.title]),
        state.choices.environment,
        (value) => {
          state.choices.environment = value;
          saveState();
          draw(false);
        }
      )
    )
  );

  const commandsTextarea = document.createElement("textarea");
  commandsTextarea.value = state.commands.join(", ");
  commandsTextarea.addEventListener("input", (event) => {
    const commands = event.target.value
      .split(",")
      .map((item) => item.trim())
      .filter(Boolean);
    state.commands = commands.map((cmd) =>
      cmd.startsWith("/") ? cmd : `/${cmd}`
    );
    saveState();
  });
  panel.appendChild(makeRow("ÐšÐ¾Ð¼Ð°Ð½Ð´Ð¸", wrapControl(commandsTextarea)));

  container.appendChild(panel);

  const brief = generateDevBrief();

  // Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð·ÑƒÑ”Ð¼Ð¾ Ñ‚ÐµÐºÑÑ‚ Ð±ÐµÐ· Ð¶Ð¾Ð´Ð½Ð¸Ñ… ÐºÐ½Ð¾Ð¿Ð¾Ðº
  const block = document.createElement("div");
  block.className = "prompt-area";

  const pre = document.createElement("pre");
  pre.className = "prompt-text";
  pre.textContent = brief;

  block.appendChild(pre);
  container.appendChild(block);
}

function renderCodePromptStep(container) {
  const prompt = generateCodePrompt();
  renderInfo(container, ["Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð½Ð¸Ð¶Ñ‡Ðµ, Ñ‰Ð¾Ð± Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ ÐºÐ¾Ð´."]);
  const aiTarget = getPromptAiTarget("code");
  const block = createPromptBlock(prompt, {
    copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚",
    ai: aiTarget,
    openLabel: getAiLabel(aiTarget),
  });
  container.appendChild(block);
}

function renderRequirementsStep(container) {
  const entryFile = getEntryFile();
  const aiTarget = getPromptAiTarget("instructions");
  const promptBlock = createPromptBlock(
    `Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ Ñ„Ð°Ð¹Ð» requirements.txt Ñ– Ð´Ð¾Ð´Ð°Ð¹ Ñ€ÑÐ´ÐºÐ¸:\n\naiogram==3.*\npython-dotenv`,
    {
      copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ñ–ÑŽ",
      ai: aiTarget,
      openLabel: getAiLabel(aiTarget),
    }
  );
  container.appendChild(promptBlock);

  const checklist = document.createElement("div");
  checklist.className = "info-block";
  const label = document.createElement("label");
  label.className = "info-line";
  const text = document.createElement("span");
  text.textContent = "ÐŸÐ¾Ð·Ð½Ð°Ñ‡, Ñ‰Ð¾ Ñ„Ð°Ð¹Ð» requirements.txt ÑÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð¾:";
  const input = document.createElement("input");
  input.type = "checkbox";
  input.checked = !!state.tools.requirements;
  input.addEventListener("change", (event) => {
    state.tools.requirements = event.target.checked;
    saveState();
    draw(false);
  });
  label.append(text, input);
  checklist.appendChild(label);
  container.appendChild(checklist);

  if (!state.tools.requirements) {
    const carousel = document.createElement("div");
    carousel.className = "carousel";

    carousel.appendChild(
      createCarouselSlide({
        title: "ÐšÑ€Ð¾Ðº 1. Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ Ñ„Ð°Ð¹Ð»",
        body: "Ð£ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€Ñ– Ð½Ð°Ñ‚Ð¸ÑÐ½Ð¸ New File, Ð½Ð°Ð·Ð²Ð¸ Ñ„Ð°Ð¹Ð» requirements.txt Ñ‚Ð° Ð·Ð±ÐµÑ€ÐµÐ¶Ð¸ Ð¹Ð¾Ð³Ð¾ Ñƒ ÐºÐ¾Ñ€ÐµÐ½Ñ– Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ.",
      })
    );

    carousel.appendChild(
      createCarouselSlide({
        title: "ÐšÑ€Ð¾Ðº 2. Ð”Ð¾Ð´Ð°Ð¹ Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚Ñ–",
        body: "Ð’ÑÑ‚Ð°Ð² Ñ€ÑÐ´ÐºÐ¸ aiogram==3.* Ñ‚Ð° python-dotenv, Ð·Ð±ÐµÑ€ÐµÐ¶Ð¸ (Ctrl/Cmd+S).",
        code: "aiogram==3.*\npython-dotenv",
      })
    );

    carousel.appendChild(
      createCarouselSlide({
        title: "ÐšÑ€Ð¾Ðº 3. ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€",
        body: `ÐŸÐµÑ€ÐµÐºÐ¾Ð½Ð°Ð¹ÑÑ, Ñ‰Ð¾ Ñ„Ð°Ð¹Ð» Ð¿Ð¾Ñ€ÑƒÑ‡ Ñ–Ð· ${entryFile}. ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° \`pip install -r requirements.txt\` Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚Ñ–.`,
      })
    );

    container.appendChild(carousel);
  }
}

function renderCustomRequirementsStep(container) {
  const custom = ensureCustomState();
  renderInfo(container, [
    "â€¢ ÐžÐ¿Ð¸ÑˆÐ¸ ÑÐ»Ð¾Ð²Ð°Ð¼Ð¸, Ñ‰Ð¾ Ñ€Ð¾Ð±Ð¸Ñ‚Ð¸Ð¼Ðµ Ñ‚Ð²Ñ–Ð¹ Ð±Ð¾Ñ‚: ÑÑ†ÐµÐ½Ð°Ñ€Ñ–Ñ—, ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸, Ñ–Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ñ–Ñ—.",
    "â€¢ Ð§Ð¸Ð¼ Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ–ÑˆÐµ Ð¿Ð¾ÑÑÐ½Ð¸Ñˆ â€” Ñ‚Ð¸Ð¼ Ñ‚Ð¾Ñ‡Ð½Ñ–ÑˆÐµ Ð±ÑƒÐ´Ðµ Ð±Ñ€Ð¸Ñ„.",
  ]);

  const textarea = document.createElement("textarea");
  textarea.value = custom.requirements;
  textarea.placeholder =
    "ÐÐ°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´: â€œÐ‘Ð¾Ñ‚ Ð´Ð»Ñ Ñ„Ñ–Ñ‚Ð½ÐµÑ-ÐºÐ¾ÑƒÑ‡Ð°: Ð·Ð±Ñ–Ñ€ Ð·Ð°ÑÐ²Ð¾Ðº, Ñ€Ð¾Ð·ÐºÐ»Ð°Ð´, Ð½Ð°Ð³Ð°Ð´ÑƒÐ²Ð°Ð½Ð½Ñ...â€";
  textarea.addEventListener("input", (event) => {
    custom.requirements = event.target.value;
    saveState();
  });
  container.appendChild(makeRow("ÐžÐ¿Ð¸Ñ Ð±Ð¾Ñ‚Ð°", wrapControl(textarea)));
}

function renderCustomBriefPromptStep(container) {
  const custom = ensureCustomState();
  if (!custom.requirements.trim()) {
    renderInfo(container, [
      "â€¢ Ð¡Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ Ð·Ð°Ð¿Ð¾Ð²Ð½Ð¸ Ð¾Ð¿Ð¸Ñ Ð±Ð¾Ñ‚Ð°, Ñ‰Ð¾Ð± ÑÑ„Ð¾Ñ€Ð¼ÑƒÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚.",
    ]);
    return;
  }
  renderInfo(container, [
    "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ¹ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ñ– Ð²ÑÑ‚Ð°Ð² Ñƒ ChatGPT / Codex, Ñ‰Ð¾Ð± Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ JSON-Ð±Ñ€Ð¸Ñ„.",
  ]);
  const prompt = generateCustomBriefPrompt();
  const aiTarget = getPromptAiTarget("instructions");
  container.appendChild(
    createPromptBlock(prompt, {
      copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ Ð±Ñ€Ð¸Ñ„Ñƒ",
      ai: aiTarget,
      openLabel: getAiLabel(aiTarget),
    })
  );
}

function renderCustomBriefInputStep(container) {
  const custom = ensureCustomState();
  renderInfo(container, [
    "Ð’ÑÑ‚Ð°Ð² JSON Ñ–Ð· Ð±Ñ€Ð¸Ñ„Ð¾Ð¼. ÐŸÑ–ÑÐ»Ñ Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð¿Ð¾Ð±ÑƒÐ´ÑƒÑ” Ð¿Ð»Ð°Ð½ Ñ„Ð°Ð¹Ð»Ñ–Ð².",
  ]);

  const textarea = document.createElement("textarea");
  textarea.value = custom.briefText;
  textarea.placeholder = '{\n  "commands": [...],\n  "files": [...],\n  ...\n}';
  textarea.rows = 12;
  textarea.addEventListener("input", (event) => {
    custom.briefText = event.target.value;
    saveState();
  });
  container.appendChild(makeRow("JSON-Ð±Ñ€Ð¸Ñ„", wrapControl(textarea)));

  const actions = document.createElement("div");
  actions.className = "prompt-actions";
  const saveBtn = document.createElement("button");
  saveBtn.type = "button";
  saveBtn.className = "primary";
  saveBtn.textContent = "Ð—Ð±ÐµÑ€ÐµÐ³Ñ‚Ð¸ Ð±Ñ€Ð¸Ñ„";
  saveBtn.addEventListener("click", () => {
    try {
      const parsed = parseCustomBrief(custom.briefText);
      custom.brief = parsed;
      updateCustomFilePlan(parsed);
      if (Array.isArray(parsed.commands) && parsed.commands.length) {
        state.commands = parsed.commands
          .map((cmd) => normalizeCommand(cmd))
          .filter(Boolean);
      }
      if (!custom.commandsText?.trim()) {
        custom.commandsText = deriveDefaultCommands(custom, getEntryFile());
      }
      const recommendedBackend = getRecommendedBackendId();
      if (recommendedBackend && !state.choices.backend) {
        state.choices.backend = recommendedBackend;
      }
      custom.diag.prompt = "";
      saveState();
      draw(true);
      showToast("Ð‘Ñ€Ð¸Ñ„ Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð¾.");
    } catch (error) {
      console.error("ÐÐµ Ð²Ð´Ð°Ð»Ð¾ÑÑ Ñ€Ð¾Ð·Ð¿Ð°Ñ€ÑÐ¸Ñ‚Ð¸ Ð±Ñ€Ð¸Ñ„", error);
      showToast(
        "ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ° JSON. ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ. Ð¯ÐºÑ‰Ð¾ ChatGPT Ð¿Ð¾Ð²ÐµÑ€Ð½ÑƒÐ² Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ Ñƒ ```json``` â€” ÑÐºÐ¾Ð¿Ñ–ÑŽÐ¹ Ð»Ð¸ÑˆÐµ Ð²Ð¼Ñ–ÑÑ‚ Ð±ÐµÐ· ÐºÐ¾Ð´Ð¾Ð²Ð¸Ñ… Ð±Ð»Ð¾ÐºÑ–Ð²."
      );
    }
  });
  actions.appendChild(saveBtn);
  container.appendChild(actions);
}

function renderCustomFilesStep(container) {
  const custom = ensureCustomState();
  if (!custom.brief) {
    renderInfo(container, [
      "â€¢ Ð¡Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ Ð·Ð±ÐµÑ€ÐµÐ¶Ð¸ JSON-Ð±Ñ€Ð¸Ñ„, Ñ‰Ð¾Ð± Ð¿Ð¾Ð±Ð°Ñ‡Ð¸Ñ‚Ð¸ Ð¿ÐµÑ€ÐµÐ»Ñ–Ðº Ñ„Ð°Ð¹Ð»Ñ–Ð².",
    ]);
    return;
  }

  if (!custom.files.length) {
    renderInfo(container, [
      "â€¢ Ð‘Ñ€Ð¸Ñ„ Ð½Ðµ Ð¼Ñ–ÑÑ‚Ð¸Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»Ñ–Ð². Ð”Ð¾Ð´Ð°Ð¹ Ñ—Ñ… Ñƒ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ Ð¨Ð†, Ñ‰Ð¾Ð± Ð¿Ð¾Ð±ÑƒÐ´ÑƒÐ²Ð°Ñ‚Ð¸ Ð¿Ð»Ð°Ð½.",
    ]);
    return;
  }

  renderInfo(container, [
    "ÐŸÐ¾Ð·Ð½Ð°Ñ‡ Ñ„Ð°Ð¹Ð»Ð¸ ÑÐº Ð²Ð¸ÐºÐ¾Ð½Ð°Ð½Ñ– Ð¿Ñ–ÑÐ»Ñ Ñ‚Ð¾Ð³Ð¾, ÑÐº Ð²ÑÑ‚Ð°Ð²Ð¸Ñˆ ÐºÐ¾Ð´ Ð°Ð±Ð¾ Ð·Ð°Ð¿Ð¾Ð²Ð½Ð¸Ñˆ Ð¿Ñ€Ð¾ÑÑ‚Ñ– ÑˆÐ°Ð±Ð»Ð¾Ð½Ð¸.",
  ]);

  const stack = document.createElement("div");
  stack.className = "file-card-stack";

  custom.files.forEach((file) => {
    const card = document.createElement("article");
    card.className = `file-card ${file.isSimple ? "static" : "manual"}`;

    const header = document.createElement("header");
    header.className = "file-card-path";
    header.textContent = file.path;
    card.appendChild(header);

    const statusRow = document.createElement("label");
    statusRow.className = "form-label";
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.checked = !!file.done;
    const span = document.createElement("span");
    span.textContent = "Ð¤Ð°Ð¹Ð» Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ð¹";
    statusRow.append(checkbox, span);
    card.appendChild(statusRow);

    const body = document.createElement("div");
    body.className = "file-card-body";

    if (file.purpose) {
      const desc = document.createElement("p");
      desc.className = "file-card-description";
      desc.textContent = file.purpose;
      body.appendChild(desc);
    }

    if (file.isSimple) {
      const note = document.createElement("p");
      note.className = "file-card-note";
      note.textContent = file.instructions;
      body.appendChild(note);
    } else if (file.prompt) {
      const aiTarget = getPromptAiTarget("code");
      const promptBlock = createPromptBlock(file.prompt, {
        copyLabel: `ÐŸÑ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ ${file.path}`,
        ai: aiTarget,
        openLabel: getAiLabel(aiTarget),
        collapsible: true,
      });
      body.appendChild(promptBlock);
      const tip = document.createElement("p");
      tip.className = "file-card-note";
      tip.textContent = "Ð—Ð³ÐµÐ½ÐµÑ€ÑƒÐ¹ ÐºÐ¾Ð´, Ð²ÑÑ‚Ð°Ð² Ñƒ Ñ„Ð°Ð¹Ð» Ñ– Ð¿Ð¾Ð·Ð½Ð°Ñ‡, Ñ‰Ð¾ Ð²Ñ–Ð½ Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ð¹.";
      body.appendChild(tip);
    }

    card.appendChild(body);

    const applyCollapsedState = (done) => {
      card.classList.toggle("collapsed", done);
      body.hidden = !!done;
    };

    applyCollapsedState(file.done);

    checkbox.addEventListener("change", (event) => {
      file.done = event.target.checked;
      saveState();
      applyCollapsedState(file.done);
    });

    stack.appendChild(card);
  });

  container.appendChild(stack);
}

function renderCustomTerminalStep(container) {
  const custom = ensureCustomState();
  if (!custom.files.length) {
    renderInfo(container, [
      "â€¢ Ð¡Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ ÑÑ„Ð¾Ñ€Ð¼ÑƒÐ¹ Ñ– Ð²Ð¸ÐºÐ¾Ð½Ð°Ð¹ ÐºÑ€Ð¾ÐºÐ¸ Ð·Ñ– ÑÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ Ñ„Ð°Ð¹Ð»Ñ–Ð².",
    ]);
    return;
  }

  renderInfo(container, [
    "Ð¦Ñ– ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸ Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð¶ÑƒÑ‚ÑŒ Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚Ð¸ Ð¿Ñ€Ð¾Ñ”ÐºÑ‚. ÐœÐ¾Ð¶ÐµÑˆ Ñ€ÐµÐ´Ð°Ð³ÑƒÐ²Ð°Ñ‚Ð¸ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿Ñ–Ð´ ÑÐµÐ±Ðµ.",
  ]);

  const textarea = document.createElement("textarea");
  textarea.value = custom.commandsText;
  textarea.placeholder = "pip install -r requirements.txt\npython main.py";
  textarea.rows = 6;
  textarea.addEventListener("input", (event) => {
    custom.commandsText = event.target.value;
    saveState();
  });
  textarea.addEventListener("blur", () => {
    draw(false);
  });
  container.appendChild(makeRow("ÐšÐ¾Ð¼Ð°Ð½Ð´Ð¸ Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÑƒ", wrapControl(textarea)));

  const commands = getCustomCommandsList(custom);
  if (commands.length) {
    const list = document.createElement("div");
    list.className = "file-card-stack";
    commands.forEach((cmd, index) => {
      const card = document.createElement("article");
      card.className = "file-card static";
      const header = document.createElement("header");
      header.className = "file-card-path";
      header.textContent = `ÐšÑ€Ð¾Ðº ${index + 1}`;
      card.appendChild(header);
      const pre = document.createElement("pre");
      pre.className = "file-card-code";
      pre.textContent = cmd;
      card.appendChild(pre);
      const actions = document.createElement("div");
      actions.className = "file-card-actions";
      const copyBtn = document.createElement("button");
      copyBtn.type = "button";
      copyBtn.className = "ghost copy-btn";
      copyBtn.textContent = "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ";
      copyBtn.addEventListener("click", () => copyText(cmd));
      actions.appendChild(copyBtn);
      card.appendChild(actions);
      list.appendChild(card);
    });
    const allActions = document.createElement("div");
    allActions.className = "prompt-actions";
    const copyAll = document.createElement("button");
    copyAll.type = "button";
    copyAll.className = "ghost copy-btn";
    copyAll.textContent = "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð²ÑÑ– ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸";
    copyAll.addEventListener("click", () => copyText(custom.commandsText));
    allActions.appendChild(copyAll);
    container.appendChild(list);
    container.appendChild(allActions);
  }
}

function renderCustomDiagnosticsStep(container) {
  const custom = ensureCustomState();
  renderInfo(container, [
    "Ð¯ÐºÑ‰Ð¾ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð²Ð¿Ð°Ð»Ð° Ð°Ð±Ð¾ Ð±Ð¾Ñ‚ Ð½Ðµ Ð¿Ñ€Ð°Ñ†ÑŽÑ”, Ð·Ð°Ñ„Ñ–ÐºÑÑƒÐ¹ Ð¿Ð¾Ð¼Ð¸Ð»ÐºÑƒ Ð¹ Ð·Ð³ÐµÐ½ÐµÑ€ÑƒÐ¹ Ð´Ñ–Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸Ñ‡Ð½Ð¸Ð¹ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚.",
  ]);

  const descArea = document.createElement("textarea");
  descArea.value = custom.diag.description;
  descArea.placeholder = "ÐšÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ð¹ Ð¾Ð¿Ð¸Ñ: Ñ‰Ð¾ Ñ€Ð¾Ð±Ð¸Ð»Ð¸, Ñ‰Ð¾ Ð¾Ñ‡Ñ–ÐºÑƒÐ²Ð°Ð»Ð¸, Ñ‰Ð¾ ÑÑ‚Ð°Ð»Ð¾ÑÑ.";
  descArea.rows = 4;
  descArea.addEventListener("input", (event) => {
    custom.diag.description = event.target.value;
    saveState();
  });

  const logsArea = document.createElement("textarea");
  logsArea.value = custom.diag.logs;
  logsArea.placeholder = "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ¹ ÑÑŽÐ´Ð¸ Ð»Ð¾Ð³Ð¸ Ð· Ñ‚ÐµÑ€Ð¼Ñ–Ð½Ð°Ð»Ñƒ Ð°Ð±Ð¾ Ñ‚ÐµÐºÑÑ‚ Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ¸.";
  logsArea.rows = 6;
  logsArea.addEventListener("input", (event) => {
    custom.diag.logs = event.target.value;
    saveState();
  });

  container.appendChild(makeRow("ÐžÐ¿Ð¸Ñ Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ¸", wrapControl(descArea)));
  container.appendChild(makeRow("Ð›Ð¾Ð³Ð¸ Ñ‚ÐµÑ€Ð¼Ñ–Ð½Ð°Ð»Ñƒ", wrapControl(logsArea)));

  const actions = document.createElement("div");
  actions.className = "prompt-actions";
  const composeBtn = document.createElement("button");
  composeBtn.type = "button";
  composeBtn.className = "primary";
  composeBtn.textContent = "Ð—Ñ–Ð±Ñ€Ð°Ñ‚Ð¸ Ð´Ñ–Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸Ñ‡Ð½Ð¸Ð¹ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚";
  composeBtn.addEventListener("click", () => {
    custom.diag.prompt = composeCustomDiagnosticPrompt(custom);
    saveState();
    draw(false);
    showToast("ÐŸÑ€Ð¾Ð¼Ð¿Ñ‚ Ð·Ñ–Ð±Ñ€Ð°Ð½Ð¾.");
  });
  actions.appendChild(composeBtn);
  container.appendChild(actions);

  if (custom.diag.prompt) {
    const aiTarget = getPromptAiTarget("instructions");
    container.appendChild(
      createPromptBlock(custom.diag.prompt, {
        copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚",
        ai: aiTarget,
        openLabel: getAiLabel(aiTarget),
      })
    );
    renderInfo(container, [
      "ÐŸÑ–ÑÐ»Ñ Ð²Ð¸Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½ÑŒ Ð¿Ð¾Ð²ÐµÑ€Ð½Ð¸ÑÑŒ Ð´Ð¾ ÐºÑ€Ð¾ÐºÑƒ Ð· ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°Ð¼Ð¸ Ñ‚Ð° Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚ÑƒÐ¹ Ð·Ð½Ð¾Ð²Ñƒ.",
    ]);
  }
}

function renderPresetReplyStep(container) {
  const spec = getPresetUiSpec("reply");
  const aiTarget = getPromptAiTarget("code");
  if (!spec || !spec.type) {
    renderInfo(container, [
      "â€¢ Ð¡Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ Ð¾Ð±ÐµÑ€Ð¸ Ñ‚Ð¸Ð¿ Ð±Ð¾Ñ‚Ð°, Ñ‰Ð¾Ð± Ð¿Ð¾Ð±Ð°Ñ‡Ð¸Ñ‚Ð¸ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð¾Ð²Ð°Ð½Ðµ Ð¼ÐµÐ½ÑŽ.",
    ]);
    return;
  }
  const uiState = ensureUiState();
  if (!spec.needed) {
    const lines = [
      "â€¢ Ð”Ð»Ñ Ñ†ÑŒÐ¾Ð³Ð¾ ÑÑ†ÐµÐ½Ð°Ñ€Ñ–ÑŽ reply-Ð¼ÐµÐ½ÑŽ Ð½Ðµ Ñ” Ð¾Ð±Ð¾Ð²â€™ÑÐ·ÐºÐ¾Ð²Ð¸Ð¼. ÐœÐ¾Ð¶ÐµÑˆ Ð¿Ñ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸ ÐºÑ€Ð¾Ðº Ð°Ð±Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¸Ñ‚Ð¸ Ð²Ð°Ñ€Ñ–Ð°Ð½Ñ‚ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚.",
    ];
    if (spec.discoveryHint) lines.push(`â€¢ ÐŸÑ–Ð´ÐºÐ°Ð·ÐºÐ°: ${spec.discoveryHint}`);
    renderInfo(container, lines);
    const prompt = generatePresetUiDiscoveryPrompt("reply", spec.type);
    container.appendChild(
      createPromptBlock(prompt, {
        copyLabel: "Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¸Ñ‚Ð¸ Ð¼ÐµÐ½ÑŽ",
        ai: aiTarget,
        openLabel: getAiLabel(aiTarget),
        collapsible: true,
      })
    );
    return;
  }

  const variants = spec.variants;
  if (!variants.length) {
    renderInfo(container, [
      "â€¢ Ð”Ð»Ñ Ñ†ÑŒÐ¾Ð³Ð¾ Ð±Ð¾Ñ‚Ð° Ð½ÐµÐ¼Ð°Ñ” Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ñ… ÐºÐ½Ð¾Ð¿Ð¾Ðº. Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð½Ð¸Ð¶Ñ‡Ðµ, Ñ‰Ð¾Ð± Ð·Ð³ÐµÐ½ÐµÑ€ÑƒÐ²Ð°Ñ‚Ð¸ ÑÐ²Ð¾Ñ—.",
    ]);
    const prompt = generatePresetUiDiscoveryPrompt("reply", spec.type);
    container.appendChild(
      createPromptBlock(prompt, {
        copyLabel: "Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¸Ñ‚Ð¸ Ð¼ÐµÐ½ÑŽ",
        ai: aiTarget,
        openLabel: getAiLabel(aiTarget),
        collapsible: true,
      })
    );
    return;
  }

  let current = variants.find((variant) => variant.id === uiState.replyVariant);
  if (!current) {
    current = variants[0];
    uiState.replyVariant = current.id;
    saveState();
  }

  if (variants.length > 1) {
    const select = document.createElement("select");
    variants.forEach((variant) => {
      const option = document.createElement("option");
      option.value = variant.id;
      option.textContent = variant.title;
      if (variant.id === current.id) option.selected = true;
      select.appendChild(option);
    });
    select.addEventListener("change", (event) => {
      uiState.replyVariant = event.target.value;
      saveState();
      draw(false);
    });
    container.appendChild(makeRow("Ð’Ð°Ñ€Ñ–Ð°Ð½Ñ‚ Ð¼ÐµÐ½ÑŽ", wrapControl(select)));
  }

  const introLines = [`â€¢ ÐžÐ±Ñ€Ð°Ð½Ð¸Ð¹ Ð²Ð°Ñ€Ñ–Ð°Ð½Ñ‚: ${current.title}.`];
  if (current.description) introLines.push(`â€¢ ${current.description}`);
  if (spec.notes) introLines.push(`â€¢ ${spec.notes}`);
  if (spec.discoveryHint)
    introLines.push(`â€¢ Ð¯ÐºÑ‰Ð¾ Ñ…Ð¾Ñ‡ÐµÑˆ Ñ–Ð½ÑˆÐ¸Ð¹ Ð½Ð°Ð±Ñ–Ñ€: ${spec.discoveryHint}`);
  renderInfo(container, introLines);

  const buttonLines = current.buttons.map((button) => {
    const details = [];
    if (button.purpose) details.push(button.purpose);
    if (button.callback) details.push(`callback: ${button.callback}`);
    if (button.url) details.push(`URL: ${button.url}`);
    if (button.note) details.push(button.note);
    return `â€¢ ${button.text}${
      details.length ? " â€” " + details.join("; ") : ""
    }`;
  });
  renderInfo(
    container,
    buttonLines,
    "Ð”Ð¾Ð´Ð°Ð¹ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ñƒ Ñ…ÐµÐ½Ð´Ð»ÐµÑ€ /start Ñ– Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚ÑƒÐ¹ Ð¼ÐµÐ½ÑŽ."
  );

  const prompt = generatePresetUiCodePrompt("reply", current, spec.type);
  container.appendChild(
    createPromptBlock(prompt, {
      copyLabel: "ÐžÐ½Ð¾Ð²Ð¸Ñ‚Ð¸ ÐºÐ¾Ð´ Ð´Ð»Ñ Ð¼ÐµÐ½ÑŽ",
      ai: aiTarget,
      openLabel: getAiLabel(aiTarget),
      collapsible: true,
    })
  );

  const discoveryPrompt = generatePresetUiDiscoveryPrompt("reply", spec.type);
  container.appendChild(
    createPromptBlock(discoveryPrompt, {
      copyLabel: "Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¸Ñ‚Ð¸ Ñ–Ð½ÑˆÐ¸Ð¹ Ð²Ð°Ñ€Ñ–Ð°Ð½Ñ‚",
      ai: aiTarget,
      openLabel: getAiLabel(aiTarget),
      collapsible: true,
    })
  );

  const customNote = [
    "â€¢ ÐœÐ¾Ð¶ÐµÑˆ Ð¿ÐµÑ€ÐµÐ»Ñ–Ñ‡Ð¸Ñ‚Ð¸ Ð²Ð»Ð°ÑÐ½Ñ– ÐºÐ½Ð¾Ð¿ÐºÐ¸ (Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚: ÐÐ°Ð·Ð²Ð° â€” Ð¿Ñ€Ð¸Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ â€” callback/URL).",
    "â€¢ Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ¹ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð½Ð¸Ð¶Ñ‡Ðµ, Ñ‰Ð¾Ð± Ð¨Ð† Ð·Ð³ÐµÐ½ÐµÑ€ÑƒÐ²Ð°Ð² ÐºÐ¾Ð´ ÑÐ°Ð¼Ðµ Ð´Ð»Ñ Ñ‚Ð²Ð¾Ð³Ð¾ Ð½Ð°Ð±Ð¾Ñ€Ñƒ.",
  ];
  renderInfo(container, customNote);

  const textarea = document.createElement("textarea");
  textarea.value = uiState.replyCustomSpec;
  textarea.placeholder =
    "ðŸ“‹ ÐšÐ»Ñ–Ñ”Ð½Ñ‚Ð¸ â€” Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ ÑÐ¿Ð¸ÑÐ¾Ðº Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¸Ñ… ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ñ–Ð²\nâž• ÐÐ¾Ð²Ð¸Ð¹ ÐºÐ»Ñ–Ñ”Ð½Ñ‚ â€” Ð²Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ð¸ Ñ„Ð¾Ñ€Ð¼Ñƒ Ð´Ð¾Ð´Ð°Ð²Ð°Ð½Ð½Ñ\n...";
  textarea.rows = 4;
  textarea.addEventListener("input", (event) => {
    uiState.replyCustomSpec = event.target.value;
    saveState();
  });
  container.appendChild(makeRow("Ð’Ð»Ð°ÑÐ½Ð¸Ð¹ Ð½Ð°Ð±Ñ–Ñ€ ÐºÐ½Ð¾Ð¿Ð¾Ðº", wrapControl(textarea)));

  const customPrompt = generatePresetUiCustomPrompt(
    "reply",
    uiState.replyCustomSpec,
    spec.type
  );
  if (customPrompt) {
    container.appendChild(
      createPromptBlock(customPrompt, {
        copyLabel: "ÐžÐ½Ð¾Ð²Ð¸Ñ‚Ð¸ ÐºÐ¾Ð´ Ð·Ð° Ð²Ð»Ð°ÑÐ½Ð¸Ð¼ Ð¼ÐµÐ½ÑŽ",
        ai: aiTarget,
        openLabel: getAiLabel(aiTarget),
        collapsible: true,
      })
    );
  }
}

function renderPresetInlineStep(container) {
  const spec = getPresetUiSpec("inline");
  const aiTarget = getPromptAiTarget("code");
  if (!spec || !spec.type) {
    renderInfo(container, ["â€¢ ÐžÐ±ÐµÑ€Ð¸ Ñ‚Ð¸Ð¿ Ð±Ð¾Ñ‚Ð°, Ñ‰Ð¾Ð± Ð½Ð°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ñ‚Ð¸ inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸."]);
    return;
  }
  const uiState = ensureUiState();
  if (!spec.needed) {
    const lines = [
      "â€¢ Ð£ Ð±Ñ€Ð¸Ñ„Ñ– Ð´Ð»Ñ Ñ†ÑŒÐ¾Ð³Ð¾ ÑÑ†ÐµÐ½Ð°Ñ€Ñ–ÑŽ inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð½Ðµ Ð¾Ð±Ð¾Ð²â€™ÑÐ·ÐºÐ¾Ð²Ñ–. ÐœÐ¾Ð¶ÐµÑˆ Ð¿Ñ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸ ÐºÑ€Ð¾Ðº Ð°Ð±Ð¾ Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ñ—Ñ… Ð·Ð° Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸.",
    ];
    if (spec.discoveryHint) lines.push(`â€¢ ÐŸÑ–Ð´ÐºÐ°Ð·ÐºÐ°: ${spec.discoveryHint}`);
    renderInfo(container, lines);
    const prompt = generatePresetUiDiscoveryPrompt("inline", spec.type);
    container.appendChild(
      createPromptBlock(prompt, {
        copyLabel: "Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¸Ñ‚Ð¸ inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸",
        ai: aiTarget,
        openLabel: getAiLabel(aiTarget),
        collapsible: true,
      })
    );
    return;
  }

  const variants = spec.variants;
  if (!variants.length) {
    renderInfo(container, [
      "â€¢ Ð“Ð¾Ñ‚Ð¾Ð²Ð¸Ñ… inline-ÐºÐ½Ð¾Ð¿Ð¾Ðº Ð½ÐµÐ¼Ð°Ñ”. Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð½Ð¸Ð¶Ñ‡Ðµ, Ñ‰Ð¾Ð± Ð·Ð³ÐµÐ½ÐµÑ€ÑƒÐ²Ð°Ñ‚Ð¸ ÑÐ²Ð¾Ñ—.",
    ]);
    const prompt = generatePresetUiDiscoveryPrompt("inline", spec.type);
    container.appendChild(
      createPromptBlock(prompt, {
        copyLabel: "Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¸Ñ‚Ð¸ inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸",
        ai: aiTarget,
        openLabel: getAiLabel(aiTarget),
        collapsible: true,
      })
    );
    return;
  }

  let current = variants.find(
    (variant) => variant.id === uiState.inlineVariant
  );
  if (!current) {
    current = variants[0];
    uiState.inlineVariant = current.id;
    saveState();
  }

  if (variants.length > 1) {
    const select = document.createElement("select");
    variants.forEach((variant) => {
      const option = document.createElement("option");
      option.value = variant.id;
      option.textContent = variant.title;
      if (variant.id === current.id) option.selected = true;
      select.appendChild(option);
    });
    select.addEventListener("change", (event) => {
      uiState.inlineVariant = event.target.value;
      saveState();
      draw(false);
    });
    container.appendChild(makeRow("Ð’Ð°Ñ€Ñ–Ð°Ð½Ñ‚ ÐºÐ½Ð¾Ð¿Ð¾Ðº", wrapControl(select)));
  }

  const introLines = [`â€¢ ÐžÐ±Ñ€Ð°Ð½Ð¸Ð¹ Ð½Ð°Ð±Ñ–Ñ€: ${current.title}.`];
  if (current.description) introLines.push(`â€¢ ${current.description}`);
  if (spec.notes) introLines.push(`â€¢ ${spec.notes}`);
  if (spec.discoveryHint)
    introLines.push(`â€¢ Ð¯ÐºÑ‰Ð¾ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ñ–Ð½ÑˆÐµ Ñ€Ñ–ÑˆÐµÐ½Ð½Ñ: ${spec.discoveryHint}`);
  renderInfo(container, introLines);

  const buttonLines = current.buttons.map((button) => {
    const details = [];
    if (button.purpose) details.push(button.purpose);
    if (button.callback) details.push(`callback: ${button.callback}`);
    if (button.url) details.push(`URL: ${button.url}`);
    if (button.note) details.push(button.note);
    return `â€¢ ${button.text}${
      details.length ? " â€” " + details.join("; ") : ""
    }`;
  });
  renderInfo(
    container,
    buttonLines,
    "Ð”Ð¾Ð´Ð°Ð¹ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ñƒ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð½Ñ– Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ Ñ– Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚ÑƒÐ¹ ÑÑ†ÐµÐ½Ð°Ñ€Ñ–Ð¹."
  );

  const prompt = generatePresetUiCodePrompt("inline", current, spec.type);
  container.appendChild(
    createPromptBlock(prompt, {
      copyLabel: "ÐžÐ½Ð¾Ð²Ð¸Ñ‚Ð¸ ÐºÐ¾Ð´ Ð´Ð»Ñ inline-ÐºÐ½Ð¾Ð¿Ð¾Ðº",
      ai: aiTarget,
      openLabel: getAiLabel(aiTarget),
      collapsible: true,
    })
  );

  const discoveryPrompt = generatePresetUiDiscoveryPrompt("inline", spec.type);
  container.appendChild(
    createPromptBlock(discoveryPrompt, {
      copyLabel: "Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¸Ñ‚Ð¸ Ñ–Ð½ÑˆÐ¸Ð¹ Ð²Ð°Ñ€Ñ–Ð°Ð½Ñ‚",
      ai: aiTarget,
      openLabel: getAiLabel(aiTarget),
      collapsible: true,
    })
  );

  const customNote = [
    "â€¢ ÐŸÐµÑ€ÐµÑ€Ð°Ñ…ÑƒÐ¹Ñ‚Ðµ Ð²Ð»Ð°ÑÐ½Ñ– inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸ (Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚: ÐÐ°Ð·Ð²Ð° â€” Ð¿Ñ€Ð¸Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ â€” callback/URL).",
    "â€¢ Ð—Ð° Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸ Ð´Ð¾Ð´Ð°Ð¹Ñ‚Ðµ, ÑÐºÐ¸Ð¹ Ñ…ÐµÐ½Ð´Ð»ÐµÑ€ Ð²Ð¸ÐºÐ»Ð¸ÐºÐ°Ñ‚Ð¸.",
  ];
  renderInfo(container, customNote);

  const textarea = document.createElement("textarea");
  textarea.value = uiState.inlineCustomSpec;
  textarea.placeholder =
    "âœ… Ð“Ð¾Ñ‚Ð¾Ð²Ð¾ â€” Ð·Ð°ÐºÑ€Ð¸Ñ‚Ð¸ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ â€” callback task_done\nâŒ ÐŸÑ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸ â€” Ð¿Ñ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ â€” callback task_skip\n...";
  textarea.rows = 4;
  textarea.addEventListener("input", (event) => {
    uiState.inlineCustomSpec = event.target.value;
    saveState();
  });
  container.appendChild(makeRow("Ð’Ð»Ð°ÑÐ½Ñ– inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸", wrapControl(textarea)));

  const customPrompt = generatePresetUiCustomPrompt(
    "inline",
    uiState.inlineCustomSpec,
    spec.type
  );
  if (customPrompt) {
    container.appendChild(
      createPromptBlock(customPrompt, {
        copyLabel: "ÐžÐ½Ð¾Ð²Ð¸Ñ‚Ð¸ ÐºÐ¾Ð´ Ð·Ð° Ð²Ð»Ð°ÑÐ½Ð¸Ð¼Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ°Ð¼Ð¸",
        ai: aiTarget,
        openLabel: getAiLabel(aiTarget),
        collapsible: true,
      })
    );
  }
}

function renderCustomReplyStep(container) {
  const custom = ensureCustomState();
  if (!custom.brief) {
    renderInfo(container, [
      "â€¢ Ð¡Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ Ð·Ð±ÐµÑ€ÐµÐ¶Ð¸ Ð±Ñ€Ð¸Ñ„, Ñ‰Ð¾Ð± Ð¿Ð¾Ð±Ð°Ñ‡Ð¸Ñ‚Ð¸ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð¾Ð²Ð°Ð½Ðµ Ð¼ÐµÐ½ÑŽ.",
    ]);
    return;
  }
  const section = getUiSection("reply");
  const aiTarget = getPromptAiTarget("code");

  if (section && section.needed === false) {
    renderInfo(container, [
      "Ð£ Ð±Ñ€Ð¸Ñ„Ñ– Ð·Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¾, Ñ‰Ð¾ reply-Ð¼ÐµÐ½ÑŽ Ð½Ðµ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ðµ. ÐŸÑ€Ð¾Ð¿ÑƒÑÑ‚Ð¸ Ñ†ÐµÐ¹ ÐºÑ€Ð¾Ðº Ð°Ð±Ð¾, Ð·Ð° Ð±Ð°Ð¶Ð°Ð½Ð½ÑÐ¼, Ð·Ð³ÐµÐ½ÐµÑ€ÑƒÐ¹ Ð¼ÐµÐ½ÑŽ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚.",
    ]);
    const prompt = generateUiDiscoveryPrompt("reply");
    container.appendChild(
      createPromptBlock(prompt, {
        copyLabel: "Ð’ÑÐµ Ð¶ Ð·Ð³ÐµÐ½ÐµÑ€ÑƒÐ²Ð°Ñ‚Ð¸ Ð¼ÐµÐ½ÑŽ",
        ai: aiTarget,
        openLabel: getAiLabel(aiTarget),
        collapsible: true,
      })
    );
    return;
  }

  if (section && section.buttons.length) {
    const items = section.buttons.map((button) => {
      const text = button.text || button.label || button.title || "ÐšÐ½Ð¾Ð¿ÐºÐ°";
      const details = [button.purpose, button.target, button.note]
        .filter(Boolean)
        .join("; ");
      return details ? `â€¢ ${text} â€” ${details}` : `â€¢ ${text}`;
    });
    if (section.notes) items.push(`ÐŸÑ€Ð¸Ð¼Ñ–Ñ‚ÐºÐ° Ð±Ñ€Ð¸Ñ„Ñƒ: ${section.notes}`);
    renderInfo(container, items, "Ð”Ð¾Ð´Ð°Ð¹ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ñƒ Ð±Ð¾Ñ‚Ð° Ñ‚Ð° Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚ÑƒÐ¹ `/start`.");
    const prompt = generateUiCodePrompt("reply", section.buttons);
    container.appendChild(
      createPromptBlock(prompt, {
        copyLabel: "ÐžÐ½Ð¾Ð²Ð¸Ñ‚Ð¸ ÐºÐ¾Ð´ Ð´Ð»Ñ Ð¼ÐµÐ½ÑŽ",
        ai: aiTarget,
        openLabel: getAiLabel(aiTarget),
        collapsible: true,
      })
    );
    return;
  }

  renderInfo(container, [
    "Ð£ Ð±Ñ€Ð¸Ñ„Ñ– Ð½ÐµÐ¼Ð°Ñ” Ð³Ð¾Ñ‚Ð¾Ð²Ð¾Ð³Ð¾ reply-Ð¼ÐµÐ½ÑŽ. Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚, Ñ‰Ð¾Ð± Ð·Ð³ÐµÐ½ÐµÑ€ÑƒÐ²Ð°Ñ‚Ð¸ Ð¹Ð¾Ð³Ð¾.",
  ]);
  const prompt = generateUiDiscoveryPrompt("reply");
  container.appendChild(
    createPromptBlock(prompt, {
      copyLabel: "Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¸Ñ‚Ð¸ Ð²Ð°Ñ€Ñ–Ð°Ð½Ñ‚Ð¸ Ð¼ÐµÐ½ÑŽ",
      ai: aiTarget,
      openLabel: getAiLabel(aiTarget),
      collapsible: true,
    })
  );
}

function renderCustomInlineStep(container) {
  const custom = ensureCustomState();
  if (!custom.brief) {
    renderInfo(container, [
      "â€¢ Ð¡Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ Ð·Ð±ÐµÑ€ÐµÐ¶Ð¸ Ð±Ñ€Ð¸Ñ„, Ñ‰Ð¾Ð± Ð¿Ð¾Ð±Ð°Ñ‡Ð¸Ñ‚Ð¸ inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸.",
    ]);
    return;
  }
  const section = getUiSection("inline");
  const aiTarget = getPromptAiTarget("code");

  if (section && section.needed === false) {
    renderInfo(container, [
      "Ð£ Ð±Ñ€Ð¸Ñ„Ñ– Ð²ÐºÐ°Ð·Ð°Ð½Ð¾, Ñ‰Ð¾ inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð½Ðµ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ñ–. ÐŸÑ€Ð¾Ð¿ÑƒÑÑ‚Ð¸ Ñ†ÐµÐ¹ ÐºÑ€Ð¾Ðº Ð°Ð±Ð¾ ÑÑ‚Ð²Ð¾Ñ€Ð¸ Ð²Ð»Ð°ÑÐ½Ñ– Ð·Ð° Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚Ð¾Ð¼.",
    ]);
    const prompt = generateUiDiscoveryPrompt("inline");
    container.appendChild(
      createPromptBlock(prompt, {
        copyLabel: "Ð’ÑÐµ Ð¶ Ð´Ð¾Ð´Ð°Ñ‚Ð¸ inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸",
        ai: aiTarget,
        openLabel: getAiLabel(aiTarget),
        collapsible: true,
      })
    );
    return;
  }

  if (section && section.buttons.length) {
    const items = section.buttons.map((button) => {
      const text = button.text || button.label || button.title || "ÐšÐ½Ð¾Ð¿ÐºÐ°";
      const parts = [
        button.purpose,
        button.callback,
        button.url,
        button.note,
      ].filter(Boolean);
      return parts.length ? `â€¢ ${text} â€” ${parts.join("; ")}` : `â€¢ ${text}`;
    });
    if (section.notes) items.push(`ÐŸÑ€Ð¸Ð¼Ñ–Ñ‚ÐºÐ° Ð±Ñ€Ð¸Ñ„Ñƒ: ${section.notes}`);
    renderInfo(container, items, "ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ¹ callback-Ð¸ Ñ‚Ð° Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚ÑƒÐ¹ ÑÑ†ÐµÐ½Ð°Ñ€Ñ–Ñ—.");
    const prompt = generateUiCodePrompt("inline", section.buttons);
    container.appendChild(
      createPromptBlock(prompt, {
        copyLabel: "ÐžÐ½Ð¾Ð²Ð¸Ñ‚Ð¸ ÐºÐ¾Ð´ Ð´Ð»Ñ inline-ÐºÐ½Ð¾Ð¿Ð¾Ðº",
        ai: aiTarget,
        openLabel: getAiLabel(aiTarget),
        collapsible: true,
      })
    );
    return;
  }

  renderInfo(container, [
    "Ð£ Ð±Ñ€Ð¸Ñ„Ñ– Ð½ÐµÐ¼Ð°Ñ” Ð´Ð°Ð½Ð¸Ñ… Ð¿Ñ€Ð¾ inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸. Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚, Ñ‰Ð¾Ð± Ð·Ð³ÐµÐ½ÐµÑ€ÑƒÐ²Ð°Ñ‚Ð¸ Ñ—Ñ….",
  ]);
  const prompt = generateUiDiscoveryPrompt("inline");
  container.appendChild(
    createPromptBlock(prompt, {
      copyLabel: "ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸Ñ‚Ð¸ inline-ÐºÐ½Ð¾Ð¿ÐºÐ¸",
      ai: aiTarget,
      openLabel: getAiLabel(aiTarget),
      collapsible: true,
    })
  );
}

function renderEnvStep(container) {
  const aiTarget = getPromptAiTarget("instructions");
  const promptBlock = createPromptBlock(
    `Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ Ñ„Ð°Ð¹Ð» .env Ñ– Ð´Ð¾Ð´Ð°Ð¹ Ñ€ÑÐ´Ð¾Ðº:\n\nBOT_TOKEN=Ñ‚ÑƒÑ‚_Ñ‚Ð²Ñ–Ð¹_Ñ‚Ð¾ÐºÐµÐ½`,
    {
      copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ñ–ÑŽ",
      ai: aiTarget,
      openLabel: getAiLabel(aiTarget),
    }
  );
  container.appendChild(promptBlock);

  const checklist = document.createElement("div");
  checklist.className = "info-block";
  const label = document.createElement("label");
  label.className = "info-line";
  const text = document.createElement("span");
  text.textContent = "ÐŸÐ¾Ð·Ð½Ð°Ñ‡, Ñ‰Ð¾ Ñ„Ð°Ð¹Ð» .env ÑÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð¾:";
  const input = document.createElement("input");
  input.type = "checkbox";
  input.checked = !!state.tools.env;
  input.addEventListener("change", (event) => {
    state.tools.env = event.target.checked;
    saveState();
    draw(false);
  });
  label.append(text, input);
  checklist.appendChild(label);
  container.appendChild(checklist);

  if (!state.tools.env) {
    const carousel = document.createElement("div");
    carousel.className = "carousel";

    carousel.appendChild(
      createCarouselSlide({
        title: "ÐšÑ€Ð¾Ðº 1. Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ Ñ„Ð°Ð¹Ð»",
        body: "Ð£ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€Ñ– Ð½Ð°Ñ‚Ð¸ÑÐ½Ð¸ New File, Ð½Ð°Ð·Ð²Ð¸ Ñ„Ð°Ð¹Ð» .env Ñ‚Ð° Ð·Ð±ÐµÑ€ÐµÐ¶Ð¸ Ð¹Ð¾Ð³Ð¾ Ñƒ ÐºÐ¾Ñ€ÐµÐ½Ñ– Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ.",
      })
    );

    carousel.appendChild(
      createCarouselSlide({
        title: "ÐšÑ€Ð¾Ðº 2. Ð”Ð¾Ð´Ð°Ð¹ Ñ‚Ð¾ÐºÐµÐ½",
        body: "Ð’ÑÑ‚Ð°Ð² Ñ€ÑÐ´Ð¾Ðº BOT_TOKEN=Ñ‚ÑƒÑ‚_Ñ‚Ð²Ñ–Ð¹_Ñ‚Ð¾ÐºÐµÐ½, Ð·Ð°Ð¼Ñ–Ð½Ð¸ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ Ð½Ð° Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¸Ð¹ Ñ‚Ð¾ÐºÐµÐ½.",
        code: "BOT_TOKEN=Ñ‚ÑƒÑ‚_Ñ‚Ð²Ñ–Ð¹_Ñ‚Ð¾ÐºÐµÐ½",
      })
    );

    carousel.appendChild(
      createCarouselSlide({
        title: "ÐšÑ€Ð¾Ðº 3. Ð—Ð°Ñ…Ð¸ÑÑ‚Ð¸ Ñ‚Ð¾ÐºÐµÐ½",
        body: "ÐŸÐµÑ€ÐµÐºÐ¾Ð½Ð°Ð¹ÑÑ, Ñ‰Ð¾ .env Ð´Ð¾Ð´Ð°Ð½Ð¸Ð¹ Ñƒ .gitignore Ñ‚Ð° Ð½Ðµ Ð¿Ð¾Ñ‚Ñ€Ð°Ð¿Ð¸Ñ‚ÑŒ Ñƒ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ð¹.",
      })
    );

    container.appendChild(carousel);
  }
}

function renderBackendChoiceStep(container) {
  const infoLines = [
    "â€¢ JSON Ñ„Ð°Ð¹Ð» â€” Ð¾Ð±ÐµÑ€Ð¸ Ð´Ð»Ñ ÑˆÐ²Ð¸Ð´ÐºÐ¸Ñ… Ð¿Ñ€Ð¾Ñ‚Ð¾Ñ‚Ð¸Ð¿Ñ–Ð² Ñ– ÑÐ¾Ð»Ð¾-Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñ–Ð² Ð±ÐµÐ· ÑÐºÐ»Ð°Ð´Ð½Ð¸Ñ… Ð·Ð²Ñ–Ñ‚Ñ–Ð².",
    "â€¢ SQLite â€” ÐºÐ¾Ð»Ð¸ Ð·Ð°Ð¿Ð¸ÑÑ–Ð² ÑƒÐ¶Ðµ ÑÐ¾Ñ‚Ð½Ñ–, Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ñ– Ñ„Ñ–Ð»ÑŒÑ‚Ñ€Ð¸ Ð¹ Ð¿Ñ€Ð¾ÑÑ‚Ñ– Ð·Ð°Ð¿Ð¸Ñ‚Ð¸ Ð±ÐµÐ· ÑÐµÑ€Ð²ÐµÑ€Ð°.",
    "â€¢ Google Sheets â€” ÑÐºÑ‰Ð¾ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ– Ñ‚Ñ€ÐµÐ±Ð° Ð±Ð°Ñ‡Ð¸Ñ‚Ð¸ Ð´Ð°Ð½Ñ– Ñƒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ– Ñ‡ÐµÑ€ÐµÐ· Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€.",
    "â€¢ Postgres (Docker) â€” Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐ½-Ð±Ð¾Ñ‚Ñ–Ð² Ñ–Ð· ÐºÑ–Ð»ÑŒÐºÐ¾Ð¼Ð° Ñ€Ð¾Ð·Ñ€Ð¾Ð±Ð½Ð¸ÐºÐ°Ð¼Ð¸ Ñ‚Ð° ÑÐµÑ€Ð¹Ð¾Ð·Ð½Ð¸Ð¼ Ð½Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½Ð½ÑÐ¼.",
  ];
  const recommendedId = isCustomBot() ? getRecommendedBackendId() : null;
  const recommendedOption = BACKEND_OPTIONS.find(
    (item) => item.id === recommendedId
  );
  if (recommendedOption) {
    infoLines.unshift(
      `â€¢ Ð”Ð»Ñ Ñ‚Ð²Ð¾Ð³Ð¾ ÑÑ†ÐµÐ½Ð°Ñ€Ñ–ÑŽ Ð½Ð°Ð¹Ñ‡Ð°ÑÑ‚Ñ–ÑˆÐµ Ð¿Ñ–Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒ ${recommendedOption.title}. ÐžÐ±ÐµÑ€Ð¸ Ð¹Ð¾Ð³Ð¾, ÑÐºÑ‰Ð¾ ÑÑƒÐ¼Ð½Ñ–Ð²Ð°Ñ”ÑˆÑÑ.`
    );
  }
  renderInfo(
    container,
    infoLines,
    "Ð—Ð°Ð²Ð¶Ð´Ð¸ Ð¼Ð¾Ð¶Ð½Ð° Ð¿Ð¾Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ÑÑ Ñ‚Ð° Ð·Ð¼Ñ–Ð½Ð¸Ñ‚Ð¸ Ð²Ð¸Ð±Ñ–Ñ€ Ð´Ð¾ Ñ‚Ð¾Ð³Ð¾, ÑÐº Ð²Ð¸ÐºÐ¾Ð½Ð°Ñ”Ñˆ ÐºÑ€Ð¾ÐºÐ¸."
  );

  const cards = document.createElement("div");
  cards.className = "card-grid";
  BACKEND_OPTIONS.forEach((option) => {
    const card = document.createElement("div");
    card.className = "card";
    if (state.choices.backend === option.id) card.classList.add("active");
    card.innerHTML = `<h3>${option.title}</h3><p>${option.summary}</p>`;
    if (recommendedId && option.id === recommendedId) {
      card.classList.add("recommended");
      const badge = document.createElement("div");
      badge.className = "backend-recommend";
      badge.textContent = "Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÑ”Ð¼Ð¾ Ð´Ð»Ñ Ð²Ð°ÑˆÐ¾Ð³Ð¾ Ð±Ð¾Ñ‚Ð°";
      card.appendChild(badge);
    }
    card.addEventListener("click", () => {
      state.choices.backend = option.id;
      saveState();
      draw(true);
    });
    cards.appendChild(card);
  });
  container.appendChild(cards);
}

function renderBackendConfirmStep(container) {
  const backend = BACKEND_OPTIONS.find(
    (option) => option.id === state.choices.backend
  );
  if (!backend) {
    renderInfo(container, [
      "â€¢ Ð¡Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ Ð¾Ð±ÐµÑ€Ð¸ Ð²Ð°Ñ€Ñ–Ð°Ð½Ñ‚ Ð·Ð±ÐµÑ€Ñ–Ð³Ð°Ð½Ð½Ñ, Ñ‰Ð¾Ð± Ð¿Ð¾Ð±Ð°Ñ‡Ð¸Ñ‚Ð¸ ÐºÑ€Ð¾ÐºÐ¸.",
    ]);
    return;
  }
  renderInfo(container, [
    `ÐžÐ±Ñ€Ð°Ð½Ð¾: ${backend.title}. ÐÐ¸Ð¶Ñ‡Ðµ â€” ÐºÑ€Ð¾ÐºÐ¸, ÑÐºÑ– Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ð²Ð¸ÐºÐ¾Ð½Ð°Ñ‚Ð¸.`,
  ]);
}

function renderBackendStep(container, backendTitle, step) {
  renderInfo(container, [`${backendTitle}: ${step.text}`]);
  if (step.prompt) {
    const aiTarget = getPromptAiTarget("code");
    const block = createPromptBlock(step.prompt, {
      copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚",
      ai: aiTarget,
      openLabel: getAiLabel(aiTarget),
    });
    container.appendChild(block);
  }
}

function renderPaymentsChoiceStep(container) {
  const cards = document.createElement("div");
  cards.className = "card-grid";

  PAYMENT_METHODS.forEach((method) => {
    const card = document.createElement("div");
    card.className = "card";
    if (state.choices.payment === method.id) card.classList.add("active");
    card.innerHTML = `<h3>${method.title}</h3><p>${method.description}</p>`;
    card.addEventListener("click", () => {
      state.choices.payment = method.id;
      saveState();
      draw(true);
    });
    cards.appendChild(card);
  });

  const skip = document.createElement("div");
  skip.className = "card";
  if (state.choices.payment === "none") skip.classList.add("active");
  skip.innerHTML = `<h3>ÐŸÑ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸</h3><p>ÐŸÐ»Ð°Ñ‚ÐµÐ¶Ñ– Ð¼Ð¾Ð¶Ð½Ð° Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ð¿Ñ–Ð·Ð½Ñ–ÑˆÐµ.</p>`;
  skip.addEventListener("click", () => {
    state.choices.payment = "none";
    saveState();
    draw(true);
  });
  cards.appendChild(skip);

  container.appendChild(cards);
}

function renderPaymentPrepStep(container) {
  if (state.choices.payment === "none") {
    renderInfo(container, [
      "â€¢ ÐžÐ¿Ð»Ð°Ñ‚Ð¸ Ð¿Ð¾ÐºÐ¸ Ñ‰Ð¾ Ð¿Ñ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½Ð¾. ÐœÐ¾Ð¶ÐµÑˆ Ð¿Ð¾Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ÑÑ Ð´Ð¾ Ñ†ÑŒÐ¾Ð³Ð¾ ÐºÑ€Ð¾ÐºÑƒ Ð¿Ñ–Ð·Ð½Ñ–ÑˆÐµ.",
    ]);
    return;
  }
  renderInfo(
    container,
    PAYMENT_INTRO.map((item) => `â€¢ ${item}`)
  );
}

function renderPaymentStep(container, title, step) {
  renderInfo(container, [`â€¢ ${title}: ${step.text}`]);
  if (step.prompt) {
    const aiTarget = getPromptAiTarget("code");
    const block = createPromptBlock(step.prompt, {
      copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚",
      ai: aiTarget,
      openLabel: getAiLabel(aiTarget),
    });
    container.appendChild(block);
  }
}

function renderLaunchStep(container, step) {
  if (step.type === "commands") {
    const commands = (
      state.commands && state.commands.length
        ? state.commands
        : ["/start", "/help"]
    )
      .map((cmd) => cmd.trim())
      .filter(Boolean);
    if (!commands.length) {
      commands.push("/start", "/help");
    }
    const lines = ["ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€, Ñ‰Ð¾ ÐºÐ»ÑŽÑ‡Ð¾Ð²Ñ– ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸ Ð¿Ñ€Ð°Ñ†ÑŽÑŽÑ‚ÑŒ Ñƒ Ñ‡Ð°Ñ‚Ñ–:"].concat(
      commands.map((cmd) => `â€¢ ${cmd}`)
    );
    renderInfo(container, lines);
    if (isCustomBot() && ensureCustomState().brief) {
      renderInfo(container, [
        "Ð¯ÐºÑ‰Ð¾ ÑÐºÐ°ÑÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð½Ðµ Ð¿Ñ€Ð°Ñ†ÑŽÑ”, ÑÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹ÑÑ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚Ð¾Ð¼ Ð½Ð¸Ð¶Ñ‡Ðµ Ð´Ð»Ñ Ð²Ð¸Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ñ.",
      ]);
      const aiTarget = getPromptAiTarget("code");
      const prompt = generateCommandFixPrompt(ensureCustomState());
      container.appendChild(
        createPromptBlock(prompt, {
          copyLabel: "ÐŸÑ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ Ð²Ð¸Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´",
          ai: aiTarget,
          openLabel: getAiLabel(aiTarget),
          collapsible: true,
        })
      );
    }
    return;
  }
  renderInfo(container, step.items || []);
}

function renderStepDetails(container, stepId) {
  const details = STEP_DETAILS[stepId];
  if (!details || !details.length) return;

  const wrapper = document.createElement("div");
  wrapper.className = "step-details";

  const toggle = document.createElement("button");
  toggle.type = "button";
  toggle.className = "ghost details-toggle";
  toggle.textContent = "Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ–ÑˆÐµ";
  wrapper.appendChild(toggle);

  const body = document.createElement("div");
  body.className = "step-details-body";
  body.hidden = true;

  details.forEach((item, index) => {
    const card = document.createElement("article");
    card.className = "step-details-card";

    const header = document.createElement("header");
    header.textContent = item.title || `ÐšÑ€Ð¾Ðº ${index + 1}`;
    card.appendChild(header);

    if (item.gif) {
      const img = document.createElement("img");
      img.src = item.gif;
      img.alt = item.title || "Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð¸Ð¹ Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´";
      img.loading = "lazy";
      card.appendChild(img);
    }

    if (item.description) {
      const p = document.createElement("p");
      p.textContent = item.description;
      card.appendChild(p);
    }

    body.appendChild(card);
  });

  toggle.addEventListener("click", () => {
    body.hidden = !body.hidden;
    toggle.textContent = body.hidden ? "Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ–ÑˆÐµ" : "Ð—Ð³Ð¾Ñ€Ð½ÑƒÑ‚Ð¸ Ð´ÐµÑ‚Ð°Ð»Ñ–";
  });

  wrapper.appendChild(body);
  container.appendChild(wrapper);
}

function renderExtraModulesStep(container) {
  const modules = ensureExtraModules();
  ensureExtraModuleData();
  const selected = EXTRA_MODULE_OPTIONS.filter(
    (option) => modules[option.id]
  );

  const infoLines = [
    "â€¢ ÐžÐ±ÐµÑ€Ð¸ Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ñ– Ð¼Ð¾Ð´ÑƒÐ»Ñ–. Ð”Ð»Ñ ÐºÐ¾Ð¶Ð½Ð¾Ð³Ð¾ Ð· Ð½Ð¸Ñ… Ð·Ê¼ÑÐ²Ð¸Ñ‚ÑŒÑÑ Ð²Ð»Ð°ÑÐ½Ð° ÑÐµÑ€Ñ–Ñ ÐºÑ€Ð¾ÐºÑ–Ð².",
    "â€¢ Ð¯ÐºÑ‰Ð¾ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð½Ðµ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ â€” Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð½ÑŒÐ¾ Ð·Ð°Ð»Ð¸ÑˆÐ¸Ñ‚Ð¸ Ñ‡ÐµÐºÐ±Ð¾ÐºÑ Ð²Ð¸Ð¼ÐºÐ½ÐµÐ½Ð¸Ð¼, Ñ– Ð¿Ñ–ÑÐ»Ñ Ñ†ÑŒÐ¾Ð³Ð¾ ÐºÑ€Ð¾ÐºÑƒ Ð¾Ð´Ñ€Ð°Ð·Ñƒ Ð±ÑƒÐ´Ðµ Â«Ð¤Ñ–Ð½Ñ–ÑˆÂ».",
  ];
  if (selected.length) {
    infoLines.push(
      `â€¢ ÐÐºÑ‚Ð¸Ð²Ð¾Ð²Ð°Ð½Ð¾: ${selected.map((item) => item.title).join(", ")}.`
    );
  } else {
    infoLines.push("â€¢ ÐÐ¸Ð½Ñ– Ð¼Ð¾Ð´ÑƒÐ»Ñ– Ð½Ðµ Ð¾Ð±Ñ€Ð°Ð½Ñ– â€” Ð¿Ñ–ÑÐ»Ñ Ñ†ÑŒÐ¾Ð³Ð¾ ÐºÑ€Ð¾ÐºÑƒ Ð±ÑƒÐ´Ðµ Ñ„Ñ–Ð½Ð°Ð».");
  }
  renderInfo(container, infoLines);

  const grid = document.createElement("div");
  grid.className = "card-grid";

  EXTRA_MODULE_OPTIONS.forEach((option) => {
    const card = document.createElement("label");
    card.className = "card module-card";
    if (modules[option.id]) card.classList.add("active");
    card.tabIndex = 0;

    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.checked = !!modules[option.id];
    checkbox.addEventListener("change", (event) => {
      modules[option.id] = event.target.checked;
      saveState();
      draw(true);
    });

    const title = document.createElement("h3");
    title.textContent = `${option.icon || ""} ${option.title}`.trim();

    const desc = document.createElement("p");
    desc.textContent = option.description;

    card.appendChild(checkbox);
    card.appendChild(title);
    card.appendChild(desc);
    grid.appendChild(card);
  });

  container.appendChild(grid);

  const hint = document.createElement("p");
  hint.className = "note-block";
  hint.textContent =
    "ÐŸÐ¾Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ÑÑ Ð´Ð¾ Ñ†ÑŒÐ¾Ð³Ð¾ ÐºÑ€Ð¾ÐºÑƒ Ð¼Ð¾Ð¶Ð½Ð° Ñƒ Ð±ÑƒÐ´ÑŒ-ÑÐºÐ¸Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ â€” Ð²Ð¸Ð±Ñ–Ñ€ Ð¼Ð¸Ñ‚Ñ‚Ñ”Ð²Ð¾ Ð¿ÐµÑ€ÐµÐ±ÑƒÐ´ÑƒÑ” Ð¿Ð¾Ð´Ð°Ð»ÑŒÑˆÑ– ÐºÑ€Ð¾ÐºÐ¸.";
  container.appendChild(hint);
}

function renderAutosaveStorageStep(container) {
  const data = ensureExtraModuleData().autosave;
  const backendTitle = getBackendTitle();
  renderInfo(container, [
    `â€¢ ÐŸÐ¾Ñ‚Ð¾Ñ‡Ð½Ð¸Ð¹ Ñ‚Ð¸Ð¿ Ð·Ð±ÐµÑ€Ñ–Ð³Ð°Ð½Ð½Ñ: ${backendTitle}. ÐŸÑ€Ð°Ñ†ÑŽÐ¹ Ð¿Ð¾Ð²ÐµÑ€Ñ… Ð½ÑŒÐ¾Ð³Ð¾ â€” Ð·Ð¼Ñ–Ð½ÑŽÐ²Ð°Ñ‚Ð¸ Ð½Ð° Ñ–Ð½ÑˆÐ¸Ð¹ Ñ‚Ð¸Ð¿ Ð½Ðµ Ð¼Ð¾Ð¶Ð½Ð°.`,
    "â€¢ Ð”Ð¾Ð´Ð°Ð¹ Ñƒ Ñ„Ð°Ð¹Ð» ÑÑ…Ð¾Ð²Ð¸Ñ‰Ð° Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ— save_user_state(user_id, state_dict) Ñ‚Ð° load_user_state(user_id).",
    "â€¢ Ð¯ÐºÑ‰Ð¾ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ð¾ÐºÑ€ÐµÐ¼Ð¸Ð¹ Ð·Ð°Ð¿Ð¸Ñ/Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ Ð´Ð»Ñ ÑÑ‚Ð°Ð½Ñƒ â€” ÑÑ‚Ð²Ð¾Ñ€Ð¸ Ñ—Ñ— Ð±ÐµÐ· Ð»Ð°Ð¼Ð°Ð½Ð½Ñ Ñ–ÑÐ½ÑƒÑŽÑ‡Ð¾Ñ— ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸.",
  ]);

  renderCodePromptSection(container, {
    title: "Ð¤Ð°Ð¹Ð» Ð·Ñ– ÑÑ…Ð¾Ð²Ð¸Ñ‰ÐµÐ¼ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°",
    dataRef: data.storage,
    fileLabel: "Ð¨Ð»ÑÑ… Ð´Ð¾ Ñ„Ð°Ð¹Ð»Ð°",
    composePrompt: () =>
      composeAutosaveStoragePrompt(data.storage, backendTitle),
    copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ ÑÑ…Ð¾Ð²Ð¸Ñ‰Ð°",
  });
}

function renderAutosaveHooksStep(container) {
  const data = ensureExtraModuleData().autosave;
  const storageFile = data.storage.file || "storage.py";
  renderInfo(container, [
    "â€¢ Ð£ÑÑ– Ð¼Ñ–ÑÑ†Ñ, Ð´Ðµ Ð·Ð¼Ñ–Ð½ÑŽÑ”Ñ‚ÑŒÑÑ ÑÑ‚Ð°Ð½ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð° (ÑÐ¿Ð¸ÑÐºÐ¸ Ð·Ð°Ð´Ð°Ñ‡, ÑÑ‚Ð°Ñ‚ÑƒÑÐ¸, Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑ), Ð¼Ð°ÑŽÑ‚ÑŒ Ð²Ð¸ÐºÐ»Ð¸ÐºÐ°Ñ‚Ð¸ Ñ„ÑƒÐ½ÐºÑ†Ñ–ÑŽ save_user_state.",
    "â€¢ Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹ Ñ–ÑÐ½ÑƒÑŽÑ‡Ð¸Ð¹ Ð¼ÐµÑ…Ð°Ð½Ñ–Ð·Ð¼ user_id / state â€” Ð½Ñ–Ñ‡Ð¾Ð³Ð¾ Ð½Ðµ Ð²Ð¸Ð³Ð°Ð´ÑƒÐ¹ Ð·Ð°Ð½Ð¾Ð²Ð¾, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð´Ð¾Ð´Ð°Ð¹ Ð²Ð¸ÐºÐ»Ð¸ÐºÐ¸ Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ.",
    `â€¢ Ð†Ð¼Ð¿Ð¾Ñ€Ñ‚ÑƒÐ¹ save_user_state Ð· Ñ„Ð°Ð¹Ð»Ð° ${storageFile}.`,
  ]);

  renderCodePromptSection(container, {
    title: "Ð¥ÐµÐ½Ð´Ð»ÐµÑ€Ð¸ Ð· Ð»Ð¾Ð³Ñ–ÐºÐ¾ÑŽ Ð±Ð¾Ñ‚Ð°",
    dataRef: data.hooks,
    fileLabel: "Ð¤Ð°Ð¹Ð» Ð· Ñ…ÐµÐ½Ð´Ð»ÐµÑ€Ð°Ð¼Ð¸",
    composePrompt: () => composeAutosaveHooksPrompt(data, storageFile),
    copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ",
  });
}

function renderAutosaveRestoreStep(container) {
  const data = ensureExtraModuleData().autosave;
  const storageFile = data.storage.file || "storage.py";
  renderInfo(container, [
    "â€¢ ÐŸÑ€Ð¸ Ð¿ÐµÑ€ÑˆÑ–Ð¹ Ð²Ð·Ð°Ñ”Ð¼Ð¾Ð´Ñ–Ñ— ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð° Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ð¿Ñ–Ð´Ñ‚ÑÐ³Ð½ÑƒÑ‚Ð¸ Ð¿Ð¾Ð¿ÐµÑ€ÐµÐ´Ð½Ñ–Ð¹ ÑÑ‚Ð°Ð½, ÑÐºÑ‰Ð¾ Ð²Ñ–Ð½ Ñ”.",
    "â€¢ Ð¡Ñ‚Ð°Ñ€Ñ‚Ð¾Ð²Ð¸Ð¹ ÑÑ†ÐµÐ½Ð°Ñ€Ñ–Ð¹ /start Ð¼Ð°Ñ” Ð»Ð¸ÑˆÐ¸Ñ‚Ð¸ÑÑ Ð·Ð½Ð°Ð¹Ð¾Ð¼Ð¸Ð¼: Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð´Ð¾Ð´Ð°Ð¹ Ð²Ñ–Ð´Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð¿ÐµÑ€ÐµÐ´ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²ÐºÐ¾ÑŽ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½ÑŒ Ñ‚Ð° ÐºÐ½Ð¾Ð¿Ð¾Ðº.",
    `â€¢ Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹ load_user_state Ð· Ñ„Ð°Ð¹Ð»Ð° ${storageFile}.`,
  ]);

  renderCodePromptSection(container, {
    title: "Ð’Ñ–Ð´Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ ÑÑ‚Ð°Ð½Ñƒ Ñƒ ÑÑ‚Ð°Ñ€Ñ‚Ð¾Ð²Ð¾Ð¼Ñƒ Ñ…ÐµÐ½Ð´Ð»ÐµÑ€Ñ–",
    dataRef: data.restore,
    fileLabel: "Ð¤Ð°Ð¹Ð» Ñ–Ð· ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾ÑŽ /start",
    composePrompt: () => composeAutosaveRestorePrompt(data, storageFile),
    copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ Ð²Ñ–Ð´Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ",
  });
}

function composeAutosaveStoragePrompt(storageData, backendTitle) {
  if (!storageData) return "";
  return buildFullFilePrompt({
    file: storageData.file || "storage.py",
    code: storageData.code,
    instructions: [
      "Ð”Ð¾Ð´Ð°Ð¹ Ñƒ Ñ„Ð°Ð¹Ð» Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ— save_user_state(user_id, state_dict) Ñ‚Ð° load_user_state(user_id), ÑÐºÑ– Ð¿Ñ€Ð°Ñ†ÑŽÑŽÑ‚ÑŒ Ð¿Ð¾Ð²ÐµÑ€Ñ… Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ð¾Ð³Ð¾ Ð±ÐµÐºÐµÐ½Ð´Ñƒ.",
      `Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹ Ñ–ÑÐ½ÑƒÑŽÑ‡Ð¸Ð¹ Ñ‚Ð¸Ð¿ Ð·Ð±ÐµÑ€Ñ–Ð³Ð°Ð½Ð½Ñ (${backendTitle}) â€” Ð½Ðµ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ÑŒ Ð½Ð° Ñ–Ð½ÑˆÐ¸Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚.`,
      "ÐÐµ Ð»Ð°Ð¼Ð°ÑŽÑ‡Ð¸ Ð½Ð°ÑÐ²Ð½Ñ– Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ–/ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸, Ð´Ð¾Ð´Ð°Ð¹ ÑƒÑÐµ Ð½ÐµÐ¾Ð±Ñ…Ñ–Ð´Ð½Ðµ Ð´Ð»Ñ Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ ÑÑ‚Ð°Ð½Ñƒ (Ð¼Ð¾Ð¶Ð½Ð° ÑÑ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð½Ð¾Ð²Ñƒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†ÑŽ Ñ‡Ð¸ JSON-Ñ€Ð¾Ð·Ð´Ñ–Ð»).",
    ],
  });
}

function composeAutosaveHooksPrompt(data, storageFile) {
  if (!data?.hooks) return "";
  return buildFullFilePrompt({
    file: data.hooks.file || getEntryFile(),
    code: data.hooks.code,
    instructions: [
      `Ð†Ð¼Ð¿Ð¾Ñ€Ñ‚ÑƒÐ¹ save_user_state (Ñ‚Ð° load_user_state Ð·Ð° Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸) Ð· Ñ„Ð°Ð¹Ð»Ð° ${storageFile}.`,
      "Ð—Ð½Ð°Ð¹Ð´Ð¸ Ð²ÑÑ– Ð¼Ñ–ÑÑ†Ñ, Ð´Ðµ Ð¾Ð½Ð¾Ð²Ð»ÑŽÑ”Ñ‚ÑŒÑÑ ÑÑ‚Ð°Ð½ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð° (Ñ†Ñ–Ð»Ñ–, Ð·Ð°Ð´Ð°Ñ‡Ñ–, Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑ, ÑÑ‚Ð°Ñ‚ÑƒÑÐ¸) Ñ‚Ð° Ð¿Ñ–ÑÐ»Ñ ÐºÐ¾Ð¶Ð½Ð¾Ñ— Ð·Ð¼Ñ–Ð½Ð¸ Ð²Ð¸ÐºÐ»Ð¸ÐºÐ°Ð¹ save_user_state(user_id, Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¸Ð¹_ÑÑ‚Ð°Ð½).",
      "ÐÐµ Ð·Ð¼Ñ–Ð½ÑŽÐ¹ Ð±Ñ–Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ñ–ÐºÑƒ Ñ‚Ð° Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ â€” Ð»Ð¸ÑˆÐµ Ð´Ð¾Ð´Ð°Ð¹ Ð°ÐºÑƒÑ€Ð°Ñ‚Ð½Ñ– Ð²Ð¸ÐºÐ»Ð¸ÐºÐ¸ Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ.",
    ],
  });
}

function composeAutosaveRestorePrompt(data, storageFile) {
  if (!data?.restore) return "";
  return buildFullFilePrompt({
    file: data.restore.file || getEntryFile(),
    code: data.restore.code,
    instructions: [
      `Ð£ ÑÑ‚Ð°Ñ€Ñ‚Ð¾Ð²Ð¾Ð¼Ñƒ Ñ…ÐµÐ½Ð´Ð»ÐµÑ€Ñ– (/start Ð°Ð±Ð¾ ÐµÐºÐ²Ñ–Ð²Ð°Ð»ÐµÐ½Ñ‚) Ð²Ð¸ÐºÐ»Ð¸Ñ‡ load_user_state(user_id) Ñ–Ð· Ñ„Ð°Ð¹Ð»Ð° ${storageFile}.`,
      "Ð¯ÐºÑ‰Ð¾ ÑÑ‚Ð°Ð½ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾ â€” Ð¿Ñ–Ð´ÑÑ‚Ð°Ð² Ð¹Ð¾Ð³Ð¾ Ñƒ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ²Ð°Ð½Ð¸Ð¹ Ð¼ÐµÑ…Ð°Ð½Ñ–Ð·Ð¼ (FSM, Ð²Ð»Ð°ÑÐ½Ð¸Ð¹ state-Ð¾Ð±â€™Ñ”ÐºÑ‚ Ñ‚Ð¾Ñ‰Ð¾) Ð¿ÐµÑ€ÐµÐ´ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²ÐºÐ¾ÑŽ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½ÑŒ.",
      "Ð¯ÐºÑ‰Ð¾ ÑÑ‚Ð°Ð½Ñƒ Ð½ÐµÐ¼Ð°Ñ” â€” Ð·Ð°Ð»Ð¸Ñˆ Ñ–ÑÐ½ÑƒÑŽÑ‡Ñƒ Ð»Ð¾Ð³Ñ–ÐºÑƒ Ð±ÐµÐ· Ð·Ð¼Ñ–Ð½.",
    ],
  });
}

function renderAdminConfigStep(container) {
  const data = ensureExtraModuleData().adminPanel;
  renderInfo(container, [
    "â€¢ ADMIN_ID Ð·Ð±ÐµÑ€Ñ–Ð³Ð°Ñ”Ñ‚ÑŒÑÑ Ñƒ `.env`. Ð”Ð¾ÑÑ‚Ð°Ñ‚Ð½ÑŒÐ¾ Ð¾Ð´Ð¸Ð½ Ñ€Ð°Ð· Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ñ€ÑÐ´Ð¾Ðº Ñ– Ð½Ðµ ÐºÐ¾Ð¼Ñ–Ñ‚Ð¸Ñ‚Ð¸ Ð¹Ð¾Ð³Ð¾ Ñƒ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ð¹.",
    "â€¢ Ð£ `config.py` (Ð°Ð±Ð¾ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð½Ð¾Ð¼Ñƒ Ñ„Ð°Ð¹Ð»Ñ–) Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ñ‡Ð¸Ñ‚Ð°Ñ‚Ð¸ BOT_TOKEN Ñ‚Ð° ADMIN_ID Ñ– Ð½Ð°Ð´Ð°Ð²Ð°Ñ‚Ð¸ Ñ„ÑƒÐ½ÐºÑ†Ñ–ÑŽ is_admin(user_id).",
  ]);

  const envRow = createTextareaRow("Ð¤Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚ .env (Ð¾Ð¿Ñ†Ñ–Ð¹Ð½Ð¾)", {
    value: data.envSnippet,
    placeholder: "ADMIN_ID=123456789",
    rows: 2,
    onInput: (value) => {
      data.envSnippet = value;
      saveState();
    },
  });
  container.appendChild(envRow);

  renderCodePromptSection(container, {
    title: "config.py",
    dataRef: data.config,
    fileLabel: "Ð¤Ð°Ð¹Ð» ÐºÐ¾Ð½Ñ„Ñ–Ð³ÑƒÑ€Ð°Ñ†Ñ–Ñ—",
    composePrompt: () => composeAdminConfigPrompt(data),
    copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ config.py",
  });
}

function renderAdminMenuStep(container) {
  const data = ensureExtraModuleData().adminPanel;
  renderInfo(container, [
    "â€¢ ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° /admin Ð¼Ð°Ñ” Ð¿Ñ€Ð°Ñ†ÑŽÐ²Ð°Ñ‚Ð¸ Ð»Ð¸ÑˆÐµ Ð´Ð»Ñ Ð°Ð´Ð¼Ñ–Ð½Ñ–ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°.",
    "â€¢ Ð”Ð»Ñ Ð°Ð´Ð¼Ñ–Ð½Ñ–ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð° Ð¿Ð¾ÐºÐ°Ð¶Ð¸ ÐºÐ»Ð°Ð²Ñ–Ð°Ñ‚ÑƒÑ€Ñƒ Ð· Ð¾Ð¿Ñ†Ñ–ÑÐ¼Ð¸: Â«Ð—Ð°ÑÐ²ÐºÐ¸Â», Â«Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°Â», Â«ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½ÑÂ», Â«Ð’Ð¸Ð¹Ñ‚Ð¸ Ð· Ð°Ð´Ð¼Ñ–Ð½-Ñ€ÐµÐ¶Ð¸Ð¼ÑƒÂ».",
    "â€¢ Ð”Ð»Ñ Ñ–Ð½ÑˆÐ¸Ñ… ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ñ–Ð² â€” ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐµ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ Â«Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ð·Ð°Ð±Ð¾Ñ€Ð¾Ð½ÐµÐ½Ð¾Â».",
  ]);

  renderCodePromptSection(container, {
    title: "Ð¥ÐµÐ½Ð´Ð»ÐµÑ€Ð¸ Ð°Ð´Ð¼Ñ–Ð½-Ð¿Ð°Ð½ÐµÐ»Ñ–",
    dataRef: data.handlers,
    fileLabel: "Ð¤Ð°Ð¹Ð» Ð· ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°Ð¼Ð¸",
    composePrompt: () => composeAdminMenuPrompt(data),
    copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸ /admin",
  });
}

function renderAdminLeadsStep(container) {
  const data = ensureExtraModuleData().adminPanel;
  const backendTitle = getBackendTitle();
  renderInfo(container, [
    "â€¢ ÐšÐ½Ð¾Ð¿ÐºÐ° Â«Ð—Ð°ÑÐ²ÐºÐ¸Â» Ð¼Ð°Ñ” Ð¿Ð¾ÐºÐ°Ð·ÑƒÐ²Ð°Ñ‚Ð¸ Ð¾ÑÑ‚Ð°Ð½Ð½Ñ– Ð·Ð²ÐµÑ€Ð½ÐµÐ½Ð½Ñ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ñ–Ð² (Ð°Ð±Ð¾ ÐºÐ»ÑŽÑ‡Ð¾Ð²Ñƒ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ Ð¿Ð¾ Ð½Ð¸Ð¼).",
    `â€¢ Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹ Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ðµ ÑÑ…Ð¾Ð²Ð¸Ñ‰Ðµ (${backendTitle}) Ñ‚Ð° Ð¹Ð¾Ð³Ð¾ Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ—. ÐÑ–Ñ‡Ð¾Ð³Ð¾ Ð½Ðµ Ð´ÑƒÐ±Ð»ÑŽÐ¹.`,
  ]);

  renderCodePromptSection(container, {
    title: "ÐžÐ±Ñ€Ð¾Ð±ÐºÐ° ÐºÐ½Ð¾Ð¿ÐºÐ¸ Â«Ð—Ð°ÑÐ²ÐºÐ¸Â»",
    dataRef: data.leads,
    fileLabel: "Ð¤Ð°Ð¹Ð» Ð· Ð°Ð´Ð¼Ñ–Ð½-Ñ…ÐµÐ½Ð´Ð»ÐµÑ€Ð°Ð¼Ð¸",
    composePrompt: () => composeAdminLeadsPrompt(data, backendTitle),
    copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ Ñ€Ð¾Ð·Ð´Ñ–Ð»Ñƒ Â«Ð—Ð°ÑÐ²ÐºÐ¸Â»",
  });
}

function renderAdminSecurityStep(container) {
  const data = ensureExtraModuleData().adminPanel;
  renderInfo(container, [
    "â€¢ ÐšÐ¾Ð¶ÐµÐ½ Ð°Ð´Ð¼Ñ–Ð½-Ñ…ÐµÐ½Ð´Ð»ÐµÑ€ Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€ÑÑ” is_admin Ð¿ÐµÑ€ÐµÐ´ Ð²Ð¸ÐºÐ¾Ð½Ð°Ð½Ð½ÑÐ¼.",
    "â€¢ ÐšÐ½Ð¾Ð¿ÐºÐ° Â«Ð’Ð¸Ð¹Ñ‚Ð¸ Ð· Ð°Ð´Ð¼Ñ–Ð½-Ñ€ÐµÐ¶Ð¸Ð¼ÑƒÂ» Ð¿Ð¾Ð²ÐµÑ€Ñ‚Ð°Ñ” ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð° Ð´Ð¾ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð³Ð¾ Ð¼ÐµÐ½ÑŽ Ñ‚Ð° Ð¾Ñ‡Ð¸Ñ‰Ð°Ñ” Ð°Ð´Ð¼Ñ–Ð½ÑÑŒÐºÐ¸Ð¹ ÑÑ‚Ð°Ð½.",
    "â€¢ Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ– ÑÑ†ÐµÐ½Ð°Ñ€Ñ–Ñ— Ð´Ð»Ñ Ð·Ð²Ð¸Ñ‡Ð°Ð¹Ð½Ð¸Ñ… ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ñ–Ð² Ð½Ðµ Ð¿Ð¾Ð²Ð¸Ð½Ð½Ñ– Ð·Ð¼Ñ–Ð½Ð¸Ñ‚Ð¸ÑÑ.",
  ]);

  renderCodePromptSection(container, {
    title: "ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ¸ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸ Ñ‚Ð° Ð²Ð¸Ñ…Ñ–Ð´",
    dataRef: data.security,
    fileLabel: "Ð¤Ð°Ð¹Ð» Ñ–Ð· Ð°Ð´Ð¼Ñ–Ð½-Ñ…ÐµÐ½Ð´Ð»ÐµÑ€Ð°Ð¼Ð¸",
    composePrompt: () => composeAdminSecurityPrompt(data),
    copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸",
  });
}

function composeAdminConfigPrompt(data) {
  const snippet = data?.envSnippet?.trim();
  const instructions = [
    snippet
      ? `Ð£ Ñ„Ð°Ð¹Ð»Ñ– .env Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ð¼Ð°Ñ‚Ð¸ Ñ€ÑÐ´Ð¾Ðº(Ð¸): ${snippet.replace(/\s+/g, " ")}`
      : "Ð”Ð¾Ð´Ð°Ð¹ Ñƒ .env Ð·Ð¼Ñ–Ð½Ð½Ñƒ ADMIN_ID Ñ‚Ð° Ð½Ðµ ÐºÐ¾Ð¼Ñ–Ñ‚ÑŒ Ñ—Ñ— Ñƒ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ð¹.",
    "ÐŸÑ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð¹ BOT_TOKEN Ñ– ADMIN_ID Ð· .env Ñ‚Ð¸Ð¼ ÑÐ°Ð¼Ð¸Ð¼ ÑÐ¿Ð¾ÑÐ¾Ð±Ð¾Ð¼, ÑÐºÐ¸Ð¹ Ð²Ð¶Ðµ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÑ”Ñ‚ÑŒÑÑ Ñƒ Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñ– (load_dotenv / environs Ñ‚Ð¾Ñ‰Ð¾).",
    "Ð•ÐºÑÐ¿Ð¾Ñ€Ñ‚ÑƒÐ¹ ADMIN_ID Ñ‚Ð° Ñ„ÑƒÐ½ÐºÑ†Ñ–ÑŽ is_admin(user_id: int) -> bool.",
    "ÐÐµ Ð·Ð¼Ñ–Ð½ÑŽÐ¹ Ñ–Ð½ÑˆÑ– Ð½Ð°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ Ñƒ ÐºÐ¾Ð½Ñ„Ñ–Ð³ÑƒÑ€Ð°Ñ†Ñ–Ñ— â€“ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð´Ð¾Ð¿Ð¾Ð²Ð½Ð¸ Ñ„Ð°Ð¹Ð» Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¸Ð¼Ð¸ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°Ð¼Ð¸.",
  ];
  return buildFullFilePrompt({
    file: data?.config?.file || "config.py",
    code: data?.config?.code,
    instructions,
  });
}

function composeAdminMenuPrompt(data) {
  if (!data?.handlers) return "";
  return buildFullFilePrompt({
    file: data.handlers.file || getEntryFile(),
    code: data.handlers.code,
    instructions: [
      "Ð†Ð¼Ð¿Ð¾Ñ€Ñ‚ÑƒÐ¹ is_admin Ð· config.py.",
      "Ð”Ð¾Ð´Ð°Ð¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /admin (Ñ‚Ð°/Ð°Ð±Ð¾ ÐºÐ½Ð¾Ð¿ÐºÑƒ), ÑÐºÐ° Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€ÑÑ” ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð° Ñ‚Ð° Ð¿Ð¾ÐºÐ°Ð·ÑƒÑ” Ð¼ÐµÐ½ÑŽ Ð°Ð´Ð¼Ñ–Ð½-Ð¿Ð°Ð½ÐµÐ»Ñ–.",
      "Ð”Ð»Ñ Ð°Ð´Ð¼Ñ–Ð½Ñ–ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð° Ð²Ð¸Ð²ÐµÐ´Ð¸ ÐºÐ»Ð°Ð²Ñ–Ð°Ñ‚ÑƒÑ€Ñƒ Ð· Ð¿ÑƒÐ½ÐºÑ‚Ð°Ð¼Ð¸: Â«Ð—Ð°ÑÐ²ÐºÐ¸Â», Â«Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°Â», Â«ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½ÑÂ», Â«Ð’Ð¸Ð¹Ñ‚Ð¸ Ð· Ð°Ð´Ð¼Ñ–Ð½-Ñ€ÐµÐ¶Ð¸Ð¼ÑƒÂ».",
      "Ð”Ð»Ñ Ð·Ð²Ð¸Ñ‡Ð°Ð¹Ð½Ð¸Ñ… ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ñ–Ð² Ð¿Ð¾Ð²ÐµÑ€Ð½Ð¸ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ Â«Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ð·Ð°Ð±Ð¾Ñ€Ð¾Ð½ÐµÐ½Ð¾Â» (Ð±ÐµÐ· Ð·Ð¼Ñ–Ð½ Ñ–Ð½ÑˆÐ¸Ñ… ÑÑ†ÐµÐ½Ð°Ñ€Ñ–Ñ—Ð²).",
    ],
  });
}

function composeAdminLeadsPrompt(data, backendTitle) {
  if (!data?.leads) return "";
  return buildFullFilePrompt({
    file: data.leads.file || data.handlers.file || getEntryFile(),
    code: data.leads.code,
    instructions: [
      "Ð”Ð¾Ð´Ð°Ð¹ Ð¾Ð±Ñ€Ð¾Ð±ÐºÑƒ ÐºÐ½Ð¾Ð¿ÐºÐ¸/ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸ Â«Ð—Ð°ÑÐ²ÐºÐ¸Â» Ð²ÑÐµÑ€ÐµÐ´Ð¸Ð½Ñ– Ð°Ð´Ð¼Ñ–Ð½-Ð¿Ð°Ð½ÐµÐ»Ñ–.",
      `ÐžÑ‚Ñ€Ð¸Ð¼Ð°Ð¹ Ð´Ð°Ð½Ñ– Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ðµ ÑÑ…Ð¾Ð²Ð¸Ñ‰Ðµ (${backendTitle}) â€” Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹ Ñ–ÑÐ½ÑƒÑŽÑ‡Ñ– Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ñ— Ñ‡Ð¸ Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ—.`,
      "ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ð¾ÑÑ‚Ð°Ð½Ð½Ñ– 5-10 Ð·Ð°Ð¿Ð¸ÑÑ–Ð² Ñƒ Ð·Ñ€Ð¾Ð·ÑƒÐ¼Ñ–Ð»Ð¾Ð¼Ñƒ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñ– (ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐµ Ñ€ÐµÐ·ÑŽÐ¼Ðµ ÐºÐ¾Ð¶Ð½Ð¾Ñ— Ð·Ð°ÑÐ²ÐºÐ¸).",
    ],
  });
}

function composeAdminSecurityPrompt(data) {
  if (!data?.security) return "";
  return buildFullFilePrompt({
    file: data.security.file || data.handlers.file || getEntryFile(),
    code: data.security.code,
    instructions: [
      "ÐŸÐµÑ€ÐµÐºÐ¾Ð½Ð°Ð¹ÑÑ, Ñ‰Ð¾ Ð²ÑÑ– Ð°Ð´Ð¼Ñ–Ð½-Ñ…ÐµÐ½Ð´Ð»ÐµÑ€Ð¸ Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€ÑÑŽÑ‚ÑŒ is_admin(user_id) Ð½Ð° Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ.",
      "Ð”Ð¾Ð´Ð°Ð¹ ÐºÐ½Ð¾Ð¿ÐºÑƒ/ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ Â«Ð’Ð¸Ð¹Ñ‚Ð¸ Ð· Ð°Ð´Ð¼Ñ–Ð½-Ñ€ÐµÐ¶Ð¸Ð¼ÑƒÂ», ÑÐºÐ° Ð¿Ñ€Ð¸Ð±Ð¸Ñ€Ð°Ñ” Ð°Ð´Ð¼Ñ–Ð½ÑÑŒÐºÑƒ ÐºÐ»Ð°Ð²Ñ–Ð°Ñ‚ÑƒÑ€Ñƒ Ñ‚Ð° Ð¿Ð¾Ð²ÐµÑ€Ñ‚Ð°Ñ” ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ðµ Ð¼ÐµÐ½ÑŽ.",
      "ÐÐµ Ð·Ð¼Ñ–Ð½ÑŽÐ¹ Ð¿Ð¾Ð²ÐµÐ´Ñ–Ð½ÐºÑƒ Ð´Ð»Ñ Ð·Ð²Ð¸Ñ‡Ð°Ð¹Ð½Ð¸Ñ… ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ñ–Ð².",
    ],
  });
}

function renderI18nDictionariesStep(container) {
  const data = ensureExtraModuleData().i18n;
  renderInfo(container, [
    "â€¢ Ð’Ð¸Ð½ÐµÑÐ¸ Ñ‚ÐµÐºÑÑ‚Ð¸ Ñƒ ÑÐ»Ð¾Ð²Ð½Ð¸ÐºÐ¸ Ð´Ð»Ñ Ð¼Ð¾Ð²: ÑƒÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ°, Ð¿Ð¾Ð»ÑŒÑÑŒÐºÐ°, Ð°Ð½Ð³Ð»Ñ–Ð¹ÑÑŒÐºÐ°.",
    "â€¢ Ð£ helper-Ð¼Ð¾Ð´ÑƒÐ»Ñ– ÑÑ‚Ð²Ð¾Ñ€Ð¸ Ñ„ÑƒÐ½ÐºÑ†Ñ–ÑŽ t(lang, key) Ð· ÐºÐµÑˆÑƒÐ²Ð°Ð½Ð½ÑÐ¼ Ñ‚Ð° fallback Ð½Ð° 'ua'.",
    "â€¢ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°: `locales/<lang>.json` + Ð¼Ð¾Ð´ÑƒÐ»ÑŒ `i18n.py` Ð´Ð»Ñ Ñ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ ÑÐ»Ð¾Ð²Ð½Ð¸ÐºÑ–Ð².",
  ]);

  renderCodePromptSection(container, {
    title: "i18n.py â€” Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ t(lang, key)",
    dataRef: data.helper,
    fileLabel: "Ð¤Ð°Ð¹Ð» i18n.py",
    composePrompt: () => composeI18nHelperPrompt(data),
    copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ i18n.py",
  });

  const localeLabels = {
    ua: "Ð£ÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ°",
    pl: "Polski",
    en: "English",
  };

  ["ua", "pl", "en"].forEach((locale) => {
    renderCodePromptSection(container, {
      title: `Ð¡Ð»Ð¾Ð²Ð½Ð¸Ðº ${localeLabels[locale]}`,
      dataRef: data.locales[locale],
      fileLabel: "Ð¤Ð°Ð¹Ð» ÑÐ»Ð¾Ð²Ð½Ð¸ÐºÐ°",
      composePrompt: () => composeLocalePrompt(locale, data.locales[locale]),
      copyLabel: `ÐŸÑ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ ${localeLabels[locale]}`,
      codeRows: 8,
      codePlaceholder:
        '{"start_welcome": "...", "main_menu_title": "...", "admin_locked": "..."}',
    });
  });
}

function renderI18nStorageStep(container) {
  const data = ensureExtraModuleData().i18n;
  const backendTitle = getBackendTitle();
  renderInfo(container, [
    "â€¢ ÐšÐ¾Ð¶ÐµÐ½ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ Ð¼Ð°Ñ” Ð¿Ð¾Ð»Ðµ language (ua/pl/en) Ð· Ð´ÐµÑ„Ð¾Ð»Ñ‚Ð¾Ð¼ ua.",
    `â€¢ ÐŸÑ€Ð°Ñ†ÑŽÐ¹ Ð¿Ð¾Ð²ÐµÑ€Ñ… Ñ–ÑÐ½ÑƒÑŽÑ‡Ð¾Ð³Ð¾ ÑÑ…Ð¾Ð²Ð¸Ñ‰Ð° (${backendTitle}) â€” Ð½Ñ–Ñ‡Ð¾Ð³Ð¾ Ð½Ðµ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿Ð¸ÑÑƒÐ¹.`,
    "â€¢ ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ñ– Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ— get_user_language(user_id) Ñ‚Ð° set_user_language(user_id, lang).",
  ]);

  renderCodePromptSection(container, {
    title: "Ð¡Ñ…Ð¾Ð²Ð¸Ñ‰Ðµ Ð¼Ð¾Ð²Ð¸ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°",
    dataRef: data.storage,
    fileLabel: "Ð¤Ð°Ð¹Ð» ÑÑ…Ð¾Ð²Ð¸Ñ‰Ð°",
    composePrompt: () => composeI18nStoragePrompt(data, backendTitle),
    copyLabel: "ÐŸÑ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ Ð¼Ð¾Ð²Ð¸",
  });
}

function renderI18nLanguageStep(container) {
  const data = ensureExtraModuleData().i18n;
  renderInfo(container, [
    "â€¢ Ð”Ð¾Ð´Ð°Ð¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /language (Ð°Ð±Ð¾ Ñ€Ð¾Ð·ÑˆÐ¸Ñ€ /start), Ñ‰Ð¾Ð± Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð²Ð¸Ð±Ð¾Ñ€Ñƒ Ð¼Ð¾Ð²Ð¸.",
    "â€¢ ÐŸÑ€Ð¸ Ð½Ð°Ñ‚Ð¸ÑÐºÐ°Ð½Ð½Ñ– Ð²Ð¸ÐºÐ»Ð¸ÐºÐ°Ð¹ set_user_language Ñ– Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð»ÑÐ¹ Ð¿Ñ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¶ÐµÐ½Ð½Ñ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ñƒ.",
  ]);

  renderCodePromptSection(container, {
    title: "Ð’Ð¸Ð±Ñ–Ñ€ Ð¼Ð¾Ð²Ð¸",
    dataRef: data.language,
    fileLabel: "Ð¤Ð°Ð¹Ð» Ñ–Ð· Ñ…ÐµÐ½Ð´Ð»ÐµÑ€Ð¾Ð¼ /start Ð°Ð±Ð¾ /language",
    composePrompt: () => composeI18nLanguagePrompt(data),
    copyLabel: "ÐŸÑ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ Ð²Ð¸Ð±Ð¾Ñ€Ñƒ Ð¼Ð¾Ð²Ð¸",
  });
}

function renderI18nUsageStep(container) {
  const data = ensureExtraModuleData().i18n;
  renderInfo(container, [
    "â€¢ Ð£ÑÑ– Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ Ð¿Ð¾Ð²Ð¸Ð½Ð½Ñ– Ð±Ñ€Ð°Ñ‚Ð¸ Ñ‚ÐµÐºÑÑ‚Ð¸ Ñ‡ÐµÑ€ÐµÐ· t(lang, key).",
    "â€¢ Ð’Ð¸Ð·Ð½Ð°Ñ‡Ð°Ð¹ user_lang Ñ‡ÐµÑ€ÐµÐ· get_user_language(user_id) Ð· Ð´ÐµÑ„Ð¾Ð»Ñ‚Ð¾Ð¼ 'ua'.",
    "â€¢ ÐÐµ Ð·Ð¼Ñ–Ð½ÑŽÐ¹ Ð±Ñ–Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ñ–ÐºÑƒ Ñ‚Ð° Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº Ð²Ð¸ÐºÐ»Ð¸ÐºÑ–Ð² â€” Ð»Ð¸ÑˆÐµ Ð·Ð°Ð¼Ñ–Ð½Ð¸ Ñ‚ÐµÐºÑÑ‚Ð¸.",
  ]);

  renderCodePromptSection(container, {
    title: "Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ ÑÐ»Ð¾Ð²Ð½Ð¸ÐºÑ–Ð² Ñƒ Ð±Ð¾Ñ‚Ñ–",
    dataRef: data.usage,
    fileLabel: "ÐžÑÐ½Ð¾Ð²Ð½Ð¸Ð¹ Ñ„Ð°Ð¹Ð» Ð±Ð¾Ñ‚Ð°",
    composePrompt: () => composeI18nUsagePrompt(data),
    copyLabel: "ÐŸÑ€Ð¾Ð¼Ð¿Ñ‚ Ð´Ð»Ñ Ð·Ð°Ð¼Ñ–Ð½Ð¸ Ñ‚ÐµÐºÑÑ‚Ñ–Ð²",
  });
}

function composeI18nHelperPrompt(data) {
  return buildFullFilePrompt({
    file: data?.helper?.file || "i18n.py",
    code: data?.helper?.code,
    instructions: [
      "Ð”Ð¾Ð´Ð°Ð¹ Ñ„ÑƒÐ½ÐºÑ†Ñ–ÑŽ t(lang: str, key: str, **kwargs), ÑÐºÐ° Ñ‡Ð¸Ñ‚Ð°Ñ” JSON-ÑÐ»Ð¾Ð²Ð½Ð¸ÐºÐ¸ Ð· ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³Ñƒ locales/ Ñ‚Ð° Ð¿Ð¾Ð²ÐµÑ€Ñ‚Ð°Ñ” Ð¿ÐµÑ€ÐµÐºÐ»Ð°Ð´.",
      "Ð—Ñ€Ð¾Ð±Ð¸ ÐºÐµÑˆÑƒÐ²Ð°Ð½Ð½Ñ ÑÐ»Ð¾Ð²Ð½Ð¸ÐºÑ–Ð² Ñƒ Ð¿Ð°Ð¼Ê¼ÑÑ‚Ñ– Ñ‚Ð° fallback Ð½Ð° Ð¼Ð¾Ð²Ñƒ 'ua', ÑÐºÑ‰Ð¾ ÐºÐ»ÑŽÑ‡ Ð°Ð±Ð¾ Ñ„Ð°Ð¹Ð» Ð²Ñ–Ð´ÑÑƒÑ‚Ð½Ñ–Ð¹.",
      "ÐŸÐµÑ€ÐµÐ´Ð±Ð°Ñ‡ Ð·Ð°Ð¼Ñ–Ð½Ñƒ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ñ–Ð² (kwargs) Ñƒ Ñ€ÑÐ´ÐºÐ°Ñ….",
    ],
  });
}

function composeLocalePrompt(locale, localeData) {
  const labels = { ua: "Ð£ÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ°", pl: "Polski", en: "English" };
  return buildFullFilePrompt({
    file: localeData?.file || `locales/${locale}.json`,
    code: localeData?.code,
    language: "json",
    instructions: [
      `Ð—Ð°Ð¿Ð¾Ð²Ð½Ð¸ ÑÐ»Ð¾Ð²Ð½Ð¸Ðº Ð´Ð»Ñ Ð¼Ð¾Ð²Ð¸ ${labels[locale] || locale} (start_welcome, main_menu_title, admin_locked, language_prompt, language_confirm, Ñ–Ð½ÑˆÑ– Ñ‚ÐµÐºÑÑ‚Ð¸ Ð· Ð±Ð¾Ñ‚Ð°).`,
      "Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹ Ñ„Ð°ÐºÑ‚Ð¸Ñ‡Ð½Ñ– Ñ‚ÐµÐºÑÑ‚Ð¸, ÑÐºÑ– Ð·Ð°Ñ€Ð°Ð· Ð½Ð°Ð´ÑÐ¸Ð»Ð°Ñ” Ð±Ð¾Ñ‚, Ð¿ÐµÑ€ÐµÐºÐ»Ð°Ð²ÑˆÐ¸ Ñ—Ñ… Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð½Ð¾ÑŽ Ð¼Ð¾Ð²Ð¾ÑŽ.",
      "JSON Ð¼Ð°Ñ” Ð±ÑƒÑ‚Ð¸ Ð²Ð°Ð»Ñ–Ð´Ð½Ð¸Ð¼ Ñ‚Ð° Ð²Ð¿Ð¾Ñ€ÑÐ´ÐºÐ¾Ð²Ð°Ð½Ð¸Ð¼.",
    ],
  });
}

function composeI18nStoragePrompt(data, backendTitle) {
  return buildFullFilePrompt({
    file: data?.storage?.file || "storage.py",
    code: data?.storage?.code,
    instructions: [
      "Ð”Ð¾Ð´Ð°Ð¹ Ð¿Ð¾Ð»Ðµ language (str, Ð´ÐµÑ„Ð¾Ð»Ñ‚ 'ua') Ð´Ð»Ñ ÑÑƒÑ‚Ð½Ð¾ÑÑ‚Ñ– ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°.",
      "Ð”Ð¾Ð´Ð°Ð¹ Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ— get_user_language(user_id) -> str Ñ‚Ð° set_user_language(user_id, lang).",
      `ÐŸÑ€Ð°Ñ†ÑŽÐ¹ Ð¿Ð¾Ð²ÐµÑ€Ñ… Ñ–ÑÐ½ÑƒÑŽÑ‡Ð¾Ð³Ð¾ Ð±ÐµÐºÐµÐ½Ð´Ñƒ (${backendTitle}) Ð±ÐµÐ· Ð·Ð¼Ñ–Ð½Ð¸ Ñ‚Ð¸Ð¿Ñƒ Ð·Ð±ÐµÑ€Ñ–Ð³Ð°Ð½Ð½Ñ.`,
    ],
  });
}

function composeI18nLanguagePrompt(data) {
  return buildFullFilePrompt({
    file: data?.language?.file || getEntryFile(),
    code: data?.language?.code,
    instructions: [
      "Ð”Ð¾Ð´Ð°Ð¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /language (Ð°Ð±Ð¾ Ñ€Ð¾Ð·ÑˆÐ¸Ñ€ /start), ÑÐºÐ° Ð¿Ð¾ÐºÐ°Ð·ÑƒÑ” ÐºÐ½Ð¾Ð¿ÐºÐ¸ Â«Ð£ÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ°Â», Â«PolskiÂ», Â«EnglishÂ».",
      "ÐŸÑ€Ð¸ Ð²Ð¸Ð±Ð¾Ñ€Ñ– Ð²Ð¸ÐºÐ»Ð¸ÐºÐ°Ð¹ set_user_language(user_id, lang) Ñ– Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð»ÑÐ¹ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ñƒ Ð¿Ñ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¶ÐµÐ½Ð½Ñ Ð· Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¸Ð¼ Ð¼ÐµÐ½ÑŽ.",
      "ÐŸÑ–ÑÐ»Ñ Ð²Ð¸Ð±Ð¾Ñ€Ñƒ Ð¾Ð´Ñ€Ð°Ð·Ñƒ Ð¿Ñ–Ð´Ñ‚ÑÐ³ÑƒÐ¹ t(lang, key), Ñ‰Ð¾Ð± Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ Ñ„Ñ€Ð°Ð·Ð¸ Ñƒ Ð½Ð¾Ð²Ñ–Ð¹ Ð¼Ð¾Ð²Ñ–.",
    ],
  });
}

function composeI18nUsagePrompt(data) {
  return buildFullFilePrompt({
    file: data?.usage?.file || getEntryFile(),
    code: data?.usage?.code,
    instructions: [
      "Ð£ ÐºÐ¾Ð¶Ð½Ð¾Ð¼Ñƒ Ñ…ÐµÐ½Ð´Ð»ÐµÑ€Ñ– Ð´Ñ–ÑÑ‚Ð°Ð²Ð°Ð¹ user_lang = get_user_language(user_id) Ð°Ð±Ð¾ 'ua' Ð·Ð° Ð·Ð°Ð¼Ð¾Ð²Ñ‡ÑƒÐ²Ð°Ð½Ð½ÑÐ¼.",
      "Ð—Ð°Ð¼Ñ–Ð½Ñ– Ð²ÑÑ– Ñ…Ð°Ñ€Ð´ÐºÐ¾Ð´Ð½Ñ– Ñ‚ÐµÐºÑÑ‚Ð¸ Ð½Ð° Ð²Ð¸ÐºÐ»Ð¸ÐºÐ¸ t(user_lang, \"key\") Ð· Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð½Ð¸Ð¼Ð¸ ÐºÐ»ÑŽÑ‡Ð°Ð¼Ð¸.",
      "ÐÐµ Ð·Ð¼Ñ–Ð½ÑŽÐ¹ Ð±Ñ–Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ñ–ÐºÑƒ, Ð»Ð¸ÑˆÐµ Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð½Ð½Ñ Ñ‚ÐµÐºÑÑ‚Ñ–Ð².",
    ],
  });
}

function getExtraModuleStepDefinitions(moduleId) {
  switch (moduleId) {
    case "autosave":
      return [
        {
          id: "autosave-storage",
          title: "ÐÐ²Ñ‚Ð¾Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ: ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÑÑ…Ð¾Ð²Ð¸Ñ‰Ð°",
          render: renderAutosaveStorageStep,
        },
        {
          id: "autosave-hooks",
          title: "ÐÐ²Ñ‚Ð¾Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ: Ð²Ð¸ÐºÐ»Ð¸ÐºÐ¸ Ñƒ Ñ…ÐµÐ½Ð´Ð»ÐµÑ€Ð°Ñ…",
          render: renderAutosaveHooksStep,
        },
        {
          id: "autosave-restore",
          title: "ÐÐ²Ñ‚Ð¾Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ: Ð²Ñ–Ð´Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð¿Ñ€Ð¸ ÑÑ‚Ð°Ñ€Ñ‚Ñ–",
          render: renderAutosaveRestoreStep,
        },
      ];
    case "adminPanel":
      return [
        {
          id: "admin-config",
          title: "ÐÐ´Ð¼Ñ–Ð½-Ð¿Ð°Ð½ÐµÐ»ÑŒ: ADMIN_ID Ñ– ÐºÐ¾Ð½Ñ„Ñ–Ð³",
          render: renderAdminConfigStep,
        },
        {
          id: "admin-menu",
          title: "ÐÐ´Ð¼Ñ–Ð½-Ð¿Ð°Ð½ÐµÐ»ÑŒ: ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° /admin",
          render: renderAdminMenuStep,
        },
        {
          id: "admin-leads",
          title: "ÐÐ´Ð¼Ñ–Ð½-Ð¿Ð°Ð½ÐµÐ»ÑŒ: Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ´ Ð·Ð°ÑÐ²Ð¾Ðº",
          render: renderAdminLeadsStep,
        },
        {
          id: "admin-security",
          title: "ÐÐ´Ð¼Ñ–Ð½-Ð¿Ð°Ð½ÐµÐ»ÑŒ: Ð±ÐµÐ·Ð¿ÐµÐºÐ° Ñ– Ð²Ð¸Ñ…Ñ–Ð´",
          render: renderAdminSecurityStep,
        },
      ];
    case "i18n":
      return [
        {
          id: "i18n-dictionaries",
          title: "Ð‘Ð°Ð³Ð°Ñ‚Ð¾Ð¼Ð¾Ð²Ð½Ñ–ÑÑ‚ÑŒ: ÑÐ»Ð¾Ð²Ð½Ð¸ÐºÐ¸",
          render: renderI18nDictionariesStep,
        },
        {
          id: "i18n-storage",
          title: "Ð‘Ð°Ð³Ð°Ñ‚Ð¾Ð¼Ð¾Ð²Ð½Ñ–ÑÑ‚ÑŒ: Ð·Ð±ÐµÑ€Ñ–Ð³Ð°Ð½Ð½Ñ Ð¼Ð¾Ð²Ð¸",
          render: renderI18nStorageStep,
        },
        {
          id: "i18n-language",
          title: "Ð‘Ð°Ð³Ð°Ñ‚Ð¾Ð¼Ð¾Ð²Ð½Ñ–ÑÑ‚ÑŒ: Ð²Ð¸Ð±Ñ–Ñ€ Ð¼Ð¾Ð²Ð¸",
          render: renderI18nLanguageStep,
        },
        {
          id: "i18n-usage",
          title: "Ð‘Ð°Ð³Ð°Ñ‚Ð¾Ð¼Ð¾Ð²Ð½Ñ–ÑÑ‚ÑŒ: Ñ‚ÐµÐºÑÑ‚Ð¸ Ñ‡ÐµÑ€ÐµÐ· t(lang, key)",
          render: renderI18nUsageStep,
        },
      ];
    default:
      return [];
  }
}

function renderInfo(container, lines, footer) {
  const entryFile = getEntryFile();
  const processedLines = lines?.map((line) =>
    replaceEntryFileTokens(line, entryFile)
  );

  if (processedLines?.length) {
    const block = document.createElement("div");
    block.className = "info-block";

    processedLines.forEach((line) => {
      const parsed = parseAiLine(line);
      if (parsed) {
        const label = document.createElement("div");
        label.className = "info-ai-label";
        label.textContent = "ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð†:";
        block.appendChild(label);

        const promptText = extractAiPrompt(parsed);
        const target = getPromptAiTarget("code");
        const promptBlock = createPromptBlock(promptText, {
          copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ",
          ai: target,
          openLabel: target === "codex" ? "Ð’Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ð¸ Codex" : "Ð’Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ð¸ ChatGPT",
        });
        block.appendChild(promptBlock);
      } else {
        appendInfoLine(block, line);
      }
    });

    container.appendChild(block);
  }

  if (footer) {
    const note = document.createElement("div");
    note.className = "note-block";
    note.textContent = replaceEntryFileTokens(footer, entryFile);
    container.appendChild(note);
  }
}

function makeRow(labelText, control) {
  const row = document.createElement("div");
  row.className = "form-row";

  const label = document.createElement("div");
  label.className = "form-label";
  label.textContent = labelText;
  row.appendChild(label);

  row.appendChild(control);
  return row;
}

function makeSelect(options, value, onChange) {
  const wrapper = document.createElement("div");
  wrapper.className = "form-control";
  const select = document.createElement("select");
  options.forEach(([val, title]) => {
    const option = document.createElement("option");
    option.value = val;
    option.textContent = title;
    if (val === value) option.selected = true;
    select.appendChild(option);
  });
  select.addEventListener("change", (event) => onChange(event.target.value));
  wrapper.appendChild(select);
  return wrapper;
}

function wrapControl(control) {
  const wrapper = document.createElement("div");
  wrapper.className = "form-control";
  wrapper.appendChild(control);
  return wrapper;
}

function createTextInputRow(labelText, { value, placeholder, onInput }) {
  const input = document.createElement("input");
  input.type = "text";
  input.value = value || "";
  if (placeholder) input.placeholder = placeholder;
  input.addEventListener("input", (event) => {
    onInput(event.target.value);
  });
  return makeRow(labelText, wrapControl(input));
}

function createTextareaRow(labelText, { value, placeholder, rows = 10, onInput }) {
  const textarea = document.createElement("textarea");
  textarea.value = value || "";
  if (placeholder) textarea.placeholder = placeholder;
  textarea.rows = rows;
  textarea.addEventListener("input", (event) => {
    onInput(event.target.value);
  });
  return makeRow(labelText, wrapControl(textarea));
}

function createPromptBlock(text, options = {}) {
  const block = document.createElement("div");
  block.className = "prompt-area";

  const content = document.createElement("pre");
  content.className = "prompt-text";
  content.textContent = text;

  if (options.collapsible) {
    block.classList.add("prompt-collapsible", "collapsed");
    const toggleWrap = document.createElement("div");
    toggleWrap.className = "prompt-collapse-head";
    const toggleBtn = document.createElement("button");
    toggleBtn.type = "button";
    toggleBtn.className = "ghost prompt-toggle";
    const collapsedLabel = options.expandLabel || "Ð Ð¾Ð·Ð³Ð¾Ñ€Ð½ÑƒÑ‚Ð¸ Ð²ÐµÑÑŒ Ð¿Ñ€Ð¾Ð¼Ñ‚";
    const expandedLabel = options.collapseLabel || "Ð—Ð³Ð¾Ñ€Ð½ÑƒÑ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ñ‚";
    toggleBtn.textContent = collapsedLabel;
    toggleBtn.addEventListener("click", () => {
      const collapsed = block.classList.toggle("collapsed");
      content.hidden = collapsed;
      toggleBtn.textContent = collapsed ? collapsedLabel : expandedLabel;
    });
    toggleWrap.appendChild(toggleBtn);
    block.appendChild(toggleWrap);
    content.hidden = true;
  }

  block.appendChild(content);

  const actions = document.createElement("div");
  actions.className = "prompt-actions";

  const copyBtn = document.createElement("button");
  copyBtn.type = "button";
  copyBtn.className = "ghost copy-btn";
  copyBtn.textContent = options.copyLabel || "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸";
  copyBtn.addEventListener("click", () => copyText(text));
  actions.appendChild(copyBtn);

  if (options.ai) {
    const target = options.ai;
    const aiBtn = document.createElement("button");
    aiBtn.type = "button";
    aiBtn.className = "primary prompt-open";
    aiBtn.textContent = options.openLabel || getAiLabel(target);
    aiBtn.addEventListener("click", () => openAi(target));
    actions.appendChild(aiBtn);
  }

  block.appendChild(actions);
  return block;
}

function createLivePromptBlock(getText, options = {}) {
  const block = document.createElement("div");
  block.className = "prompt-area live-prompt";

  const content = document.createElement("pre");
  content.className = "prompt-text";
  block.appendChild(content);

  const actions = document.createElement("div");
  actions.className = "prompt-actions";

  const copyBtn = document.createElement("button");
  copyBtn.type = "button";
  copyBtn.className = "ghost copy-btn";
  copyBtn.textContent = options.copyLabel || "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚";
  copyBtn.addEventListener("click", () => {
    const text = getText();
    if (!text?.trim()) {
      showToast("Ð¡Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ Ð·Ð°Ð¿Ð¾Ð²Ð½Ð¸ Ð¿Ð¾Ð»Ñ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚Ñƒ.");
      return;
    }
    copyText(text);
  });
  actions.appendChild(copyBtn);

  if (options.ai) {
    const aiBtn = document.createElement("button");
    aiBtn.type = "button";
    aiBtn.className = "primary prompt-open";
    aiBtn.textContent = options.openLabel || getAiLabel(options.ai);
    aiBtn.addEventListener("click", () => openAi(options.ai));
    actions.appendChild(aiBtn);
  }

  block.appendChild(actions);

  const placeholder =
    options.placeholder || "Ð”Ð¾Ð´Ð°Ð¹ ÐºÐ¾Ð´ Ð²Ð¸Ñ‰Ðµ, Ñ‰Ð¾Ð± ÑÑ„Ð¾Ñ€Ð¼ÑƒÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚.";

  function update() {
    const text = getText();
    if (text?.trim()) {
      content.textContent = text;
      copyBtn.disabled = false;
    } else {
      content.textContent = placeholder;
      copyBtn.disabled = true;
    }
  }

  block.updatePrompt = update;
  update();

  return block;
}

function renderCodePromptSection(container, config) {
  const {
    title,
    description,
    dataRef,
    fileLabel = "Ð¤Ð°Ð¹Ð»",
    filePlaceholder,
    codeLabel = "ÐŸÐ¾Ñ‚Ð¾Ñ‡Ð½Ð¸Ð¹ ÐºÐ¾Ð´",
    codePlaceholder,
    codeRows = 12,
    composePrompt,
    copyLabel,
    promptPlaceholder,
  } = config;

  const section = document.createElement("section");
  section.className = "module-section";

  if (title) {
    const h4 = document.createElement("h4");
    h4.textContent = title;
    section.appendChild(h4);
  }

  if (description) {
    const p = document.createElement("p");
    p.className = "module-section-desc";
    p.textContent = description;
    section.appendChild(p);
  }

  const aiTarget = getPromptAiTarget();

  const updatePrompt = () => {
    saveState();
    promptBlock.updatePrompt();
  };

  const fileRow = createTextInputRow(fileLabel, {
    value: dataRef.file,
    placeholder: filePlaceholder,
    onInput: (value) => {
      dataRef.file = value;
      updatePrompt();
    },
  });
  section.appendChild(fileRow);

  const codeRow = createTextareaRow(codeLabel, {
    value: dataRef.code,
    placeholder:
      codePlaceholder ||
      "Ð’ÑÑ‚Ð°Ð² ÑÑŽÐ´Ð¸ Ð¿Ð¾Ð²Ð½Ð¸Ð¹ ÐºÐ¾Ð´ Ñ„Ð°Ð¹Ð»Ð° Ð¿ÐµÑ€ÐµÐ´ Ñ‚Ð¸Ð¼, ÑÐº Ð¿Ñ€Ð¾ÑÐ¸Ñ‚Ð¸ Ð¨Ð† Ð¿Ñ€Ð¾ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ.",
    rows: codeRows,
    onInput: (value) => {
      dataRef.code = value;
      updatePrompt();
    },
  });
  section.appendChild(codeRow);

  const promptBlock = createLivePromptBlock(
    () => composePrompt(dataRef),
    {
      copyLabel,
      ai: aiTarget,
      openLabel: getAiLabel(aiTarget),
      placeholder: promptPlaceholder,
    }
  );
  section.appendChild(promptBlock);

  container.appendChild(section);
  promptBlock.updatePrompt();
}

function buildFullFilePrompt({
  file,
  code,
  instructions,
  language = "python",
}) {
  const content = typeof code === "string" ? code : "";
  const normalizedInstructions = Array.isArray(instructions)
    ? instructions.filter(Boolean)
    : [];
  if (!content.trim()) return "";
  const lines = [
    `Ð¤Ð°Ð¹Ð»: ${file || "main.py"}.`,
    "",
    "ÐŸÐ¾Ñ‚Ð¾Ñ‡Ð½Ð¸Ð¹ Ð¿Ð¾Ð²Ð½Ð¸Ð¹ ÐºÐ¾Ð´:",
    `\`\`\`${language}`,
    content,
    "```",
  ];
  if (normalizedInstructions.length) {
    lines.push("", "Ð©Ð¾ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ð·Ñ€Ð¾Ð±Ð¸Ñ‚Ð¸:");
    normalizedInstructions.forEach((item, index) => {
      lines.push(`${index + 1}. ${item}`);
    });
  }
  lines.push(
    "",
    "ÐŸÐµÑ€ÐµÐ¿Ð¸ÑˆÐ¸ Ð¿Ð¾Ð²Ð½Ñ–ÑÑ‚ÑŽ Ñ„Ð°Ð¹Ð», Ð·Ð±ÐµÑ€Ñ–Ð³Ð°ÑŽÑ‡Ð¸ Ð²ÑÑŽ Ñ–ÑÐ½ÑƒÑŽÑ‡Ñƒ Ð»Ð¾Ð³Ñ–ÐºÑƒ Ð±Ð¾Ñ‚Ð°. Ð”Ð¾Ð´Ð°Ð¹ Ñ‚Ñ–Ð»ÑŒÐºÐ¸ Ð¾Ð¿Ð¸ÑÐ°Ð½Ñ– Ð·Ð¼Ñ–Ð½Ð¸. Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ð¹ Ð»Ð¸ÑˆÐµ Ð¿Ð¾Ð²Ð½Ð¸Ð¼ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¼ ÐºÐ¾Ð´Ð¾Ð¼ Ñ„Ð°Ð¹Ð»Ñƒ Ð±ÐµÐ· Ð¿Ð¾ÑÑÐ½ÐµÐ½ÑŒ."
  );
  return lines.join("\n");
}

function createToolCard({ title, description, link, prompt, ai }) {
  const card = document.createElement("div");
  card.className = "card";

  const h = document.createElement("h3");
  h.textContent = title;
  card.appendChild(h);

  if (description) {
    const p = document.createElement("p");
    p.textContent = description;
    card.appendChild(p);
  }

  if (prompt) {
    const aiTarget = ai || "chatgpt";
    card.appendChild(
      createPromptBlock(prompt, {
        copyLabel: "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ñ–ÑŽ",
        ai: aiTarget,
        openLabel: getAiLabel(aiTarget),
      })
    );
  }

  if (link) {
    const actions = document.createElement("div");
    actions.className = "prompt-actions";
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "primary prompt-open";
    btn.textContent = "Ð’Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ð¸ ÑÐ°Ð¹Ñ‚";
    btn.addEventListener("click", () => openAi(link));
    actions.appendChild(btn);
    card.appendChild(actions);
  }

  return card;
}

function createCarouselSlide({ title, body, code }) {
  const slide = document.createElement("div");
  slide.className = "carousel-slide";

  const h = document.createElement("h4");
  h.textContent = title;
  slide.appendChild(h);

  const p = document.createElement("p");
  p.textContent = body;
  slide.appendChild(p);

  if (code) {
    const pre = document.createElement("pre");
    pre.className = "carousel-code";
    pre.textContent = code;
    slide.appendChild(pre);

    const actions = document.createElement("div");
    actions.className = "prompt-actions";
    const copyBtn = document.createElement("button");
    copyBtn.type = "button";
    copyBtn.className = "ghost copy-btn";
    copyBtn.textContent = "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ ÐºÐ¾Ð´";
    copyBtn.addEventListener("click", () => copyText(code));
    actions.appendChild(copyBtn);
    slide.appendChild(actions);
  }

  return slide;
}

function getAiLabel(target) {
  switch (target) {
    case "codex":
      return "Ð’Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ð¸ Codex";
    case "chatgpt":
    default:
      return "Ð’Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ð¸ ChatGPT";
  }
}

function getPromptAiTarget(kind = "code") {
  if (state.choices.mode !== "codex") return "chatgpt";
  return kind === "code" ? "codex" : "chatgpt";
}

function openAi(target) {
  const url = AI_LINKS[target] || target;
  window.open(url, "_blank", "noopener");
}

function parseAiLine(line) {
  const trimmed = line.trim();
  const withoutBullet = trimmed.startsWith("â€¢")
    ? trimmed.slice(1).trim()
    : trimmed;
  return withoutBullet.startsWith("ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð†") ? withoutBullet : null;
}

function extractAiPrompt(line) {
  let prompt = line.replace(/^ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸ Ð¨Ð†:\s*/, "").trim();
  if (prompt.startsWith("Â«") && prompt.endsWith("Â»"))
    prompt = prompt.slice(1, -1);
  prompt = prompt
    .replace(/^[Â«"]/u, "")
    .replace(/[Â»"]?\.?$/u, "")
    .trim();
  return prompt;
}

function extractBackticked(line) {
  const items = [];
  const regex = /`([^`]+)`/g;
  let match;
  while ((match = regex.exec(line)) !== null) {
    if (match[1]) items.push(match[1]);
  }
  return items;
}

function replaceEntryFileTokens(text, entryFile) {
  if (typeof text !== "string") return text;
  return text.replace(/main\.py/g, entryFile || "main.py");
}

function appendInfoLine(block, line) {
  const row = document.createElement("div");
  row.className = "info-line";

  const text = document.createElement("div");
  text.className = "info-line-text";
  text.textContent = line;
  row.appendChild(text);

  const actions = document.createElement("div");
  actions.className = "inline-actions";

  const snippets = extractBackticked(line);
  snippets.forEach((snippet) => {
    if (snippet === "@BotFather") return;
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "ghost copy-btn";
    btn.textContent = `Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ ${snippet}`;
    btn.addEventListener("click", () => copyText(snippet));
    actions.appendChild(btn);
  });

  if (/BotFather/i.test(line)) {
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "primary prompt-open";
    btn.textContent = "Ð’Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ð¸ BotFather";
    btn.addEventListener("click", () => openAi("https://t.me/BotFather"));
    actions.appendChild(btn);
  }

  if (actions.childElementCount) row.appendChild(actions);
  block.appendChild(row);
}

// --- Ð—Ð°Ð³Ð°Ð»ÑŒÐ½Ñ– ÑƒÑ‚Ð¸Ð»Ñ–Ñ‚Ð¸ ---
function copyText(text) {
  if (!navigator.clipboard) {
    showToast("Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð½Ðµ Ð²Ð´Ð°Ð»Ð¾ÑÑ (Ð¾Ð±Ð¼ÐµÐ¶ÐµÐ½Ð½Ñ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð°).");
    return;
  }
  navigator.clipboard
    .writeText(text)
    .then(() => showToast("Ð¡ÐºÐ¾Ð¿Ñ–Ð¹Ð¾Ð²Ð°Ð½Ð¾ Ñƒ Ð±ÑƒÑ„ÐµÑ€."));
}

function showToast(message) {
  elements.toast.textContent = message;
  elements.toast.style.display = "inline-flex";
  clearTimeout(showToast._timer);
  showToast._timer = setTimeout(() => {
    elements.toast.style.display = "none";
  }, 2200);
}

function validateStep(step) {
  switch (step.id) {
    case "bot-type":
      return state.choices.botType ? ok() : fail("ÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ñ‚Ð¸Ð¿ Ð±Ð¾Ñ‚Ð°.");
    case "mode":
      return state.choices.mode ? ok() : fail("ÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ñ€ÐµÐ¶Ð¸Ð¼ Ð¨Ð†.");
    case "environment":
      return state.choices.environment ? ok() : fail("ÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ ÑÐµÑ€ÐµÐ´Ð¾Ð²Ð¸Ñ‰Ðµ.");
    case "tools": {
      const checklist =
        state.choices.environment === "codespaces"
          ? CODESPACES_TOOL_CHECKLIST
          : TOOL_CHECKLIST;
      const required = checklist.filter(
        (tool) => !tool.optional || state.choices.mode === "codex"
      );
      required.forEach((tool) => {
        if (state.tools[tool.id] === undefined) state.tools[tool.id] = false;
      });
      const ready = required.every((tool) => state.tools[tool.id]);
      return ready ? ok() : fail("ÐŸÐ¾ÑÑ‚Ð°Ð² Ð³Ð°Ð»Ð¾Ñ‡ÐºÐ¸ Ñƒ Ñ‡ÐµÐº-Ð»Ð¸ÑÑ‚Ñ–.");
    }
    case "requirements":
      return state.tools.requirements
        ? ok()
        : fail("Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ requirements.txt Ð°Ð±Ð¾ Ð¿Ð¾Ð·Ð½Ð°Ñ‡, Ñ‰Ð¾ Ð·Ñ€Ð¾Ð±Ð¸Ñˆ Ñ†Ðµ.");
    case "env-file":
      return state.tools.env
        ? ok()
        : fail("Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸ .env Ð°Ð±Ð¾ Ð¿Ð¾Ð·Ð½Ð°Ñ‡, Ñ‰Ð¾ Ð·Ñ€Ð¾Ð±Ð¸Ñˆ Ñ†Ðµ.");
    case "backend-choice":
      return state.choices.backend ? ok() : fail("ÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ñ‚Ð¸Ð¿ Ð·Ð±ÐµÑ€Ñ–Ð³Ð°Ð½Ð½Ñ.");
    case "custom-requirements": {
      const custom = ensureCustomState();
      return custom.requirements?.trim()
        ? ok()
        : fail("ÐžÐ¿Ð¸ÑˆÐ¸, ÑÐºÐ¾Ð³Ð¾ Ð±Ð¾Ñ‚Ð° Ñ‚Ð¸ Ñ…Ð¾Ñ‡ÐµÑˆ.");
    }
    case "custom-brief-import": {
      const custom = ensureCustomState();
      return custom.brief
        ? ok()
        : fail("Ð”Ð¾Ð´Ð°Ð¹ JSON-Ð±Ñ€Ð¸Ñ„ Ñ– Ð½Ð°Ñ‚Ð¸ÑÐ½Ð¸ Â«Ð—Ð±ÐµÑ€ÐµÐ³Ñ‚Ð¸ Ð±Ñ€Ð¸Ñ„Â».");
    }
    case "custom-files": {
      const custom = ensureCustomState();
      if (!custom.files.length)
        return fail("Ð¡Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ Ð·Ð±ÐµÑ€ÐµÐ¶Ð¸ Ð±Ñ€Ð¸Ñ„, Ñ‰Ð¾Ð± Ð¿Ð¾Ð±ÑƒÐ´ÑƒÐ²Ð°Ñ‚Ð¸ ÑÐ¿Ð¸ÑÐ¾Ðº Ñ„Ð°Ð¹Ð»Ñ–Ð².");
      const allDone = custom.files.every((file) => file.done);
      return allDone ? ok() : fail("ÐŸÐ¾Ð·Ð½Ð°Ñ‡ ÑƒÑÑ– Ñ„Ð°Ð¹Ð»Ð¸ ÑÐº Ð²Ð¸ÐºÐ¾Ð½Ð°Ð½Ñ–.");
    }
    case "custom-terminal": {
      const custom = ensureCustomState();
      return custom.commandsText?.trim()
        ? ok()
        : fail("Ð”Ð¾Ð´Ð°Ð¹ Ð°Ð±Ð¾ Ð¿Ñ–Ð´Ñ‚Ð²ÐµÑ€Ð´ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸ Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÑƒ.");
    }
    default:
      return ok();
  }

  function ok() {
    return { allow: true };
  }
  function fail(message) {
    return { allow: false, message };
  }
}

function generateDevBrief() {
  const type = BOT_TYPES.find((item) => item.id === state.choices.botType);
  const mode = MODE_OPTIONS.find((item) => item.id === state.choices.mode);
  const environment = ENVIRONMENTS.find(
    (item) => item.id === state.choices.environment
  );
  const backend = BACKEND_OPTIONS.find(
    (item) => item.id === state.choices.backend
  );

  return [
    `Ð¢Ð¸Ð¿ Ð±Ð¾Ñ‚Ð°: ${
      type ? `${type.title} (${type.description})` : "Ñ‰Ðµ Ð½Ðµ Ð¾Ð±Ñ€Ð°Ð½Ð¾"
    }.`,
    `Ð ÐµÐ¶Ð¸Ð¼ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸: ${mode ? mode.title : "Ñ‰Ðµ Ð½Ðµ Ð¾Ð±Ñ€Ð°Ð½Ð¾"}.`,
    `Ð¡ÐµÑ€ÐµÐ´Ð¾Ð²Ð¸Ñ‰Ðµ: ${environment ? environment.title : "Ñ‰Ðµ Ð½Ðµ Ð¾Ð±Ñ€Ð°Ð½Ð¾"}.`,
    `ÐšÐ¾Ð¼Ð°Ð½Ð´Ð¸: ${
      state.commands.length ? state.commands.join(", ") : "/start, /help"
    }.`,
    `Ð‘ÐµÐºÐµÐ½Ð´: ${backend ? backend.title : "JSON (Ð·Ð° Ð·Ð°Ð¼Ð¾Ð²Ñ‡ÑƒÐ²Ð°Ð½Ð½ÑÐ¼)"}.`,
    "ÐœÐ¾Ð²Ð° Ñ–Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑƒ: ÑƒÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ°.",
    "ÐšÐ°Ð½Ð°Ð»: Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ñ– Ñ‡Ð°Ñ‚Ð¸ (dm).",
    "",
    "Ð¦Ñ–Ð»ÑŒ: ÑÑ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ñ€Ð¾Ð±Ð¾Ñ‡Ð¾Ð³Ð¾ Telegram-Ð±Ð¾Ñ‚Ð° Ð· Ð¿Ð¾ÐºÑ€Ð¾ÐºÐ¾Ð²Ð¸Ð¼ Ð½Ð°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½ÑÐ¼.",
    "Ð¡ÐºÐ¾Ð¿Ñ–ÑŽÐ¹ Ñ†ÐµÐ¹ Ð±Ñ€Ð¸Ñ„ Ñƒ ChatGPT Ð°Ð±Ð¾ Codex, Ñ‰Ð¾Ð± Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ñ–Ñ— Ð· ÐºÐ¾Ð´Ñƒ.",
  ].join("\n");
}

function generateManualFilePrompt(entryFile, currentState = state) {
  const type = BOT_TYPES.find(
    (item) => item.id === currentState.choices.botType
  );
  const backend = BACKEND_OPTIONS.find(
    (item) => item.id === currentState.choices.backend
  );

  return [
    `ÐœÐµÐ½Ñ– Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ñ„Ð°Ð¹Ð» ${entryFile}.`,
    `Ð¢Ð¸Ð¿ Ð±Ð¾Ñ‚Ð°: ${
      type ? `${type.title} â€” ${type.description}` : "Ð±Ð°Ð·Ð¾Ð²Ð¸Ð¹ Ð°ÑÐ¸ÑÑ‚ÐµÐ½Ñ‚"
    }.`,
    `ÐšÐ¾Ð¼Ð°Ð½Ð´Ð¸: ${
      currentState.commands.length
        ? currentState.commands.join(", ")
        : "/start, /help"
    }.`,
    `Ð‘ÐµÐºÐµÐ½Ð´/Ð·Ð±ÐµÑ€Ñ–Ð³Ð°Ð½Ð½Ñ: ${
      backend ? backend.title : "JSON (Ð¿Ñ€Ð¾ÑÑ‚Ðµ Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ Ñƒ Ñ„Ð°Ð¹Ð»Ñ–)"
    }.`,
    `ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ð¿Ð¾Ð²Ð½Ð¸Ð¹ ÐºÐ¾Ð´ Ñ„Ð°Ð¹Ð»Ð° ${entryFile} Ð¾Ð´Ð½Ð¸Ð¼ Ð±Ð»Ð¾ÐºÐ¾Ð¼ Ð±ÐµÐ· ÐºÐ¾Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ñ–Ð² Ñ‚Ð° Ð·Ð°Ð¹Ð²Ð¸Ñ… Ð¿Ð¾ÑÑÐ½ÐµÐ½ÑŒ.`,
    "ÐÐ°Ð¿Ñ€Ð¸ÐºÑ–Ð½Ñ†Ñ– ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾ Ð½Ð°Ð³Ð°Ð´Ð°Ð¹, ÑÐº Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸ Ð±Ð¾Ñ‚Ð° (python " + entryFile + ").",
  ].join("\n");
}

function getBackendTitle(currentState = state) {
  const backend = BACKEND_OPTIONS.find(
    (item) => item.id === currentState?.choices?.backend
  );
  return backend ? backend.title : "JSON Ñ„Ð°Ð¹Ð» (Ð·Ð° Ð·Ð°Ð¼Ð¾Ð²Ñ‡ÑƒÐ²Ð°Ð½Ð½ÑÐ¼)";
}

function generateCodePrompt() {
  const entryFile = getEntryFile();
  const manualPrompt = generateManualFilePrompt(entryFile);

  return [
    "Ð¢Ð¸ â€” Ð´Ð¾ÑÐ²Ñ–Ð´Ñ‡ÐµÐ½Ð¸Ð¹ Python-Ñ€Ð¾Ð·Ñ€Ð¾Ð±Ð½Ð¸Ðº. ÐŸÐ¾Ð±ÑƒÐ´ÑƒÐ¹ Telegram-Ð±Ð¾Ñ‚Ð° Ð½Ð° aiogram v3.",
    manualPrompt,
    "ÐÐµ Ð´Ð¾Ð´Ð°Ð²Ð°Ð¹ Ñ–Ð½ÑˆÑ– Ñ„Ð°Ð¹Ð»Ð¸ Ñ‡Ð¸ Ñ€Ð¾Ð·Ñ€Ñ–Ð·Ð½ÐµÐ½Ñ– Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ð¸ â€” Ñ‚Ñ–Ð»ÑŒÐºÐ¸ Ð¿Ð¾Ð²Ð½Ð¸Ð¹ ÐºÐ¾Ð´ Ð·Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¾Ð³Ð¾ Ñ„Ð°Ð¹Ð»Ð°.",
    "ÐŸÑ–ÑÐ»Ñ ÐºÐ¾Ð´Ñƒ Ð´Ð°Ð¹ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ñ–Ñ— Ð· Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚ÐµÐ¹ (pip install -r requirements.txt) Ñ‚Ð° Ð·Ð°Ð¿ÑƒÑÐºÑƒ Ð±Ð¾Ñ‚Ð°.",
    "Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹ Ð´Ñ€ÑƒÐ¶Ð½Ñ– Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ ÑƒÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ¾ÑŽ.",
  ].join("\n");
}

function loadState() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return structuredClone(defaultState);
    const parsed = JSON.parse(raw);
    const merged = Object.assign(structuredClone(defaultState), parsed);
    merged.tools = Object.assign({}, defaultState.tools, merged.tools);
    if (merged.tools.requirements === undefined)
      merged.tools.requirements = false;
    if (merged.tools.env === undefined) merged.tools.env = false;
    if (merged.tools.codespace === undefined) merged.tools.codespace = false;
    if (merged.tools.browser === undefined) merged.tools.browser = false;
    merged.custom = Object.assign(
      structuredClone(defaultCustomState),
      merged.custom || {}
    );
    if (!Array.isArray(merged.custom.files)) merged.custom.files = [];
    if (!merged.custom.diag)
      merged.custom.diag = { description: "", logs: "", prompt: "" };
    if (!merged.choices.entryFile)
      merged.choices.entryFile = ENTRY_FILE_OPTIONS[0].id;
    merged.ui = Object.assign(structuredClone(defaultUiState), merged.ui || {});
    if (!merged.ui.replyVariant) merged.ui.replyVariant = "default";
    if (!merged.ui.inlineVariant) merged.ui.inlineVariant = "default";
    if (typeof merged.ui.replyCustomSpec !== "string")
      merged.ui.replyCustomSpec = "";
    if (typeof merged.ui.inlineCustomSpec !== "string")
      merged.ui.inlineCustomSpec = "";
    ensureExtraModules(merged);
    ensureExtraModuleData(merged);
    return merged;
  } catch (error) {
    console.error("ÐÐµ Ð²Ð´Ð°Ð»Ð¾ÑÑ Ð·Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶Ð¸Ñ‚Ð¸ ÑÑ‚Ð°Ð½", error);
    return structuredClone(defaultState);
  }
}

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

function structuredClone(value) {
  return JSON.parse(JSON.stringify(value));
}
